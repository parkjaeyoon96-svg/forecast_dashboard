# 데이터 조회 최적화 가이드

## 개요
이전 데이터를 조회할 때 매번 파이썬 스크립트를 실행하는 것은 비효율적이므로, 이미 처리된 데이터는 재계산하지 않고 저장된 값을 사용하도록 개선했습니다.

## 데이터 업데이트 주기

### 월별 업데이트 (한 달에 한 번)
- **계획 데이터**: `raw/YYYYMM/plan/plan_YYYYMM_전처리완료.csv`
- **전년 데이터**: `raw/YYYYMM/previous/` (향후 구현)

### 주별 업데이트 (매주)
- **주차별 매출**: `raw/YYYYMM/present/YYYYMMDD/ke30_YYYYMMDD_YYYYMM_전처리완료.csv`
- **월말예상매출**: `raw/YYYYMM/forecast/` (향후 구현)

## 동작 방식

### 1. 이전 데이터 조회
- 사용자가 메인 화면에서 이전 날짜(예: 11/10)를 선택
- 시스템이 해당 날짜의 전처리 완료 파일 존재 여부 확인
- 파일이 있으면:
  - 트리맵 데이터 파일(`treemap_data_YYYYMMDD.js`, `data_YYYYMMDD.js`) 존재 여부 확인
  - 파일이 있으면 **재계산 없이 기존 파일 사용**
  - 파일이 없으면 원본 전처리 파일을 기반으로 트리맵 데이터 생성

### 2. 새 데이터 업데이트
- 11/17에 새 데이터로 업데이트하는 경우:
  - 배치 파일(`당년데이터_처리실행.bat`) 실행
  - 전처리 스크립트가 `raw/202511/present/20251117/` 폴더에 데이터 저장
  - 트리맵 데이터 생성 스크립트가 `public/treemap_data_20251117.js`, `public/data_20251117.js` 생성
  - 이후 11/17 데이터 조회 시 재계산 없이 즉시 로드

### 3. 최적화 로직
- **파일 존재 확인**: 트리맵 데이터 파일이 이미 존재하면 스킵
- **원본 파일 확인**: 원본 전처리 파일이 없으면 에러 반환
- **재계산 방지**: 이전 날짜 조회 시 그 당시 계산된 데이터 사용

## 파일 구조

```
raw/
├── 202511/
│   ├── present/
│   │   ├── 20251110/          # 11/10 데이터 (이전)
│   │   │   └── ke30_20251110_202511_전처리완료.csv
│   │   └── 20251117/          # 11/17 데이터 (최신)
│   │       └── ke30_20251117_202511_전처리완료.csv
│   ├── plan/
│   │   └── plan_202511_전처리완료.csv  # 월별 업데이트
│   └── previous/              # 전년 데이터 (월별)
│       └── ...
└── ...

public/
├── treemap_data_20251110.js   # 11/10 트리맵 데이터 (이전)
├── data_20251110.js           # 11/10 대시보드 데이터 (이전)
├── treemap_data_20251117.js   # 11/17 트리맵 데이터 (최신)
└── data_20251117.js           # 11/17 대시보드 데이터 (최신)
```

## 사용 시나리오

### 시나리오 1: 이전 데이터 조회
1. 사용자가 메인 화면에서 "2025.11.10" 입력
2. 시스템이 `raw/202511/present/20251110/` 폴더 확인
3. 전처리 완료 파일 존재 확인
4. `public/treemap_data_20251110.js`, `public/data_20251110.js` 존재 확인
5. 파일이 있으면 **재계산 없이 즉시 로드** ✅
6. 파일이 없으면 원본 파일 기반으로 트리맵 데이터 생성

### 시나리오 2: 새 데이터 업데이트
1. 11/17에 새 데이터 파일(`ke30_20251117_202511.xlsx`) 준비
2. `당년데이터_처리실행.bat` 실행
3. 전처리 스크립트가 `raw/202511/present/20251117/`에 데이터 저장
4. 트리맵 데이터 생성 스크립트가 `public/`에 JS 파일 생성
5. 이후 11/17 데이터 조회 시 재계산 없이 즉시 로드 ✅

## 장점

1. **성능 향상**: 이전 데이터 조회 시 재계산 없이 즉시 로드
2. **데이터 일관성**: 각 날짜별로 그 당시 계산된 데이터 보존
3. **효율성**: 불필요한 파이썬 스크립트 실행 방지
4. **사용자 경험**: 빠른 데이터 조회 가능


