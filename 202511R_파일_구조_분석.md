# 📊 202511R_M.csv 파일 구조 분석

## 📁 파일 개요

- **파일명**: `202511R_M.csv`
- **브랜드**: M (MLB)
- **데이터 타입**: 계획(Plan) 데이터
- **포맷**: 와이드 포맷 (Wide Format)

---

## 🏗️ 파일 구조

### 1. 헤더 구조 (3행)

```
행 1: Version, F11_2025_R, F11_2025_R, ... (메타데이터)
행 2: 채널, Unassigned, (브랜드) 백화점, (브랜드) 면세점, 직영점(가두), ...
행 3: Measure units, 합계, 합계, 합계, ... (단위 정보)
```

### 2. 데이터 구조 (4행부터)

**첫 번째 컬럼**: `구분` (지표명)
- TAG가 [v+]
- 실판매액 [v+]
- 실판매액 [v-]
- 수수료차감매출 [v-]
- 할인율(%)
- 출고율(%)
- 매출(출고)
- 매출원가
- 재고평가감_환입
- 재고평가감_설정
- 재고자산평가
- 원가
- 매출원가율(%)
- 직접제조원가율(%)
- 매출총이익
- 매출총이익율(%)
- 지급수수료_중간관리수수료
- 지급수수료_중간관리수수료(직영)
- 지급수수료_판매사원도급비(직영)
- 지급수수료_판매사원도급비(면세)
- 지급수수료_물류용역비
- 지급수수료_물류운송비
- 지급수수료_이천보관료
- 지급수수료_카드수수료
- 지급수수료_온라인위탁판매수수료
- 지급수수료_로열티
- 지급임차료_매장(변동)
- 지급임차료_매장(고정)
- 지급임차료_관리비
- 감가상각비_임차시설물
- 직접비
- 직접이익
- 직접이익율(%)
- 영업비
- 영업이익
- 영업이익율(%)

**나머지 컬럼**: 채널별 수치값
- Unassigned
- (브랜드) 백화점
- (브랜드) 면세점
- 직영점(가두)
- 온라인(자사)
- 온라인(제휴)
- 대리점
- 아울렛(직영)
- 사입
- 수출
- 직영(가두)2

---

## 🔄 처리 과정 (process_202511R_plan.py)

### 1. 파일 읽기 (`read_plan_csv()`)
```python
df = pd.read_csv(path, encoding="utf-8-sig")
# 첫 번째 컬럼을 "구분"으로 정규화
# 나머지 컬럼은 채널로 인식
```

### 2. 포맷 판별
- **와이드 포맷**: 채널이 컬럼으로 나열된 형태 (현재 파일)
- **롱 포맷**: 채널이 행으로 나열된 형태

현재 파일은 **와이드 포맷**입니다.

### 3. 채널 정규화
- `(브랜드) 백화점` → `백화점`
- `(브랜드) 면세점` → `면세점`
- `온라인(자사)` → `자사몰`
- `온라인(제휴)` → `제휴몰`
- `직영점(가두)` → `직영점(가두)`
- 등등...

### 4. 직접비 매핑
다음 항목들을 직접비 카테고리로 통합:
- **인건비**: 지급수수료_중간관리수수료, 지급수수료_판매사원도급비 등
- **물류운송비**: 지급수수료_물류용역비, 지급수수료_물류운송비, 지급수수료_이천보관료
- **로열티**: 지급수수료_로열티
- **임차관리비**: 지급임차료_매장(변동), 지급임차료_매장(고정), 지급임차료_관리비
- **감가상각비**: 감가상각비_임차시설물
- **기타**: 기타 직접비 항목들

### 5. 출력 형식
```csv
브랜드,구분,백화점,면세점,직영점(가두),자사몰,제휴몰,대리점,아울렛,사입,수출,직영몰,전체
M,TAG가 [v+],9348281,10918718,2964483,1450138,2571476,6534429,,8547585,171423536,662640,42997751
M,실판매액 [v+],8970000,10600000,2831000,1210000,2489000,6260000,,1828938,71408209,640000,...
```

---

## 📋 주요 지표 설명

### 매출 관련
- **TAG가 [v+]**: 태그가(판매가) 합계 (양수)
- **실판매액 [v+]**: 실제 판매액 (양수)
- **실판매액 [v-]**: 실제 판매액 (음수, 반품 등)
- **수수료차감매출 [v-]**: 수수료를 차감한 매출

### 원가 관련
- **매출원가**: 판매한 상품의 원가
- **원가**: 최종 원가 (재고평가감 반영)
- **매출원가율(%)**: 매출원가 / 매출 × 100

### 이익 관련
- **매출총이익**: 실판매액 - 매출원가
- **직접이익**: 매출총이익 - 직접비
- **영업이익**: 직접이익 - 영업비

### 직접비 세부 항목
- **인건비**: 중간관리수수료, 판매사원도급비 등
- **물류운송비**: 물류용역비, 물류운송비, 이천보관료
- **로열티**: 로열티 지급
- **임차관리비**: 매장 임차료, 관리비
- **감가상각비**: 임차시설물 감가상각

---

## 🔍 데이터 예시

### 행 4: TAG가 [v+]
```
구분: TAG가 [v+]
Unassigned: 214421287
(브랜드) 백화점: 9348281
(브랜드) 면세점: 10918718
직영점(가두): 2964483
...
```

### 행 5: 실판매액 [v+]
```
구분: 실판매액 [v+]
Unassigned: 106237146
(브랜드) 백화점: 8970000
(브랜드) 면세점: 10600000
...
```

### 행 8: 할인율(%)
```
구분: 할인율(%)
Unassigned: 50.45
(브랜드) 백화점: 4.05
(브랜드) 면세점: 2.92
...
```

---

## ⚙️ 처리 스크립트 동작

1. **파일 읽기**: `read_plan_csv()` - 첫 3행 헤더 처리, 첫 컬럼을 "구분"으로 정규화
2. **포맷 판별**: 와이드 포맷으로 인식 (채널이 컬럼으로 나열)
3. **채널 매핑**: 채널마스터를 사용하여 표준 채널명으로 변환
4. **직접비 통합**: 직접비 마스터를 사용하여 세부 항목을 대분류로 통합
5. **집계**: 브랜드별로 모든 지표를 집계
6. **출력**: 표준 형식으로 CSV 저장

---

## 📝 참고사항

- **인코딩**: UTF-8 with BOM (utf-8-sig)
- **빈 값**: 일부 채널은 데이터가 없을 수 있음 (예: 아울렛)
- **브랜드 코드**: 파일명에서 추출 (`202511R_M.csv` → `M`)
- **출력 위치**: `raw/202511/plan/plan_202511_전처리완료.csv` (새 구조)



