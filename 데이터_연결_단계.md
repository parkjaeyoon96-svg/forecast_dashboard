# 📊 Dashboard.html 데이터 연결 단계

> ⚠️ **중요**: Dashboard.html 코드는 **절대 변경하지 않습니다**. 데이터만 연결합니다!

---

## 🎯 현재 상태

```
✅ Dashboard.html (완성된 대시보드) - public/Dashboard.html
✅ Next.js에서 iframe으로 표시 중
❌ data.js (실제 데이터) - 아직 없음
```

---

## 📋 순차적 단계

### STEP 1: Dashboard.html이 필요로 하는 데이터 구조 파악

**위치:** Dashboard.html은 다음 파일을 로드합니다:
```html
<script defer src="./data.js"></script>
```

**필요한 작업:**
1. Dashboard.html에서 어떤 데이터 변수를 사용하는지 확인
2. data.js에서 정의해야 할 변수 목록 작성

**확인 방법:**
```javascript
// Dashboard.html 내부 JavaScript에서 사용하는 데이터
// 예: window.brandData, window.realData 등
```

---

### STEP 2: 데이터 소스 확인

**현재 가능한 데이터 소스:**

#### A. Python 스크립트로 생성된 데이터
```
📁 scripts/
  ├── data_processor.py      # 데이터 처리
  ├── process_ke30.py        # SAP KE30 처리
  └── exporter.py            # data.js 생성 (추정)
```

#### B. CSV 파일
```
📁 raw/
  ├── sap_ke30_sample.csv    # SAP 샘플
  └── PA1000_250824.xlsx     # 기타 데이터
```

#### C. 직접 생성
- Python 스크립트를 실행해서 data.js 생성
- 또는 수동으로 data.js 작성

**질문:**
- 기존에 data.js를 어떻게 생성했나요?
- Python 스크립트 `exporter.py` 같은 파일이 있나요?

---

### STEP 3: data.js 파일 구조 파악

**목표:** Dashboard.html이 기대하는 정확한 데이터 형식 파악

**방법 1: 기존 data.js가 있다면**
```bash
# 기존 data.js 파일 찾기
dir /s data.js
```

**방법 2: Dashboard.html 코드 분석**
```javascript
// Dashboard.html 내부에서 사용하는 데이터 패턴 찾기
// 예시:
window.brandData = { ... }
window.realData = { ... }
```

**예상 구조:**
```javascript
// data.js
window.dashboardData = {
  lastUpdated: "2025년 8월 17일 09:00",
  insights: { ... }
};

window.brandData = {
  'MLB': { name: 'MLB', color: '#dc2626' },
  'MLB_KIDS': { name: 'MLB Kids', color: '#eab308' },
  // ...
};

window.realData = {
  'MLB': {
    '당년': { '백화점': [0,0,0,50,52,...], ... },
    '전년': { '백화점': [0,0,0,52,54,...], ... }
  },
  // ...
};
```

---

### STEP 4: 데이터 생성 방법 선택

#### 옵션 A: Python 스크립트 실행 (추천)

**장점:**
- 자동화된 데이터 생성
- CSV → data.js 변환
- 기존 로직 재사용

**필요 파일:**
```python
# scripts/generate_data_js.py (신규 생성 또는 기존 찾기)
import json
import csv

# 1. CSV 읽기
# 2. 데이터 변환
# 3. data.js 생성
```

**실행 방법:**
```bash
python scripts/generate_data_js.py
# 결과: public/data.js 생성
```

#### 옵션 B: Node.js API로 동적 생성

**장점:**
- CSV 파일 변경 시 자동 반영
- 실시간 데이터 연동

**구조:**
```
public/data.js (동적 생성)
  ← GET /api/generate-data-js
      ← raw/sap_ke30.csv 읽기
      ← 데이터 변환
      ← JavaScript 형식으로 출력
```

#### 옵션 C: 수동 작성

**장점:**
- 빠른 테스트
- 간단한 구조

**단점:**
- 자동화 안됨
- 유지보수 어려움

---

### STEP 5: 데이터 변환 로직 작성

**입력:** CSV 파일 (SAP KE30, Snowflake 등)
```csv
자재코드,자재명,수량,매출액,매출원가,영업이익,일자
MAT001,제품A,100,10000000,6000000,2000000,2024-11-01
```

**출력:** data.js
```javascript
window.realData = {
  'MLB': {
    '당년': {
      '백화점': [0, 0, 0, 0, 50, 52, 48, 51, 49],
      // 주차별 데이터
    }
  }
};
```

**변환 규칙:**
- 자재명 → 브랜드 매핑
- 일자 → 주차 계산
- 매출액 → 억원 단위 변환
- 채널별 분류

---

### STEP 6: data.js 생성 및 배치

**생성 위치:**
```
public/data.js  ← Dashboard.html이 로드하는 위치
```

**검증:**
```javascript
// 브라우저 콘솔에서 확인
console.log(window.brandData);
console.log(window.realData);
```

---

### STEP 7: Dashboard.html에서 데이터 확인

**테스트 순서:**

1. **브라우저 열기**
   ```
   http://localhost:3000/dashboard
   ```

2. **개발자 도구 (F12) → Console**
   ```javascript
   // 데이터 로드 확인
   console.log('brandData:', window.brandData);
   console.log('realData:', window.realData);
   ```

3. **차트 표시 확인**
   - KPI 카드 숫자가 표시되는지
   - 차트가 그려지는지
   - 오류 메시지 없는지

---

### STEP 8: 데이터 업데이트 자동화

**목표:** CSV 파일 변경 시 자동으로 data.js 갱신

#### 방법 1: 배치 파일
```batch
@echo off
echo 데이터 업데이트 중...
python scripts/generate_data_js.py
echo 완료!
pause
```

#### 방법 2: npm 스크립트
```json
// package.json
{
  "scripts": {
    "update-data": "python scripts/generate_data_js.py",
    "dev": "npm run update-data && next dev"
  }
}
```

#### 방법 3: 파일 감시
```javascript
// scripts/watch-csv.js
const chokidar = require('chokidar');

chokidar.watch('raw/*.csv').on('change', () => {
  console.log('CSV 변경 감지, data.js 갱신 중...');
  // Python 스크립트 실행
});
```

---

## 🔍 필요한 정보

다음 단계로 진행하기 위해 확인이 필요합니다:

### ❓ 질문 1: 기존 data.js 생성 방법
- [ ] Python 스크립트가 있나요? (어떤 파일?)
- [ ] 수동으로 만들었나요?
- [ ] 다른 도구를 사용했나요?

### ❓ 질문 2: 데이터 형식
- [ ] 기존 data.js 파일이 어디 있나요?
- [ ] 없다면 샘플을 만들어야 하나요?

### ❓ 질문 3: 데이터 소스
- [ ] SAP KE30 CSV만 사용하나요?
- [ ] 다른 CSV 파일도 사용하나요?
- [ ] Excel 파일도 사용하나요?

### ❓ 질문 4: 브랜드 정보
- [ ] 브랜드 목록: MLB, MLB Kids, DISCOVERY, DUVETICA, SERGIO, SUPRA
- [ ] 맞나요? 추가/변경 필요한가요?

### ❓ 질문 5: 채널 정보
- [ ] 채널 목록: 백화점, 면세점, 직영점, 자사몰, 제휴몰, 대리점
- [ ] 맞나요? 추가/변경 필요한가요?

---

## 📊 데이터 구조 템플릿

### 최소 필수 구조
```javascript
// public/data.js

// 1. 브랜드 정보
window.brandData = {
  'MLB': { name: 'MLB', color: '#dc2626' },
  'MLB_KIDS': { name: 'MLB Kids', color: '#eab308' },
  'DISCOVERY': { name: 'DISCOVERY', color: '#3b82f6' },
  'DUVETICA': { name: 'DUVETICA', color: '#1f2937' },
  'SERGIO': { name: 'SERGIO', color: '#10b981' },
  'SUPRA': { name: 'SUPRA', color: '#8b5cf6' }
};

// 2. 실제 매출 데이터 (주차별)
window.realData = {
  'MLB': {
    '당년': {
      '백화점': [0, 0, 0, 0, 50, 52, 48, 51, 49],  // 주차별
      '면세점': [0, 0, 0, 0, 60, 62, 58, 63, 61],
      // ... 다른 채널
    },
    '전년': {
      '백화점': [0, 0, 0, 0, 52, 54, 50, 53, 51],
      '면세점': [0, 0, 0, 0, 62, 64, 60, 65, 63],
      // ... 다른 채널
    }
  },
  // ... 다른 브랜드
};

// 3. 대시보드 메타데이터
window.dashboardData = {
  lastUpdated: "2025년 8월 17일 09:00",
  insights: {
    overview: "매출 분석 내용..."
  }
};
```

---

## 🎯 다음 단계

### 당장 할 일:
1. **기존 data.js 파일 찾기**
2. **또는 Dashboard.html이 기대하는 데이터 구조 정확히 파악**
3. **데이터 생성 방법 결정 (Python vs Node.js vs 수동)**

### 준비 완료 후:
1. data.js 생성 스크립트 작성
2. CSV → data.js 변환 로직 구현
3. public/data.js 배치
4. 테스트 및 검증

---

## 💡 권장 접근법

### 🥇 최선: Python 스크립트 자동화
```
CSV 파일 → Python 스크립트 → data.js → Dashboard.html
```

**이유:**
- 재사용 가능
- 자동화 용이
- 기존 로직 활용

### 🥈 차선: 빠른 테스트
```
샘플 data.js 수동 작성 → 테스트 → 이후 자동화
```

**이유:**
- 빠른 검증
- 데이터 구조 확인

---

**다음 단계를 진행하려면 위 질문들에 답변해주세요!** 

그러면 정확한 데이터 연결 방법을 알려드리겠습니다. 🚀





