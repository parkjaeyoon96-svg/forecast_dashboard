# 트리맵 데이터 생성 완료 ✅

## 📋 작업 요약

**작업일:** 2025-11-16  
**작업 내용:** 채널별, 아이템별 트리맵 데이터 생성 및 대시보드 연동 준비

---

## ✅ 생성된 파일

### 1. Python 스크립트
```
scripts/create_treemap_data.py
```
- 전처리 완료된 KE30 데이터 읽기
- 브랜드, 채널명, 아이템_중분류별 실판매액 집계
- JSON 형식으로 변환
- JavaScript 파일 자동 생성

### 2. 배치 파일
```
트리맵데이터_생성.bat
```
- Python 스크립트 실행
- 간편한 더블클릭 실행

### 3. 출력 데이터 파일
```
public/treemap_data.js
```
- 브랜드별, 채널별, 아이템별 실판매액 데이터
- 브라우저에서 바로 사용 가능한 JavaScript 형식

### 4. 가이드 문서
```
트리맵_데이터_연동_가이드.md
```
- 상세한 사용 방법
- 대시보드 연동 코드 예시
- 문제 해결 가이드

---

## 📊 데이터 구조

### JSON 형식
```javascript
{
  "I": {  // 브랜드 코드 (MLB KIDS)
    "백화점": {  // 채널명
      "Headwear": 92804140,      // 아이템_중분류: 실판매액
      "과시즌의류": 56917490,
      "당시즌의류": 908506230,
      "Shoes": 194344190,
      "Bag": 33312910,
      "Acc_etc": 9271390
    },
    "대리점": {
      ...
    }
  },
  "M": {  // MLB
    ...
  }
}
```

### 계층 구조
```
브랜드 (I, M, X, V, ST, W)
  └─ 채널 (백화점, 대리점, 면세점 등)
      └─ 아이템 (Headwear, Outer, Inner 등)
          └─ 실판매액
```

---

## 📈 데이터 통계

### 총 집계
- **브랜드 수:** 6개
- **총 데이터 행:** 276행
- **총 매출:** 61,539,630,467원

### 브랜드별 매출

| 순위 | 브랜드 코드 | 브랜드명 | 총 매출 | 비율 |
|-----|-----------|---------|---------|------|
| 1 | X | REEBOK CLASSIC | 28,085,669,084원 | 45.6% |
| 2 | M | MLB | 25,937,334,630원 | 42.1% |
| 3 | I | MLB KIDS | 4,557,986,654원 | 7.4% |
| 4 | V | NBA | 2,470,338,880원 | 4.0% |
| 5 | ST | STARTER | 377,925,160원 | 0.6% |
| 6 | W | WITHMUU | 110,376,059원 | 0.2% |

### MLB KIDS (I) 상세

**총 매출:** 4,557,986,654원  
**채널 수:** 10개

| 순위 | 채널명 | 매출 | 비율 |
|-----|--------|------|------|
| 1 | 백화점 | 1,295,156,350원 | 28.4% |
| 2 | 사입 | 1,114,034,370원 | 24.4% |
| 3 | 제휴몰 | 645,350,070원 | 14.2% |
| 4 | 대리점 | 412,323,550원 | 9.0% |
| 5 | 수출 | 359,362,834원 | 7.9% |

**백화점 아이템 구성:**
- 당시즌의류: 908,506,230원 (70.1%)
- Shoes: 194,344,190원 (15.0%)
- Headwear: 92,804,140원 (7.2%)
- 과시즌의류: 56,917,490원 (4.4%)
- Bag: 33,312,910원 (2.6%)
- Acc_etc: 9,271,390원 (0.7%)

---

## 🚀 사용 방법

### 1단계: 데이터 생성
```cmd
트리맵데이터_생성.bat 실행
```

### 2단계: 대시보드 연동
```html
<!-- public/Dashboard.html -->
<head>
    <script src="./treemap_data.js"></script>
</head>
```

### 3단계: 트리맵 표시
```javascript
// 브랜드 선택 시
const brandCode = 'I';  // MLB KIDS
const brandData = window.channelItemSalesData[brandCode];

// 채널별 트리맵
createChannelTreemap(brandData);

// 아이템별 트리맵
createItemTreemap(brandData);
```

---

## 🎯 주요 기능

### 1. 채널별 매출 구성
- 브랜드별 채널 매출 현황
- 클릭 시 아이템으로 드릴다운

### 2. 아이템별 매출 구성
- 브랜드별 아이템 매출 현황
- 카테고리별 비율 확인

### 3. 드릴다운 기능
```
브랜드 선택
  └─ 채널별 트리맵 표시
      └─ 채널 클릭
          └─ 해당 채널의 아이템별 구성 표시
```

---

## 📂 파일 위치

```
Project_Forcast/
├── scripts/
│   └── create_treemap_data.py          (생성 스크립트)
├── public/
│   └── treemap_data.js                 (출력 데이터)
├── raw/
│   └── ke30_20251114_202511_전처리완료.csv  (입력 데이터)
├── 트리맵데이터_생성.bat                 (실행 파일)
├── 트리맵_데이터_연동_가이드.md          (상세 가이드)
└── 트리맵_완료_요약.md                   (이 파일)
```

---

## 🔄 데이터 업데이트 절차

### 새로운 KE30 데이터 반영 시

1. **KE30 전처리 실행**
```cmd
당년데이터_처리실행.bat
```

2. **트리맵 데이터 생성**
```cmd
트리맵데이터_생성.bat
```

3. **브라우저 새로고침**
```
Ctrl + F5 (강제 새로고침)
```

---

## ✅ 검증 완료 사항

- [x] 전처리 데이터 정상 읽기
- [x] 브랜드, 채널, 아이템별 집계 정확성
- [x] JSON 구조 정확성
- [x] JavaScript 파일 생성
- [x] 브라우저 호환성 (window 객체 사용)
- [x] 한글 인코딩 (UTF-8)
- [x] 숫자 포맷팅 (쉼표, 소수점)

---

## 🎨 대시보드 연동 예시

### HTML 구조
```html
<div id="brandButtons">
    <button onclick="loadBrandData('I')">MLB KIDS</button>
    <button onclick="loadBrandData('M')">MLB</button>
    <button onclick="loadBrandData('X')">REEBOK CLASSIC</button>
</div>

<div id="channelTreemap"></div>
<div id="itemTreemap"></div>
```

### JavaScript 함수
```javascript
function loadBrandData(brandCode) {
    const brandName = window.brandNames[brandCode];
    const brandData = window.channelItemSalesData[brandCode];
    
    // 채널별 트리맵
    createChannelTreemapWithDrilldown(brandData);
    
    // 아이템별 트리맵
    createItemTreemap(brandData);
}
```

---

## 📊 시각화 옵션

### Plotly 트리맵
- 계층 구조 표현
- 드릴다운 기능
- 인터랙티브 호버
- 색상 테마 커스터마이징

### 표시 정보
- 라벨 (채널명/아이템명)
- 값 (실판매액)
- 비율 (전체 대비 %)
- 호버 툴팁 (상세 정보)

---

## 🔍 데이터 품질

### 필터링 적용
- ✅ 실판매액 > 0 (음수 및 0원 제외)
- ✅ NaN 값 제거
- ✅ 유효한 브랜드, 채널, 아이템만 포함

### 집계 정확성
- ✅ 브랜드별 합계 검증
- ✅ 채널별 합계 검증
- ✅ 전체 합계 일치 확인

---

## 🎉 완료!

모든 트리맵 데이터가 성공적으로 생성되었습니다!

### 다음 단계
1. **대시보드에 트리맵 구현**
2. **드릴다운 기능 추가**
3. **인터랙티브 필터 추가**
4. **KPI와 연동**

---

## 📞 참고 문서

- **상세 가이드:** `트리맵_데이터_연동_가이드.md`
- **전처리 가이드:** `KE30_전처리_가이드.md`
- **Python 스크립트:** `scripts/create_treemap_data.py`

---

**작성일:** 2025-11-16  
**상태:** ✅ 완료  
**다음 작업:** 대시보드 트리맵 UI 구현
