# ğŸ“Š ì›”ë§ˆê°ì˜ˆìƒì†ìµ ì €ì¥ ìœ„ì¹˜ ê¶Œì¥ì‚¬í•­

## ğŸ” ê³„ì‚° ë¡œì§ ìš”ì•½

1. **ë¸Œëœë“œë³„ ì „ë…„ ë™ì£¼ì°¨ ë§¤ì¶œì•¡** â†’ Snowflakeì—ì„œ ì¡°íšŒ
2. **ì£¼ì°¨ë³„ ì§„í–‰ìœ¨ë¡œ í™˜ì‚°**
3. **ë‹¹ì›” ì¼ìˆ˜ì—ì„œ í™˜ì‚°**
4. **ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡/ì›”ìˆ˜ * í™˜ì‚°ì¼ìˆ˜**

---

## ğŸ“ ê¶Œì¥ í´ë” êµ¬ì¡°

### ì˜µì…˜ 1: `forecast/` í´ë” (âœ… **ê¶Œì¥**)

```
raw/
â”œâ”€â”€ 202511/
â”‚   â”œâ”€â”€ present/                     # ë‹¹ë…„ ì‹¤ì œ ë°ì´í„° (ì£¼ì°¨ë³„)
â”‚   â”‚   â”œâ”€â”€ 20251117/
â”‚   â”‚   â””â”€â”€ 20251124/
â”‚   â”œâ”€â”€ previous/                    # ì „ë…„ ì‹¤ì œ ë°ì´í„° (ì›”ë³„)
â”‚   â”‚   â””â”€â”€ ke30_prev_202411_ì „ì²˜ë¦¬ì™„ë£Œ.csv
â”‚   â”œâ”€â”€ plan/                        # ê³„íš ë°ì´í„° (ì›”ë³„)
â”‚   â”‚   â””â”€â”€ plan_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
â”‚   â””â”€â”€ forecast/                    # ì˜ˆìƒ/ì˜ˆì¸¡ ë°ì´í„° (ì›”ë³„) â­ ì‹ ê·œ
â”‚       â””â”€â”€ forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
â”‚
â””â”€â”€ 202512/
    â”œâ”€â”€ present/
    â”œâ”€â”€ previous/
    â”œâ”€â”€ plan/
    â””â”€â”€ forecast/
```

**íŒŒì¼ëª… í˜•ì‹:**
- `forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv`

**ì´ìœ :**
- âœ… **ëª…í™•í•œ ì˜ë¯¸**: ì˜ˆìƒ/ì˜ˆì¸¡ ë°ì´í„°ì„ì„ ëª…í™•íˆ í‘œí˜„
- âœ… **ë°ì´í„° íƒ€ì… êµ¬ë¶„**: ì‹¤ì œ(present), ì „ë…„(previous), ê³„íš(plan), ì˜ˆìƒ(forecast)
- âœ… **í™•ì¥ì„±**: í–¥í›„ ë‹¤ë¥¸ ì˜ˆì¸¡ ë°ì´í„°ë„ ì¶”ê°€ ê°€ëŠ¥
- âœ… **ì¼ê´€ì„±**: ê¸°ì¡´ êµ¬ì¡°ì™€ ë™ì¼í•œ íŒ¨í„´

---

### ì˜µì…˜ 2: `calculated/` í´ë”

```
raw/202511/calculated/
â””â”€â”€ monthly_forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
```

**ì´ìœ :**
- âœ… ê³„ì‚°ëœ ë°ì´í„°ì„ì„ ëª…í™•íˆ í‘œí˜„
- âš ï¸ í•˜ì§€ë§Œ "forecast"ê°€ ë” ì§ê´€ì 

---

### ì˜µì…˜ 3: `plan/` í´ë”ì— í†µí•© (ë¹„ê¶Œì¥)

```
raw/202511/plan/
â”œâ”€â”€ plan_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv          # ê³„íš ë°ì´í„°
â””â”€â”€ forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv       # ì˜ˆìƒ ë°ì´í„°
```

**ì´ìœ :**
- âš ï¸ ê³„íšê³¼ ì˜ˆìƒì€ ë‹¤ë¥¸ ê°œë… (ê³„íš=ëª©í‘œ, ì˜ˆìƒ=ì‹¤ì œ ê¸°ë°˜ ì˜ˆì¸¡)
- âš ï¸ í˜¼ë™ ê°€ëŠ¥ì„±

---

## ğŸ“‹ ê¶Œì¥ êµ¬ì¡° ìƒì„¸

### í´ë” êµ¬ì¡°

```
raw/
â””â”€â”€ 202511/
    â”œâ”€â”€ present/                     # ë‹¹ë…„ ì‹¤ì œ ë°ì´í„°
    â”‚   â””â”€â”€ 20251117/
    â”‚       â””â”€â”€ ke30_20251117_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
    â”‚
    â”œâ”€â”€ previous/                     # ì „ë…„ ì‹¤ì œ ë°ì´í„°
    â”‚   â””â”€â”€ ke30_prev_202411_ì „ì²˜ë¦¬ì™„ë£Œ.csv
    â”‚
    â”œâ”€â”€ plan/                         # ê³„íš ë°ì´í„° (ëª©í‘œ)
    â”‚   â””â”€â”€ plan_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
    â”‚
    â””â”€â”€ forecast/                     # ì˜ˆìƒ ë°ì´í„° (ê³„ì‚° ê²°ê³¼) â­
        â””â”€â”€ forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv
```

---

## ğŸ“Š ì˜ˆìƒ ë°ì´í„° íŒŒì¼ êµ¬ì¡°

### CSV êµ¬ì¡° ì˜ˆì‹œ

```csv
ë¸Œëœë“œ,êµ¬ë¶„,ë°±í™”ì ,ë©´ì„¸ì ,ì§ì˜ì (ê°€ë‘),ìì‚¬ëª°,ì œíœ´ëª°,ëŒ€ë¦¬ì ,ì•„ìš¸ë ›,ì‚¬ì…,ìˆ˜ì¶œ,ì§ì˜ëª°,ì „ì²´
M,ì˜ˆìƒë§¤ì¶œ,9348281,10918718,2964483,1450138,2571476,6534429,,8547585,171423536,662640,42997751
M,ì˜ˆìƒë§¤ì¶œì›ê°€,1569165,1834778,498312,241176,432199,1096948,,1539200,31791564,111254,...
M,ì˜ˆìƒë§¤ì¶œì´ì´ìµ,7779116,9083940,2466171,120962,2139277,5437481,,7016385,139631972,551386,...
M,ì˜ˆìƒì§ì ‘ì´ìµ,2186529,2803070,905690,727153,1078196,2192581,-11799,60544,32475824,158708,...
M,ì˜ˆìƒì˜ì—…ì´ìµ,1285057,1737724,483080,506063,798758,1564574,-11812,-122936,32458340,67312,...
MLB,ì˜ˆìƒë§¤ì¶œ,...,...
MLB_KIDS,ì˜ˆìƒë§¤ì¶œ,...,...
```

**ë˜ëŠ” ë” ìƒì„¸í•œ êµ¬ì¡°:**

```csv
ë¸Œëœë“œ,êµ¬ë¶„,ì±„ë„,ì „ë…„ë™ì£¼ì°¨ë§¤ì¶œ,ì£¼ì°¨ì§„í–‰ìœ¨,ë‹¹ì›”ì¼ìˆ˜,í™˜ì‚°ì¼ìˆ˜,ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡,ì›”ìˆ˜,ìµœì¢…ì˜ˆìƒê¸ˆì•¡
M,ì˜ˆìƒë§¤ì¶œ,ë°±í™”ì ,9348281,0.65,30,19.5,9348281,30,6076382.65
M,ì˜ˆìƒë§¤ì¶œ,ë©´ì„¸ì ,10918718,0.65,30,19.5,10918718,30,7097166.7
...
```

---

## ğŸ”§ path_utils.py ì¶”ê°€ í•¨ìˆ˜

```python
def get_forecast_dir(year_month: str) -> str:
    """
    ì˜ˆìƒ ë°ì´í„° ë””ë ‰í† ë¦¬ ê²½ë¡œ ë°˜í™˜
    êµ¬ì¡°: raw/YYYYMM/forecast/
    
    Args:
        year_month: YYYYMM í˜•ì‹ì˜ ì—°ì›” ë¬¸ìì—´ (ì˜ˆ: "202511")
    
    Returns:
        str: ë””ë ‰í† ë¦¬ ê²½ë¡œ
    """
    return os.path.join(RAW_DIR, year_month, "forecast")

def get_forecast_file_path(year_month: str, filename: str = None) -> str:
    """
    ì˜ˆìƒ ë°ì´í„° íŒŒì¼ ê²½ë¡œ ë°˜í™˜
    
    Args:
        year_month: YYYYMM í˜•ì‹ì˜ ì—°ì›” ë¬¸ìì—´ (ì˜ˆ: "202511")
        filename: íŒŒì¼ëª… (ì—†ìœ¼ë©´ ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±)
    
    Returns:
        str: íŒŒì¼ ì „ì²´ ê²½ë¡œ
    """
    if filename is None:
        filename = f"forecast_{year_month}_ì „ì²˜ë¦¬ì™„ë£Œ.csv"
    return os.path.join(get_forecast_dir(year_month), filename)
```

---

## ğŸ“ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ

### ì›”ë§ˆê°ì˜ˆìƒì†ìµ ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸

```python
# scripts/calculate_monthly_forecast.py

import os
import pandas as pd
from path_utils import get_forecast_file_path, get_previous_year_dir
from datetime import datetime

def calculate_monthly_forecast(year_month: str):
    """
    ì›”ë§ˆê°ì˜ˆìƒì†ìµ ê³„ì‚°
    
    1. ë¸Œëœë“œë³„ ì „ë…„ ë™ì£¼ì°¨ ë§¤ì¶œì•¡ (Snowflakeì—ì„œ ì¡°íšŒ)
    2. ì£¼ì°¨ë³„ ì§„í–‰ìœ¨ë¡œ í™˜ì‚°
    3. ë‹¹ì›” ì¼ìˆ˜ì—ì„œ í™˜ì‚°
    4. ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡/ì›”ìˆ˜ * í™˜ì‚°ì¼ìˆ˜
    """
    # 1. Snowflakeì—ì„œ ì „ë…„ ë™ì£¼ì°¨ ë§¤ì¶œì•¡ ì¡°íšŒ
    # (ì‹¤ì œ êµ¬í˜„ ì‹œ Snowflake ì—°ê²° í•„ìš”)
    prev_year_sales = get_previous_year_week_sales_from_snowflake(year_month)
    
    # 2. ì£¼ì°¨ë³„ ì§„í–‰ìœ¨ ê³„ì‚°
    week_progress_rate = calculate_week_progress_rate(year_month)
    
    # 3. ë‹¹ì›” ì¼ìˆ˜ ê³„ì‚°
    days_in_month = get_days_in_month(year_month)
    
    # 4. ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡ ê³„ì‚°
    forecast_data = []
    for brand, sales_data in prev_year_sales.items():
        for channel, amount in sales_data.items():
            # í™˜ì‚°ì¼ìˆ˜ = ë‹¹ì›”ì¼ìˆ˜ * ì£¼ì°¨ì§„í–‰ìœ¨
            converted_days = days_in_month * week_progress_rate
            
            # ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡ = ì „ë…„ë™ì£¼ì°¨ë§¤ì¶œ * (í™˜ì‚°ì¼ìˆ˜ / ì›”ìˆ˜)
            monthly_forecast = amount * (converted_days / days_in_month)
            
            forecast_data.append({
                'ë¸Œëœë“œ': brand,
                'ì±„ë„': channel,
                'ì „ë…„ë™ì£¼ì°¨ë§¤ì¶œ': amount,
                'ì£¼ì°¨ì§„í–‰ìœ¨': week_progress_rate,
                'ë‹¹ì›”ì¼ìˆ˜': days_in_month,
                'í™˜ì‚°ì¼ìˆ˜': converted_days,
                'ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡': monthly_forecast
            })
    
    # 5. ê²°ê³¼ ì €ì¥
    df = pd.DataFrame(forecast_data)
    output_path = get_forecast_file_path(year_month)
    os.makedirs(os.path.dirname(output_path), exist_ok=True)
    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    
    print(f"[OK] ì›”ë§ˆê°ì˜ˆìƒì†ìµ ì €ì¥: {output_path}")
    return output_path
```

---

## ğŸ¯ ìµœì¢… ê¶Œì¥ì‚¬í•­

### âœ… `raw/YYYYMM/forecast/` í´ë” ì‚¬ìš©

**ì´ìœ :**
1. **ëª…í™•í•œ ì˜ë¯¸**: ì˜ˆìƒ/ì˜ˆì¸¡ ë°ì´í„°ì„ì„ ëª…í™•íˆ í‘œí˜„
2. **ë°ì´í„° íƒ€ì… êµ¬ë¶„**: 
   - `present/` - ë‹¹ë…„ ì‹¤ì œ
   - `previous/` - ì „ë…„ ì‹¤ì œ
   - `plan/` - ê³„íš(ëª©í‘œ)
   - `forecast/` - ì˜ˆìƒ(ê³„ì‚°)
3. **ì¼ê´€ì„±**: ê¸°ì¡´ êµ¬ì¡°ì™€ ë™ì¼í•œ íŒ¨í„´
4. **í™•ì¥ì„±**: í–¥í›„ ë‹¤ë¥¸ ì˜ˆì¸¡ ë°ì´í„° ì¶”ê°€ ê°€ëŠ¥

**íŒŒì¼ëª…:**
- `forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv`

**ê²½ë¡œ ì˜ˆì‹œ:**
- `raw/202511/forecast/forecast_202511_ì „ì²˜ë¦¬ì™„ë£Œ.csv`

---

## ğŸ“‹ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `path_utils.py`ì— `get_forecast_dir()`, `get_forecast_file_path()` í•¨ìˆ˜ ì¶”ê°€
- [ ] `scripts/calculate_monthly_forecast.py` ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- [ ] Snowflake ì—°ê²° ë¡œì§ êµ¬í˜„
- [ ] ì£¼ì°¨ë³„ ì§„í–‰ìœ¨ ê³„ì‚° ë¡œì§ êµ¬í˜„
- [ ] ì›”ì¤‘ì˜ˆìƒê¸ˆì•¡ ê³„ì‚° ë¡œì§ êµ¬í˜„
- [ ] ê²°ê³¼ CSV ì €ì¥ ë¡œì§ êµ¬í˜„
- [ ] ëŒ€ì‹œë³´ë“œì—ì„œ forecast ë°ì´í„° ë¡œë“œ ë¡œì§ ì¶”ê°€



