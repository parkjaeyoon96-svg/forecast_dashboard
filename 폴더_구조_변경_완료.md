# 📁 폴더 구조 변경 완료

## ✅ 변경된 구조

```
raw/
├── 202511/                          # 2025년 11월
│   ├── present/                     # 당년 데이터 (주차별)
│   │   ├── 20251117/
│   │   │   └── ke30_20251117_202511_전처리완료.csv
│   │   └── 20251124/
│   │       └── ke30_20251124_202511_전처리완료.csv
│   ├── previous/                    # 전년 데이터 (월별 1개)
│   │   └── ke30_prev_202411_전처리완료.csv
│   └── plan/                        # 계획 데이터 (월별 1개)
│       └── plan_202511_전처리완료.csv
│
└── 202512/                          # 2025년 12월
    ├── present/
    ├── previous/
    └── plan/
```

---

## 🔧 수정된 파일 목록

### 1. **scripts/path_utils.py** (신규 생성)
- 경로 유틸리티 함수 모음
- `get_current_year_dir()`, `get_previous_year_dir()`, `get_plan_dir()` 등
- 모든 스크립트에서 일관된 경로 사용

### 2. **scripts/process_ke30_current_year.py**
- ✅ 저장 경로 변경: `raw/YYYYMMDD/` → `raw/YYYYMM/present/YYYYMMDD/`
- ✅ `path_utils.get_current_year_dir()` 사용

### 3. **scripts/create_treemap_data.py**
- ✅ 읽기 경로 변경: `raw/YYYYMMDD/` → `raw/YYYYMM/present/YYYYMMDD/`
- ✅ 기존 구조 호환성 유지 (하위 호환)

### 4. **scripts/process_202511R_plan.py**
- ✅ 저장 경로 변경: `raw/202511R_집계_전처리완료.csv` → `raw/YYYYMM/plan/plan_YYYYMM_전처리완료.csv`
- ✅ 파일명에서 연월 자동 추출 (202511R → 202511)

### 5. **app/api/list-dates/route.ts**
- ✅ 새 구조 지원: `raw/YYYYMM/present/YYYYMMDD/` 탐색
- ✅ 기존 구조 호환성 유지

### 6. **당년데이터_처리실행.bat**
- ✅ 새 구조에서 날짜 폴더 찾기 로직 수정
- ✅ 기존 구조 호환성 유지

---

## 📋 주요 변경 사항

### 당년 데이터 (Present)
- **이전**: `raw/20251117/ke30_*.csv`
- **변경**: `raw/202511/present/20251117/ke30_*.csv`

### 전년 데이터 (Previous)
- **이전**: `raw/previous/202411/ke30_prev_*.csv` (제안만 있었음)
- **변경**: `raw/202411/previous/ke30_prev_202411_전처리완료.csv`

### 계획 데이터 (Plan)
- **이전**: `raw/202511R_집계_전처리완료.csv`
- **변경**: `raw/202511/plan/plan_202511_전처리완료.csv`

---

## 🔄 기존 데이터 마이그레이션

기존 데이터가 있다면 다음 명령으로 마이그레이션할 수 있습니다:

### Windows (PowerShell)
```powershell
# 예시: 20251117 데이터를 새 구조로 이동
$date = "20251117"
$yearMonth = $date.Substring(0, 6)  # "202511"
New-Item -ItemType Directory -Force -Path "raw\$yearMonth\present\$date"
Move-Item -Path "raw\$date\*" -Destination "raw\$yearMonth\present\$date\" -Force
Remove-Item -Path "raw\$date" -Force
```

### Python 스크립트 (마이그레이션 도구)
```python
import os
import shutil

def migrate_data():
    raw_dir = "raw"
    
    # 기존 구조: raw/YYYYMMDD/
    for item in os.listdir(raw_dir):
        item_path = os.path.join(raw_dir, item)
        if os.path.isdir(item_path) and item.isdigit() and len(item) == 8:
            # YYYYMMDD 형식의 폴더
            year_month = item[:6]  # YYYYMM
            new_path = os.path.join(raw_dir, year_month, "present", item)
            os.makedirs(new_path, exist_ok=True)
            
            # 파일 이동
            for file in os.listdir(item_path):
                src = os.path.join(item_path, file)
                dst = os.path.join(new_path, file)
                shutil.move(src, dst)
            
            # 빈 폴더 삭제
            os.rmdir(item_path)
            print(f"마이그레이션 완료: {item} -> {year_month}/present/{item}")

if __name__ == "__main__":
    migrate_data()
```

---

## ✅ 테스트 체크리스트

- [ ] `process_ke30_current_year.py` 실행 → `raw/YYYYMM/present/YYYYMMDD/`에 파일 생성 확인
- [ ] `create_treemap_data.py` 실행 → 새 경로에서 파일 읽기 확인
- [ ] `process_202511R_plan.py` 실행 → `raw/YYYYMM/plan/`에 파일 생성 확인
- [ ] `당년데이터_처리실행.bat` 실행 → 전체 프로세스 정상 작동 확인
- [ ] 메인 화면에서 날짜 선택 → 대시보드 정상 로드 확인
- [ ] API `/api/list-dates` 호출 → 날짜 목록 정상 반환 확인

---

## 🚨 주의사항

1. **기존 데이터 호환성**: 기존 구조(`raw/YYYYMMDD/`)도 여전히 지원하지만, 새 데이터는 새 구조로 저장됩니다.

2. **전년/계획 데이터**: 전년 및 계획 데이터 처리 스크립트가 아직 없다면, `path_utils.py`의 함수를 사용하여 구현할 수 있습니다.

3. **배치 파일**: 배치 파일은 새 구조를 우선적으로 찾고, 없으면 기존 구조를 찾습니다.

---

## 📝 다음 단계 (선택사항)

1. **전년 데이터 전처리 스크립트 작성**
   - `scripts/process_ke30_previous_year.py` 생성
   - `raw/YYYYMM/previous/` 경로 사용

2. **데이터 마이그레이션 스크립트 실행**
   - 기존 데이터를 새 구조로 이동

3. **문서 업데이트**
   - README.md에 새 폴더 구조 설명 추가



