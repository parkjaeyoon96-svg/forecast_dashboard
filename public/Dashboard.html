<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì›”ì¤‘ ì†ìµì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>

  <!-- Chart.js (í•œ ë²ˆë§Œ) -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Plotly.jsnpm run dev for treemap -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  
  <!-- â˜…â˜…â˜… JSON ë°ì´í„° fetch ë°©ì‹ ë¡œë“œ â˜…â˜…â˜… -->
  <script>
    // URLì—ì„œ ë‚ ì§œ íŒŒë¼ë¯¸í„° ì½ê¸°
    (function() {
      var urlParams = new URLSearchParams(window.location.search);
      var dateParam = urlParams.get('date');
      
      // ë‚ ì§œ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© (ìµœì‹  ë‚ ì§œ)
      if (!dateParam || dateParam.length !== 8) {
        dateParam = '20260119';
        console.log('[ë°ì´í„°ë¡œë“œ] ë‚ ì§œ íŒŒë¼ë¯¸í„° ì—†ìŒ, ê¸°ë³¸ê°’:', dateParam);
      } else {
        console.log('[ë°ì´í„°ë¡œë“œ] ë‚ ì§œ íŒŒë¼ë¯¸í„°:', dateParam);
      }
      
      // JSON íŒŒì¼ìš© ë‚ ì§œ
      window.__DATA_DATE__ = dateParam;
      
      // API í˜¸ì¶œìš© ë‚ ì§œ (ì˜¤ëŠ˜ ë‚ ì§œ YYYYMMDD í˜•ì‹)
      var today = new Date();
      window.__API_DATE__ = today.getFullYear().toString() + 
                            ('0' + (today.getMonth() + 1)).slice(-2) + 
                            ('0' + today.getDate()).slice(-2);
      
      console.log('[ë°ì´í„°ë¡œë“œ] JSON íŒŒì¼ ë‚ ì§œ:', window.__DATA_DATE__);
      console.log('[ë°ì´í„°ë¡œë“œ] API í˜¸ì¶œ ë‚ ì§œ:', window.__API_DATE__);
      
      window.__DATA_LOADED__ = false;
      
      // ì „ì—­ ë°ì´í„° ê°ì²´ ì´ˆê¸°í™” (JSON ë°©ì‹)
      window.overviewPL = null;           // ì „ì²´ ì†ìµê³„ì‚°ì„œ
      window.by_brand = null;             // ë¸Œëœë“œë³„ ë§¤ì¶œ/ì´ìµ
      window.waterfallData = null;        // ì›Œí„°í´ ì°¨íŠ¸
      window.cumulativeTrendData = null;  // ëˆ„ì  ì¶”ì´
      window.overviewKPI = null;          // ì „ì²´ KPI
      window.brandKPI = {};               // ë¸Œëœë“œë³„ KPI
      window.brandPLData = {};            // ë¸Œëœë“œë³„ ì†ìµê³„ì‚°ì„œ
      window.salesRateData = null;        // íŒë§¤ìœ¨ ë°ì´í„°
      window.salesRateCache = {};         // ë¸Œëœë“œë³„ íŒë§¤ìœ¨ ìºì‹œ
      window.channelPL = {};
      window.channelProfitLossData = {};
      window.weeklySalesTrend = {};
      window.clothingBrandStatus = {};
      window.channelTreemapData = null; // â˜… JSON ì‚¬ìš© ì•ˆí•¨ - Snowflake API ì‚¬ìš© â˜…
      window.salesCompositionData = null; // ë§¤ì¶œêµ¬ì„± ë°ì´í„° (íŠ¸ë¦¬ë§µìš© - Snowflake API)
      window.discountDetailData = null; // í• ì¸ë‚´ì—­ ì›ë³¸ ë°ì´í„° (Snowflake API)
      window.promotionData = {}; // í”„ë¡œëª¨ì…˜ ë°ì´í„° (ë¸Œëœë“œë³„ - Snowflake API)
      window.promotionData = {}; // í”„ë¡œëª¨ì…˜ ë°ì´í„° (ë¸Œëœë“œë³„ - Snowflake API)
    })();
  </script>
  <script>
    // JSON ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    async function loadAllDashboardData() {
      const dateStr = window.__DATA_DATE__;
      const baseUrl = `/data/${dateStr}`;
      
      console.log('[ë°ì´í„°ë¡œë“œ] JSON ë¡œë“œ ì‹œì‘:', dateStr);
      console.log('[ë°ì´í„°ë¡œë“œ] baseUrl:', baseUrl);
      console.log('[ë°ì´í„°ë¡œë“œ] overview_pl.json URL:', `${baseUrl}/overview_pl.json`);
      
      try {
        // Overview ê°œë³„ íŒŒì¼ ìš°ì„  ë¡œë“œ ì‹œë„
        const [overviewKPI, overviewByBrand, overviewPL, overviewWaterfall, overviewTrend] = await Promise.all([
          fetch(`${baseUrl}/overview_kpi.json?t=${Date.now()}`).then(r => {
            console.log(`[ë°ì´í„°ë¡œë“œ] overview_kpi.json ì‘ë‹µ:`, r.status, r.ok);
            return r.ok ? r.json() : null;
          }).catch(err => {
            console.error(`[ë°ì´í„°ë¡œë“œ] overview_kpi.json ë¡œë“œ ì‹¤íŒ¨:`, err);
            return null;
          }),
          fetch(`${baseUrl}/overview_by_brand.json?t=${Date.now()}`).then(r => {
            console.log(`[ë°ì´í„°ë¡œë“œ] overview_by_brand.json ì‘ë‹µ:`, r.status, r.ok);
            return r.ok ? r.json() : null;
          }).catch(err => {
            console.error(`[ë°ì´í„°ë¡œë“œ] overview_by_brand.json ë¡œë“œ ì‹¤íŒ¨:`, err);
            return null;
          }),
          fetch(`${baseUrl}/overview_pl.json?t=${Date.now()}`).then(r => {
            console.log(`[ë°ì´í„°ë¡œë“œ] overview_pl.json ì‘ë‹µ:`, r.status, r.ok, r.statusText);
            if (!r.ok) {
              console.error(`[ë°ì´í„°ë¡œë“œ] overview_pl.json ë¡œë“œ ì‹¤íŒ¨ - ìƒíƒœ:`, r.status, r.statusText);
              console.error(`[ë°ì´í„°ë¡œë“œ] ì‹œë„í•œ URL:`, `${baseUrl}/overview_pl.json`);
            }
            return r.ok ? r.json() : null;
          }).catch(err => {
            console.error(`[ë°ì´í„°ë¡œë“œ] overview_pl.json ë¡œë“œ ì‹¤íŒ¨:`, err);
            console.error(`[ë°ì´í„°ë¡œë“œ] ì‹œë„í•œ URL:`, `${baseUrl}/overview_pl.json`);
            return null;
          }),
          fetch(`${baseUrl}/overview_waterfall.json?t=${Date.now()}`).then(r => {
            console.log(`[ë°ì´í„°ë¡œë“œ] overview_waterfall.json ì‘ë‹µ:`, r.status, r.ok);
            return r.ok ? r.json() : null;
          }).catch(err => {
            console.error(`[ë°ì´í„°ë¡œë“œ] overview_waterfall.json ë¡œë“œ ì‹¤íŒ¨:`, err);
            return null;
          }),
          fetch(`${baseUrl}/overview_trend.json?t=${Date.now()}`).then(r => {
            console.log(`[ë°ì´í„°ë¡œë“œ] overview_trend.json ì‘ë‹µ:`, r.status, r.ok);
            return r.ok ? r.json() : null;
          }).catch(err => {
            console.error(`[ë°ì´í„°ë¡œë“œ] overview_trend.json ë¡œë“œ ì‹¤íŒ¨:`, err);
            return null;
          })
        ]);
        
        // ê°œë³„ íŒŒì¼ì´ ìˆìœ¼ë©´ ê°œë³„ ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹, ì—†ìœ¼ë©´ í†µí•© íŒŒì¼ ë¡œë“œ
        if (overviewKPI || overviewByBrand || overviewPL || overviewWaterfall || overviewTrend) {
          // ê°œë³„ íŒŒì¼ë“¤ì„ ê°ê°ì˜ ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹
          if (overviewKPI) {
            window.overviewKPI = overviewKPI;
            console.log('  âœ“ overview_kpi.json');
          }
          if (overviewByBrand) {
            window.by_brand = overviewByBrand;
            console.log('  âœ“ overview_by_brand.json');
          }
          if (overviewPL) {
            window.overviewPL = overviewPL;
            console.log('  âœ“ overview_pl.json ë¡œë“œ ì™„ë£Œ');
            console.log('  âœ“ overview_pl ë°ì´í„° í™•ì¸:', {
              tagRevenue: overviewPL.tagRevenue?.forecast,
              revenue: overviewPL.revenue?.forecast,
              directProfit: overviewPL.directProfit?.forecast,
              opProfit: overviewPL.opProfit?.forecast
            });
            // â˜… ë Œë”ë§ì€ jsonDataLoaded ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ (í•¨ìˆ˜ ì •ì˜ í›„)
          } else {
            console.warn('  âœ— overview_pl.json ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” ë°ì´í„° ì—†ìŒ');
          }
          if (overviewWaterfall) {
            window.waterfallData = overviewWaterfall;
            console.log('  âœ“ overview_waterfall.json');
          }
          if (overviewTrend) {
            window.cumulativeTrendData = overviewTrend;
            console.log('  âœ“ overview_trend.json');
          }
        } else {
          // ê°œë³„ íŒŒì¼ì´ ì—†ìœ¼ë©´ í†µí•© íŒŒì¼ ë¡œë“œ (í•˜ìœ„ í˜¸í™˜ì„±)
          const overview = await fetch(`${baseUrl}/overview.json`).then(r => r.ok ? r.json() : null).catch(() => null);
          if (overview) {
            // í†µí•© íŒŒì¼ì—ì„œ ê°œë³„ ì „ì—­ ë³€ìˆ˜ë¡œ ë¶„ë°°
            window.by_brand = overview.by_brand || null;
            window.overviewPL = overview.overviewPL || null;
            window.waterfallData = overview.waterfallData || null;
            window.cumulativeTrendData = overview.cumulativeTrendData || null;
            
            // overview.jsonì—ì„œ stock_analysis ê´€ë ¨ ë°ì´í„°ë„ ë¡œë“œ (clothingItemRatesOverall ë“±)
            if (overview.clothingSummary && !window.clothingSummary) {
              window.clothingSummary = overview.clothingSummary;
              console.log('  âœ“ overview.json - clothingSummary');
            }
            if (overview.accSummary && !window.accSummary) {
              window.accSummary = overview.accSummary;
              console.log('  âœ“ overview.json - accSummary');
            }
            if (overview.clothingItemRatesOverall && !window.clothingItemRatesOverall) {
              window.clothingItemRatesOverall = overview.clothingItemRatesOverall;
              console.log('  âœ“ overview.json - clothingItemRatesOverall (í‰ê· íŒë§¤ìœ¨ ë°ì´í„°)');
              console.log('  âœ“ clothingItemRatesOverall ì•„ì´í…œ:', Object.keys(window.clothingItemRatesOverall || {}));
            }
            
            console.log('  âœ“ overview.json (í†µí•© íŒŒì¼)');
          }
        }
        
        // overview.jsonì—ì„œ clothingItemRatesOverall ë¡œë“œ (ê°œë³„ íŒŒì¼ì´ ìˆì–´ë„ ë¡œë“œ)
        // ì´ëŠ” stock_analysis.jsonë³´ë‹¤ ë¨¼ì € ë¡œë“œë˜ì–´ ìµœì‹  ë°ì´í„°ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤
        const overviewForRates = await fetch(`${baseUrl}/overview.json`).then(r => r.ok ? r.json() : null).catch(() => null);
        if (overviewForRates) {
          // overview.jsonì—ì„œ stock_analysis ê´€ë ¨ ë°ì´í„° ë¡œë“œ (clothingItemRatesOverall ë“±)
          if (overviewForRates.clothingSummary && !window.clothingSummary) {
            window.clothingSummary = overviewForRates.clothingSummary;
            console.log('  âœ“ overview.json - clothingSummary');
          }
          if (overviewForRates.accSummary && !window.accSummary) {
            window.accSummary = overviewForRates.accSummary;
            console.log('  âœ“ overview.json - accSummary');
          }
          if (overviewForRates.clothingItemRatesOverall) {
            window.clothingItemRatesOverall = overviewForRates.clothingItemRatesOverall;
            console.log('  âœ“ overview.json - clothingItemRatesOverall (í‰ê· íŒë§¤ìœ¨ ë°ì´í„°)');
            console.log('  âœ“ clothingItemRatesOverall ì•„ì´í…œ:', Object.keys(window.clothingItemRatesOverall || {}));
          }
        }
        
        // ë‹¤ë¥¸ JSON íŒŒì¼ë“¤ ë³‘ë ¬ ë¡œë“œ (treemap.json ì œì™¸ - Snowflake API ì‚¬ìš©)
        const [brandKPI, brandPL, channelProfitLoss, radarChart, weeklyTrend, treemap, brandPlan, insightsData, metrics] = await Promise.all([
          fetch(`${baseUrl}/brand_kpi.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/brand_pl.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/channel_profit_loss.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/radar_chart.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/weekly_trend.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          Promise.resolve(null), // treemap.json ë¡œë”© ë¹„í™œì„±í™” - Snowflake API ì‚¬ìš©
          fetch(`${baseUrl}/radar_chart.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/ai_insights/insights_data_${dateStr}.json`).then(r => r.ok ? r.json() : null).catch(() => null),
          fetch(`${baseUrl}/metrics.json`).then(r => r.ok ? r.json() : null).catch(() => null)
        ]);
        
        // ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹ (overviewëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì²˜ë¦¬ë¨)
        
        if (brandKPI) {
          window.brandKPI = brandKPI;
          console.log('  âœ“ brand_kpi.json');
          
          // â˜…â˜…â˜… ì¦‰ì‹œ brandData ë§¤í•‘ ì‹¤í–‰ â˜…â˜…â˜…
          if (!window.brandData) window.brandData = {};
          const brandNames = ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
          const brandCodeMap = { 'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X', 'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W' };
          
          brandNames.forEach(brandName => {
            const kpi = brandKPI[brandName] || brandKPI[brandCodeMap[brandName]];
            if (kpi) {
              window.brandData[brandName] = {
                current: { 
                  revenue: { value: kpi.revenue / 100000000, discountRate: kpi.discountRate || 0 }, 
                  profit: { value: kpi.directProfit / 100000000 }, 
                  margin: { value: kpi.directProfitRate || 0 }, 
                  progress: { value: kpi.progressRate || 0 } 
                },
                revenue: { 
                  forecast: kpi.revenueForecast / 100000000, 
                  discountRate: kpi.discountRateForecast || kpi.discountRate || 0,
                  achievement: kpi.progressRateForecast || kpi.progressRate || 0,
                  vsPlan: kpi.revenueVsPlan || 0,
                  vsPrevious: kpi.revenueVsPrevious || 0
                }, 
                profit: { 
                  forecast: kpi.directProfitForecast / 100000000,
                  marginForecast: kpi.directProfitRateForecast || kpi.directProfitRate || 0,
                  achievement: kpi.progressRateForecast || kpi.progressRate || 0,
                  vsPlan: kpi.profitVsPlan || 0,
                  vsPrevious: kpi.profitVsPrevious || 0
                }, 
                opProfit: {
                  current: (kpi.operatingProfit || 0) / 100000000,
                  forecast: (kpi.operatingProfitForecast || 0) / 100000000,
                  rate: kpi.operatingProfitRate || 0,
                  rateForecast: kpi.operatingProfitRateForecast || 0,
                  // â˜… JSON ë°ì´í„° ê¸°ë°˜ ê³„ì‚°: ì˜ì—…ì´ìµ ëª©í‘œëŒ€ë¹„ëŠ” ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„ ì‚¬ìš© (JSONì— operatingProfitVsPlan ì—†ìŒ)
                  vsPlan: kpi.profitVsPlan || 0,
                  // â˜… JSON ë°ì´í„° ê¸°ë°˜ ê³„ì‚°: ì˜ì—…ì´ìµ ì „ë…„ëŒ€ë¹„ = (ì›”ë§ì˜ˆìƒ - ì „ë…„) / ì „ë…„ * 100
                  vsPrevious: kpi.operatingProfitPrevious ? ((kpi.operatingProfitForecast || 0) - (kpi.operatingProfitPrevious || 0)) / Math.abs(kpi.operatingProfitPrevious) * 100 : 0
                }
              };
              console.log(`  âœ“ ${brandName} brandData ë§¤í•‘ ì™„ë£Œ:`, window.brandData[brandName].current.revenue.value.toFixed(1), 'ì–µì›');
            }
          });
        }
        
        if (brandPL) {
          window.brandPLData = brandPL;
          console.log('  âœ“ brand_pl.json');
        }
        
        if (brandPlan) {
          // radar_chart.jsonì˜ brandTotalPlanì„ brandPlanDataë¡œ ë³€í™˜ (ì› -> ì–µì›)
          if (brandPlan.brandTotalPlan) {
            window.brandPlanData = {};
            for (const [brand, value] of Object.entries(brandPlan.brandTotalPlan)) {
              window.brandPlanData[brand] = value / 100000000; // ì› -> ì–µì›
            }
            console.log('  âœ“ radar_chart.json (ì „ì²´ ë¸Œëœë“œ ë ˆì´ë” ì°¨íŠ¸ìš©)');
            console.log('  brandPlanData:', window.brandPlanData);
          } else {
            window.brandPlanData = brandPlan;
            console.log('  âœ“ radar_chart.json (ì „ì²´ ë¸Œëœë“œ ë ˆì´ë” ì°¨íŠ¸ìš©, êµ¬ êµ¬ì¡°)');
          }
        }
        
        if (channelProfitLoss) {
          // â˜… channel_profit_loss.json êµ¬ì¡° (ë¸Œëœë“œë³„ ë°ì´í„° í¬í•¨) â˜…
          // JSON êµ¬ì¡°: { channelRevenueData: {MLB: [...], ...}, channelProfitData: {...}, brandRevenueTotals: {...}, brandProfitTotals: {...} }
          if (channelProfitLoss.channelRevenueData) {
            // ìƒˆ êµ¬ì¡°: ë¸Œëœë“œë³„ ë°ì´í„°ê°€ ì´ë¯¸ í¬í•¨ë˜ì–´ ìˆìŒ
            window.channelProfitLossData = {
              channelRevenueData: channelProfitLoss.channelRevenueData,
              channelProfitData: channelProfitLoss.channelProfitData,
              brandRevenueTotals: channelProfitLoss.brandRevenueTotals,
              brandProfitTotals: channelProfitLoss.brandProfitTotals
            };
            console.log('  âœ“ channel_profit_loss.json (ë¸Œëœë“œë³„ ë°ì´í„°:', Object.keys(channelProfitLoss.channelRevenueData), ')');
          } else {
            // êµ¬ êµ¬ì¡° í˜¸í™˜: ì „ì²´ í•©ì‚°ë§Œ ìˆëŠ” ê²½ìš°
            const convertedData = {
              channelRevenueData: {},
              channelProfitData: {},
              brandRevenueTotals: {},
              brandProfitTotals: {}
            };
            const allBrands = ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
            
            if (channelProfitLoss.ë§¤ì¶œ) {
              const revenueChannels = channelProfitLoss.ë§¤ì¶œ.map(row => ({
                channel: row.ì±„ë„,
                prev: row.ì „ë…„_ë§¤ì¶œ || 0,
                target: row.ê³„íš_ë§¤ì¶œ || 0,
                forecast: row.ë‹¹ë…„_ë§¤ì¶œ || 0,
                prevRate: row.ì „ë…„_í• ì¸ìœ¨ || 0,
                targetRate: row.ê³„íš_í• ì¸ìœ¨ || 0,
                forecastRate: row.ë‹¹ë…„_í• ì¸ìœ¨ || 0,
                yoy: row.ì „ë…„ëŒ€ë¹„ || 0,
                achievement: row.ê³„íšëŒ€ë¹„ || 0
              }));
              allBrands.forEach(brand => {
                convertedData.channelRevenueData[brand] = revenueChannels;
                convertedData.brandRevenueTotals[brand] = {
                  prev: revenueChannels.reduce((sum, ch) => sum + ch.prev, 0),
                  target: revenueChannels.reduce((sum, ch) => sum + ch.target, 0),
                  forecast: revenueChannels.reduce((sum, ch) => sum + ch.forecast, 0)
                };
              });
            }
            
            if (channelProfitLoss.ì§ì ‘ì´ìµ) {
              const profitChannels = channelProfitLoss.ì§ì ‘ì´ìµ.map(row => ({
                channel: row.ì±„ë„,
                prev: row.ì „ë…„_ë§¤ì¶œ || 0,
                target: row.ê³„íš_ë§¤ì¶œ || 0,
                forecast: row.ë‹¹ë…„_ë§¤ì¶œ || 0,
                prevRate: row.ì „ë…„_í• ì¸ìœ¨ || 0,
                targetRate: row.ê³„íš_í• ì¸ìœ¨ || 0,
                forecastRate: row.ë‹¹ë…„_í• ì¸ìœ¨ || 0,
                yoy: row.ì „ë…„ëŒ€ë¹„ || 0,
                achievement: row.ê³„íšëŒ€ë¹„ || 0
              }));
              allBrands.forEach(brand => {
                convertedData.channelProfitData[brand] = profitChannels;
                convertedData.brandProfitTotals[brand] = {
                  prev: profitChannels.reduce((sum, ch) => sum + ch.prev, 0),
                  target: profitChannels.reduce((sum, ch) => sum + ch.target, 0),
                  forecast: profitChannels.reduce((sum, ch) => sum + ch.forecast, 0)
                };
              });
            }
            window.channelProfitLossData = convertedData;
            console.log('  âœ“ channel_profit_loss.json (ë ˆê±°ì‹œ ë³€í™˜, ì±„ë„:', channelProfitLoss.ë§¤ì¶œ?.length, 'ê°œ)');
          }
        }
        
        if (radarChart) {
          // ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„°ë¥¼ brandKPIì— ë³‘í•©
          // radar_chart.jsonì˜ í‚¤ëŠ” ë¸Œëœë“œëª…(MLB, MLB_KIDS ë“±)ì´ê³ , brandKPIì˜ í‚¤ëŠ” ë¸Œëœë“œ ì½”ë“œ(M, I ë“±)
          const brandNameToCode = {
            'MLB': 'M',
            'MLB_KIDS': 'I',
            'DISCOVERY': 'X',
            'DUVETICA': 'V',
            'SERGIO': 'ST',
            'SUPRA': 'W'
          };
          
          if (window.brandKPI) {
            // ë¸Œëœë“œëª…ìœ¼ë¡œ ì ‘ê·¼ (radar_chart.jsonì˜ í‚¤)
            for (const [brandName, brandCode] of Object.entries(brandNameToCode)) {
              const data = window.brandKPI[brandCode];
              if (!data) continue;
              
              // ë¸Œëœë“œëª…ìœ¼ë¡œ radar_chart.jsonì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              if (radarChart.channelPlan && radarChart.channelPlan[brandName]) {
                data.channelPlan = radarChart.channelPlan[brandName];
              }
              if (radarChart.channelYoy && radarChart.channelYoy[brandName]) {
                data.channelYoy = radarChart.channelYoy[brandName];
              }
              if (radarChart.channelCurrent && radarChart.channelCurrent[brandName]) {
                data.channelCurrent = radarChart.channelCurrent[brandName];
              }
              if (radarChart.itemPlan && radarChart.itemPlan[brandName]) {
                data.itemPlan = radarChart.itemPlan[brandName];
              }
              if (radarChart.itemYoy && radarChart.itemYoy[brandName]) {
                data.itemYoy = radarChart.itemYoy[brandName];
              }
              if (radarChart.itemCurrent && radarChart.itemCurrent[brandName]) {
                data.itemCurrent = radarChart.itemCurrent[brandName];
              }
            }
          }
          window.radarChartData = radarChart;
          console.log('  âœ“ radar_chart.json (ë¸Œëœë“œëª…:', Object.keys(radarChart.channelCurrent || {}), ')');
        }
        
        if (weeklyTrend) {
          // weekly_trend.json êµ¬ì¡°ë¥¼ JS íŒŒì¼ê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ë³€í™˜
          if (weeklyTrend.weeklySalesTrend) {
            // ê¸°ì¡´ êµ¬ì¡° (ë¸Œëœë“œë³„, ì±„ë„ë³„ current/previous)ë¥¼ rawData êµ¬ì¡°ë¡œ ë³€í™˜
            const rawData = [];
            const weeks = new Set();
            const brands = new Set();
            const channels = new Set();
            
            Object.keys(weeklyTrend.weeklySalesTrend).forEach(brandCode => {
              brands.add(brandCode);
              Object.keys(weeklyTrend.weeklySalesTrend[brandCode]).forEach(channelName => {
                channels.add(channelName);
                const channelData = weeklyTrend.weeklySalesTrend[brandCode][channelName];
                
                // current ë°ì´í„° (ë‹¹ë…„)
                if (channelData.current) {
                  channelData.current.forEach(item => {
                    const weekDate = new Date(item.week);
                    const weekLabel = `${weekDate.getMonth() + 1}/${weekDate.getDate()}`;
                    weeks.add(weekLabel);
                    rawData.push({
                      ë¸Œëœë“œ: brandCode,
                      ì±„ë„ëª…: channelName,
                      êµ¬ë¶„: 'ë‹¹ë…„',
                      ì¢…ë£Œì¼: item.week,
                      ì‹¤íŒë§¤ì¶œ: item.value
                    });
                  });
                }
                
                // previous ë°ì´í„° (ì „ë…„)
                if (channelData.previous) {
                  channelData.previous.forEach(item => {
                    const weekDate = new Date(item.week);
                    const weekLabel = `${weekDate.getMonth() + 1}/${weekDate.getDate()}`;
                    weeks.add(weekLabel);
                    rawData.push({
                      ë¸Œëœë“œ: brandCode,
                      ì±„ë„ëª…: channelName,
                      êµ¬ë¶„: 'ì „ë…„',
                      ì¢…ë£Œì¼: item.week,
                      ì‹¤íŒë§¤ì¶œ: item.value
                    });
                  });
                }
              });
            });
            
            // JS íŒŒì¼ê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ë³€í™˜
            window.weeklySalesTrend = {
              updateDate: dateStr ? `${dateStr.slice(0,4)}-${dateStr.slice(4,6)}-${dateStr.slice(6,8)}` : new Date().toISOString().split('T')[0],
              weeks: Array.from(weeks).sort((a, b) => {
                const [aMonth, aDay] = a.split('/').map(Number);
                const [bMonth, bDay] = b.split('/').map(Number);
                if (aMonth !== bMonth) return aMonth - bMonth;
                return aDay - bDay;
              }),
              brands: Array.from(brands),
              channels: Array.from(channels),
              rawData: rawData
            };
            console.log('  âœ“ weekly_trend.json (êµ¬ì¡° ë³€í™˜ ì™„ë£Œ)');
          } else {
            // ì´ë¯¸ JS íŒŒì¼ êµ¬ì¡°ì¸ ê²½ìš°
            window.weeklySalesTrend = weeklyTrend;
            console.log('  âœ“ weekly_trend.json');
          }
        }
        
        // stock_analysis.json ë¡œë”© ì œê±°ë¨ - ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        
        // â˜… treemap.json ë¡œë”© ì™„ì „íˆ ë¹„í™œì„±í™” - Snowflake API ì‚¬ìš© â˜…
        console.log('  âš  treemap.json ë¡œë”© ìŠ¤í‚µ (Snowflake API ì‚¬ìš©)');
        
        // metrics.json ë¡œë“œ (channelItemSalesDataìš©)
        if (metrics) {
          if (metrics.channelItemSalesData) {
            window.channelItemSalesData = metrics.channelItemSalesData;
            console.log('  âœ“ metrics.json - channelItemSalesData ë¡œë“œ ì™„ë£Œ:', Object.keys(window.channelItemSalesData));
          }
          if (metrics.channelMetrics) {
            window.channelMetrics = metrics.channelMetrics;
          }
          if (metrics.channelItemMetrics) {
            window.channelItemMetrics = metrics.channelItemMetrics;
          }
          if (metrics.itemMetrics) {
            window.itemMetrics = metrics.itemMetrics;
          }
          if (metrics.itemChannelMetrics) {
            window.itemChannelMetrics = metrics.itemChannelMetrics;
          }
        } else {
          console.warn('  âœ— metrics.json ë¡œë“œ ì‹¤íŒ¨ - ë¸Œëœë“œë³„ íŠ¸ë¦¬ë§µì´ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤');
        }
        
        // â˜… treemap.json ë°ì´í„° ì²˜ë¦¬ ì™„ì „íˆ ì œê±° - Snowflake API ì‚¬ìš© â˜…
        // treemap ë³€ìˆ˜ëŠ” nullì´ë¯€ë¡œ ì´ ë¸”ë¡ì€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
        console.log('  âš  treemap.json ë°ì´í„° ì²˜ë¦¬ ìŠ¤í‚µ (Snowflake APIë¡œ ëŒ€ì²´)');
        
        if (insightsData) {
          window.insightsData = insightsData;
          console.log('  âœ“ insights_data.json ë¡œë“œ ì™„ë£Œ');
          console.log('  âœ“ ë¸Œëœë“œ:', Object.keys(insightsData).filter(k => k !== 'overview'));
          console.log('  âœ“ overview ë°ì´í„°:', insightsData.overview ? 'ìˆìŒ' : 'ì—†ìŒ');
          if (insightsData.overview) {
            console.log('  âœ“ overview.content:', insightsData.overview.content ? `ìˆìŒ (${insightsData.overview.content.substring(0, 50)}...)` : 'ì—†ìŒ');
            console.log('  âœ“ overview.keyPoints:', insightsData.overview.keyPoints ? `ìˆìŒ (${insightsData.overview.keyPoints.substring(0, 50)}...)` : 'ì—†ìŒ');
          }
          console.log('  âœ“ MLB ë°ì´í„°:', insightsData.MLB ? 'ìˆìŒ' : 'ì—†ìŒ');
          if (insightsData.MLB) {
            console.log('  âœ“ MLB treemapInsight:', insightsData.MLB.treemapInsight ? 'ìˆìŒ (' + insightsData.MLB.treemapInsight.substring(0, 50) + '...)' : 'ì—†ìŒ');
          }
          
          // AI ë¶„ì„ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë‹¤ì‹œ ë Œë”ë§
          if (window.aiPartMode && typeof renderAIPartNotes === 'function') {
            console.log('  âœ“ AI ë¶„ì„ ëª¨ë“œ í™œì„±í™”ë¨, renderAIPartNotes í˜¸ì¶œ');
            setTimeout(() => {
              renderAIPartNotes();
            }, 100);
          } else {
            console.log('  âš  AI ë¶„ì„ ëª¨ë“œ ë¹„í™œì„±í™” ë˜ëŠ” renderAIPartNotes í•¨ìˆ˜ ì—†ìŒ');
          }
        } else {
          console.warn('  âš  insights_data.json ë¡œë“œ ì‹¤íŒ¨');
        }
        
        // brand_stock_analysisëŠ” ì´ì œ JSON íŒŒì¼ë¡œ ë¡œë“œë¨ (stock_analysis.json)
        // JS íŒŒì¼ ë¡œë“œ ì½”ë“œ ì œê±° - JSON ë°©ì‹ìœ¼ë¡œ í†µì¼
        
        // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í‘œì‹œ ë° ì´ë²¤íŠ¸ ë°œìƒ
        window.__DATA_LOADED__ = true;
        console.log('[ë°ì´í„°ë¡œë“œ] âœ… ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ, jsonDataLoaded ì´ë²¤íŠ¸ ë°œìƒ');
        console.log('[ë°ì´í„°ë¡œë“œ] overviewPL:', !!window.overviewPL);
        window.dispatchEvent(new CustomEvent('jsonDataLoaded'));
        
      } catch (error) {
        console.error('[ë°ì´í„°ë¡œë“œ] ì˜¤ë¥˜:', error);
        window.__DATA_LOADED__ = true; // ì—ëŸ¬ ì‹œì—ë„ ê³„ì† ì§„í–‰
        window.dispatchEvent(new CustomEvent('jsonDataLoaded'));
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ ì‹œì‘
    console.log('[ì´ˆê¸°í™”] loadAllDashboardData ì‹¤í–‰ ì¤€ë¹„');
    loadAllDashboardData();
  </script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#333;min-height:100vh;overflow-x:auto;}
    .dashboard-header{background:rgba(255,255,255,0.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:16px 24px;box-shadow:0 4px 20px rgba(0,0,0,0.1);border-bottom:3px solid #4f46e5;position:sticky;top:0;z-index:100;}
    .header-content{display:flex;justify-content:space-between;align-items:center;}
    .header-content h1{color:#1e293b;font-size:24px;font-weight:700;}
    .header-content p{color:#64748b;font-size:14px;}
    .edit-btn,.reset-btn,.save-btn,.export-btn,.ai-btn{padding:8px 16px;border:2px solid #4f46e5;background:#fff;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;transition:all .3s ease;color:#4f46e5;}
    .edit-btn:hover,.reset-btn:hover,.save-btn:hover,.export-btn:hover{background:#4f46e5;color:#fff;}
    .ai-btn{border-color:#9333ea;color:#9333ea;}
    .ai-btn:hover{background:#9333ea;color:#fff;}
    .date-input-group{display:flex;gap:12px;align-items:center;margin-top:8px;}
    .date-input-label{font-size:13px;color:#64748b;font-weight:500;white-space:nowrap;}
    .date-input{padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;font-size:13px;color:#1e293b;background:#fff;min-width:120px;transition:all .2s ease;}
    .date-input:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px rgba(79,70,229,0.1);}
    .date-input:hover{border-color:#cbd5e1;}
    .ai-note{position:absolute;right:8px;top:8px;max-width:42%;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;padding:8px 10px;font-size:11px;color:#92400e;box-shadow:0 4px 12px rgba(0,0,0,.08);} 
    .chart-container{position:relative;}
    /* íŒë§¤ìœ¨ ë“œë¦´ë‹¤ìš´ ì‚¬ì´ë“œ íŒ¨ë„ */
    .side-panel{position:fixed;right:-550px;top:0;width:550px;height:100vh;background:#fff;box-shadow:-4px 0 20px rgba(0,0,0,0.15);transition:right 0.4s ease;z-index:1000;overflow-y:auto;}
    .side-panel.open{right:0;}
    /* ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” */
    .item-treemap-sidebar{position:fixed;right:-600px;top:0;width:600px;height:100vh;background:#fff;box-shadow:-4px 0 20px rgba(0,0,0,0.15);transition:right 0.4s ease;z-index:1000;overflow-y:auto;}
    .item-treemap-sidebar.open{right:0;}
    .sidebar-arrow-btn{position:absolute;right:10px;top:10px;background:#4f46e5;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-size:14px;cursor:pointer;font-weight:600;transition:all 0.3s ease;z-index:10;}
    .sidebar-arrow-btn:hover{background:#4338ca;transform:scale(1.05);}
    .period-btn{transition:all 0.3s ease;}
    .period-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(79,70,229,0.2);}
    .period-btn.active{border-color:#4f46e5!important;background:#4f46e5!important;color:#fff!important;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    #sales-rate-table tbody tr{cursor:pointer;transition:all 0.2s ease;}
    #sales-rate-table tbody tr:hover{background:#f8fafc;transform:scale(1.01);}
    #drilldown-table tbody tr{border-bottom:1px solid #e5e7eb;}
    #drilldown-table tbody tr:hover{background:#f1f5f9;}
    /* AI ìš”ì•½ ëª¨ë‹¬ */
    .ai-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:500;}
    .ai-modal{background:#fff;border-radius:12px;max-width:840px;width:92%;max-height:80vh;overflow:auto;box-shadow:0 20px 60px rgba(0,0,0,.25);}
    .ai-modal header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #e5e7eb;}
    .ai-modal header h4{font-size:16px;color:#111827;font-weight:700;}
    .ai-modal .content{padding:14px 16px;color:#374151;font-size:13px;line-height:1.6;}
    .ai-modal .close-btn{background:#ef4444;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-size:12px;}
    .ai-rightnote{background:#fff7ed;border:1px solid #fdba74;border-radius:8px;padding:10px;font-size:12px;color:#92400e;margin-top:12px;display:none;}
    #ai-rightnotes .ai-rightnote + .ai-rightnote{margin-top:10px;}
    .ai-part-note{background:#fff7ed;border:1px solid #fdba74;border-radius:8px;padding:12px;font-size:12px;color:#92400e;}
    .ai-part-note-side{position:absolute;right:12px;top:12px;max-width:300px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;padding:12px;font-size:11px;color:#92400e;box-shadow:0 4px 12px rgba(0,0,0,.08);z-index:10;}
    .edit-btn.active{background:#4f46e5;color:#fff;}
    .reset-btn{border-color:#dc2626;color:#dc2626;}
    .reset-btn:hover{background:#dc2626;color:#fff;}
    .save-btn{border-color:#059669;color:#059669;}
    .save-btn:hover{background:#059669;color:#fff;}
    .export-btn{border-color:#0ea5e9;color:#0ea5e9;}
    .export-btn:hover{background:#0ea5e9;color:#fff;}
    .editable{position:relative;transition:all .2s ease;}
    .editable[contenteditable="true"]{background:#fef3c7;border-radius:4px;padding:2px 4px;outline:2px dashed #f59e0b;cursor:text;}
    .editable[contenteditable="true"]:focus{outline:2px solid #f59e0b;background:#fef9e7;}
    .edit-indicator{position:absolute;top:-8px;right:-8px;background:#f59e0b;color:#fff;font-size:9px;padding:2px 6px;border-radius:10px;display:none;font-weight:600;}
    .editable[contenteditable="true"] .edit-indicator{display:block;}
    .drillback-btn{display:none;padding:4px 12px;border:2px solid #4f46e5;background:#fff;color:#4f46e5;border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;transition:all .3s ease;}
    .drillback-btn:hover{background:#4f46e5;color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(79,70,229,0.3);}
    .dashboard-layout{display:flex;min-height:calc(100vh - 80px);min-width:1600px;}
    .sidebar{width:200px;background:rgba(255,255,255,0.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:20px;box-shadow:2px 0 20px rgba(0,0,0,0.1);flex-shrink:0;}
    .sidebar h3{color:#1e293b;margin-bottom:16px;font-size:16px;font-weight:600;}
    .nav-item{padding:10px 14px;margin-bottom:6px;border-radius:10px;cursor:pointer;transition:all .3s ease;font-weight:500;font-size:14px;}
    .nav-item:hover{background:#f1f5f9;transform:translateX(3px);}
    .nav-item.active{background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;box-shadow:0 4px 15px rgba(79,70,229,.3);}
    .main-content{flex:1;background:rgba(255,255,255,0.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:20px;overflow-y:auto;display:flex;flex-direction:column;}
    .content-section{display:none;height:100%;}
    .content-section.active{display:flex;flex-direction:column;}
    .insights-section{background:linear-gradient(135deg,#fef3c7,#fed7aa);border-radius:10px;padding:16px;margin-bottom:20px;border-left:4px solid #f59e0b;flex-shrink:0;display:block;width:100%;box-sizing:border-box;}
    .insights-section h3{color:#92400e;margin-bottom:10px;font-size:16px;font-weight:600;}
    .insights-content{color:#78350f;line-height:1.5;font-size:13px;display:block;width:100%;}
    .brand-controls{margin-bottom:20px;flex-shrink:0;}
    .brand-buttons{display:flex;gap:10px;flex-wrap:wrap;}
    .brand-btn{padding:8px 16px;border:2px solid #e2e8f0;background:#fff;border-radius:20px;cursor:pointer;font-weight:500;font-size:13px;transition:all .3s ease;}
    .brand-btn:hover{border-color:#4f46e5;background:#f8fafc;}
    .brand-btn.active{background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;border-color:transparent;box-shadow:0 4px 15px rgba(79,70,229,.3);}
    .content-body{flex:1;display:flex;gap:20px;min-height:0;}
    .charts-area{flex:1;display:flex;flex-direction:column;gap:15px;min-width:0;max-width:calc(100vw - 480px);}
    .kpi-section{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;flex-shrink:0;min-height:180px;}
    .kpi-card{background:linear-gradient(135deg,#fff,#f8fafc);border-radius:10px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid #e2e8f0;transition:transform .3s ease,box-shadow .3s ease;}
    .kpi-card:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,.15);}
    .kpi-title{color:#64748b;font-size:15px;margin-bottom:6px;font-weight:600;}
    .kpi-value{color:#1e293b;font-size:20px;font-weight:700;margin-bottom:4px;}
    .kpi-value-line{display:flex;align-items:baseline;gap:6px;margin-bottom:4px;}
    .kpi-value-line + .kpi-value-line{margin-top:8px;padding-top:8px;border-top:1px solid #e2e8f0;}
    .kpi-value-with-rate{display:flex;align-items:baseline;gap:4px;}
    .kpi-rate{color:#64748b;font-size:13px;font-weight:500;}
    .kpi-label{color:#94a3b8;font-size:12px;font-weight:500;}
    .kpi-change{font-size:11px;font-weight:500;}
    .kpi-change-line{font-size:11px;font-weight:500;margin-bottom:2px;}
    .kpi-positive{color:#059669;}
    .kpi-negative{color:#dc2626;}
    .charts-grid{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:450px 450px;gap:10px;min-height:580px;width:100%;margin-bottom:10px;}
    .overview-charts-grid{grid-template-rows:350px 350px;}
    .chart-container{background:#fff;border-radius:10px;padding:14px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid #e2e8f0;display:flex;flex-direction:column;}
    .chart-title{color:#1e293b;font-size:16px;font-weight:700;margin-bottom:10px;text-align:center;flex-shrink:0;}
    .chart-wrapper{flex:1;position:relative;min-height:180px;}
    .financial-report{width:420px;background:rgba(255,255,255,0.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:20px;box-shadow:-2px 0 20px rgba(0,0,0,.1);overflow-y:auto;flex-shrink:0;position:relative;}
    .financial-report h3{color:#1e293b;margin-bottom:16px;font-size:16px;font-weight:600;text-align:center;padding-bottom:10px;border-bottom:2px solid #e2e8f0;}
    .pl-table{width:100%;border-collapse:collapse;margin-bottom:20px;}
    .pl-table th,.pl-table td{padding:5px 6px;text-align:right;border-bottom:1px solid #e2e8f0;font-size:11px;}
    .pl-table th{background:#f8fafc;color:#475569;font-weight:600;}
    .pl-table .item-name{text-align:left;font-weight:500;}
    .pl-table .sub-item{padding-left:16px;color:#64748b;font-size:11px;}
    .pl-table .total-row{border-top:2px solid #4f46e5;background:#f8fafc;font-weight:600;}
    /* ì£¼ìš” ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” êµ¬ë¶„ì„  - í—¤ë”ì—ëŠ” êµ¬ë¶„ì„  ì—†ìŒ, ë°ì´í„° í–‰ì—ë§Œ êµ¬ë¶„ì„  */
    /* í—¤ë”(th)ì—ëŠ” êµ¬ë¶„ì„  ì—†ìŒ */
    #channel-pl-inline th{border-right:none !important;}
    /* ë°ì´í„° í–‰(td)ì—ë§Œ êµ¬ë¶„ì„ : ì±„ë„(1) ë‹¤ìŒ, ì „ë…„ í• ì¸ìœ¨(3) ë‹¤ìŒ, ê³„íš í• ì¸ìœ¨(5) ë‹¤ìŒ, ë‹¹ë…„ í• ì¸ìœ¨(7) ë‹¤ìŒ, ê³„íšëŒ€ë¹„(9) ë‹¤ìŒ */
    #channel-pl-inline td:nth-child(1){border-right:1px solid #94a3b8;}
    #channel-pl-inline td:nth-child(3){border-right:1px solid #94a3b8;}
    #channel-pl-inline td:nth-child(5){border-right:1px solid #94a3b8;}
    #channel-pl-inline td:nth-child(7){border-right:1px solid #94a3b8;}
    #channel-pl-inline td:nth-child(9){border-right:1px solid #94a3b8;}
    /* ë‚˜ë¨¸ì§€ ë°ì´í„° ì»¬ëŸ¼ì—ëŠ” êµ¬ë¶„ì„  ì—†ìŒ */
    #channel-pl-inline td:nth-child(2){border-right:none !important;}
    #channel-pl-inline td:nth-child(4){border-right:none !important;}
    #channel-pl-inline td:nth-child(6){border-right:none !important;}
    #channel-pl-inline td:nth-child(8){border-right:none !important;}
    /* ì•„ì´í…œ ë¶„ì„ í‘œ ì •ë ¬: ëª¨ë‘ ê°€ìš´ë° ì •ë ¬ */
    #itemDiffTable th, #itemDiffTable td { text-align:center; white-space:nowrap; }
    /* ì•„ì´í…œ ë¶„ì„ í…Œì´ë¸” ì»¬ëŸ¼ ìƒ‰ìƒ êµ¬ë¶„ */
    #itemDiffTable thead tr:first-child th:nth-child(1),
    #itemDiffTable thead tr:first-child th:nth-child(2),
    #itemDiffTable thead tr:first-child th:nth-child(3){
      background:#334155; color:#fff; border-color:#1f2937;
    }
    /* 1í–‰ ê·¸ë£¹ í—¤ë”: 4 ë°œì£¼, 5 ì£¼ê°„, 6 ëˆ„ì , 7 íŒë§¤ìœ¨ (ìƒ‰ìƒ ì‚¬ì§„ê³¼ ìœ ì‚¬) */
    #itemDiffTable thead tr:first-child th:nth-child(4){
      background:#f59e0b; color:#1f2937; border-color:#d97706; /* ì˜¤ë Œì§€ */
    }
    #itemDiffTable thead tr:first-child th:nth-child(5){
      background:#60a5fa; color:#1f2937; border-color:#3b82f6; /* ë¸”ë£¨ */
    }
    #itemDiffTable thead tr:first-child th:nth-child(6){
      background:#f0abfc; color:#1f2937; border-color:#e879f9; /* í•‘í¬/ë³´ë¼ */
    }
    #itemDiffTable thead tr:first-child th:nth-child(7){
      background:#86efac; color:#1f2937; border-color:#4ade80; /* ì—°ë‘ */
    }
    /* 2í–‰ í—¤ë” ì»¬ëŸ¼ ìƒ‰ìƒ (ê·¸ë£¹ì— ë§ì¶˜ ë¼ì´íŠ¸ í†¤) */
    /* (2í–‰) 1-2: ë°œì£¼ (1í–‰ê³¼ ë™ì¼ ìƒ‰) - 1í–‰ 3ê°œëŠ” rowspanì´ë¼ 2í–‰ indexëŠ” 1ë¶€í„° ì‹œì‘ */
    #itemDiffTable thead tr:nth-child(2) th:nth-child(n+1):nth-child(-n+2){
      background:#f59e0b; color:#1f2937; border-color:#d97706;
    }
    /* (2í–‰) 3-4: ì£¼ê°„ (1í–‰ê³¼ ë™ì¼ ìƒ‰) */
    #itemDiffTable thead tr:nth-child(2) th:nth-child(n+3):nth-child(-n+4){
      background:#60a5fa; color:#1f2937; border-color:#3b82f6;
    }
    /* (2í–‰) 5-6: ëˆ„ì  (1í–‰ê³¼ ë™ì¼ ìƒ‰) */
    #itemDiffTable thead tr:nth-child(2) th:nth-child(n+5):nth-child(-n+6){
      background:#f0abfc; color:#1f2937; border-color:#e879f9;
    }
    /* (2í–‰) 7-9: íŒë§¤ìœ¨ (1í–‰ê³¼ ë™ì¼ ìƒ‰) */
    #itemDiffTable thead tr:nth-child(2) th:nth-child(n+7):nth-child(-n+9){
      background:#86efac; color:#1f2937; border-color:#4ade80;
    }
    /* ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ: 1í–‰ í—¤ë” ìƒ‰ìƒ */
    #itemDiffTable.inventory-mode thead tr:first-child th:nth-child(1),
    #itemDiffTable.inventory-mode thead tr:first-child th:nth-child(2),
    #itemDiffTable.inventory-mode thead tr:first-child th:nth-child(3){
      background:#334155; color:#fff; border-color:#1f2937;
    }
    #itemDiffTable.inventory-mode thead tr:first-child th:nth-child(4){
      background:#f59e0b; color:#1f2937; border-color:#d97706; /* ì£¼ê°„ë§¤ì¶œ - ì£¼í™© */
    }
    #itemDiffTable.inventory-mode thead tr:first-child th:nth-child(5){
      background:#60a5fa; color:#1f2937; border-color:#3b82f6; /* ì¬ê³ ì£¼ìˆ˜ - íŒŒë‘ */
    }
    /* ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ: 2í–‰ í—¤ë” ìƒ‰ìƒ */
    #itemDiffTable.inventory-mode thead tr:nth-child(2) th:nth-child(n+1):nth-child(-n+5){
      background:#f59e0b; color:#1f2937; border-color:#d97706; /* ì£¼ê°„ë§¤ì¶œ - ì£¼í™© */
    }
    #itemDiffTable.inventory-mode thead tr:nth-child(2) th:nth-child(n+6):nth-child(-n+9){
      background:#60a5fa; color:#1f2937; border-color:#3b82f6; /* ì¬ê³ ì£¼ìˆ˜ - íŒŒë‘ */
    }
    /* ë¦¬ìŠ¤íŠ¸(ë°”ë””) ì…€ ë°°ê²½ ì œê±° - í—¤ë”ë§Œ ìƒ‰ìƒ ìœ ì§€ */
    #itemDiffTable tbody td{ background:transparent; }
    .progress-bar{width:100%;height:6px;background:#e2e8f0;border-radius:3px;overflow:hidden;margin-top:6px;}
    .progress-fill{height:100%;background:linear-gradient(90deg,#4f46e5,#7c3aed);transition:width .3s ease;}
    canvas{max-height:100% !important;}
    ::-webkit-scrollbar{width:8px;height:8px;}
    ::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px;}
    ::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#4f46e5,#7c3aed);border-radius:4px;}
    ::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#4338ca,#6d28d9);}
    #discount-detail-table-container::-webkit-scrollbar{width:10px;}
    #discount-detail-table-container::-webkit-scrollbar-track{background:#e0e7ff;border-radius:5px;}
    #discount-detail-table-container::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#4f46e5,#7c3aed);border-radius:5px;border:2px solid #e0e7ff;}
    #discount-detail-table-container::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#4338ca,#6d28d9);}
    @media (max-width:1600px){
      .dashboard-layout{min-width:1400px;}
      .financial-report{width:300px;}
    }
    /* ì „ì²´í˜„í™© íˆíŠ¸ë§µ ìŠ¤íƒ€ì¼ */
    .heatmap-table {
      width: 100%;
      overflow-x: auto;
      margin-top: 20px;
    }
    .cell-excellent {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
    }
    .cell-good {
      background: linear-gradient(135deg, #ecc94b, #d69e2e);
      color: #2d3748;
    }
    .cell-average {
      background: linear-gradient(135deg, #ed8936, #dd6b20);
      color: white;
    }
    .cell-poor {
      background: linear-gradient(135deg, #fc8181, #f56565);
      color: white;
    }
    .cell-empty {
      background: #f9fafb;
      color: #9ca3af;
    }
    #overviewHeatmapTable tr:hover td {
      background: #edf2f7 !important;
    }
  </style>
</head>
<body>
  <div class="dashboard-header">
    <div class="header-content">
      <div>
      <h1>ğŸ“Š ì›”ì¤‘ ì†ìµì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</h1>
      <div id="last-updated">
        <p style="margin:4px 0;font-size:14px;">ì—…ë°ì´íŠ¸ ì¼ì: <span id="update-date">-</span></p>
        <div id="date-info" style="font-size:12px;color:#64748b;margin-top:2px;"></div>
      </div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
          <button id="btn-update-all-data" 
            style="padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.3s;display:flex;align-items:center;gap:6px;"
            onmouseover="this.style.background='#4338ca'" 
            onmouseout="this.style.background='#4f46e5'"
            title="ëª¨ë“  ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜/íŠ¸ë¦¬ë§µ/í• ì¸ë‚´ì—­)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
            ì—…ë°ì´íŠ¸
          </button>
          <button id="ai-btn" class="ai-btn">ğŸ¤– AIë¶„ì„</button>
        <button id="edit-mode-btn" class="edit-btn">âœï¸ í¸ì§‘ ëª¨ë“œ</button>
        <button id="save-btn" class="save-btn" style="display:none;">ğŸ’¾ ì €ì¥</button>
      </div>
    </div>
  </div>

  <div class="dashboard-layout">
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
      <h3>ë©”ë‰´</h3>
      <div class="nav-item active" data-section="overview">ğŸ“ˆ ì „ì²´ í˜„í™©</div>
      <div class="nav-item" data-section="brand">ğŸ·ï¸ ë¸Œëœë“œë³„ ë¶„ì„</div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content">
      <!-- ì „ì²´ í˜„í™© ì„¹ì…˜ -->
      <div id="content-overview" class="content-section active">
        <div class="insights-section">
          <div class="insights-content editable" id="overview-insights" contenteditable="false">
            <!-- ì¸ì‚¬ì´íŠ¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <div class="content-body">
          <div class="charts-area">
            <div class="kpi-section">
              <!-- ì‹¤íŒë§¤ì¶œ(í• ì¸ìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì‹¤íŒë§¤ì¶œ<span style="color:#8b5cf6;font-weight:600;">(í• ì¸ìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-current-revenue" class="kpi-value editable" contenteditable="false">881.6ì–µì›</span>
                    <span id="overview-current-discount-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-revenue" class="kpi-value editable" contenteditable="false">881.6ì–µì›</span>
                    <span id="overview-discount-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="overview-revenue-change" class="kpi-change-line kpi-negative editable" contenteditable="false">ëª©í‘œ ëŒ€ë¹„ -5%</div>
                <div id="overview-revenue-yoy" class="kpi-change kpi-negative editable" contenteditable="false">ì „ë…„ ëŒ€ë¹„ -4%</div>
                <div class="progress-bar"><div id="overview-revenue-progress" class="progress-fill" style="width:95%"></div></div>
              </div>
              
              <!-- ì§ì ‘ì´ìµ(ì´ìµìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì§ì ‘ì´ìµ<span style="color:#8b5cf6;font-weight:600;">(ì´ìµìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-current-profit" class="kpi-value editable" contenteditable="false">191.4ì–µì›</span>
                    <span id="overview-current-profit-margin-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-profit" class="kpi-value editable" contenteditable="false">191.4ì–µì›</span>
                    <span id="overview-profit-margin-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="overview-profit-change" class="kpi-change-line kpi-negative editable" contenteditable="false">ëª©í‘œ ëŒ€ë¹„ -8%</div>
                <div id="overview-profit-yoy" class="kpi-change kpi-negative editable" contenteditable="false">ì „ë…„ ëŒ€ë¹„ -5%</div>
                <div class="progress-bar"><div id="overview-profit-progress" class="progress-fill" style="width:92%"></div></div>
              </div>
              
              <!-- ì˜ì—…ì´ìµ(ì´ìµìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì˜ì—…ì´ìµ<span style="color:#8b5cf6;font-weight:600;">(ì´ìµìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-current-opprofit" class="kpi-value editable" contenteditable="false">63.4ì–µì›</span>
                    <span id="overview-current-opprofit-margin-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="overview-opprofit" class="kpi-value editable" contenteditable="false">63.4ì–µì›</span>
                    <span id="overview-opprofit-margin-rate" class="kpi-rate">(0.0%)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="overview-opprofit-change" class="kpi-change-line kpi-negative editable" contenteditable="false">ëª©í‘œ ëŒ€ë¹„ -21%</div>
                <div id="overview-opprofit-yoy" class="kpi-change kpi-negative editable" contenteditable="false">ì „ë…„ ëŒ€ë¹„ -27%</div>
                <div class="progress-bar"><div id="overview-opprofit-progress" class="progress-fill" style="width:79%"></div></div>
              </div>
              
              <!-- ì§„ì²™ìœ¨ í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì§ì ‘ì´ìµ ì§„ì²™ìœ¨</div>
                <div class="kpi-value-line">
                  <span id="overview-current-progress" class="kpi-value editable" contenteditable="false">-%</span>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <span id="overview-progress" class="kpi-value editable" contenteditable="false">-%</span>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="overview-progress-change" class="kpi-change-line editable" contenteditable="false" style="min-height:20px;display:block;">&nbsp;</div>
                <div id="overview-progress-yoy" class="kpi-change editable" contenteditable="false" style="min-height:20px;display:block;">&nbsp;</div>
                <div class="progress-bar"><div id="overview-progress-progress" class="progress-fill" style="width:0%"></div></div>
              </div>
            </div>

            <div class="charts-grid overview-charts-grid">
              <div class="chart-container">
                <div class="chart-title">ë¸Œëœë“œë³„ ë§¤ì¶œ í˜„í™© & ì˜ì—…ì´ìµ</div>
                <div class="chart-wrapper"><canvas id="brandRevenueChart"></canvas></div>
              </div>
              <div class="chart-container">
                <div class="chart-title">ì „ì²´ ë¸Œëœë“œ ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„</div>
                <div style="display:flex;justify-content:center;align-items:center;margin:4px 0 8px 0;gap:12px;font-size:12px;">
                  <div style="display:flex;align-items:center;gap:6px;"><span style="display:inline-block;width:10px;height:10px;background:#3B82F6;border-radius:2px;"></span> ê³„íš</div>
                  <div style="display:flex;align-items:center;gap:6px;"><span style="display:inline-block;width:10px;height:10px;background:#10B981;border-radius:2px;"></span> ì „ë…„</div>
                </div>
                <div class="chart-wrapper"><canvas id="brandAllRadarChart"></canvas>
                  <!-- ì „ì²´í˜„í™© ë ˆì´ë” ì°¨íŠ¸ ë¸Œëœë“œ ìƒì„¸ ì •ë³´ í† ê¸€ -->
                  <div id="brandAllRadarToggle" style="display:none; position:absolute; background:white; border:1px solid #e5e7eb; border-radius:8px; padding:16px; box-shadow:0 4px 6px rgba(0,0,0,0.1); z-index:1000; min-width:200px; font-size:14px;">
                    <div style="font-weight:600; font-size:16px; margin-bottom:12px; color:#1f2937; border-bottom:1px solid #e5e7eb; padding-bottom:8px;" id="brandAllRadarToggleBrandName"></div>
                    <div style="margin-bottom:8px;">
                      <span style="color:#6b7280;">ë§¤ì¶œ : </span>
                      <span style="font-weight:600; color:#1f2937;" id="brandAllRadarToggleCurrent"></span>
                    </div>
                    <div style="margin-bottom:8px;">
                      <span style="color:#6b7280;">ì „ë…„ : </span>
                      <span style="font-weight:600; color:#1f2937;" id="brandAllRadarToggleYoy"></span>
                    </div>
                    <div>
                      <span style="color:#6b7280;">ê³„íš : </span>
                      <span style="font-weight:600; color:#1f2937;" id="brandAllRadarTogglePlan"></span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chart-container">
                <div class="chart-title">ì „ì²´ ì†ìµ êµ¬ì¡° (Waterfall Chart) - 7ë‹¨ê³„</div>
                <div style="text-align:center;font-size:10px;color:#64748b;margin-bottom:8px;">
                  <span style="color:#10b981;">â— ë§¤ì¶œ/ì´ìµ</span> 
                  <span style="color:#ef4444;margin-left:12px;">â— ë¹„ìš©(ì°¨ê°)</span>
                  <span style="color:#3b82f6;margin-left:12px;">â— ì¤‘ê°„í•©ê³„</span>
                  <span style="color:#4f46e5;margin-left:12px;">â— ìµœì¢…ê²°ê³¼</span>
                </div>
                <div class="chart-wrapper"><canvas id="waterfallChart"></canvas></div>
              </div>
              <div class="chart-container">
                <div class="chart-title">ì›”ì¤‘ ëˆ„ì  ë§¤ì¶œ ì¶”ì´</div>
                <div class="chart-wrapper"><canvas id="cumulativeTrendChart"></canvas></div>
              </div>
            </div>

            <!-- ë‹¹ì‹œì¦Œì˜ë¥˜/ACCì¬ê³ ì£¼ìˆ˜ ë¶„ì„ ë²„ë¸” ì°¨íŠ¸ -->
            <div class="chart-container" style="grid-column: 1 / -1; min-height: 900px;">
              <div class="chart-title">
                <span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>
                ë‹¹ì‹œì¦Œì˜ë¥˜/ACCì¬ê³ ì£¼ìˆ˜ ë¶„ì„
              </div>
              <div style="display:flex;justify-content:center;align-items:center;margin:8px 0 15px 0;">
                <div style="display:flex;gap:6px;align-items:center;">
                  <button id="overviewBtnSaleRate" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;">íŒë§¤ìœ¨</button>
                  <button id="overviewBtnInventory" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;">ì¬ê³ ì£¼ìˆ˜</button>
                </div>
              </div>
              <!-- ë²„ë¸” ì°¨íŠ¸ìš© ì»¨íŠ¸ë¡¤ (ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ) -->
              <div id="bubbleControlsContainer" style="margin-bottom:15px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                  <div style="font-size:11px;color:#6b7280;">
                    Xì¶•: ì¬ê³ ì£¼ìˆ˜ | Yì¶•: ë§¤ì¶œì „ë…„ëŒ€ë¹„ | í¬ê¸°: ì¬ê³ ê¸ˆì•¡
                  </div>
                  <div style="display:flex;gap:0;background:#f3f4f6;padding:4px;border-radius:8px;">
                    <button id="bubbleViewBtn4" class="view-btn-4quad active" onclick="switchBubbleView('4quadrant')" style="padding:8px 16px;border:none;background:white;color:#1e293b;font-size:12px;font-weight:600;cursor:pointer;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:all 0.2s;">4ë¶„ë©´</button>
                    <button id="bubbleViewBtn9" class="view-btn-9quad" onclick="switchBubbleView('9quadrant')" style="padding:8px 16px;border:none;background:transparent;color:#6b7280;font-size:12px;font-weight:600;cursor:pointer;border-radius:6px;transition:all 0.2s;">9ë¶„ë©´</button>
                  </div>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;padding:8px 12px;background:#f9fafb;border-radius:6px;">
                  <span style="font-size:11px;font-weight:600;color:#6b7280;">ë¸Œëœë“œ:</span>
                  <button class="brand-filter-btn-overview all active" onclick="filterBubbleBrand('all')" style="padding:4px 8px;border:2px solid #1f2937;background:#1f2937;color:white;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">ì „ì²´</button>
                  <button class="brand-filter-btn-overview M" onclick="filterBubbleBrand('M')" style="padding:4px 8px;border:2px solid #dc2626;background:white;color:#dc2626;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">MLB</button>
                  <button class="brand-filter-btn-overview I" onclick="filterBubbleBrand('I')" style="padding:4px 8px;border:2px solid #eab308;background:white;color:#eab308;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">MLB KIDS</button>
                  <button class="brand-filter-btn-overview X" onclick="filterBubbleBrand('X')" style="padding:4px 8px;border:2px solid #3b82f6;background:white;color:#3b82f6;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">DISCOVERY</button>
                  <button class="brand-filter-btn-overview V" onclick="filterBubbleBrand('V')" style="padding:4px 8px;border:2px solid #1f2937;background:white;color:#1f2937;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">DUVETICA</button>
                  <button class="brand-filter-btn-overview ST" onclick="filterBubbleBrand('ST')" style="padding:4px 8px;border:2px solid #8b5cf6;background:white;color:#8b5cf6;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">SERGIO</button>
                  <button class="brand-filter-btn-overview W" onclick="filterBubbleBrand('W')" style="display:none;padding:4px 8px;border:2px solid #10b981;background:white;color:#10b981;border-radius:4px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;">SUPRA</button>
                </div>
              </div>
              <!-- íŒë§¤ìœ¨ íˆíŠ¸ë§µ (íŒë§¤ìœ¨ ë²„íŠ¼ í´ë¦­ ì‹œ í‘œì‹œ) -->
              <div id="overviewHeatmapContainer" style="display:block;margin-bottom:20px;">
                <!-- ì •ë ¬ ì˜µì…˜ -->
                <div style="display:flex;justify-content:flex-start;align-items:center;margin-bottom:15px;gap:10px;">
                  <span style="font-size:12px;font-weight:600;color:#6b7280;">ì •ë ¬:</span>
                  <div style="display:flex;gap:6px;">
                    <button id="sortBySale" class="heatmap-sort-btn active" onclick="sortHeatmap('sale')" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;transition:all 0.2s;">ë§¤ì¶œ ë†’ì€ ìˆœ</button>
                    <button id="sortBySaleRate" class="heatmap-sort-btn" onclick="sortHeatmap('salesRate')" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;transition:all 0.2s;">íŒë§¤ìœ¨ ìˆœ</button>
                  </div>
                </div>
                <div class="heatmap-table" style="overflow-x:auto;">
                  <table id="overviewHeatmapTable" style="width:100%;border-collapse:separate;border-spacing:0;font-size:13px;">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                  </table>
                </div>
              </div>
              <!-- ë²„ë¸” ì°¨íŠ¸ (ì¬ê³ ì£¼ìˆ˜ ë²„íŠ¼ í´ë¦­ ì‹œ í‘œì‹œ) -->
              <div id="overviewBubbleContainer" style="display:none;">
              <!-- ì¬ê³ ì£¼ìˆ˜ ë‚ ì§œ ì •ë³´ -->
              <div id="overviewStockWeeksDateInfo" style="padding:12px;background:#f8fafc;border-radius:6px;margin-bottom:10px;font-size:12px;color:#475569;line-height:1.6;">
                <div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> <span id="overview-stock-weeks-update-date">-</span></div>
                <div><strong>ë§¤ì¶œ ê¸°ì¤€ ê¸°ê°„:</strong> 7ì¼ / 28ì¼
                  <div style="margin-left:20px;">- ì£¼ê°„ë§¤ì¶œ: ìµœê·¼ 1ì£¼ (<span id="overview-stock-weeks-7d-start">-</span> ~ <span id="overview-stock-weeks-7d-end">-</span>)</div>
                  <div style="margin-left:20px;">- ì¬ê³ ì£¼ìˆ˜ ì‚°ì •ìš© íŒë§¤ëŸ‰: ìµœê·¼ 4ì£¼ (<span id="overview-stock-weeks-28d-start">-</span> ~ <span id="overview-stock-weeks-28d-end">-</span>)</div>
                </div>
                <div><strong>ê¸ˆì•¡:</strong> ë°±ë§Œ</div>
              </div>
              <div class="chart-wrapper" style="height:700px;">
                <canvas id="overviewBubbleChart"></canvas>
                </div>
              </div>
              <!-- 4ë¶„ë©´ KPI -->
              <div id="overviewKpi4" class="overview-kpi-4" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:15px;">
                <div class="overview-kpi-card critical" onclick="openBubbleModal('critical')" style="padding:12px;border-radius:6px;border-left:3px solid #dc2626;background:#fee2e2;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewCriticalCount">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸš¨ ì €ì„±ì¥+ê³ ì¬ê³ </div>
                </div>
                <div class="overview-kpi-card caution" onclick="openBubbleModal('caution')" style="padding:12px;border-radius:6px;border-left:3px solid #f59e0b;background:#fef3c7;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewCautionCount">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">âš ï¸ ê³ ì„±ì¥+ê³ ì¬ê³ </div>
                </div>
                <div class="overview-kpi-card growth" onclick="openBubbleModal('growth')" style="padding:12px;border-radius:6px;border-left:3px solid #3b82f6;background:#dbeafe;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewGrowthCount">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ”¥ ê³ ì„±ì¥+ì €ì¬ê³ </div>
                </div>
                <div class="overview-kpi-card review" onclick="openBubbleModal('review')" style="padding:12px;border-radius:6px;border-left:3px solid #6b7280;background:#f3f4f6;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewReviewCount">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ“‹ ì €ì„±ì¥+ì €ì¬ê³ </div>
                </div>
              </div>
              <!-- 9ë¶„ë©´ KPI -->
              <div id="overviewKpi9" class="overview-kpi-9" style="display:none;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px;">
                <div class="overview-kpi-card q1" onclick="openBubbleModal('q1')" style="padding:12px;border-radius:6px;border-left:3px solid #2563eb;background:#dbeafe;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ1Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ”¥ ì ê·¹ë°œì£¼<br>(ì €ì¬ê³ +ê°•ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q4" onclick="openBubbleModal('q4')" style="padding:12px;border-radius:6px;border-left:3px solid #059669;background:#d1fae5;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ4Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ’š ì•ˆì •ì„±ì¥<br>(ì¤‘ì¬ê³ +ê°•ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q7" onclick="openBubbleModal('q7')" style="padding:12px;border-radius:6px;border-left:3px solid #fb923c;background:#fff7ed;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ7Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸŸ¡ ë°œì£¼ì¤‘ë‹¨<br>(ê³ ì¬ê³ +ê°•ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q2" onclick="openBubbleModal('q2')" style="padding:12px;border-radius:6px;border-left:3px solid #10b981;background:#d1fae5;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ2Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">âœ… ë°œì£¼ìœ ì§€<br>(ì €ì¬ê³ +ì•½ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q5" onclick="openBubbleModal('q5')" style="padding:12px;border-radius:6px;border-left:3px solid #6366f1;background:#e0e7ff;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ5Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ”µ í˜„ìƒìœ ì§€<br>(ì¤‘ì¬ê³ +ì•½ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q8" onclick="openBubbleModal('q8')" style="padding:12px;border-radius:6px;border-left:3px solid #ea580c;background:#fed7aa;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ8Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸŸ  ì¬ê³ ê´€ë¦¬<br>(ê³ ì¬ê³ +ì•½ì„±ì¥)</div>
                </div>
                <div class="overview-kpi-card q3" onclick="openBubbleModal('q3')" style="padding:12px;border-radius:6px;border-left:3px solid #6b7280;background:#f3f4f6;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ3Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸ“‹ ê²€í† í•„ìš”<br>(ì €ì¬ê³ +ê°ì†Œ)</div>
                </div>
                <div class="overview-kpi-card q6" onclick="openBubbleModal('q6')" style="padding:12px;border-radius:6px;border-left:3px solid #f59e0b;background:#fef3c7;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ6Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">âš ï¸ ì£¼ì˜ê´€ì°°<br>(ì¤‘ì¬ê³ +ê°ì†Œ)</div>
                </div>
                <div class="overview-kpi-card q9" onclick="openBubbleModal('q9')" style="padding:12px;border-radius:6px;border-left:3px solid #dc2626;background:#fee2e2;text-align:center;cursor:pointer;transition:transform 0.2s;">
                  <div style="font-size:18px;font-weight:700;margin-bottom:3px;" id="overviewQ9Count">0</div>
                  <div style="font-size:10px;font-weight:600;color:#374151;line-height:1.3;">ğŸš¨ ê¸´ê¸‰ì¡°ì¹˜<br>(ê³ ì¬ê³ +ê°ì†Œ)</div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- ë¸Œëœë“œë³„ ë¶„ì„ ì„¹ì…˜ -->
      <div id="content-brand" class="content-section">
        <div class="insights-section">
          <div class="insights-content editable" id="brand-insights" contenteditable="false">
            <!-- ë¸Œëœë“œë³„ ì¸ì‚¬ì´íŠ¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <div class="brand-controls">
          <div class="brand-buttons">
            <button class="brand-btn active" data-brand="MLB">MLB</button>
            <button class="brand-btn" data-brand="MLB_KIDS">MLB KIDS</button>
            <button class="brand-btn" data-brand="DISCOVERY">DISCOVERY</button>
            <button class="brand-btn" data-brand="DUVETICA">DUVETICA</button>
            <button class="brand-btn" data-brand="SERGIO">SERGIO</button>
            <button class="brand-btn" data-brand="SUPRA" style="display:none;">SUPRA</button>
          </div>
        </div>

        <div class="content-body">
          <div class="charts-area">
            <div class="kpi-section">
              <!-- ì‹¤íŒë§¤ì¶œ(í• ì¸ìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì‹¤íŒë§¤ì¶œ<span style="color:#8b5cf6;font-weight:600;">(í• ì¸ìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-current-revenue" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-current-discount-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-revenue" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-discount-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="brand-revenue-change" class="kpi-change-line editable" contenteditable="false">-</div>
                <div id="brand-revenue-yoy" class="kpi-change editable" contenteditable="false">-</div>
                <div class="progress-bar"><div id="brand-revenue-progress" class="progress-fill" style="width:0%"></div></div>
              </div>
              
              <!-- ì§ì ‘ì´ìµ(ì´ìµìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì§ì ‘ì´ìµ<span style="color:#8b5cf6;font-weight:600;">(ì´ìµìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-current-profit" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-current-profit-margin-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-profit" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-profit-margin-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="brand-profit-change" class="kpi-change-line editable" contenteditable="false">-</div>
                <div id="brand-profit-yoy" class="kpi-change editable" contenteditable="false">-</div>
                <div class="progress-bar"><div id="brand-profit-progress" class="progress-fill" style="width:0%"></div></div>
              </div>
              
              <!-- ì˜ì—…ì´ìµ(ì´ìµìœ¨) í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì˜ì—…ì´ìµ<span style="color:#8b5cf6;font-weight:600;">(ì´ìµìœ¨)</span></div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-current-opprofit" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-current-opprofit-margin-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <div class="kpi-value-with-rate">
                    <span id="brand-opprofit" class="kpi-value editable" contenteditable="false">-</span>
                    <span id="brand-opprofit-margin-rate" class="kpi-rate">(-)</span>
                  </div>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="brand-opprofit-change" class="kpi-change-line editable" contenteditable="false">-</div>
                <div id="brand-opprofit-yoy" class="kpi-change editable" contenteditable="false">-</div>
                <div class="progress-bar"><div id="brand-opprofit-progress" class="progress-fill" style="width:0%"></div></div>
              </div>
              
              <!-- ì§„ì²™ìœ¨ í†µí•© KPI -->
              <div class="kpi-card">
                <div class="kpi-title">ì§ì ‘ì´ìµ ì§„ì²™ìœ¨</div>
                <div class="kpi-value-line">
                  <span id="brand-current-progress" class="kpi-value editable" contenteditable="false">-%</span>
                  <span class="kpi-label">(í˜„ì‹œì )</span>
                </div>
                <div class="kpi-value-line">
                  <span id="brand-progress" class="kpi-value editable" contenteditable="false">-%</span>
                  <span class="kpi-label">(ì›”ë§ì˜ˆìƒ)</span>
                </div>
                <div id="brand-progress-change" class="kpi-change-line editable" contenteditable="false" style="min-height:20px;display:block;">&nbsp;</div>
                <div id="brand-progress-yoy" class="kpi-change editable" contenteditable="false" style="min-height:20px;display:block;">&nbsp;</div>
                <div class="progress-bar"><div id="brand-progress-progress" class="progress-fill" style="width:0%"></div></div>
              </div>
            </div>

            <div class="charts-grid">
              <!-- 1í–‰ 1ì—´: ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ -->
              <div class="chart-container" style="position:relative;">
                <div class="chart-title" id="treemapTitleChannel">
                  <span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>
                  ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„±(í˜„ì‹œì )
                </div>
                <div style="display:flex;gap:6px;margin-bottom:8px;">
                  <button id="treemapDrillbackChannel" class="drillback-btn" style="display:none;">â† ë’¤ë¡œê°€ê¸°</button>
                  <div style="flex:1;"></div>
                </div>
                <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
                <div id="treemapChannelLoading" style="display:flex;position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);z-index:1000;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                  </svg>
                  <div style="margin-top:12px;font-size:14px;font-weight:600;color:#4f46e5;">ì—…ë°ì´íŠ¸ ì¤‘...</div>
                </div>
                <div class="chart-wrapper" id="treemapWrapperChannel"></div>
                <!-- íŠ¸ë¦¬ë§µ ë‚ ì§œ ì •ë³´ -->
                <div id="treemapChannelDateInfo" style="margin-top:6px;padding:6px 8px;background:#f8fafc;border-left:3px solid #4f46e5;font-size:10px;color:#64748b;line-height:1.4;">
                  <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
              </div>
              <!-- 1í–‰ 2ì—´: ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ -->
              <div class="chart-container" style="position:relative;">
                <div class="chart-title" id="treemapTitleItem">
                  <span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>
                  ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„±(í˜„ì‹œì )
                </div>
                <button id="openItemTreemapSidebar" class="sidebar-arrow-btn">â†’</button>
                <div style="display:flex;gap:6px;margin-bottom:8px;">
                  <button id="treemapDrillbackItem" class="drillback-btn" style="display:none;">â† ë’¤ë¡œê°€ê¸°</button>
                  <button id="downloadItemTreemapCSV" class="drillback-btn" style="background:#10B981;">ğŸ“¥ ì „ë…„ ë°ì´í„° CSV</button>
                </div>
                <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
                <div id="treemapItemLoading" style="display:flex;position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);z-index:1000;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                  </svg>
                  <div style="margin-top:12px;font-size:14px;font-weight:600;color:#10b981;">ì—…ë°ì´íŠ¸ ì¤‘...</div>
                </div>
                <div class="chart-wrapper" id="treemapWrapperItem"></div>
                <!-- íŠ¸ë¦¬ë§µ ë‚ ì§œ ì •ë³´ -->
                <div id="treemapItemDateInfo" style="margin-top:6px;padding:6px 8px;background:#f8fafc;border-left:3px solid #10b981;font-size:10px;color:#64748b;line-height:1.4;">
                  <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
              </div>
              <!-- 2í–‰ 1ì—´: ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„ (ë ˆì´ë”ì°¨íŠ¸) -->
              <div class="chart-container">
                <div class="chart-title">ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„</div>
                <div style="display:flex;justify-content:center;align-items:center;margin:4px 0 8px 0;gap:12px;font-size:12px;">
                  <div style="display:flex;align-items:center;gap:6px;"><span style="display:inline-block;width:10px;height:10px;background:#3B82F6;border-radius:2px;"></span> ê³„íš</div>
                  <div style="display:flex;align-items:center;gap:6px;"><span style="display:inline-block;width:10px;height:10px;background:#10B981;border-radius:2px;"></span> ì „ë…„</div>
                </div>
                <div style="display:flex;justify-content:flex-end;align-items:center;margin:0 0 8px 0;">
                  <div style="display:flex;gap:6px;">
                    <button id="radarBtnChannel" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì±„ë„ë³„</button>
                    <button id="radarBtnItem" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì•„ì´í…œë³„</button>
                  </div>
                </div>
                <div class="chart-wrapper"><canvas id="radarChart"></canvas>
                  <!-- ë ˆì´ë” ì°¨íŠ¸ ì±„ë„ ìƒì„¸ ì •ë³´ í† ê¸€ -->
                  <div id="radarChannelToggle" style="display:none; position:absolute; background:white; border:1px solid #e5e7eb; border-radius:8px; padding:16px; box-shadow:0 4px 6px rgba(0,0,0,0.1); z-index:1000; min-width:200px; font-size:14px;">
                    <div style="font-weight:600; font-size:16px; margin-bottom:12px; color:#1f2937; border-bottom:1px solid #e5e7eb; padding-bottom:8px;" id="radarToggleChannelName"></div>
                    <div style="margin-bottom:8px;">
                      <span style="color:#6b7280;">ë‹¹ë…„ : </span>
                      <span style="font-weight:600; color:#1f2937;" id="radarToggleCurrent"></span>
                    </div>
                    <div style="margin-bottom:8px;">
                      <span style="color:#6b7280;">ì „ë…„ : </span>
                      <span style="font-weight:600; color:#1f2937;" id="radarToggleYoy"></span>
                    </div>
                    <div>
                      <span style="color:#6b7280;">ê³„íš : </span>
                      <span style="font-weight:600; color:#1f2937;" id="radarTogglePlan"></span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 2í–‰ 2ì—´: ì£¼ìš” ì±„ë„ë³„ ì†ìµ (í‘œ) -->
              <div class="chart-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                  <div class="chart-title" style="margin:0;text-align:center;flex:1;">ì£¼ìš” ì±„ë„ë³„ ì†ìµ (ì›”ë§ì˜ˆìƒ)</div>
                  <div style="display:flex;gap:5px;">
                    <button id="channelPlRevenue" class="channel-pl-toggle-btn active" style="background:#4f46e5;color:white;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;">ë§¤ì¶œ</button>
                    <button id="channelPlProfit" class="channel-pl-toggle-btn" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;">ì§ì ‘ì´ìµ</button>
                  </div>
                </div>
                <div class="chart-wrapper" style="min-height:200px;overflow-x:auto;">
                  <table class="pl-table" id="channel-pl-inline" style="font-size:10px;">
                    <thead>
                      <tr>
                        <th class="item-name" rowspan="2" style="vertical-align:middle;">ì±„ë„</th>
                        <th colspan="2" style="text-align:center;border-bottom:1px solid #e2e8f0;">ì „ë…„</th>
                        <th colspan="2" style="text-align:center;border-bottom:1px solid #e2e8f0;">ê³„íš</th>
                        <th colspan="2" style="text-align:center;border-bottom:1px solid #e2e8f0;">ë‹¹ë…„</th>
                        <th colspan="2" style="text-align:center;border-bottom:1px solid #e2e8f0;" id="channel-pl-yoy-header">ë§¤ì¶œ YOY</th>
                      </tr>
                      <tr>
                        <th id="channel-pl-value-header-1" style="text-align:center;">ë§¤ì¶œ</th>
                        <th id="channel-pl-rate-header-1" style="text-align:center;">í• ì¸ìœ¨</th>
                        <th id="channel-pl-value-header-2" style="text-align:center;">ë§¤ì¶œ</th>
                        <th id="channel-pl-rate-header-2" style="text-align:center;">í• ì¸ìœ¨</th>
                        <th id="channel-pl-value-header-3" style="text-align:center;">ë§¤ì¶œ</th>
                        <th id="channel-pl-rate-header-3" style="text-align:center;">í• ì¸ìœ¨</th>
                        <th style="text-align:center;">ì „ë…„ëŒ€ë¹„</th>
                        <th style="text-align:center;">ê³„íšëŒ€ë¹„</th>
                      </tr>
                    </thead>
                    <tbody id="channel-pl-inline-body"></tbody>
                  </table>
                </div>
              </div>
            </div>
            <!-- ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ (ì „ì²´ ë„ˆë¹„) -->
            <div class="chart-container" style="width: 100%;">
                <div class="chart-title">ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸</div>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:10px;">
                  <div style="display:flex;gap:6px;flex-wrap:wrap;">
                    <button id="weeklyChannelFilterAll" class="weekly-channel-filter-btn active" data-channel="all" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì „ì²´</button>
                    <button id="weeklyChannelFilterDept" class="weekly-channel-filter-btn" data-channel="ë°±í™”ì " style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ë°±í™”ì </button>
                    <button id="weeklyChannelFilterDutyFree" class="weekly-channel-filter-btn" data-channel="ë©´ì„¸ì " style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ë©´ì„¸ì </button>
                    <button id="weeklyChannelFilterDirect" class="weekly-channel-filter-btn" data-channel="ì§ì˜ì (ê°€ë‘)" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì§ì˜ì (ê°€ë‘)</button>
                    <button id="weeklyChannelFilterAgent" class="weekly-channel-filter-btn" data-channel="ëŒ€ë¦¬ì " style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ëŒ€ë¦¬ì </button>
                    <button id="weeklyChannelFilterOutlet" class="weekly-channel-filter-btn" data-channel="ì•„ìš¸ë ›" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì•„ìš¸ë ›</button>
                    <button id="weeklyChannelFilterStore" class="weekly-channel-filter-btn" data-channel="ì§ì˜ëª°" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì§ì˜ëª°</button>
                    <button id="weeklyChannelFilterOwn" class="weekly-channel-filter-btn" data-channel="ìì‚¬ëª°" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ìì‚¬ëª°</button>
                    <button id="weeklyChannelFilterPartner" class="weekly-channel-filter-btn" data-channel="ì œíœ´ëª°" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì œíœ´ëª°</button>
                    <button id="weeklyChannelFilterRF" class="weekly-channel-filter-btn" data-channel="RF" style="display:none;background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">RF</button>
                  </div>
                  <div style="display:flex;gap:6px;">
                  <button id="weeklyModeBtnWeekly" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ì£¼ì°¨ë³„</button>
                  <button id="weeklyModeBtnCumulative" style="background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;">ëˆ„ì </button>
                </div>
              </div>
                <div class="chart-wrapper" style="min-height:400px;"><canvas id="weeklyTrendChart"></canvas></div>
                <div style="margin-top:10px;padding:8px;background:#f8fafc;border-left:3px solid #64748b;font-size:11px;color:#64748b;text-align:center;">
                  <strong>â€» Xì¶•ì˜ ì¼ìëŠ” ì£¼ê°„ ì¢…ë£Œì¼(ì¼ìš”ì¼)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ê¸°ê°„: ì›”~ì¼)</strong>
                </div>
                
                <!-- ì£¼ì°¨ë³„ ë§¤ì¶œ ë°ì´í„° í‘œ -->
                <div id="weeklyDataTable" style="margin-top:15px;overflow-x:auto;">
                  <table style="width:100%;border-collapse:collapse;font-size:13px;text-align:center;">
                    <thead id="weeklyDataTableHead">
                      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </thead>
                    <tbody id="weeklyDataTableBody">
                      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </tbody>
                  </table>
                </div>
            </div>
            
            <!-- ë‹¹ì‹œì¦Œ ì˜ë¥˜ íŒë§¤ìœ¨ ë¶„ì„ í…Œì´ë¸” -->
            <div id="brand-sales-rate-section" class="chart-container" style="margin-top: 15px; width: 100%;">
              <div class="chart-title" style="text-align:center;">
                <span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>
                ë‹¹ì‹œì¦Œ ì˜ë¥˜ íŒë§¤ìœ¨ / ACC ì¬ê³ ì£¼ìˆ˜ ë¶„ì„
              </div>
              
              <!-- íƒ­ ë²„íŠ¼ -->
              <div id="analysis-tab-buttons" style="padding:10px 0;display:flex;gap:8px;border-bottom:2px solid #e5e7eb;margin-bottom:10px;">
                <button id="tab-sales-rate" class="analysis-tab-btn active" 
                  style="padding:10px 20px;background:#4f46e5;color:#fff;border:none;border-radius:6px 6px 0 0;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s;">
                  íŒë§¤ìœ¨
                </button>
                <button id="tab-stock-weeks" class="analysis-tab-btn" 
                  style="padding:10px 20px;background:#f1f5f9;color:#64748b;border:none;border-radius:6px 6px 0 0;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s;">
                  ì¬ê³ ì£¼ìˆ˜
                </button>
              </div>
              
              <!-- íŒë§¤ìœ¨ ë¶„ì„ ì½˜í…ì¸  -->
              <div id="sales-rate-content">
              <!-- ë‚ ì§œ ì •ë³´ -->
              <div id="sales-rate-date-info" style="padding:12px;background:#f8fafc;border-radius:6px;margin:10px 0;font-size:12px;color:#475569;line-height:1.6;">
                <div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> <span id="sales-rate-update-date">-</span></div>
                <div><strong>ë¶„ì„ê¸°ê°„:</strong> <span id="sales-rate-period-info">-</span></div>
                <div><strong>ëŒ€ìƒì‹œì¦Œ:</strong> <span id="sales-rate-season-info">-</span></div>
                <div><strong>ë‹¨ìœ„:</strong> ë°±ë§Œ</div>
                <div><strong>íŒë§¤ìœ¨:</strong> ëˆ„ì íŒë§¤TAGë§¤ì¶œ/ëˆ„ì ì…ê³ TAGê¸ˆì•¡</div>
              </div>
              
              <!-- ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ -->
              <div id="sales-rate-filters" style="padding:10px 0;display:flex;gap:8px;">
                <button class="sales-rate-filter-btn active" data-category="ì „ì²´" style="padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">ì „ì²´</button>
                <button class="sales-rate-filter-btn" data-category="Outer" style="padding:8px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">Outer</button>
                <button class="sales-rate-filter-btn" data-category="Inner" style="padding:8px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">Inner</button>
                <button class="sales-rate-filter-btn" data-category="Bottom" style="padding:8px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">Bottom</button>
                <button class="sales-rate-filter-btn" data-category="Acc_etc" style="padding:8px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">Acc_etc</button>
              </div>
              
              <div id="sales-rate-loading" style="display:none;text-align:center;padding:40px;">
                <div style="display:inline-block;width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #4f46e5;border-radius:50%;animation:spin 1s linear infinite;"></div>
                <p style="margin-top:10px;color:#64748b;">íŒë§¤ìœ¨ ë°ì´í„° ì¡°íšŒ ì¤‘...</p>
              </div>
              <div id="sales-rate-error" style="display:none;text-align:center;padding:40px;color:#dc2626;">
                <p>âš ï¸ íŒë§¤ìœ¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <button onclick="loadSalesRateData()" style="margin-top:10px;padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;">ë‹¤ì‹œ ì‹œë„</button>
              </div>
              <div id="sales-rate-table-wrapper" style="overflow-x:auto;margin-top:10px;">
                <table id="sales-rate-table" class="pl-table" style="width:100%;min-width:1400px;border-collapse:collapse;">
                  <thead>
                    <tr style="background:#f8fafc;border-bottom:2px solid #cbd5e1;">
                      <th style="position:sticky;left:0;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì¹´í…Œê³ ë¦¬</th>
                      <th style="position:sticky;left:80px;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì•„ì´í…œì½”ë“œ</th>
                      <th style="position:sticky;left:180px;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ì•„ì´í…œëª…</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ì•„ì´í…œë¹„ì¤‘</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„ëˆ„ì TAGë§¤ì¶œ</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë§¤ì¶œYOY</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„íŒë§¤ìœ¨</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì „ë…„íŒë§¤ìœ¨</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì°¨ì´</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ì „ë…„ë§ˆê°íŒë§¤ìœ¨</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„ë°œì£¼TAG</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë°œì£¼YOY</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„ëˆ„ì ì…ê³ TAG</th>
                      <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì…ê³ YOY</th>
                    </tr>
                  </thead>
                  <tbody id="sales-rate-tbody">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                  </tbody>
                </table>
              </div>
              </div>
              <!-- /íŒë§¤ìœ¨ ë¶„ì„ ì½˜í…ì¸  -->
              
              <!-- ì¬ê³ ì£¼ìˆ˜ ë¶„ì„ ì½˜í…ì¸  (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
              <div id="stock-weeks-content" style="display:none;">
                <!-- ë‚ ì§œ ì •ë³´ -->
                <div id="stock-weeks-date-info" style="padding:12px;background:#f8fafc;border-radius:6px;margin:10px 0;font-size:12px;color:#475569;line-height:1.6;">
                  <div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> <span id="stock-weeks-update-date">-</span> (ë‹¹ì¼)</div>
                  <div><strong>ë§¤ì¶œ ê¸°ì¤€ ê¸°ê°„:</strong> 7ì¼ / 28ì¼
                    <div style="margin-left:20px;">- ì£¼ê°„ë§¤ì¶œ: ìµœê·¼ 1ì£¼ (<span id="stock-weeks-7d-start">-</span> ~ <span id="stock-weeks-7d-end">-</span>)</div>
                    <div style="margin-left:20px;">- ì¬ê³ ì£¼ìˆ˜ ì‚°ì •ìš© íŒë§¤ëŸ‰: ìµœê·¼ 4ì£¼ (<span id="stock-weeks-28d-start">-</span> ~ <span id="stock-weeks-28d-end">-</span>)</div>
                  </div>
                  <div><strong>ê¸ˆì•¡:</strong> ë°±ë§Œ</div>
                  <div><strong>ì§€í‘œ ì •ì˜:</strong>
                    <div style="margin-left:20px;">- 4ì£¼ í‰ê· íŒë§¤ëŸ‰: ìµœê·¼ 4ì£¼ê°„ íŒë§¤ìˆ˜ëŸ‰ Ã· 4</div>
                    <div style="margin-left:20px;">- ì¬ê³ ì£¼ìˆ˜: ê¸°ì¤€ì¼ ì¬ê³ ìˆ˜ëŸ‰ Ã· ìµœê·¼ 4ì£¼ í‰ê· íŒë§¤ëŸ‰</div>
                    <div style="margin-left:20px;">- ì¬ê³ ì£¼ìˆ˜ í‘œì‹œ: 20ì£¼ ì´í•˜ ì´ˆë¡ / 20ì£¼ ì´ˆê³¼~50ì£¼ ì´í•˜ ë…¸ë‘ / 50ì£¼ ì´ˆê³¼ ë¹¨ê°•</div>
                  </div>
                </div>
                
                <!-- ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ -->
                <div id="stock-weeks-filters" style="padding:10px 0;display:flex;gap:8px;">
                  <button class="stock-weeks-filter-btn active" data-category="ì „ì²´" style="padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">ì „ì²´</button>
                  <!-- ì¹´í…Œê³ ë¦¬ëŠ” ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>
                
                <div id="stock-weeks-loading" style="display:none;text-align:center;padding:40px;">
                  <div style="display:inline-block;width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #4f46e5;border-radius:50%;animation:spin 1s linear infinite;"></div>
                  <p style="margin-top:10px;color:#64748b;">ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ì¡°íšŒ ì¤‘...</p>
                </div>
                <div id="stock-weeks-error" style="display:none;text-align:center;padding:40px;color:#dc2626;">
                  <p>âš ï¸ ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                  <button onclick="loadStockWeeksData()" style="margin-top:10px;padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;">ë‹¤ì‹œ ì‹œë„</button>
                </div>
                <div id="stock-weeks-table-wrapper" style="overflow-x:auto;margin-top:10px;">
                  <table id="stock-weeks-table" class="pl-table" style="width:100%;min-width:1600px;border-collapse:collapse;">
                    <thead>
                      <tr style="background:#f8fafc;border-bottom:2px solid #cbd5e1;">
                        <th style="position:sticky;left:0;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì¹´í…Œê³ ë¦¬</th>
                        <th style="position:sticky;left:100px;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì•„ì´í…œ</th>
                        <th style="position:sticky;left:180px;z-index:20;background:#f8fafc;padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ì•„ì´í…œëª…</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì£¼ê°„íŒë§¤ìˆ˜ëŸ‰</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì£¼ê°„TAGë§¤ì¶œ</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ë§¤ì¶œYOY</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">4ì£¼í‰ê· íŒë§¤ëŸ‰</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì¬ê³ ì£¼ìˆ˜</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;border-right:2px solid #cbd5e1;">ì¬ê³ ì£¼ìˆ˜ì°¨ì´</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„ì¬ê³ ìˆ˜ëŸ‰</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ë‹¹ë…„ì¬ê³ TAG</th>
                        <th style="padding:12px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ì¬ê³ YOY</th>
                      </tr>
                    </thead>
                    <tbody id="stock-weeks-tbody">
                      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- /ì¬ê³ ì£¼ìˆ˜ ë¶„ì„ ì½˜í…ì¸  -->
            </div>
            
            <!-- (ìš”ì²­) ì•„ì´í…œë³„ íŒë§¤ ë¶„ì„ ê·¸ë˜í”„ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ -->
            <div class="chart-container" style="display:none;">
              <div class="chart-title">ì•„ì´í…œë³„ íŒë§¤ ë¶„ì„</div>
              <div class="chart-wrapper" style="height:600px;"><div id="itemHeatmapChart" style="height:100%;"></div></div>
                </div>
            
            <!-- íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ë¶„ì„ (í‘œ) -->
          </div>
        </div>
      </div>
    </div>

    <!-- íŒë§¤ìœ¨ ë“œë¦´ë‹¤ìš´ ì‚¬ì´ë“œ íŒ¨ë„ -->
    <div id="drilldown-panel" class="side-panel">
      <div class="panel-header" style="display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e5e7eb;">
        <h4 id="drilldown-title" style="margin:0;font-size:18px;color:#1f2937;">ì•„ì´í…œ ìƒì„¸</h4>
        <button id="close-drilldown" style="background:#ef4444;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;font-size:14px;font-weight:600;">âœ•</button>
      </div>
      
      <div style="padding:16px;">
        <div class="period-selector" style="display:flex;gap:8px;margin-bottom:16px;">
          <button class="period-btn active" data-period="CUR" style="flex:1;padding:10px;border:2px solid #4f46e5;background:#4f46e5;color:#fff;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s;">ë‹¹ë…„</button>
          <button class="period-btn" data-period="PY" style="flex:1;padding:10px;border:2px solid #cbd5e1;background:#fff;color:#475569;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s;">ì „ë…„</button>
          <button class="period-btn" data-period="PY_END" style="flex:1;padding:10px;border:2px solid #cbd5e1;background:#fff;color:#475569;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s;">ì „ë…„ë§ˆê°</button>
        </div>
        
        <input type="text" id="product-search" placeholder="ìƒí’ˆëª… ê²€ìƒ‰..." style="width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:8px;font-size:14px;margin-bottom:16px;">
        
        <div style="overflow-x:auto;max-height:calc(100vh - 250px);overflow-y:auto;">
          <table id="drilldown-table" class="pl-table" style="width:100%;border-collapse:collapse;">
            <thead style="position:sticky;top:0;background:#f8fafc;z-index:1;">
              <tr style="border-bottom:2px solid #cbd5e1;">
                <th style="padding:10px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">ìƒí’ˆì½”ë“œ</th>
                <th style="padding:10px 8px;text-align:left;font-size:12px;color:#475569;font-weight:600;">ìƒí’ˆëª…</th>
                <th style="padding:10px 8px;text-align:right;font-size:12px;color:#475569;font-weight:600;">ëˆ„ì íŒë§¤TAG</th>
                <th style="padding:10px 8px;text-align:center;font-size:12px;color:#475569;font-weight:600;">íŒë§¤ìœ¨</th>
                <th style="padding:10px 8px;text-align:right;font-size:12px;color:#475569;font-weight:600;">ë°œì£¼TAG</th>
                <th style="padding:10px 8px;text-align:right;font-size:12px;color:#475569;font-weight:600;">ì…ê³ TAG</th>
                <th style="padding:10px 8px;text-align:right;font-size:12px;color:#475569;font-weight:600;">ì¬ê³ TAG</th>
              </tr>
            </thead>
            <tbody id="drilldown-tbody">
              <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ì¬ê³ ì£¼ìˆ˜ ë“œë¦´ë‹¤ìš´ ì‚¬ì´ë“œ íŒ¨ë„ -->
    <div id="stock-weeks-drilldown-panel" class="side-panel">
      <div class="panel-header" style="display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e5e7eb;">
        <h4 id="stock-weeks-drilldown-title" style="margin:0;font-size:18px;color:#1f2937;">ì•„ì´í…œ ìƒì„¸ (ì¬ê³ ì£¼ìˆ˜)</h4>
        <button id="close-stock-weeks-drilldown" style="background:#ef4444;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;font-size:14px;font-weight:600;">âœ•</button>
      </div>
      
      <div style="padding:16px;">
        <div class="period-selector" style="display:flex;gap:8px;margin-bottom:16px;">
          <button class="stock-weeks-period-btn active" data-period="CY" style="flex:1;padding:10px;border:2px solid #4f46e5;background:#4f46e5;color:#fff;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s;">ë‹¹ë…„</button>
          <button class="stock-weeks-period-btn" data-period="PY" style="flex:1;padding:10px;border:2px solid #cbd5e1;background:#fff;color:#475569;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s;">ì „ë…„</button>
        </div>
        
        <input type="text" id="stock-weeks-product-search" placeholder="ìƒí’ˆëª…/í’ˆë²ˆ ê²€ìƒ‰..." style="width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:8px;font-size:14px;margin-bottom:16px;">
        
        <div style="overflow-x:auto;max-height:calc(100vh - 250px);overflow-y:auto;">
          <table id="stock-weeks-drilldown-table" class="pl-table" style="width:100%;border-collapse:collapse;">
            <thead style="position:sticky;top:0;background:#f8fafc;z-index:1;">
              <tr style="border-bottom:2px solid #cbd5e1;">
                <th style="padding:8px 6px;text-align:center;font-size:11px;color:#475569;font-weight:600;">í’ˆë²ˆ</th>
                <th style="padding:8px 6px;text-align:left;font-size:11px;color:#475569;font-weight:600;">í’ˆëª…</th>
                <th style="padding:8px 6px;text-align:right;font-size:11px;color:#475569;font-weight:600;">ì£¼ê°„íŒë§¤ìˆ˜ëŸ‰</th>
                <th style="padding:8px 6px;text-align:right;font-size:11px;color:#475569;font-weight:600;">ì£¼ê°„TAGë§¤ì¶œ</th>
                <th style="padding:8px 6px;text-align:center;font-size:11px;color:#475569;font-weight:600;">4ì£¼í‰ê· íŒë§¤ëŸ‰</th>
                <th style="padding:8px 6px;text-align:center;font-size:11px;color:#475569;font-weight:600;">ì¬ê³ ì£¼ìˆ˜</th>
                <th style="padding:8px 6px;text-align:right;font-size:11px;color:#475569;font-weight:600;">ì¬ê³ ìˆ˜ëŸ‰</th>
                <th style="padding:8px 6px;text-align:right;font-size:11px;color:#475569;font-weight:600;">ì¬ê³ TAG</th>
              </tr>
            </thead>
            <tbody id="stock-weeks-drilldown-tbody">
              <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” -->
    <div id="item-treemap-sidebar" class="item-treemap-sidebar">
      <div class="panel-header" style="display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:2px solid #e5e7eb;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);">
        <h4 style="margin:0;font-size:20px;color:#fff;font-weight:700;">ğŸ“Š ì•„ì´í…œë³„ ë§¤ì¶œ ìƒì„¸ ì •ë³´</h4>
        <button id="close-item-treemap-sidebar" style="background:#ef4444;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.3s ease;">âœ• ë‹«ê¸°</button>
      </div>
      
      <div style="padding:24px;overflow-y:auto;height:calc(100vh - 80px);">
        <!-- ìš”ì•½ ì •ë³´ ì¹´ë“œ (ë¸Œëœë“œ + ë§¤ì¶œ ë°°ë„ˆ) -->
        <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px;padding:20px;margin-bottom:24px;box-shadow:0 4px 12px rgba(0,0,0,0.1);">
          <div style="color:#fff;font-size:14px;margin-bottom:8px;opacity:0.9;">í˜„ì¬ ì„ íƒëœ ë¸Œëœë“œ</div>
          <div id="sidebar-brand-name" style="color:#fff;font-size:24px;font-weight:700;margin-bottom:16px;">-</div>
          
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div style="background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);border-radius:8px;padding:12px;">
              <div style="color:#fff;font-size:12px;margin-bottom:4px;opacity:0.9;">ì´ ë§¤ì¶œ</div>
              <div id="sidebar-total-revenue" style="color:#fff;font-size:18px;font-weight:700;">0ì›</div>
            </div>
            <div style="background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);border-radius:8px;padding:12px;">
              <div style="color:#fff;font-size:12px;margin-bottom:4px;opacity:0.9;">ë§¤ì¶œê¸°ê°„</div>
              <div id="sidebar-sales-period" style="color:#fff;font-size:18px;font-weight:700;">-</div>
            </div>
          </div>
        </div>

        <!-- ìœ ì˜ì‚¬í•­ -->
        <div style="background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid #e5e7eb;">
          <h5 style="color:#dc2626;font-size:14px;font-weight:700;margin-bottom:12px;">* ìœ ì˜ì‚¬í•­</h5>
          <div style="font-size:12px;color:#475569;line-height:1.8;">
            <p>ëŒ€ì‹œë³´ë“œ ì‹¤íŒë§¤ì¶œì€ ì™„ë¶ˆê¸°ì¤€(ì¬ë¬´ì†ìµ ê¸°ì¤€) ë§¤ì¶œì´ë©°,<br>
            í˜„ ë°ì´í„°ì˜ ì‹¤íŒë§¤ì¶œì€ íŒë§¤ì¼ì ê¸°ì¤€(íŒë§¤ê¸°ì¤€) ë§¤ì¶œì…ë‹ˆë‹¤.</p>
            <p style="margin-top:8px;">ë§¤ì¶œì¸ì‹ ê¸°ì¤€ ì‹œì ì˜ ì°¨ì´ë¡œ ì¸í•´ ë™ì¼ ê¸°ê°„ì´ë¼ë„ ë§¤ì¶œ ê¸ˆì•¡ì— ì°¨ì´ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
          
          <details style="margin-top:12px;">
            <summary style="cursor:pointer;font-weight:600;color:#1f2937;font-size:13px;">ëŒ€ì‹œë³´ë“œ ë§¤ì¶œ ë°ì´í„° ë¶„ë¥˜</summary>
            <div style="margin-top:12px;font-size:12px;color:#475569;line-height:1.8;">
              <p><strong>ì „ì²´í˜„í™©</strong></p>
              <ul style="margin-left:20px;margin-top:4px;">
                <li>ì™„ë¶ˆê¸°ì¤€(ì¬ë¬´ì†ìµ): KPI, ë¸Œëœë“œë³„ ë§¤ì¶œí˜„í™© & ì˜ì—…ì´ìµ, ì „ì²´ ë¸Œëœë“œ ë§¤ì¶œê³„íš/ì „ë…„ë¹„ ë ˆì´ë”ì°¨íŠ¸, ì „ì²´ì†ìµêµ¬ì¡°</li>
                <li>íŒë§¤ì¼ìê¸°ì¤€: ì›”ì¤‘ ëˆ„ì  ë§¤ì¶œì¶”ì´, ë‹¹ì‹œì¦Œì˜ë¥˜íŒë§¤ìœ¨/ACCì¬ê³ ì£¼ìˆ˜ë¶„ì„</li>
              </ul>
              <p style="margin-top:8px;"><strong>ë¸Œëœë“œë³„ í˜„í™©</strong></p>
              <ul style="margin-left:20px;margin-top:4px;">
                <li>ì™„ë¶ˆê¸°ì¤€(ì¬ë¬´ì†ìµ): KPI, ì†ìµê³„ì‚°ì„œ, ë§¤ì¶œê³„íš/ì „ë…„ë¹„ ë ˆì´ë”ì°¨íŠ¸, ì£¼ìš”ì±„ë„ë³„ ì†ìµ</li>
                <li>íŒë§¤ì¼ìê¸°ì¤€: ì£¼ì°¨ë³„ë§¤ì¶œì¶”ì„¸, ë‹¹ì‹œì¦Œì˜ë¥˜íŒë§¤ìœ¨/ACCì¬ê³ ì£¼ìˆ˜ë¶„ì„</li>
              </ul>
            </div>
          </details>
        </div>

        <!-- 1. ì•„ì´í…œë³„ ìƒì„¸ -->
        <div style="background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid #e5e7eb;">
          <h5 style="color:#1f2937;font-size:16px;font-weight:700;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #e5e7eb;">
            ğŸ“‹ 1. ì•„ì´í…œë³„ ìƒì„¸
          </h5>
          
          <!-- 1-1. ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„ ë“œë¦´ë‹¤ìš´ -->
          <div style="margin-bottom:20px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
              <h6 style="color:#475569;font-size:14px;font-weight:600;margin:0;padding-left:8px;border-left:3px solid #4f46e5;">
                1) ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„ ë“œë¦´ë‹¤ìš´
              </h6>
              <button id="sidebar-category-channel-back-btn" onclick="sidebarCategoryChannelGoBack()" style="display:none;padding:4px 12px;background:#8b5cf6;color:white;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.3s ease;">
                â† ë’¤ë¡œ
              </button>
            </div>
            <div style="background:#f8fafc;border-radius:8px;padding:16px;">
              <!-- íŠ¸ë¦¬ë§µ ì˜ì—­ -->
              <div id="sidebar-category-channel-treemap" style="min-height:350px;background:#fff;border-radius:6px;border:1px solid #e5e7eb;"></div>
            </div>
          </div>

          <!-- 1-2. ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ -->
          <div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
              <h6 style="color:#475569;font-size:14px;font-weight:600;margin:0;padding-left:8px;border-left:3px solid #10b981;">
                2) ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ ë“œë¦´ë‹¤ìš´
              </h6>
              <button id="sidebar-category-item-back-btn" onclick="sidebarCategoryItemGoBack()" style="display:none;padding:4px 12px;background:#f59e0b;color:white;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.3s ease;">
                â† ë’¤ë¡œ
              </button>
            </div>
            <div style="background:#f8fafc;border-radius:8px;padding:16px;">
              <!-- íŠ¸ë¦¬ë§µ ì˜ì—­ -->
              <div id="sidebar-category-item-treemap" style="min-height:350px;background:#fff;border-radius:6px;border:1px solid #e5e7eb;"></div>
            </div>
          </div>
        </div>

        <!-- 2. í• ì¸ë‚´ì—­ -->
        <div style="background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid #e5e7eb;">
          <h5 style="color:#1f2937;font-size:16px;font-weight:700;margin-bottom:8px;padding-bottom:12px;border-bottom:2px solid #e5e7eb;display:flex;align-items:center;gap:8px;">
            <span style="font-size:20px;">ğŸ’°</span>
            <span>2. í• ì¸ë‚´ì—­</span>
            <span style="font-size:11px;color:#64748b;font-weight:500;margin-left:8px;">(ë‹¨ìœ„: ë°±ë§Œ)</span>
            <button onclick="testDiscountAPI()" style="margin-left:auto;padding:4px 8px;background:#4f46e5;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:11px;">API í…ŒìŠ¤íŠ¸</button>
          </h5>
          
          <!-- ì•ˆë‚´ ë©˜íŠ¸ -->
          <div style="background:#fef3c7;border-left:4px solid #f59e0b;padding:10px 12px;margin-bottom:12px;border-radius:6px;">
            <div style="font-size:11px;color:#92400e;font-weight:600;display:flex;align-items:center;gap:6px;">
              <span style="font-size:14px;">â„¹ï¸</span>
              <span>â€» í• ì¸ë‚´ì—­ì€ ì‚¬ì…Â·ê¸°íƒ€ ì¶œê³ ë§¤ì¶œì„ ì œì™¸í•œ ë¦¬í…Œì¼ íŒë§¤ë§¤ì¶œë§Œì„ í¬í•¨</span>
            </div>
          </div>
          
          <div style="overflow-x:auto;">
            <table id="sidebar-discount-table" style="width:100%;border-collapse:collapse;font-size:12px;">
              <thead>
                <tr style="border-bottom:2px solid #cbd5e1;">
                  <th rowspan="2" style="padding:10px 6px;text-align:left;font-size:12px;color:#475569;font-weight:700;background:#f8fafc;vertical-align:middle;border-right:1px solid #e5e7eb;">í• ì¸ì½”ë“œ</th>
                  <th colspan="2" style="padding:8px 6px;text-align:center;font-size:12px;color:#475569;font-weight:700;background:#f8fafc;border-right:1px solid #e5e7eb;">ë‹¹ë…„</th>
                  <th colspan="2" style="padding:8px 6px;text-align:center;font-size:12px;color:#475569;font-weight:700;background:#f8fafc;border-right:1px solid #e5e7eb;">ì „ë…„</th>
                  <th rowspan="2" style="padding:10px 6px;text-align:center;font-size:12px;color:#475569;font-weight:700;background:#f8fafc;vertical-align:middle;border-right:1px solid #e5e7eb;">YOY</th>
                  <th rowspan="2" style="padding:10px 6px;text-align:center;font-size:12px;color:#475569;font-weight:700;background:#f8fafc;vertical-align:middle;">í• ì¸ìœ¨ì°¨ì´</th>
                </tr>
                <tr style="border-bottom:2px solid #cbd5e1;">
                  <th style="padding:8px 6px;text-align:right;font-size:11px;color:#64748b;font-weight:600;background:#f8fafc;">ì‹¤íŒë§¤ì¶œ</th>
                  <th style="padding:8px 6px;text-align:center;font-size:11px;color:#64748b;font-weight:600;background:#f8fafc;border-right:1px solid #e5e7eb;">í• ì¸ìœ¨</th>
                  <th style="padding:8px 6px;text-align:right;font-size:11px;color:#64748b;font-weight:600;background:#f8fafc;">ì‹¤íŒë§¤ì¶œ</th>
                  <th style="padding:8px 6px;text-align:center;font-size:11px;color:#64748b;font-weight:600;background:#f8fafc;border-right:1px solid #e5e7eb;">í• ì¸ìœ¨</th>
                </tr>
              </thead>
              <tbody id="sidebar-discount-tbody">
                <!-- ë°ì´í„°ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
              </tbody>
            </table>
          </div>

          <!-- í• ì¸ìœ¨ ì°¨íŠ¸ (ì„ íƒì‚¬í•­) -->
          <div style="margin-top:16px;padding-top:16px;border-top:1px solid #e5e7eb;">
            <canvas id="sidebar-discount-chart" style="max-height:200px;"></canvas>
          </div>
        </div>

        <!-- 3. í”„ë¡œëª¨ì…˜ ë‚´ìš© -->
        <div style="background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid #e5e7eb;">
          <h5 style="color:#1f2937;font-size:16px;font-weight:700;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #e5e7eb;">
            ğŸ¯ 3. í”„ë¡œëª¨ì…˜ ë‚´ìš©
          </h5>
          
          <div id="sidebar-promotion-content" style="background:#f8fafc;border-radius:8px;padding:16px;min-height:150px;">
            <div style="color:#64748b;font-size:13px;line-height:1.7;">
              <p style="margin-bottom:10px;">ğŸ“Œ ì§„í–‰ ì¤‘ì¸ í”„ë¡œëª¨ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              <div id="promotion-list" style="display:none;">
                <!-- í”„ë¡œëª¨ì…˜ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- í”„ë¡œëª¨ì…˜ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="promotion-detail-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;align-items:center;justify-content:center;">
      <div style="background:#fff;border-radius:12px;max-width:90%;max-height:90%;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.3);display:flex;flex-direction:column;">
        <!-- ëª¨ë‹¬ í—¤ë” -->
        <div style="padding:20px 24px;border-bottom:2px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,#667eea,#764ba2);">
          <h3 id="promotion-modal-title" style="color:#fff;font-size:18px;font-weight:700;margin:0;">í”„ë¡œëª¨ì…˜ ìƒì„¸ ì •ë³´</h3>
          <button onclick="closePromotionDetailModal()" style="background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:24px;cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.2)';">Ã—</button>
        </div>
        
        <!-- ëª¨ë‹¬ ë°”ë”” -->
        <div style="padding:24px;overflow-y:auto;max-height:calc(90vh - 120px);">
          <div id="promotion-modal-body">
            <!-- ìƒì„¸ í…Œì´ë¸”ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>

    <!-- ì†ìµê³„ì‚°ì„œ íŒ¨ë„ -->
    <div class="financial-report">
      <div id="overview-pl">
        <h3>ğŸ“Š ì „ì²´ ì†ìµê³„ì‚°ì„œ</h3>
        <table class="pl-table">
          <thead><tr><th class="item-name">êµ¬ë¶„</th><th>ì „ë…„</th><th>ëª©í‘œ</th><th>ì›”ë§ì˜ˆìƒ</th><th>ì „ë…„ëŒ€ë¹„</th><th>ë‹¬ì„±ë¥ </th></tr></thead>
          <tbody>
            <tr><td class="item-name">TAGë§¤ì¶œ</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name">ì‹¤íŒë§¤ì¶œ(V+)</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name">í• ì¸ìœ¨</td><td class="editable" contenteditable="false">0.0%</td><td class="editable" contenteditable="false">0.0%</td><td class="editable" contenteditable="false">0.0%</td><td class="editable" contenteditable="false"></td><td class="editable" contenteditable="false"></td></tr>
            <tr><td class="item-name sub-item">(ë§¤ì¶œì›ê°€)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr class="total-row"><td class="item-name">ë§¤ì¶œì´ì´ìµ</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">(ì§ì ‘ë¹„)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ì¸ê±´ë¹„</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ì„ì°¨ê´€ë¦¬ë¹„</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ë¬¼ë¥˜ìš´ì†¡ë¹„</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ë¡œì—´í‹°</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ê°ê°€ìƒê°ë¹„</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">- ê¸°íƒ€</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr class="total-row"><td class="item-name">ì§ì ‘ì´ìµ</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr><td class="item-name sub-item">(ì˜ì—…ë¹„)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">(0)</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
            <tr class="total-row"><td class="item-name">ì˜ì—…ì´ìµ</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">0</td><td class="editable" contenteditable="false">-</td><td class="editable" contenteditable="false">-</td></tr>
          </tbody>
        </table>
      </div>

      <div id="brand-pl" style="display:none;">
        <h3>ğŸ“Š MLB ì†ìµê³„ì‚°ì„œ</h3>
        <table class="pl-table">
          <thead><tr><th class="item-name">êµ¬ë¶„í•­ëª©</th><th>ì „ë…„</th><th>ëª©í‘œ</th><th>ì›”ë§ì˜ˆìƒ</th><th>ì „ë…„ëŒ€ë¹„</th><th>ëª©í‘œëŒ€ë¹„</th></tr></thead>
          <tbody>
            <tr><td class="item-name">TAGë§¤ì¶œ</td><td>0</td><td>0</td><td>0</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name">ì‹¤íŒë§¤ì¶œ(V+)</td><td>0</td><td>0</td><td>0</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name">í• ì¸ìœ¨</td><td>0.0%</td><td>0.0%</td><td>0.0%</td><td></td><td></td></tr>
            <tr><td class="item-name sub-item">(ë§¤ì¶œì›ê°€)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr class="total-row"><td class="item-name">ë§¤ì¶œì´ì´ìµ</td><td>0</td><td>0</td><td>0</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">(ì§ì ‘ë¹„)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ì¸ê±´ë¹„</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ì„ì°¨ê´€ë¦¬ë¹„</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ë¬¼ë¥˜ìš´ì†¡ë¹„</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ë¡œì—´í‹°</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ê°ê°€ìƒê°ë¹„</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">- ê¸°íƒ€</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr class="total-row"><td class="item-name">ì§ì ‘ì´ìµ</td><td>0</td><td>0</td><td>0</td><td>-</td><td>-</td></tr>
            <tr><td class="item-name sub-item">(ì˜ì—…ë¹„)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>-</td><td>-</td></tr>
            <tr class="total-row"><td class="item-name">ì˜ì—…ì´ìµ</td><td>0</td><td>0</td><td>0</td><td>-</td><td>-</td></tr>
          </tbody>
        </table>

      </div>
      
      <!-- ë¸Œëœë“œë³„ ë¶„ì„ AI ê·¸ë˜í”„ë³„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë…¸íŠ¸ë“¤ (ì ˆëŒ€ ìœ„ì¹˜ë¡œ ë°°ì¹˜í•˜ì—¬ ë ˆì´ì•„ì›ƒì— ì˜í–¥ ì—†ìŒ) -->
      <!-- ì±„ë„ë³„/ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± (ìš°ì¸¡ íŒ¨ë„ ìƒë‹¨ - ë§¨ ìœ„ë¶€í„° ì¤‘ê°„ê¹Œì§€) -->
      <div id="ai-insight-treemap" class="ai-part-note" style="display:none;position:absolute;top:320px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š ì±„ë„ë³„/ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„±</div>
        <div id="ai-insight-treemap-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      
      <!-- ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„ (ìš°ì¸¡ íŒ¨ë„ ìƒë‹¨ ì¤‘ê°„ - ì¤‘ê°„ë¶€í„° ì±„ë„ë³„/ì•„ì´í…œë³„ ë°•ìŠ¤ ëê¹Œì§€) -->
      <div id="ai-insight-radar" class="ai-part-note" style="display:none;position:absolute;top:450px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„</div>
        <div id="ai-insight-radar-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      
      <!-- ì£¼ìš” ì±„ë„ë³„ ì†ìµ ë¶„ì„ (ìš°ì¸¡ íŒ¨ë„ ì¤‘ê°„ - ì£¼ìš” ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” ìœ„ì¹˜) -->
      <div id="ai-insight-channel-pl" class="ai-part-note" style="display:none;position:absolute;top:640px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š ì£¼ìš” ì±„ë„ë³„ ì†ìµ ë¶„ì„</div>
        <div id="ai-insight-channel-pl-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      
      <!-- ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ (ìš°ì¸¡ íŒ¨ë„ ì¤‘ê°„ - ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸ ìœ„ì¹˜) -->
      <div id="ai-insight-weekly" class="ai-part-note" style="display:none;position:absolute;top:640px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸</div>
        <div id="ai-insight-weekly-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      
      <!-- íŒë§¤ìœ¨ ë¶„ì„ (ìš°ì¸¡ íŒ¨ë„ í•˜ë‹¨ - íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ìœ„ì¹˜) -->
      <div id="ai-insight-sale-rate" class="ai-part-note" style="display:none;position:absolute;top:940px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š íŒë§¤ìœ¨ ë¶„ì„</div>
        <div id="ai-insight-sale-rate-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      
      <!-- ì¬ê³ ì£¼ìˆ˜ ë¶„ì„ (ìš°ì¸¡ íŒ¨ë„ í•˜ë‹¨ - íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ìœ„ì¹˜) -->
      <div id="ai-insight-inventory" class="ai-part-note" style="display:none;position:absolute;top:1020px;left:20px;right:20px;padding:12px;background:#fff7ed;border:1px solid #fdba74;border-radius:8px;z-index:10;">
        <div style="font-weight:700;margin-bottom:6px;font-size:13px;color:#92400e;">ğŸ“Š ì¬ê³ ì£¼ìˆ˜ ë¶„ì„</div>
        <div id="ai-insight-inventory-content" style="font-size:12px;color:#92400e;line-height:1.6;"></div>
      </div>
      <!-- ìš°ì¸¡ íŒ¨ë„ í•˜ë‹¨ AI ì½”ë©˜íŠ¸ ë©”ëª¨ë“¤ (ê°œìš”/ë¸Œëœë“œ ê³µìš©) -->
      <div id="ai-rightnotes">
        <div id="ai-rightnote-1" class="ai-rightnote"></div>
        <div id="ai-rightnote-2" class="ai-rightnote"></div>
        <div id="ai-rightnote-3" class="ai-rightnote"></div>
      </div>
    </div>
  </div>

  <script>
    // â€» í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì§í›„ ìŠ¤í… ë“±ë¡ (DOM ë¡œë“œ ì „ í´ë¦­ ëŒ€ë¹„)
    window.showDiscountDetail = function(discountCode, brandName) {
      var fn = window.__showDiscountDetailImpl;
      if (typeof fn === 'function') return fn(discountCode, brandName);
      alert('í• ì¸ë‚´ì—­ ìƒì„¸ ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. í˜ì´ì§€ê°€ ì™„ì „íˆ ëœ¬ ë’¤ ì ì‹œ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    };

    // ---------- ë°ì´í„° ì°¸ì¡° ì„¸íŒ… (JSON ë°©ì‹) ----------
    // â˜… JSON íŒŒì¼ì´ ê°œë³„ ì „ì—­ ë³€ìˆ˜ë¡œ ë¡œë“œë¨
    console.log('[ë°ì´í„°] ì „ì—­ ë³€ìˆ˜ ìƒíƒœ:');
    console.log('  - overviewPL:', !!window.overviewPL);
    console.log('  - by_brand:', !!window.by_brand);
    console.log('  - brandPLData:', !!window.brandPLData);
    console.log('  - brandKPI:', !!window.brandKPI);

    // ========== í¸ì§‘ ëª¨ë“œ ê¸°ëŠ¥ (ê°œì„  ë²„ì „) ==========
    let isEditMode = false;
    // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ (ê° ì—…ë°ì´íŠ¸ ì¼ìë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ ì €ì¥) â˜…â˜…â˜…
    const getStorageKey = (baseKey) => {
      const dateStr = window.__DATA_DATE__ || '';
      return dateStr ? `${baseKey}_${dateStr}` : baseKey;
    };
    const STORAGE_KEY = getStorageKey('dashboard_edits');
    const ORIGINAL_DATA_KEY = getStorageKey('dashboard_original');

    // ID ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ  í‚¤ ìƒì„±
    function getElementKey(el) {
      // ì¸ì‚¬ì´íŠ¸ ì˜ì—­ì€ ì„¹ì…˜ê³¼ ë¸Œëœë“œ ì •ë³´ í¬í•¨
      if (el.id === 'overview-insights') {
        return 'insights:overview';
      }
      if (el.id === 'brand-insights') {
        return `insights:brand:${currentBrand}`;
      }
      
      // KPI ì¹´ë“œë“¤ì€ ë¸Œëœë“œë³„ë¡œ ë…ë¦½ì ì¸ í‚¤ ìƒì„±
      if (el.id && el.id.startsWith('brand-')) {
        return `kpi:${currentBrand}:${el.id}`;
      }
      
      if (el.id) return 'id:' + el.id;
      
      // IDê°€ ì—†ìœ¼ë©´ ë¶€ëª¨ êµ¬ì¡°ì™€ ìœ„ì¹˜ë¡œ ê³ ìœ í‚¤ ìƒì„±
      // í…Œì´ë¸” ì…€ì˜ ê²½ìš°: í…Œì´ë¸” ì‹ë³„ + ë¸Œëœë“œ + í–‰/ì—´ ìœ„ì¹˜ ì‚¬ìš©
      if (el.tagName === 'TD') {
        const row = el.parentElement;
        const table = row.closest('table');
        const tbody = row.parentElement;
        
        // í…Œì´ë¸” ì‹ë³„ (ê°€ì¥ ê°€ê¹Œìš´ idë¥¼ ê°€ì§„ ë¶€ëª¨ ì°¾ê¸°)
        let tableId = '';
        let parent = table;
        while (parent && !parent.id) {
          parent = parent.parentElement;
        }
        if (parent && parent.id) {
          tableId = parent.id;
        }
        
        // í–‰/ì—´ ìœ„ì¹˜
        const rowIndex = Array.from(tbody.children).indexOf(row);
        const cellIndex = Array.from(row.children).indexOf(el);
        
        // ì²« ë²ˆì§¸ ì…€ì˜ í…ìŠ¤íŠ¸ (í–‰ ì‹ë³„ìš©)
        const firstCellText = row.querySelector('.item-name')?.textContent || '';
        
        // brand-pl í…Œì´ë¸”ì´ê±°ë‚˜ channel-pl-tbodyì´ë©´ ë¸Œëœë“œ ì •ë³´ í¬í•¨
        if (tableId === 'brand-pl' || parent?.id === 'brand-pl' || tbody?.id === 'channel-pl-tbody') {
          return `table:${tableId}:${currentBrand}:${firstCellText}:${rowIndex}:${cellIndex}`;
        }
        
        return `table:${tableId}:${firstCellText}:${rowIndex}:${cellIndex}`;
      }
      
      // ì¼ë°˜ ìš”ì†ŒëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì™€ í…ìŠ¤íŠ¸ ì‚¬ìš©
      const parent = el.parentElement?.className || '';
      const text = el.textContent.substring(0, 20);
      return 'text:' + parent + ':' + text;
    }

    // ì›ë³¸ ë°ì´í„° ì €ì¥ (í‚¤ ê¸°ë°˜) - ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ìš”ì†Œ ê³ ë ¤
    function saveOriginalData() {
      // ì´ë¯¸ ì›ë³¸ì´ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°
      if (localStorage.getItem(ORIGINAL_DATA_KEY)) {
        return;
      }
      
      // ëª¨ë“  ì°¨íŠ¸ì™€ í…Œì´ë¸”ì´ ë¡œë“œëœ í›„ ì›ë³¸ ë°ì´í„° ì €ì¥
      setTimeout(() => {
        const editables = document.querySelectorAll('.editable');
        const originalData = {};
        editables.forEach((el) => {
          // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” ì›ë³¸ ë°ì´í„°ì—ë„ ì €ì¥í•˜ì§€ ì•ŠìŒ â˜…â˜…â˜…
          const isKPI = el.closest('.kpi-card') !== null || 
                       el.closest('#overview-kpi-4') !== null || 
                       el.closest('#overview-kpi-9') !== null ||
                       el.closest('#brand-kpi') !== null ||
                       (el.id && (el.id.includes('overview-') || el.id.includes('brand-')) && 
                        (el.id.includes('revenue') || el.id.includes('profit') || el.id.includes('opprofit') || el.id.includes('progress')));
          
          const isPL = el.closest('#overview-pl') !== null || 
                       el.closest('#brand-pl') !== null ||
                       el.closest('.pl-table') !== null;
          
          if (isKPI || isPL) {
            return; // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” ì›ë³¸ ë°ì´í„°ì—ë„ ì €ì¥í•˜ì§€ ì•ŠìŒ
          }
          
          const key = getElementKey(el);
          // innerHTMLì´ ìˆëŠ” ìš”ì†ŒëŠ” innerHTMLë¡œ, ì•„ë‹ˆë©´ textContentë¡œ
          originalData[key] = el.innerHTML && el.innerHTML.includes('<') ? el.innerHTML : el.textContent;
        });
        localStorage.setItem(ORIGINAL_DATA_KEY, JSON.stringify(originalData));
        console.log(`ğŸ“¦ ì›ë³¸ ë°ì´í„° ${Object.keys(originalData).length}ê°œ í•­ëª© ì €ì¥ë¨ (KPI ë° ì†ìµê³„ì‚°ì„œ ì œì™¸)`);
      }, 1000);
    }

    // í¸ì§‘ëœ ë°ì´í„° ì €ì¥ (í‚¤ ê¸°ë°˜) - ë³€ê²½ëœ ê²ƒë§Œ ì €ì¥
    function saveEdits() {
      const editables = document.querySelectorAll('.editable');
      const original = JSON.parse(localStorage.getItem(ORIGINAL_DATA_KEY) || '{}');
      const currentEdits = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      
      const edits = {};
      let changedCount = 0;
      
      editables.forEach((el) => {
        // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ â˜…â˜…â˜…
        const isKPI = el.closest('.kpi-card') !== null || 
                     el.closest('#overview-kpi-4') !== null || 
                     el.closest('#overview-kpi-9') !== null ||
                     el.closest('#brand-kpi') !== null ||
                     (el.id && (el.id.includes('overview-') || el.id.includes('brand-')) && 
                      (el.id.includes('revenue') || el.id.includes('profit') || el.id.includes('opprofit') || el.id.includes('progress')));
        
        const isPL = el.closest('#overview-pl') !== null || 
                     el.closest('#brand-pl') !== null ||
                     el.closest('.pl-table') !== null;
        
        if (isKPI || isPL) {
          return; // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
        }
        
        const key = getElementKey(el);
        // innerHTMLì´ ìˆëŠ” ìš”ì†ŒëŠ” innerHTMLë¡œ, ì•„ë‹ˆë©´ textContentë¡œ
        const currentValue = el.innerHTML && el.innerHTML.includes('<') ? el.innerHTML : el.textContent;
        const originalValue = original[key];
        
        // ì›ë³¸ê³¼ ë‹¤ë¥¸ ê²½ìš°ì—ë§Œ ì €ì¥
        if (currentValue !== originalValue) {
          edits[key] = currentValue;
          changedCount++;
        } else if (currentEdits[key]) {
          // ì›ë³¸ê³¼ ê°™ì§€ë§Œ ì´ì „ì— í¸ì§‘í–ˆë˜ ê²ƒì€ ì œê±°
          delete currentEdits[key];
        }
      });
      
      // ê¸°ì¡´ í¸ì§‘ ë‚´ìš©ê³¼ ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ ë³‘í•©
      const finalEdits = { ...currentEdits, ...edits };
      
      localStorage.setItem(STORAGE_KEY, JSON.stringify(finalEdits));
      
      // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ë‚´ìš©ë„ í•¨ê»˜ ì €ì¥
      if (currentSection === 'brand' && window.aiPartMode) {
        saveAIPartEdits();
      }
      
      console.log(`âœ… ë³€ê²½ëœ í•­ëª©: ${changedCount}ê°œ, ì´ ì €ì¥ëœ í¸ì§‘: ${Object.keys(finalEdits).length}ê°œ`, finalEdits);
      
      if (changedCount === 0 && Object.keys(finalEdits).length === 0) {
        alert('âš ï¸ ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
      } else {
        alert('âœ… ìˆ˜ì •ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.');
      }
    }

    // í¸ì§‘ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (í‚¤ ê¸°ë°˜)
    function loadEdits() {
      const edits = localStorage.getItem(STORAGE_KEY);
      if (edits) {
        const data = JSON.parse(edits);
        const editables = document.querySelectorAll('.editable');
        let loadedCount = 0;
        editables.forEach((el) => {
          // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” localStorageì—ì„œ ë¡œë“œí•˜ì§€ ì•ŠìŒ (JSON ë°ì´í„°ë§Œ ì‚¬ìš©) â˜…â˜…â˜…
          const isKPI = el.closest('.kpi-card') !== null || 
                       el.closest('#overview-kpi-4') !== null || 
                       el.closest('#overview-kpi-9') !== null ||
                       el.closest('#brand-kpi') !== null ||
                       (el.id && (el.id.includes('overview-') || el.id.includes('brand-')) && 
                        (el.id.includes('revenue') || el.id.includes('profit') || el.id.includes('opprofit') || el.id.includes('progress')));
          
          const isPL = el.closest('#overview-pl') !== null || 
                       el.closest('#brand-pl') !== null ||
                       el.closest('.pl-table') !== null;
          
          // ì œì™¸í•  ìš”ì†Œë“¤ (ê¸°ì¡´ íŒ¨í„´)
          const id = el.id || '';
          const className = el.className || '';
          const excludePatterns = [
            'opprofit', 'ì˜ì—…ì´ìµ',  // ì˜ì—…ì´ìµ
            'revenue-change', 'revenue-yoy',  // ë§¤ì¶œ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„
            'profit-change', 'profit-yoy',  // ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„
            'progress-change', 'progress-yoy',  // ì§„ì²™ìœ¨ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„
            'channel-pl'  // ì£¼ìš” ì±„ë„ë³„ ì†ìµ
          ];
          
          // â˜…â˜…â˜… ì£¼ìš” ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” ë‚´ë¶€ ìš”ì†Œ í™•ì¸ (ë” í™•ì‹¤í•œ ë°©ë²•) â˜…â˜…â˜…
          const channelPLTableBody = document.getElementById('channel-pl-inline-body');
          const isInChannelPLTable = channelPLTableBody && (
            channelPLTableBody.contains(el) ||  // tbody ë‚´ë¶€ì— ìˆëŠ”ì§€ í™•ì¸
            el.closest('#channel-pl-inline-body') !== null ||  // closestë¡œë„ í™•ì¸
            (el.closest('table') && el.closest('table').querySelector('#channel-pl-inline-body') === channelPLTableBody)  // ê°™ì€ í…Œì´ë¸” ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
          );
          
          const shouldExclude = isKPI || isPL || 
                                excludePatterns.some(pattern => 
                                  id.includes(pattern) || className.includes(pattern)
                                ) || isInChannelPLTable;
          
          if (shouldExclude) {
            return; // JSON ë°ì´í„° ìš°ì„ ì´ë¯€ë¡œ localStorageì—ì„œ ë¡œë“œí•˜ì§€ ì•ŠìŒ
          }
          
          const key = getElementKey(el);
          if (data[key] !== undefined) {
            // innerHTMLì´ ìˆëŠ” ìš”ì†ŒëŠ” innerHTMLë¡œ, ì•„ë‹ˆë©´ textContentë¡œ
            if (el.innerHTML && el.innerHTML.includes('<')) {
              el.innerHTML = data[key];
            } else {
              el.textContent = data[key];
            }
            loadedCount++;
          }
        });
        console.log(`âœ… ${loadedCount}ê°œ í•­ëª©ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤ (ì´ ${Object.keys(data).length}ê°œ ì €ì¥ë¨, KPI ë° ì†ìµê³„ì‚°ì„œ ì œì™¸)`);
      } else {
        console.log('âš ï¸ ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
    function resetToOriginal() {
      if (confirm('âš ï¸ ëª¨ë“  ìˆ˜ì •ì‚¬í•­ì„ ì‚­ì œí•˜ê³  ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const original = localStorage.getItem(ORIGINAL_DATA_KEY);
        if (original) {
          const data = JSON.parse(original);
          const editables = document.querySelectorAll('.editable');
          editables.forEach((el) => {
            const key = getElementKey(el);
            if (data[key] !== undefined) {
              el.textContent = data[key];
            }
          });
          localStorage.removeItem(STORAGE_KEY);
          // localStorage ì™„ì „ ì´ˆê¸°í™” (ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ ì œê±°)
          clearAllLocalStorage();
          alert('âœ… ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!');
          // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì™„ì „íˆ ì´ˆê¸°í™”
          location.reload();
        }
      }
    }
    
    // localStorage ì™„ì „ ì´ˆê¸°í™” (ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ ì œê±°)
    function clearAllLocalStorage() {
      // dashboard ê´€ë ¨ localStorage í‚¤ ëª¨ë‘ ì‚­ì œ
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ì‚¬ìš© â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      if (dateStr) {
        localStorage.removeItem(`dashboard_edits_${dateStr}`);
        localStorage.removeItem(`dashboard_original_${dateStr}`);
        localStorage.removeItem(`ai-summary-edits_${dateStr}`);
        // ë¸Œëœë“œë³„ AI í¸ì§‘ ë‚´ìš© ì‚­ì œ
        ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'].forEach(brand => {
          localStorage.removeItem(`ai-part-edits-${brand}_${dateStr}`);
        });
      } else {
        // ë‚ ì§œê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ (í•˜ìœ„ í˜¸í™˜ì„±)
        localStorage.removeItem('dashboard_edits');
        localStorage.removeItem('dashboard_original');
        localStorage.removeItem('ai-summary-edits');
        ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'].forEach(brand => {
          localStorage.removeItem(`ai-part-edits-${brand}`);
        });
      }
      localStorage.removeItem('treemap_sizes'); // treemap_sizesëŠ” ë‚ ì§œì™€ ë¬´ê´€í•˜ê²Œ ìœ ì§€
      console.log('âœ… localStorage ì´ˆê¸°í™” ì™„ë£Œ (ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ ì œê±°)');
      // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í¬ë§·íŒ… ì¬ì ìš©
      location.reload();
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
    window.clearAllLocalStorage = clearAllLocalStorage;

    // í¸ì§‘ ëª¨ë“œ í† ê¸€
    function toggleEditMode() {
      isEditMode = !isEditMode;
      applyEditMode();
      
      const editBtn = document.getElementById('edit-mode-btn');
      const saveBtn = document.getElementById('save-btn');

      if (isEditMode) {
        editBtn.classList.add('active');
        editBtn.textContent = 'ğŸ‘ï¸ ë³´ê¸° ëª¨ë“œ';
        saveBtn.style.display = 'inline-block';
      } else {
        editBtn.classList.remove('active');
        editBtn.textContent = 'âœï¸ í¸ì§‘ ëª¨ë“œ';
        saveBtn.style.display = 'none';
      }
    }

    // í¸ì§‘ ëª¨ë“œ ì ìš© (ë™ì  ìš”ì†Œ í¬í•¨)
    function applyEditMode() {
      const editables = document.querySelectorAll('.editable');
      editables.forEach(el => {
        // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ í¸ì§‘ ë¶ˆê°€ëŠ¥ â˜…â˜…â˜…
        const isKPI = el.closest('.kpi-card') !== null || 
                     el.closest('#overview-kpi-4') !== null || 
                     el.closest('#overview-kpi-9') !== null ||
                     el.closest('#brand-kpi') !== null ||
                     el.id && (el.id.includes('overview-') || el.id.includes('brand-')) && 
                     (el.id.includes('revenue') || el.id.includes('profit') || el.id.includes('opprofit') || el.id.includes('progress'));
        
        const isPL = el.closest('#overview-pl') !== null || 
                     el.closest('#brand-pl') !== null ||
                     el.closest('.pl-table') !== null;
        
        if (isKPI || isPL) {
          // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ í¸ì§‘ ë¶ˆê°€ëŠ¥
          el.contentEditable = false;
        } else {
          el.contentEditable = isEditMode;
        }
      });
      
      // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ëª¨ë“œë„ í•¨ê»˜ ì ìš©
      applyAIPartEditMode();
    }
    
    // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ëª¨ë“œ ì ìš©
    function applyAIPartEditMode() {
      const editables = document.querySelectorAll('.ai-part-editable');
      editables.forEach(el => {
        el.contentEditable = isEditMode;
        if (isEditMode) {
          el.style.border = '1px dashed #3b82f6';
          el.style.padding = '4px';
          el.style.borderRadius = '4px';
          el.style.minHeight = '20px';
        } else {
          el.style.border = 'none';
          el.style.padding = '0';
        }
      });
    }
    
    // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ë‚´ìš© ì €ì¥
    function saveAIPartEdits() {
      const editables = document.querySelectorAll('.ai-part-editable');
      const edits = {};
      
      editables.forEach(el => {
        const id = el.id;
        if (id) {
          // IDì—ì„œ í‚¤ ì¶”ì¶œ (ì˜ˆ: ai-insight-treemap-content -> ai-part-treemap)
          let key = '';
          if (id.includes('treemap')) key = 'ai-part-treemap';
          else if (id.includes('radar')) key = 'ai-part-radar';
          else if (id.includes('channel-pl')) key = 'ai-part-channel-pl';
          else if (id.includes('weekly')) key = 'ai-part-weekly';
          else if (id.includes('sale-rate')) key = 'ai-part-sale-rate';
          else if (id.includes('inventory')) key = 'ai-part-inventory';
          
          if (key) {
            edits[key] = el.innerHTML || el.textContent;
          }
        }
      });
      
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-part-edits-${currentBrand}_${dateStr}` : `ai-part-edits-${currentBrand}`;
      localStorage.setItem(storageKey, JSON.stringify(edits));
      console.log(`âœ… ${currentBrand} ë¸Œëœë“œ AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ë‚´ìš© ì €ì¥ë¨ (ë‚ ì§œ: ${dateStr}):`, edits);
    }
    
    // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ë‚´ìš© ë¡œë“œ
    function loadAIPartEdits() {
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-part-edits-${currentBrand}_${dateStr}` : `ai-part-edits-${currentBrand}`;
      const savedEdits = localStorage.getItem(storageKey);
      if (!savedEdits) return;
      
      const edits = JSON.parse(savedEdits);
      const editables = document.querySelectorAll('.ai-part-editable');
      
      editables.forEach(el => {
        const id = el.id;
        if (id) {
          let key = '';
          if (id.includes('treemap')) key = 'ai-part-treemap';
          else if (id.includes('radar')) key = 'ai-part-radar';
          else if (id.includes('channel-pl')) key = 'ai-part-channel-pl';
          else if (id.includes('weekly')) key = 'ai-part-weekly';
          else if (id.includes('sale-rate')) key = 'ai-part-sale-rate';
          else if (id.includes('inventory')) key = 'ai-part-inventory';
          
          if (key && edits[key] !== undefined) {
            el.innerHTML = edits[key];
          }
        }
      });
    }

    // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” í™•ì¸ (JSON ë°©ì‹)
    if (!window.lastUpdated) window.lastUpdated = null;
    if (!window.by_brand) window.by_brand = null;
    if (!window.brandData) window.brandData = null;

    // 1) last_updatedê°€ ìˆìœ¼ë©´ í—¤ë”ì— ë°˜ì˜
    document.addEventListener('DOMContentLoaded', async () => {
      // ì „ì—­ ë‚ ì§œ ë³€ìˆ˜ ì‚¬ìš©
      const dateParam = window.__DATA_DATE__;  // JSON íŒŒì¼ìš©
      const apiDate = window.__API_DATE__;      // API í˜¸ì¶œìš© (ì˜¤ëŠ˜)
      
      // URLì—ì„œ ë¶„ì„ì›” íŒŒë¼ë¯¸í„° ì½ê¸°
      const urlParams = new URLSearchParams(window.location.search);
      const monthParam = urlParams.get('month');
      
      console.log('[DOMContentLoaded] ë‚ ì§œ:', { dateParam, apiDate, monthParam });
      
      const updateDateElement = document.getElementById('update-date');
      
      // ë°ì´í„° íŒŒì¼ ë¡œë“œ í•¨ìˆ˜ (headì—ì„œ ì •ì  ë¡œë“œëœ ê²½ìš° ìŠ¤í‚µ)
      const loadDataFile = (dateStr) => {
        return new Promise((resolve, reject) => {
          // â˜… ë°ì´í„°ê°€ ì´ë¯¸ headì—ì„œ ì •ì  ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
          const dataAlreadyLoaded = window.overviewPL || window.by_brand || window.brandPLData;
          
          if (dataAlreadyLoaded) {
            console.log('âœ… [ë°ì´í„°ë¡œë“œ] ë°ì´í„°ê°€ ì´ë¯¸ headì—ì„œ ì •ì  ë¡œë“œë¨ - ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ìŠ¤í‚µ');
            console.log('[ë°ì´í„°ë¡œë“œ] window.overviewPL ì¡´ì¬:', !!window.overviewPL);
            console.log('[ë°ì´í„°ë¡œë“œ] window.by_brand ì¡´ì¬:', !!window.by_brand);
            console.log('[ë°ì´í„°ë¡œë“œ] window.cumulativeTrendData ì¡´ì¬:', !!window.cumulativeTrendData);
            
            // í›„ì† ì‘ì—…ë§Œ ìˆ˜í–‰ (brandPLData JSON ë¡œë“œ ë“±)
            const performPostLoadTasks = async () => {
              // brandPLData ì—…ë°ì´íŠ¸
              if (window.brandPLData) {
                brandPLData = window.brandPLData;
                console.log('[ë°ì´í„°ë¡œë“œ] brandPLData ì‚¬ìš©:', Object.keys(brandPLData));
              }
              
              // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
              if (!window.lastUpdated && dateStr) {
                const formattedDate = `${dateStr.slice(0, 4)}.${dateStr.slice(4, 6)}.${dateStr.slice(6, 8)}`;
                window.lastUpdated = formattedDate;
              }
              
              // â˜… brandKPI ë°ì´í„°ë¡œ brandData ì—…ë°ì´íŠ¸ (KPI ì¹´ë“œìš©)
              if (typeof window.brandKPI !== 'undefined' && typeof window.updateBrandDataFromKPI === 'function') {
                console.log('[ë°ì´í„°ë¡œë“œ] brandKPI ë°œê²¬, updateBrandDataFromKPI í˜¸ì¶œ');
                window.updateBrandDataFromKPI();
              }
              
              // brandPLDataëŠ” loadAllDashboardData()ì—ì„œ ì´ë¯¸ ë¡œë“œë¨ (brand_pl.json)
              
              // â˜… ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ (íŠ¸ë¦¬ë§µìš©) - í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
              window.addEventListener('load', () => {
                console.log('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì‹œì‘ (í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„)');
                if (typeof loadSalesCompositionData === 'function') {
                  loadSalesCompositionData().then(() => {
                    console.log('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                    // ì´ˆê¸° ë¸Œëœë“œ íŠ¸ë¦¬ë§µ ë Œë”ë§
                    if (currentBrand && typeof updateBrandTreemaps === 'function') {
                      console.log('[ë°ì´í„°ë¡œë“œ] updateBrandTreemaps í˜¸ì¶œ:', currentBrand);
                      updateBrandTreemaps(currentBrand);
                      
                      // íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                      setTimeout(() => {
                        const treemapChannelLoading = document.getElementById('treemapChannelLoading');
                        const treemapItemLoading = document.getElementById('treemapItemLoading');
                        if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                        if (treemapItemLoading) treemapItemLoading.style.display = 'none';
                        console.log('[ë°ì´í„°ë¡œë“œ] íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€');
                      }, 500);
                    } else {
                      console.warn('[ë°ì´í„°ë¡œë“œ] updateBrandTreemaps í•¨ìˆ˜ ì—†ìŒ ë˜ëŠ” currentBrand ì—†ìŒ');
                    }
                  }).catch(err => {
                    console.error('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
                    // ì‹¤íŒ¨ ì‹œì—ë„ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                    const treemapChannelLoading = document.getElementById('treemapChannelLoading');
                    const treemapItemLoading = document.getElementById('treemapItemLoading');
                    if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                    if (treemapItemLoading) treemapItemLoading.style.display = 'none';
                  });
                } else {
                  console.error('[ë°ì´í„°ë¡œë“œ] loadSalesCompositionData í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
                }
              });
              
              // dataLoaded ì´ë²¤íŠ¸ ë°œìƒ
              console.log('[Dashboard] ë°ì´í„° ë¡œë“œ ì™„ë£Œ, dataLoaded ì´ë²¤íŠ¸ ë°œìƒ');
              window.dispatchEvent(new CustomEvent('dataLoaded'));
            };
            
            performPostLoadTasks().then(() => resolve()).catch(() => resolve());
            return;
          }
          
          // â˜… JSON íŒŒì¼ì—ì„œë§Œ ë°ì´í„° ë¡œë“œ
          console.log('[ë°ì´í„°ë¡œë“œ] JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œì‘');
          
          const loadData = async () => {
            // â˜… JSON íŒŒì¼ë§Œ ì‚¬ìš©
            try {
              await loadAllDashboardData();
              console.log('âœ… JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
              
              // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
              if (!window.lastUpdated && dateStr) {
                const formattedDate = `${dateStr.slice(0, 4)}.${dateStr.slice(4, 6)}.${dateStr.slice(6, 8)}`;
                window.lastUpdated = formattedDate;
              }
              
              // brandPLDataëŠ” loadAllDashboardData()ì—ì„œ ì´ë¯¸ ë¡œë“œë¨ (brand_pl.json)
              
              // brandKPI ë°ì´í„°ë¡œ brandData ì—…ë°ì´íŠ¸
              if (typeof window.brandKPI !== 'undefined' && typeof window.updateBrandDataFromKPI === 'function') {
                window.updateBrandDataFromKPI();
              }
              
              // â˜… ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ (íŠ¸ë¦¬ë§µìš©) - í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
              window.addEventListener('load', () => {
                console.log('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì‹œì‘ (í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„)');
                if (typeof loadSalesCompositionData === 'function') {
                  loadSalesCompositionData().then(() => {
                    console.log('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                    // ì´ˆê¸° ë¸Œëœë“œ íŠ¸ë¦¬ë§µ ë Œë”ë§
                    if (currentBrand && typeof updateBrandTreemaps === 'function') {
                      console.log('[ë°ì´í„°ë¡œë“œ] updateBrandTreemaps í˜¸ì¶œ:', currentBrand);
                      updateBrandTreemaps(currentBrand);
                      
                      // íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                      setTimeout(() => {
                        const treemapChannelLoading = document.getElementById('treemapChannelLoading');
                        const treemapItemLoading = document.getElementById('treemapItemLoading');
                        if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                        if (treemapItemLoading) treemapItemLoading.style.display = 'none';
                        console.log('[ë°ì´í„°ë¡œë“œ] íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€');
                      }, 500);
                    } else {
                      console.warn('[ë°ì´í„°ë¡œë“œ] updateBrandTreemaps í•¨ìˆ˜ ì—†ìŒ ë˜ëŠ” currentBrand ì—†ìŒ');
                    }
                  }).catch(err => {
                    console.error('[ë°ì´í„°ë¡œë“œ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
                    // ì‹¤íŒ¨ ì‹œì—ë„ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                    const treemapChannelLoading = document.getElementById('treemapChannelLoading');
                    const treemapItemLoading = document.getElementById('treemapItemLoading');
                    if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                    if (treemapItemLoading) treemapItemLoading.style.display = 'none';
                  });
                } else {
                  console.error('[ë°ì´í„°ë¡œë“œ] loadSalesCompositionData í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
                }
              });
              
              // â˜… ì†ìµê³„ì‚°ì„œëŠ” jsonDataLoaded ì´ë²¤íŠ¸ì—ì„œ ì—…ë°ì´íŠ¸ (í•¨ìˆ˜ ì •ì˜ í›„)
              console.log('[ë°ì´í„°ë¡œë“œ] window.overviewPL ìƒíƒœ:', !!window.overviewPL);
              if (typeof updateBrandPL === 'function') {
                updateBrandPL();
              }
              
              // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (weekly_trend.json ë¡œë“œ í›„)
              console.log('[ë°ì´í„°ë¡œë“œ] updateWeeklyTrendChart í˜¸ì¶œ ì „, window.weeklySalesTrend ìƒíƒœ:', !!window.weeklySalesTrend);
              if (window.weeklySalesTrend && window.weeklySalesTrend.rawData) {
                console.log('[ë°ì´í„°ë¡œë“œ] window.weeklySalesTrend ë°ì´í„°:', {
                  weeks: window.weeklySalesTrend.weeks?.length,
                  brands: window.weeklySalesTrend.brands,
                  rawDataCount: window.weeklySalesTrend.rawData?.length
                });
                
                // â˜… ë¸Œëœë“œ íƒ­ì´ í™œì„±í™”ëœ ê²½ìš° ì°¨íŠ¸ ì—…ë°ì´íŠ¸ â˜…
                if (typeof updateWeeklyTrendChart === 'function' && currentTab === 'brand') {
                  console.log('[ë°ì´í„°ë¡œë“œ] updateWeeklyTrendChart í•¨ìˆ˜ í˜¸ì¶œ (ë¸Œëœë“œ íƒ­ í™œì„±í™”ë¨)');
                  setTimeout(() => {
                    updateWeeklyTrendChart();
                  }, 100);
                } else {
                  console.log('[ë°ì´í„°ë¡œë“œ] updateWeeklyTrendChart í˜¸ì¶œ ëŒ€ê¸° (í˜„ì¬ íƒ­:', currentTab, ')');
                }
              }
              
              // ì±„ë„ë³„ ì†ìµ ë°ì´í„° ë¡œë“œ í™•ì¸
              const waitForChannelData = (retryCount = 0) => {
                if (window.channelProfitLossData) {
                  if (typeof updateBrandChannels === 'function') {
                    updateBrandChannels();
                  }
                } else if (retryCount < 5) {
                  setTimeout(() => waitForChannelData(retryCount + 1), 200);
                } else if (typeof updateBrandChannels === 'function') {
                  updateBrandChannels();
                }
              };
              setTimeout(waitForChannelData, 100);
              
              // dataLoaded ì´ë²¤íŠ¸ ë°œìƒ
              console.log('[Dashboard] ë°ì´í„° ë¡œë“œ ì™„ë£Œ, dataLoaded ì´ë²¤íŠ¸ ë°œìƒ');
              window.dispatchEvent(new CustomEvent('dataLoaded'));
              
            } catch (error) {
              console.error('âŒ JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
              throw error;
            }
            
            // data.js ë¡œë“œ ì½”ë“œ ì œê±°ë¨ - ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
            return Promise.resolve();
          };
          
          // window.brandKPI ë°ì´í„°ë¡œ brandData ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ë“±ë¡)
          window.updateBrandDataFromKPI = () => {
            if (typeof window.brandKPI === 'undefined') return;
            
            // ë¸Œëœë“œ ì´ë¦„ ë¦¬ìŠ¤íŠ¸
            const brandNames = ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
            
            // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘ (í´ë°±ìš©)
            const brandCodeMap = {
              'MLB': 'M',
              'MLB_KIDS': 'I',
              'DISCOVERY': 'X',
              'DUVETICA': 'V',
              'SERGIO': 'ST',
              'SUPRA': 'W'
            };
            
            // window.brandDataê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!window.brandData) {
              window.brandData = {};
            }
            
            // ê° ë¸Œëœë“œë³„ë¡œ KPI ë°ì´í„° ì—…ë°ì´íŠ¸
            brandNames.forEach(brandName => {
              // ë¸Œëœë“œ ì´ë¦„ìœ¼ë¡œ ë¨¼ì € ì‹œë„, ì—†ìœ¼ë©´ ë¸Œëœë“œ ì½”ë“œë¡œ ì‹œë„
              const kpi = window.brandKPI[brandName] || window.brandKPI[brandCodeMap[brandName]];
              
              if (kpi) {
                // window.brandData ì´ˆê¸°í™” (ì—†ìœ¼ë©´)
                if (!window.brandData[brandName]) {
                  window.brandData[brandName] = {
                    current: {
                      revenue: { value: 0, target: 0, achievement: 0, yoy: 0, discountRate: 0 },
                      profit: { value: 0, target: 0, achievement: 0, yoy: 0 },
                      margin: { value: 0, target: 0, change: 0, yoy: 0 },
                      progress: { value: 0, target: 100, achievement: 0, yoy: 0 }
                    },
                    revenue: { target: 0, forecast: 0, achievement: 0, yoy: 0, discountRate: 0 },
                    profit: { target: 0, forecast: 0, achievement: 0, yoy: 0 }
                  };
                }
                
                // ì‹¤íŒë§¤ì¶œ ì—…ë°ì´íŠ¸ (ì› ë‹¨ìœ„ë¥¼ ì–µì› ë‹¨ìœ„ë¡œ ë³€í™˜)
                const revenueInHundredMillion = kpi.revenue / 100000000;
                window.brandData[brandName].current.revenue.value = revenueInHundredMillion;
                
                // ì›”ë§ì˜ˆìƒ ì‹¤íŒë§¤ì¶œ ì—…ë°ì´íŠ¸ (forecast ë°ì´í„° ì‚¬ìš©)
                if (kpi.revenueForecast !== undefined) {
                  const revenueForecastInHundredMillion = kpi.revenueForecast / 100000000;
                  window.brandData[brandName].revenue.forecast = revenueForecastInHundredMillion;
                } else {
                  // í´ë°±: í˜„ì‹œì  ë°ì´í„° ì‚¬ìš©
                  window.brandData[brandName].revenue.forecast = revenueInHundredMillion;
                }
                
                // ì§ì ‘ì´ìµ ì—…ë°ì´íŠ¸ (ì› ë‹¨ìœ„ë¥¼ ì–µì› ë‹¨ìœ„ë¡œ ë³€í™˜)
                const profitInHundredMillion = kpi.directProfit / 100000000;
                window.brandData[brandName].current.profit.value = profitInHundredMillion;
                
                // ì›”ë§ì˜ˆìƒ ì§ì ‘ì´ìµ ì—…ë°ì´íŠ¸ (forecast ë°ì´í„° ì‚¬ìš©)
                if (kpi.directProfitForecast !== undefined) {
                  const profitForecastInHundredMillion = kpi.directProfitForecast / 100000000;
                  window.brandData[brandName].profit.forecast = profitForecastInHundredMillion;
                } else {
                  // í´ë°±: í˜„ì‹œì  ë°ì´í„° ì‚¬ìš©
                  window.brandData[brandName].profit.forecast = profitInHundredMillion;
                }
                
                // ì§ì ‘ì´ìµìœ¨ ì—…ë°ì´íŠ¸
                window.brandData[brandName].current.margin.value = kpi.directProfitRate;
                
                // ì›”ë§ì˜ˆìƒ ì§ì ‘ì´ìµìœ¨ ì—…ë°ì´íŠ¸ (forecast ë°ì´í„° ì‚¬ìš©)
                if (kpi.directProfitRateForecast !== undefined) {
                  window.brandData[brandName].revenue.marginForecast = kpi.directProfitRateForecast;
                  window.brandData[brandName].profit.marginForecast = kpi.directProfitRateForecast;
                } else {
                  // í´ë°±: í˜„ì‹œì  ì§ì ‘ì´ìµìœ¨ ì‚¬ìš©
                  window.brandData[brandName].revenue.marginForecast = kpi.directProfitRate;
                  window.brandData[brandName].profit.marginForecast = kpi.directProfitRate;
                }
                
                // í• ì¸ìœ¨ ì—…ë°ì´íŠ¸
                if (kpi.discountRate !== undefined) {
                  window.brandData[brandName].current.revenue.discountRate = kpi.discountRate;
                  // ì›”ë§ì˜ˆìƒ í• ì¸ìœ¨ ì—…ë°ì´íŠ¸ (forecast ë°ì´í„° ì‚¬ìš©)
                  if (kpi.discountRateForecast !== undefined) {
                    window.brandData[brandName].revenue.discountRate = kpi.discountRateForecast;
                  } else {
                    window.brandData[brandName].revenue.discountRate = kpi.discountRate;
                  }
                }
                
                // â˜… ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ (ì§ì ‘ì´ìµ ê¸°ì¤€) â˜…
                // í˜„ì‹œì  ì§„ì²™ìœ¨
                window.brandData[brandName].current.progress.value = kpi.progressRate;
                // ì›”ë§ì˜ˆìƒ ì§„ì²™ìœ¨
                window.brandData[brandName].revenue.achievement = kpi.progressRateForecast || kpi.progressRate;
                // progressRateForecastë„ ë³„ë„ ì €ì¥
                window.brandData[brandName].profit.achievement = kpi.progressRateForecast || kpi.progressRate;
                
                // â˜… ì˜ì—…ì´ìµ ë°ì´í„° ì¶”ê°€ â˜…
                if (!window.brandData[brandName].opProfit) {
                  window.brandData[brandName].opProfit = { current: 0, forecast: 0, rate: 0, rateForecast: 0 };
                }
                window.brandData[brandName].opProfit.current = (kpi.operatingProfit || 0) / 100000000;
                window.brandData[brandName].opProfit.forecast = (kpi.operatingProfitForecast || 0) / 100000000;
                window.brandData[brandName].opProfit.rate = kpi.operatingProfitRate || 0;
                window.brandData[brandName].opProfit.rateForecast = kpi.operatingProfitRateForecast || 0;
                
                console.log(`ë¸Œëœë“œ KPI ì—…ë°ì´íŠ¸: ${brandName}`, {
                  revenue: revenueInHundredMillion,
                  revenueForecast: window.brandData[brandName].revenue.forecast,
                  profit: profitInHundredMillion,
                  profitForecast: window.brandData[brandName].profit.forecast,
                  profitRate: kpi.directProfitRate,
                  progressRate: kpi.progressRate,
                  progressRateForecast: kpi.progressRateForecast
                });
              }
            });
            
            // ë¸Œëœë“œ ë·° ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë¡œë“œëœ ê²½ìš°)
            if (typeof updateBrandView === 'function' && typeof currentBrand !== 'undefined') {
              updateBrandView();
            }
          };
          
          // JSON íŒŒì¼ë§Œ ë¡œë“œ (JS íŒŒì¼ ì œê±°)
          loadData()
            .then(() => {
              console.log('ëª¨ë“  ë°ì´í„° íŒŒì¼ ë¡œë“œ ì™„ë£Œ');
              resolve();
            })
            .catch((err) => {
              console.error('ë°ì´í„° íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', err);
              reject(err);
            });
        });
      };
      
      if (updateDateElement) {
        if (dateParam && dateParam.length === 8) {
          try {
            // ë‚ ì§œ ì •ë³´ ê³„ì‚° API í˜¸ì¶œ (ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©)
            const dateInfoResponse = await fetch(`/api/calculate-date-info?date=${apiDate}`);
            const dateInfo = await dateInfoResponse.json();
            
            if (dateInfo.success) {
              // ì—…ë°ì´íŠ¸ì¼ì í‘œì‹œ
              updateDateElement.textContent = dateInfo.updateDateFormatted;
              
              // ë¶„ì„ì›”/ë§¤ì¶œì¼ì ì •ë³´ í‘œì‹œ
              const dateInfoElement = document.getElementById('date-info');
              if (dateInfoElement) {
                // URLì—ì„œ ë°›ì€ ë¶„ì„ì›”ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ì—†ìœ¼ë©´ APIì—ì„œ ë°›ì€ analysisMonth(ì£¼ì°¨ ì‹œì‘ì¼ ê¸°ì¤€) ì‚¬ìš©
                const displayMonth = monthParam || dateInfo.analysisMonth || dateInfo.currentMonth;
                
                // ë§¤ì¶œì¼ì ê³„ì‚°: ë¶„ì„ì›”ì˜ 1ì¼ ~ ì—…ë°ì´íŠ¸ì¼ìì˜ d-1
                // ë‹¨, ì—…ë°ì´íŠ¸ ì¼ìê°€ ë¶„ì„ì›”ì„ ë„˜ì–´ê°ˆ ê²½ìš° ë§ì¼ë¡œ ì„¤ì •
                const analysisMonthStr = displayMonth.replace('-', ''); // 2025-11 -> 202511
                const analysisYear = parseInt(analysisMonthStr.slice(0, 4));
                const analysisMonth = parseInt(analysisMonthStr.slice(4, 6));
                
                const updateYear = parseInt(dateParam.slice(0, 4));
                const updateMonth = parseInt(dateParam.slice(4, 6));
                const updateDay = parseInt(dateParam.slice(6, 8));
                
                // ë§¤ì¶œì¼ì ì‹œì‘: ë¶„ì„ì›”ì˜ 1ì¼
                const salesDateStart = `${analysisYear}-${String(analysisMonth).padStart(2, '0')}-01`;
                
                // ë§¤ì¶œì¼ì ì¢…ë£Œ ê³„ì‚°
                let salesDateEnd;
                // ì—…ë°ì´íŠ¸ ì¼ìê°€ ë¶„ì„ì›”ì„ ë„˜ì–´ê°€ëŠ”ì§€ í™•ì¸
                if (updateYear > analysisYear || (updateYear === analysisYear && updateMonth > analysisMonth)) {
                  // ë¶„ì„ì›”ì˜ ë§ì¼ë¡œ ì„¤ì •
                  const lastDay = new Date(analysisYear, analysisMonth, 0).getDate();
                  salesDateEnd = `${analysisYear}-${String(analysisMonth).padStart(2, '0')}-${String(lastDay).padStart(2, '0')}`;
                } else {
                  // ì—…ë°ì´íŠ¸ ì¼ìì˜ d-1
                  const prevDay = updateDay - 1;
                  salesDateEnd = `${updateYear}-${String(updateMonth).padStart(2, '0')}-${String(prevDay).padStart(2, '0')}`;
                }
                
                dateInfoElement.innerHTML = `ë¶„ì„ì›”: ${displayMonth} | ë§¤ì¶œì¼ì : ${salesDateStart} ~ ${salesDateEnd}`;
              }
            } else {
              // API ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ í¬ë§·íŒ…
              const formattedDate = `${dateParam.slice(0, 4)}.${dateParam.slice(4, 6)}.${dateParam.slice(6, 8)}`;
              updateDateElement.textContent = formattedDate;
              
              // API ì‹¤íŒ¨ ì‹œì—ë„ ë¶„ì„ì›”/ë§¤ì¶œì¼ì í‘œì‹œ
              const dateInfoElement = document.getElementById('date-info');
              if (dateInfoElement && monthParam) {
                // ë§¤ì¶œì¼ì ê³„ì‚°: ë¶„ì„ì›”ì˜ 1ì¼ ~ ì—…ë°ì´íŠ¸ì¼ìì˜ d-1
                // ë‹¨, ì—…ë°ì´íŠ¸ ì¼ìê°€ ë¶„ì„ì›”ì„ ë„˜ì–´ê°ˆ ê²½ìš° ë§ì¼ë¡œ ì„¤ì •
                const analysisMonthStr = monthParam.replace('-', ''); // 2025-11 -> 202511
                const analysisYear = parseInt(analysisMonthStr.slice(0, 4));
                const analysisMonth = parseInt(analysisMonthStr.slice(4, 6));
                
                const updateYear = parseInt(dateParam.slice(0, 4));
                const updateMonth = parseInt(dateParam.slice(4, 6));
                const updateDay = parseInt(dateParam.slice(6, 8));
                
                // ë§¤ì¶œì¼ì ì‹œì‘: ë¶„ì„ì›”ì˜ 1ì¼
                const salesDateStart = `${analysisYear}-${String(analysisMonth).padStart(2, '0')}-01`;
                
                // ë§¤ì¶œì¼ì ì¢…ë£Œ ê³„ì‚°
                let salesDateEnd;
                // ì—…ë°ì´íŠ¸ ì¼ìê°€ ë¶„ì„ì›”ì„ ë„˜ì–´ê°€ëŠ”ì§€ í™•ì¸
                if (updateYear > analysisYear || (updateYear === analysisYear && updateMonth > analysisMonth)) {
                  // ë¶„ì„ì›”ì˜ ë§ì¼ë¡œ ì„¤ì •
                  const lastDay = new Date(analysisYear, analysisMonth, 0).getDate();
                  salesDateEnd = `${analysisYear}-${String(analysisMonth).padStart(2, '0')}-${String(lastDay).padStart(2, '0')}`;
                } else {
                  // ì—…ë°ì´íŠ¸ ì¼ìì˜ d-1
                  const prevDay = updateDay - 1;
                  salesDateEnd = `${updateYear}-${String(updateMonth).padStart(2, '0')}-${String(prevDay).padStart(2, '0')}`;
                }
                
                dateInfoElement.innerHTML = `ë¶„ì„ì›”: ${monthParam} | ë§¤ì¶œì¼ì : ${salesDateStart} ~ ${salesDateEnd}`;
              }
            }
            
            // í•´ë‹¹ ë‚ ì§œì˜ íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„±/ë¡œë“œ
            try {
              console.log('ë‚ ì§œë³„ íŠ¸ë¦¬ë§µ ë°ì´í„° í™•ì¸ ì‹œì‘:', apiDate);
              const treemapResponse = await fetch(`/api/generate-treemap?date=${apiDate}`);
              const treemapData = await treemapResponse.json();
              
              if (treemapData.success) {
                if (treemapData.generated) {
                  console.log('íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„± ì™„ë£Œ:', treemapData);
                } else {
                  console.log('íŠ¸ë¦¬ë§µ ë°ì´í„° íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ì¦‰ì‹œ ë¡œë“œí•©ë‹ˆë‹¤.');
                }
                // ë‚ ì§œë³„ ë°ì´í„° íŒŒì¼ ë¡œë“œ (ë³‘ë ¬ ë¡œë“œë¡œ ìµœì í™”ë¨)
                await loadDataFile(dateParam);
                
                // â˜… ì˜›ë‚  JSON ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ì œê±° - Snowflake API ì‚¬ìš© â˜…
                console.log('âš  ì˜›ë‚  íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ìŠ¤í‚µ (Snowflake API ì‚¬ìš©)');
              } else {
                console.warn('íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', treemapData.error);
                // ì‹¤íŒ¨í•´ë„ ê¸°ë³¸ íŒŒì¼ ë¡œë“œ ì‹œë„
                await loadDataFile(dateParam).catch(() => {
                  console.error('ë°ì´í„° íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨');
                });
                // â˜… ì˜›ë‚  íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ì œê±° - Snowflake API ì‚¬ìš© â˜…
              }
            } catch (treemapError) {
              console.error('íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„± ì˜¤ë¥˜:', treemapError);
              // ì—ëŸ¬ ë°œìƒí•´ë„ ê¸°ë³¸ íŒŒì¼ ë¡œë“œ ì‹œë„
              await loadDataFile(dateParam).catch(() => {
                console.error('ë°ì´í„° íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨');
              });
              // ë°ì´í„° ë¡œë“œ í›„ íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ì‹œë„
              setTimeout(() => {
                if (typeof window.channelItemSalesData !== 'undefined' && typeof initTreemap === 'function') {
                  initTreemap();
                }
              }, 500);
            }
            
          } catch (error) {
            console.error('ë‚ ì§œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            // ì—ëŸ¬ ì‹œ ê¸°ë³¸ í¬ë§·íŒ…
            const formattedDate = `${dateParam.slice(0, 4)}.${dateParam.slice(4, 6)}.${dateParam.slice(6, 8)}`;
            updateDateElement.textContent = formattedDate;
            // ê¸°ë³¸ íŒŒì¼ ë¡œë“œ ì‹œë„
            await loadDataFile(dateParam).catch(() => {
              console.error('ë°ì´í„° íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨');
            });
            // ë°ì´í„° ë¡œë“œ í›„ íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ì‹œë„
            setTimeout(() => {
              if (typeof window.channelItemSalesData !== 'undefined' && typeof initTreemap === 'function') {
                initTreemap();
              }
            }, 500);
          }
        } else {
          // ë‚ ì§œ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ë˜ëŠ” ìµœì‹  ë‚ ì§œ í‘œì‹œ
      const last = document.getElementById('last-updated');
          if (window.lastUpdated && last) {
            last.textContent = `ì—…ë°ì´íŠ¸: ${window.lastUpdated}`;
          } else {
            updateDateElement.textContent = '-';
          }
          // ê¸°ë³¸ data.js ë¡œë“œ
          await loadDataFile('').catch(() => {
            console.warn('ê¸°ë³¸ data.js ë¡œë“œ ì‹¤íŒ¨');
          });
        }
      }
      
      const last = document.getElementById('last-updated');
      if (window.lastUpdated && last && !dateParam) {
        last.textContent = `ì—…ë°ì´íŠ¸: ${window.lastUpdated}`;
      }
      
      // ë°ì´í„° ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ - ë‹¤ë¥¸ ì´ˆê¸°í™” ì½”ë“œê°€ ì´ ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦¼
      console.log('[Dashboard] ë°ì´í„° ë¡œë“œ ì™„ë£Œ, dataLoaded ì´ë²¤íŠ¸ ë°œìƒ');
      window.dispatchEvent(new CustomEvent('dataLoaded'));

      // â˜…â˜…â˜… dataLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” â˜…â˜…â˜…
      const initRadarChartOnLoad = () => {
        try {
          console.log('[ì´ˆê¸°í™”] ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘, currentBrand:', currentBrand);
          // ë ˆì´ë” ì°¨íŠ¸ íƒ€ì…ì„ ì±„ë„ë³„ë¡œ ì„¤ì •
          window.radarChartType = 'channel';
          
          // ë ˆì´ë” ì°¨íŠ¸ í† ê¸€ ë²„íŠ¼ ì´ˆê¸°í™”
          if (typeof initRadarToggle === 'function') {
            initRadarToggle();
          }
          
          // ë¸Œëœë“œ ì°¨íŠ¸ ì´ˆê¸°í™” (ë ˆì´ë” ì°¨íŠ¸ í¬í•¨)
          if (typeof initBrandCharts === 'function') {
            console.log('[ì´ˆê¸°í™”] initBrandCharts í˜¸ì¶œ');
            initBrandCharts();
          } else {
            // initBrandChartsê°€ ì—†ìœ¼ë©´ updateBrandCharts í˜¸ì¶œ
            if (typeof updateBrandCharts === 'function') {
              console.log('[ì´ˆê¸°í™”] updateBrandCharts í˜¸ì¶œ');
              updateBrandCharts();
            }
          }
          console.log('[ì´ˆê¸°í™”] ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (e) {
          console.error('[ì´ˆê¸°í™”] ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” ì—ëŸ¬:', e);
        }
      };
      
      // dataLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      window.addEventListener('dataLoaded', () => {
        setTimeout(initRadarChartOnLoad, 300);
      });
      
      // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
        setTimeout(initRadarChartOnLoad, 300);
      
      // â˜… ì „ì²´í˜„í™© íˆíŠ¸ë§µìš© API ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ (ë§¤ì¶œêµ¬ì„±/í• ì¸ë‚´ì—­ë„ ë¨¼ì € ë¡œë“œí•˜ì—¬ ë¸Œëœë“œ í´ë¦­ ì‹œ ë¹ ë¥´ê²Œ í‘œì‹œ)
      console.log('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜/ë§¤ì¶œêµ¬ì„±/í• ì¸ë‚´ì—­ API ë°ì´í„° ë¡œë“œ ì‹œì‘');
      
      Promise.all([
        loadOverviewSalesRateData(),
        loadOverviewStockWeeksData(),
        loadSalesCompositionData(),
        loadOverviewDiscountData(),
        loadAllPromotionData()
      ]).then(() => {
        console.log('[ì „ì²´í˜„í™©] API ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        // í• ì¸ë‚´ì—­: ë¡œë“œëœ overview ë°ì´í„°ë¡œ ë¸Œëœë“œë³„ ìºì‹œ(byCode) êµ¬ì¡° ìƒì„± â†’ í…Œì´ë¸”/ë“œë¦´ë‹¤ìš´ì—ì„œ ì‚¬ìš©
        if (typeof buildDiscountCacheFromOverview === 'function') {
          buildDiscountCacheFromOverview();
        }
        if (typeof updateDiscountTable === 'function') {
          updateDiscountTable()
            .then(() => console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ'))
            .catch(err => console.error('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err));
        }
      }).catch(err => {
        console.error('[ì „ì²´í˜„í™©] API ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', err);
        // ì‹¤íŒ¨í•´ë„ í• ì¸ë‚´ì—­ì€ ê°œë³„ APIë¡œ ë¡œë“œ ê°€ëŠ¥í•˜ë¯€ë¡œ í…Œì´ë¸” ê°±ì‹  ì‹œë„
        if (typeof updateDiscountTable === 'function') {
          updateDiscountTable()
            .then(() => console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ (í´ë°±)'))
            .catch(e => console.error('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ í…Œì´ë¸” í´ë°± ì‹¤íŒ¨:', e));
        }
      });
      
      // í• ì¸ë‚´ì—­ì€ loadOverviewDiscountDataì—ì„œ Promise.allë¡œ ë¡œë“œë¨ (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼)

      // í¸ì§‘ ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('edit-mode-btn').addEventListener('click', toggleEditMode);
      document.getElementById('save-btn').addEventListener('click', saveEdits);
      
      // ë“œë¦´ë°± ë²„íŠ¼ ì´ë²¤íŠ¸ (í•œ ë²ˆë§Œ ë“±ë¡)
      const drillbackBtn = document.getElementById('drillbackBtn');
      if (drillbackBtn) {
        drillbackBtn.addEventListener('click', function() {
        // ì›ë˜ ë¸Œëœë“œ ë°ì´í„°ë¡œ ë³µì›
        const rows = Array.isArray(window.by_brand) ? window.by_brand : null;
        const labels = rows ? rows.map(r=> (r.BRAND||r.brand||r.name) ) : ['MLB','MLB KIDS','DISCOVERY','DUVETICA','SERGIO','SUPRA'];
        const sales  = rows ? rows.map(r=> Number(r.SALES||r.sales||r.revenue||0) ) : [236.9,78.9,42.1,28.7,31.2,16.8];
        
        isDrilledDown = false;
        currentDrillBrand = null;
        createBrandContributionChart(labels, sales);
        document.getElementById('contributionChartTitle').textContent = 'ë¸Œëœë“œë³„ ë§¤ì¶œ ê¸°ì—¬ë„';
        this.style.display = 'none';
      });
      }

      // AI ë¶„ì„ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      const aiBtn = document.getElementById('ai-btn');
      if (aiBtn){
        aiBtn.addEventListener('click', (e)=>{
          e.stopPropagation();
          console.log('AI ë²„íŠ¼ í´ë¦­ë¨, currentSection:', currentSection);
          // í˜„ì¬ ì„¹ì…˜ì— ë”°ë¼ ë‹¤ë¥¸ ê¸°ëŠ¥ ì‹¤í–‰
          if (currentSection === 'overview'){
            // ì „ì²´ í˜„í™©: í•œì¥ìš”ì•½ í‘œì‹œ
            console.log('showAISummary í˜¸ì¶œ');
            showAISummary();
          } else {
            // ë¸Œëœë“œë³„ ë¶„ì„: íŒŒíŠ¸ë³„ ë¶„ì„ í‘œì‹œ/í† ê¸€
          window.aiPartMode = !window.aiPartMode;
          if (window.aiPartMode){
              console.log('renderAIPartNotes í˜¸ì¶œ');
            renderAIPartNotes();
          } else {
            clearAIPartNotes();
            }
          }
        });
      } else {
        console.error('AI ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    });
    // ---------- AI ê¸°ëŠ¥ êµ¬í˜„ ----------
    function ensureAIModal(){
      let backdrop = document.getElementById('ai-modal-backdrop');
      if (!backdrop){
        backdrop = document.createElement('div');
        backdrop.id = 'ai-modal-backdrop';
        backdrop.className = 'ai-modal-backdrop';
        backdrop.innerHTML = `
          <div class="ai-modal">
            <header>
              <h4>ğŸ¤– AI í•œì¥ìš”ì•½</h4>
              <div style="display:flex;gap:8px;align-items:center;">
                <button class="close-btn" id="ai-summary-edit-btn" style="background:#3b82f6;color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:12px;cursor:pointer;font-weight:600;">âœï¸ í¸ì§‘</button>
                <button class="close-btn" id="ai-modal-close">ë‹«ê¸°</button>
              </div>
            </header>
            <div class="content" id="ai-modal-content"></div>
          </div>`;
        document.body.appendChild(backdrop);
        backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) backdrop.style.display='none'; });
        document.getElementById('ai-modal-close').addEventListener('click', ()=>{ backdrop.style.display='none'; });
        
        // AI í•œì¥ìš”ì•½ í¸ì§‘ ë²„íŠ¼ ì´ë²¤íŠ¸
        const editBtn = document.getElementById('ai-summary-edit-btn');
        if (editBtn && !editBtn.hasAttribute('data-listener')) {
          editBtn.setAttribute('data-listener', 'true');
          editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleAISummaryEditMode();
          });
        }
      } else {
        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë„ í¸ì§‘ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
        const editBtn = document.getElementById('ai-summary-edit-btn');
        if (editBtn && !editBtn.hasAttribute('data-listener')) {
          editBtn.setAttribute('data-listener', 'true');
          editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleAISummaryEditMode();
          });
        }
      }
      return backdrop;
    }
    
    // AI í•œì¥ìš”ì•½ í¸ì§‘ ëª¨ë“œ í† ê¸€
    let aiSummaryEditMode = false;
    function toggleAISummaryEditMode() {
      aiSummaryEditMode = !aiSummaryEditMode;
      const contentEl = document.getElementById('ai-modal-content');
      const editBtn = document.getElementById('ai-summary-edit-btn');
      
      if (!contentEl) return;
      
      const editables = contentEl.querySelectorAll('.ai-editable');
      editables.forEach(el => {
        el.contentEditable = aiSummaryEditMode;
        if (aiSummaryEditMode) {
          el.style.border = '1px dashed #3b82f6';
          el.style.padding = '4px';
          el.style.borderRadius = '4px';
          el.style.minHeight = '20px';
        } else {
          el.style.border = 'none';
          el.style.padding = '0';
        }
      });
      
      if (editBtn) {
        if (aiSummaryEditMode) {
          editBtn.textContent = 'ğŸ’¾ ì €ì¥';
          editBtn.style.background = '#10b981';
        } else {
          editBtn.textContent = 'âœï¸ í¸ì§‘';
          editBtn.style.background = '#3b82f6';
          saveAISummaryEdits();
        }
      }
    }
    
    // AI í•œì¥ìš”ì•½ í¸ì§‘ ë‚´ìš© ì €ì¥
    function saveAISummaryEdits() {
      const contentEl = document.getElementById('ai-modal-content');
      if (!contentEl) return;
      
      const edits = {};
      const editables = contentEl.querySelectorAll('.ai-editable');
      
      editables.forEach((el, index) => {
        const key = `ai-summary-${index}`;
        edits[key] = el.innerHTML || el.textContent;
      });
      
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-summary-edits_${dateStr}` : 'ai-summary-edits';
      localStorage.setItem(storageKey, JSON.stringify(edits));
      console.log(`âœ… AI í•œì¥ìš”ì•½ í¸ì§‘ ë‚´ìš© ì €ì¥ë¨ (ë‚ ì§œ: ${dateStr}):`, edits);
    }
    
    // AI í•œì¥ìš”ì•½ í¸ì§‘ ë‚´ìš© ë¡œë“œ
    function loadAISummaryEdits() {
      const contentEl = document.getElementById('ai-modal-content');
      if (!contentEl) return;
      
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-summary-edits_${dateStr}` : 'ai-summary-edits';
      const edits = localStorage.getItem(storageKey);
      if (edits) {
        const data = JSON.parse(edits);
        const editables = contentEl.querySelectorAll('.ai-editable');
        
        editables.forEach((el, index) => {
          const key = `ai-summary-${index}`;
          if (data[key] !== undefined) {
            el.innerHTML = data[key];
          }
        });
        console.log('âœ… AI í•œì¥ìš”ì•½ í¸ì§‘ ë‚´ìš© ë¡œë“œë¨');
      }
    }

    function showAISummary(){
      const backdrop = ensureAIModal();
      const contentEl = document.getElementById('ai-modal-content');
      let html = '';
      
      // window.insightsDataë¥¼ ì§ì ‘ ì‚¬ìš© (JSON ë¡œë“œ í›„ ì—…ë°ì´íŠ¸ë¨)
      const currentInsightsData = window.insightsData || {};
      
      console.log('[showAISummary] insightsData:', currentInsightsData);
      console.log('[showAISummary] overview:', currentInsightsData.overview);
      
      // ë¸Œëœë“œ ìˆœì„œ ì •ì˜
      const brandOrder = ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
      const brandDisplayNames = {
        'MLB': 'MLB',
        'MLB_KIDS': 'MLB KIDS',
        'DISCOVERY': 'DISCOVERY',
        'DUVETICA': 'DUVETICA',
        'SERGIO': 'SERGIO',
        'SUPRA': 'SUPRA'
      };
      
      // ì €ì¥ëœ í¸ì§‘ ë‚´ìš© ë¡œë“œ
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-summary-edits_${dateStr}` : 'ai-summary-edits';
      const savedEdits = localStorage.getItem(storageKey);
      const edits = savedEdits ? JSON.parse(savedEdits) : {};
      
      // ì „ì²´ í˜„í™© ì„¹ì…˜
      if (currentInsightsData.overview) {
        const editKey0 = 'ai-summary-0';
        const editKey1 = 'ai-summary-1';
        let defaultOverviewContent = currentInsightsData.overview.content || '';
        // "ğŸ“Š ì†ìµê³„ì‚°ì„œ ë¶„ì„" ì œëª© ì œê±° (ë‚´ìš©ì€ ìœ ì§€) - ëª¨ë“  ê°€ëŠ¥í•œ íŒ¨í„´ ì²˜ë¦¬
        defaultOverviewContent = defaultOverviewContent.replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>\s*<br\s*\/?>/gi, '')
                                                       .replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>/gi, '')
                                                       .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„\s*<br\s*\/?>/gi, '')
                                                       .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„/gi, '');
        let c = edits[editKey0] !== undefined ? edits[editKey0] : defaultOverviewContent;
        // í¸ì§‘ëœ ë‚´ìš©ì—ì„œë„ "ğŸ“Š ì†ìµê³„ì‚°ì„œ ë¶„ì„" ì œëª© ì œê±°
        c = c.replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>\s*<br\s*\/?>/gi, '')
            .replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>/gi, '')
            .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„\s*<br\s*\/?>/gi, '')
            .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„/gi, '');
        const k = edits[editKey1] !== undefined ? edits[editKey1] : (currentInsightsData.overview.keyPoints || '');
        html += `<div style="margin-bottom:20px;padding-bottom:20px;border-bottom:2px solid #e5e7eb;">
          <h3 style="margin:0 0 10px 0;font-size:16px;font-weight:700;color:#1f2937;">ğŸ“ˆ ì „ì²´ í˜„í™©</h3>
          <div class="ai-editable" style="margin-bottom:10px;line-height:1.6;">${c}</div>
          <div class="ai-editable" style="white-space:pre-line;line-height:1.6;">${k}</div>
        </div>`;
      }
      
      // ê° ë¸Œëœë“œë³„ ì„¹ì…˜
      let editIndex = 2;
      brandOrder.forEach((brandKey, index) => {
        const brandData = currentInsightsData[brandKey];
        if (brandData) {
          const brandName = brandDisplayNames[brandKey] || brandKey;
          const editKeyContent = `ai-summary-${editIndex}`;
          const editKeyPoints = `ai-summary-${editIndex + 1}`;
          // ë¸Œëœë“œë³„ contentëŠ” part1(ì†ìµê³„ì‚°ì„œ ë¶„ì„)ì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
          let defaultContent = brandData.part1 || brandData.content || '';
          // "ğŸ“Š ì†ìµê³„ì‚°ì„œ ë¶„ì„" ì œëª© ì œê±° (ë‚´ìš©ì€ ìœ ì§€) - ëª¨ë“  ê°€ëŠ¥í•œ íŒ¨í„´ ì²˜ë¦¬
          defaultContent = defaultContent.replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>\s*<br\s*\/?>/gi, '')
                                         .replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>/gi, '')
                                         .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„\s*<br\s*\/?>/gi, '')
                                         .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„/gi, '');
          // ë¸Œëœë“œë³„ keyPointsëŠ” ì‹¤ì œ keyPoints ì‚¬ìš© (ë¶„ì„ ì™„ë£Œ ë©”ì‹œì§€ ì œê±°)
          const defaultKeyPoints = brandData.keyPoints || '';
          let c = edits[editKeyContent] !== undefined ? edits[editKeyContent] : defaultContent;
          // í¸ì§‘ëœ ë‚´ìš©ì—ì„œë„ "ğŸ“Š ì†ìµê³„ì‚°ì„œ ë¶„ì„" ì œëª© ì œê±° - ëª¨ë“  ê°€ëŠ¥í•œ íŒ¨í„´ ì²˜ë¦¬
          c = c.replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>\s*<br\s*\/?>/gi, '')
              .replace(/<strong>ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„<\/strong>/gi, '')
              .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„\s*<br\s*\/?>/gi, '')
              .replace(/ğŸ“Š\s*ì†ìµê³„ì‚°ì„œ\s*ë¶„ì„/gi, '');
          const k = edits[editKeyPoints] !== undefined ? edits[editKeyPoints] : defaultKeyPoints;
          const isLast = index === brandOrder.length - 1;
          
          html += `<div style="margin-bottom:${isLast ? '0' : '20px'};padding-bottom:${isLast ? '0' : '20px'};border-bottom:${isLast ? 'none' : '2px solid #e5e7eb'};">
            <h3 style="margin:0 0 10px 0;font-size:16px;font-weight:700;color:#1f2937;">ğŸ·ï¸ ${brandName}</h3>
            <div class="ai-editable" style="margin-bottom:10px;line-height:1.6;">${c}</div>
            <div class="ai-editable" style="white-space:pre-line;line-height:1.6;">${k}</div>
          </div>`;
          editIndex += 2;
        }
      });
      
      contentEl.innerHTML = html;
      
      // í¸ì§‘ ë‚´ìš© ë¡œë“œ (ì´ë¯¸ ì €ì¥ëœ í¸ì§‘ì´ ìˆìœ¼ë©´ ì ìš©)
      setTimeout(() => {
        loadAISummaryEdits();
      }, 50);
      
      backdrop.style.display = 'flex';
    }

    function renderAIPartNotes(){
      // ëª¨ë“  íŒŒíŠ¸ë³„ ë¶„ì„ ë…¸íŠ¸ ì œê±°
      clearAIPartNotes();

      // window.insightsDataë¥¼ ì§ì ‘ ì‚¬ìš© (JSON ë¡œë“œ í›„ ì—…ë°ì´íŠ¸ë¨)
      const currentInsightsData = window.insightsData || {};
      
      console.log('[renderAIPartNotes] currentBrand:', currentBrand);
      console.log('[renderAIPartNotes] insightsData:', currentInsightsData);
      console.log('[renderAIPartNotes] insightsData keys:', Object.keys(currentInsightsData));
      
      // window.insightsDataê°€ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìœ¼ë©´ ê²½ê³ 
      if (!window.insightsData || Object.keys(currentInsightsData).length === 0) {
        console.warn('[renderAIPartNotes] window.insightsDataê°€ ì—†ìŠµë‹ˆë‹¤. AI ì¸ì‚¬ì´íŠ¸ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.warn('[renderAIPartNotes] ë°ì´í„° íŒŒì¼ ê²½ë¡œ í™•ì¸ í•„ìš”: /public/data/' + (window.__DATA_DATE__ || 'YYYYMMDD') + '/ai_insights/insights_data_' + (window.__DATA_DATE__ || 'YYYYMMDD') + '.json');
        return;
      }
      
      // ë¸Œëœë“œë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandData = currentInsightsData[currentBrand] || currentInsightsData.MLB || {};
      
      console.log('[renderAIPartNotes] brandData:', brandData);
      console.log('[renderAIPartNotes] treemapInsight:', brandData?.treemapInsight);
      
      // ê° ê·¸ë˜í”„ë³„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë°ì´í„° êµ¬ì¡°
      const insights = {
        treemap: { // ì±„ë„ë³„/ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„±
          content: brandData?.treemapInsight || ''
        },
        radar: { // ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„
          content: brandData?.radarInsight || ''
        },
        channelPl: { // ì£¼ìš” ì±„ë„ë³„ ì†ìµ ë¶„ì„
          content: brandData?.channelPlInsight || ''
        },
        weekly: { // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸
          content: brandData?.weeklyInsight || ''
        },
        saleRate: { // íŒë§¤ìœ¨ ë¶„ì„
          content: brandData?.saleRateInsight || ''
        },
        inventory: { // ì¬ê³ ì£¼ìˆ˜ ë¶„ì„
          content: brandData?.inventoryInsight || ''
        },
      };

      // ì €ì¥ëœ í¸ì§‘ ë‚´ìš© ë¡œë“œ
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `ai-part-edits-${currentBrand}_${dateStr}` : `ai-part-edits-${currentBrand}`;
      const savedEdits = localStorage.getItem(storageKey);
      const edits = savedEdits ? JSON.parse(savedEdits) : {};
      
      // ê° ê·¸ë˜í”„ë³„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë…¸íŠ¸ ë Œë”ë§
      // ì±„ë„ë³„/ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± ë¶„ì„
      const treemapNote = document.getElementById('ai-insight-treemap');
      const treemapContent = document.getElementById('ai-insight-treemap-content');
      if (treemapNote && treemapContent) {
        const editKey = 'ai-part-treemap';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.treemap.content;
        if (content && content.trim()) {
          treemapContent.innerHTML = content;
          treemapContent.className = 'ai-part-editable';
          treemapNote.style.display = 'block';
        } else {
          treemapNote.style.display = 'none';
        }
      }

      // ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„ ë¶„ì„
      const radarNote = document.getElementById('ai-insight-radar');
      const radarContent = document.getElementById('ai-insight-radar-content');
      if (radarNote && radarContent) {
        const editKey = 'ai-part-radar';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.radar.content;
        if (content && content.trim()) {
          radarContent.innerHTML = content;
          radarContent.className = 'ai-part-editable';
          radarNote.style.display = 'block';
        } else {
          radarNote.style.display = 'none';
        }
      }

      // ì£¼ìš” ì±„ë„ë³„ ì†ìµ ë¶„ì„
      const channelPlNote = document.getElementById('ai-insight-channel-pl');
      const channelPlContent = document.getElementById('ai-insight-channel-pl-content');
      if (channelPlNote && channelPlContent) {
        const editKey = 'ai-part-channel-pl';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.channelPl.content;
        if (content && content.trim()) {
          channelPlContent.innerHTML = content;
          channelPlContent.className = 'ai-part-editable';
          channelPlNote.style.display = 'block';
        } else {
          channelPlNote.style.display = 'none';
        }
      }

      // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ë¶„ì„
      const weeklyNote = document.getElementById('ai-insight-weekly');
      const weeklyContent = document.getElementById('ai-insight-weekly-content');
      if (weeklyNote && weeklyContent) {
        const editKey = 'ai-part-weekly';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.weekly.content;
        if (content && content.trim()) {
          weeklyContent.innerHTML = content;
          weeklyContent.className = 'ai-part-editable';
          weeklyNote.style.display = 'block';
        } else {
          weeklyNote.style.display = 'none';
        }
      }

      // íŒë§¤ìœ¨ ë¶„ì„
      const saleRateNote = document.getElementById('ai-insight-sale-rate');
      const saleRateContent = document.getElementById('ai-insight-sale-rate-content');
      if (saleRateNote && saleRateContent) {
        const editKey = 'ai-part-sale-rate';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.saleRate.content;
        if (content && content.trim()) {
          saleRateContent.innerHTML = content;
          saleRateContent.className = 'ai-part-editable';
          saleRateNote.style.display = 'block';
        } else {
          saleRateNote.style.display = 'none';
        }
      }

      // ì¬ê³ ì£¼ìˆ˜ ë¶„ì„
      const inventoryNote = document.getElementById('ai-insight-inventory');
      const inventoryContent = document.getElementById('ai-insight-inventory-content');
      if (inventoryNote && inventoryContent) {
        const editKey = 'ai-part-inventory';
        const content = edits[editKey] !== undefined ? edits[editKey] : insights.inventory.content;
        if (content && content.trim()) {
          inventoryContent.innerHTML = content;
          inventoryContent.className = 'ai-part-editable';
          inventoryNote.style.display = 'block';
        } else {
          inventoryNote.style.display = 'none';
        }
      }
      
      // í¸ì§‘ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ í¸ì§‘ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
      setTimeout(() => {
        applyAIPartEditMode();
        loadAIPartEdits();
      }, 50);
      
      // ë©”ëª¨ ìœ„ì¹˜ ë™ì  ì¡°ì • (ì‹¤ì œ ìš”ì†Œ ìœ„ì¹˜ ì¸¡ì •í•˜ì—¬ ìë™ ì¡°ì •)
      adjustNotePositions();
    }
    
    // ë©”ëª¨ ìœ„ì¹˜ ì¡°ì • í•¨ìˆ˜ (ì‹¤ì œ ìš”ì†Œ ìœ„ì¹˜ë¥¼ ì¸¡ì •í•˜ì—¬ ìë™ìœ¼ë¡œ ì¡°ì •)
    function adjustNotePositions(){
      const financialReport = document.querySelector('.financial-report');
      const mainContent = document.querySelector('.main-content');
      
      if (!financialReport || !mainContent) return;
      
      // ìš°ì¸¡ íŒ¨ë„ê³¼ ì¤‘ì•™ ì»¨í…ì¸ ì˜ ìƒë‹¨ ìœ„ì¹˜ ì°¨ì´ ê³„ì‚°
      const financialReportRect = financialReport.getBoundingClientRect();
      const mainContentRect = mainContent.getBoundingClientRect();
      const financialReportScrollTop = financialReport.scrollTop || 0;
      
      // ê° ê·¸ë˜í”„/í‘œ ìš”ì†Œ ì°¾ê¸° ë° ìœ„ì¹˜ ì¸¡ì •
      const elements = {
        'ai-insight-treemap': document.querySelector('#treemapWrapperChannel')?.closest('.chart-container') || document.querySelector('#content-brand .charts-grid .chart-container:first-child'),
        'ai-insight-radar': document.querySelector('#radarChart')?.closest('.chart-container'),
        'ai-insight-channel-pl': document.querySelector('#channel-pl-inline')?.closest('.chart-container'),
        'ai-insight-weekly': document.querySelector('#weeklyTrendChart')?.closest('.chart-container'),
        'ai-insight-sale-rate': document.querySelector('#itemDiffTable')?.closest('.chart-container'),
        'ai-insight-inventory': document.querySelector('#itemDiffTable')?.closest('.chart-container')
      };
      
      // ê° ë©”ëª¨ ìœ„ì¹˜ ì¡°ì •
      Object.entries(elements).forEach(([noteId, element]) => {
        const note = document.getElementById(noteId);
        if (note && element) {
          // ì¤‘ì•™ ì»¨í…ì¸ ì˜ ê·¸ë˜í”„ ìš”ì†Œ ìœ„ì¹˜ (viewport ê¸°ì¤€)
          const elementRect = element.getBoundingClientRect();
          // ìš°ì¸¡ íŒ¨ë„ ë‚´ë¶€ì˜ ìƒëŒ€ì  ìœ„ì¹˜ ê³„ì‚°
          const relativeTop = elementRect.top - financialReportRect.top + financialReportScrollTop;
          
          // ìš°ì¸¡ íŒ¨ë„ íŒ¨ë”©(20px) ê³ ë ¤
          note.style.top = Math.max(0, relativeTop + 20) + 'px';
        }
      });
      
      // í´ë°±: ìš”ì†Œë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš° ê¸°ë³¸ê°’ ì‚¬ìš©
      const fallbackPositions = {
        'ai-insight-treemap': 320,
        'ai-insight-radar': 450,
        'ai-insight-channel-pl': 640,
        'ai-insight-weekly': 640,
        'ai-insight-sale-rate': 940,
        'ai-insight-inventory': 1020
      };
      
      // ë©”ëª¨ê°€ í‘œì‹œëœ í›„ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ìœ„ì¹˜ ì¬ì¡°ì •
      setTimeout(() => {
        // 1. ì±„ë„ë³„/ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± ì•„ë˜ì— ë§¤ì¶œ ê³„íš/ì „ë…„ë¹„ ë°°ì¹˜
        const treemapNote = document.getElementById('ai-insight-treemap');
        const radarNote = document.getElementById('ai-insight-radar');
        if (treemapNote && radarNote && treemapNote.style.display !== 'none' && radarNote.style.display !== 'none') {
          const treemapRect = treemapNote.getBoundingClientRect();
          const relativeTop = treemapRect.top - financialReportRect.top + financialReportScrollTop;
          radarNote.style.top = (relativeTop + treemapRect.height + 15) + 'px'; // 15px ê°„ê²©
        }
        
        // 2. ì£¼ìš” ì±„ë„ë³„ ì†ìµ ì•„ë˜ì— ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ë°°ì¹˜
        const channelPlNote = document.getElementById('ai-insight-channel-pl');
        const weeklyNote = document.getElementById('ai-insight-weekly');
        if (channelPlNote && weeklyNote && channelPlNote.style.display !== 'none' && weeklyNote.style.display !== 'none') {
          const channelPlRect = channelPlNote.getBoundingClientRect();
          const relativeTop = channelPlRect.top - financialReportRect.top + financialReportScrollTop;
          weeklyNote.style.top = (relativeTop + channelPlRect.height + 15) + 'px'; // 15px ê°„ê²©
        }
        
        // 3. ì¬ê³ ì£¼ìˆ˜ ë¶„ì„ì€ íŒë§¤ìœ¨ ë¶„ì„ ì•„ë˜ì— ìœ„ì¹˜í•˜ë„ë¡ ì¡°ì •
        const saleRateNote = document.getElementById('ai-insight-sale-rate');
        if (saleRateNote && saleRateNote.style.display !== 'none') {
          const saleRateRect = saleRateNote.getBoundingClientRect();
          const inventoryNote = document.getElementById('ai-insight-inventory');
          if (inventoryNote && inventoryNote.style.display !== 'none') {
            const relativeTop = saleRateRect.top - financialReportRect.top + financialReportScrollTop;
            inventoryNote.style.top = (relativeTop + saleRateRect.height + 15) + 'px'; // 15px ê°„ê²©
          }
        }
      }, 50);
      
      Object.entries(fallbackPositions).forEach(([noteId, fallbackTop]) => {
        const note = document.getElementById(noteId);
        if (note && !elements[noteId]) {
          note.style.top = fallbackTop + 'px';
        }
      });
    }

    function clearAIPartNotes(){
      // ì¹´ë“œì˜ ë©”ëª¨ì§€ ì œê±°
      document.querySelectorAll('.ai-note').forEach(n=> n.remove());
      // ìš°ì¸¡ í•˜ë‹¨ ë©”ëª¨ 3ê°œ ìˆ¨ê¹€
      ['ai-rightnote-1','ai-rightnote-2','ai-rightnote-3'].forEach(id=>{
        const el = document.getElementById(id); if(el){ el.style.display='none'; el.innerHTML=''; }
      });
      // ê° ê·¸ë˜í”„ë³„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë…¸íŠ¸ ìˆ¨ê¹€
      ['ai-insight-treemap','ai-insight-radar','ai-insight-channel-pl','ai-insight-weekly','ai-insight-sale-rate','ai-insight-inventory'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) {
          el.style.display = 'none';
        }
      });
      
      // ê° ê·¸ë˜í”„ë³„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë…¸íŠ¸ ë‚´ìš© ì´ˆê¸°í™”
      ['ai-insight-treemap-content','ai-insight-radar-content','ai-insight-channel-pl-content','ai-insight-weekly-content','ai-insight-sale-rate-content','ai-insight-inventory-content'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) {
          el.innerHTML = '';
        }
      });
    }

    // 2) brandData: data.jsì—ì„œ ë¡œë“œëœ ë°ì´í„°ë§Œ ì‚¬ìš© (í•˜ë“œì½”ë”© ì œê±°)
    let brandData = window.brandData || {};

    // 3) insightsData: JSON íŒŒì¼ì—ì„œ ë¡œë“œëœ ë°ì´í„°ë§Œ ì‚¬ìš© (í•˜ë“œì½”ë”© ì œê±°)
    let insightsData = window.insightsData || {};

    // ë¸Œëœë“œë³„ ì†ìµê³„ì‚°ì„œ ë°ì´í„° (JSONì—ì„œ ë¹„ë™ê¸° ë¡œë“œë¨)
    // â˜… ì´ˆê¸°ì—ëŠ” ë¹ˆ ê°ì²´, jsonDataLoaded ì´ë²¤íŠ¸ í›„ì— window.brandPLDataë¡œ ì—…ë°ì´íŠ¸ë¨
    let brandPLData = window.brandPLData || {};
    console.log('[brandPLData] ì´ˆê¸° ìƒíƒœ (JSON ë¡œë“œ ì „):', Object.keys(brandPLData).length > 0 ? Object.keys(brandPLData) : '(ëŒ€ê¸° ì¤‘)');

    // ============ ë¸Œëœë“œ ë§ˆìŠ¤í„° ë°ì´í„° ============
    const BRAND_MASTER = {
      M: 'MLB',
      I: 'MLB KIDS',
      X: 'DISCOVERY',
      V: 'DUVETICA',
      W: 'SUPRA',
      ST: 'SERGIO'
    };
    
    // ë¸Œëœë“œ ì½”ë“œ ì—­ë§¤í•‘ (ì´ë¦„ -> ì½”ë“œ)
    const BRAND_CODE_MAP = {
      'MLB': 'M',
      'MLB KIDS': 'I',
      'DISCOVERY': 'X',
      'DUVETICA': 'V',
      'SUPRA': 'W',
      'SERGIO': 'ST'
    };

    // ì „ì—­ ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘ (ëª¨ë“  ê·¸ë˜í”„ì—ì„œ ê³µí†µ ì‚¬ìš©)
    const brandCodeMap = {
      'MLB': 'M',
      'MLB_KIDS': 'I',
      'DISCOVERY': 'X',
      'DUVETICA': 'V',
      'SERGIO': 'ST',
      'SUPRA': 'W'
    };
    
    let currentBrand = 'MLB';
    let currentSection = 'overview';
    let charts = {};
    let isDrilledDown = false;
    let currentDrillBrand = null;
    // í™”ë©´ë§Œ ë¨¼ì € êµ¬ì„±: falseì´ë©´ ì‹¤ì œ brandKPI ë°ì´í„°ë¡œ í‘œì‹œ
    window.uiStaticMode = false;
    window.radarChartType = 'channel';
    
    // 100% ë¼ì¸ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ (ë ˆì´ë” ì°¨íŠ¸ìš©)
    if (typeof Chart !== 'undefined' && Chart.register) {
      Chart.register({
        id: 'radar100Line',
        beforeDraw: (chart) => {
          if (chart.config.type !== 'radar') return;
          const {ctx, chartArea, scales} = chart;
          if (!chartArea || !scales || !scales.r) return;
          const {left, top, right, bottom} = chartArea;
          const {r} = scales;
          const centerX = (left + right) / 2;
          const centerY = (top + bottom) / 2;
          const maxRadius = Math.min((right - left) / 2, (bottom - top) / 2);
          const value100 = 100;
          const radius100 = (value100 / r.max) * maxRadius;
          
          ctx.save();
          ctx.strokeStyle = '#dc2626'; // ë¹¨ê°„ìƒ‰
          ctx.lineWidth = 2;
          ctx.setLineDash([]);
          ctx.beginPath();
          ctx.arc(centerX, centerY, radius100, 0, Math.PI * 2);
          ctx.stroke();
          ctx.restore();
        }
      });
    }
    
    // realData ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ë‚˜ì¤‘ì— ì´ˆê¸°í™”ë¨)
    let realData = null;

    // -------- ë„¤ë¹„ê²Œì´ì…˜ --------
    document.querySelectorAll('.nav-item').forEach(item=>{
      item.addEventListener('click', function(){
        document.querySelectorAll('.nav-item').forEach(nav=>nav.classList.remove('active'));
        this.classList.add('active');

        const section = this.dataset.section;
        currentSection = section;
        console.log('ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­:', {section, currentSection});
        document.querySelectorAll('.content-section').forEach(sec=>sec.classList.remove('active'));
        document.getElementById(`content-${section}`).classList.add('active');

        // ì„¹ì…˜ ë³€ê²½ ì‹œ íŒŒíŠ¸ë³„ ë¶„ì„ ëª¨ë“œ ë¹„í™œì„±í™”
        if (window.aiPartMode) {
          window.aiPartMode = false;
          clearAIPartNotes();
        }

        if(section==='overview'){
          document.getElementById('overview-pl').style.display='block';
          document.getElementById('brand-pl').style.display='none';
        }else{
          document.getElementById('overview-pl').style.display='none';
          document.getElementById('brand-pl').style.display='block';
        }

        // â˜…â˜…â˜… ë ˆì´ì•„ì›ƒ ê¹œë¹¡ì„ ë°©ì§€: ì„¹ì…˜ í‘œì‹œ í›„ ì°¨íŠ¸ ì´ˆê¸°í™” â˜…â˜…â˜…
        if(section==='overview'){
          // ì „ì²´ í˜„í™©: ì¦‰ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™” (API ë°ì´í„°ëŠ” ë°±ê·¸ë¼ìš´ë“œ ë¡œë“œ)
          requestAnimationFrame(()=>{ 
            initOverviewCharts();
            renderInsights();
            requestAnimationFrame(() => {
              loadEdits();
              if(isEditMode) applyEditMode();
            });
          });
        } else {
          // ë¸Œëœë“œë³„ ë¶„ì„: ë·° ì—…ë°ì´íŠ¸ ë¨¼ì €, ê·¸ ë‹¤ìŒ ì°¨íŠ¸ ì´ˆê¸°í™”
          updateBrandView();
          renderInsights();
          
          // â˜…â˜…â˜… ë ˆì´ì•„ì›ƒì´ ì™„ì „íˆ ë Œë”ë§ëœ í›„ ì°¨íŠ¸ ì´ˆê¸°í™” (2ë‹¨ê³„ ì§€ì—°) â˜…â˜…â˜…
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              // ì°¨íŠ¸ ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸
              if (typeof initBrandCharts === 'function') {
                initBrandCharts();
              }
              if (typeof updateBrandCharts === 'function') {
                updateBrandCharts();
              }
              if (typeof updateBrandPL === 'function') {
                updateBrandPL();
              }
              if (typeof renderItemDiffTable === 'function') {
                renderItemDiffTable();
              }
              if (typeof updateWeeklyTrendChart === 'function') {
                updateWeeklyTrendChart();
              }
              if (typeof updateBrandChannels === 'function') {
                updateBrandChannels();
              }
              
              // í¸ì§‘ ë‚´ìš© ì ìš©
              loadEdits();
              if(isEditMode) applyEditMode();
              if (window.aiPartMode) { renderAIPartNotes(); }
              
              // â˜…â˜…â˜… ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ (ë ˆì´ì•„ì›ƒ ì•ˆì •í™”) â˜…â˜…â˜…
              setTimeout(() => {
                try{
                  const treemapWrapperChannel = document.getElementById('treemapWrapperChannel');
                  const treemapWrapperItem = document.getElementById('treemapWrapperItem');
                  
                  if(treemapWrapperChannel && window.Plotly && window.Plotly.Plots){
                    window.Plotly.Plots.resize(treemapWrapperChannel);
                  }
                  if(treemapWrapperItem && window.Plotly && window.Plotly.Plots){
                    window.Plotly.Plots.resize(treemapWrapperItem);
                  }
                  
                  // Chart.js ë ˆì´ë” ì°¨íŠ¸ resize
                  if(charts.radar){
                    charts.radar.resize();
                    const radarType = window.radarChartType || 'channel';
                    const radarData = (radarType === 'channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand);
                    charts.radar.data.labels = radarData.labels;
                    charts.radar.data.datasets[0].data = radarData.plan;
                    charts.radar.data.datasets[1].data = radarData.yoy;
                    charts.radar.update();
                  }
                }catch(e){ console.warn('ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ ì‹¤íŒ¨:', e); }
              }, 100);
            });
          });
        }
      });
    });

    // -------- ë¸Œëœë“œ ë²„íŠ¼ --------
    // â˜…â˜…â˜… DOMì´ ì™„ì „íˆ ì¤€ë¹„ëœ í›„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡ â˜…â˜…â˜…
    setTimeout(() => {
    const brandBtns = document.querySelectorAll('.brand-btn');
    console.log('[ë¸Œëœë“œ ë²„íŠ¼] ì°¾ì€ ë²„íŠ¼ ìˆ˜:', brandBtns.length);
    brandBtns.forEach(btn=>{
      btn.addEventListener('click', function(){
        console.log('[ë¸Œëœë“œ ë²„íŠ¼] í´ë¦­ë¨!');
        document.querySelectorAll('.brand-btn').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        currentBrand = this.dataset.brand;
        console.log('ë¸Œëœë“œ ë²„íŠ¼ í´ë¦­:', currentBrand);
        
        // ë ˆì´ë” ì°¨íŠ¸ë¥¼ ì±„ë„ë³„ë¡œ ì´ˆê¸°í™”
        window.radarChartType = 'channel';
        // â˜…â˜…â˜… ë ˆì´ë” ì°¨íŠ¸ í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¬ë“±ë¡ â˜…â˜…â˜…
        if (typeof initRadarToggle === 'function') {
          initRadarToggle();
        } else {
          // initRadarToggleì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì§ì ‘ ì„¤ì •
          const btnCh = document.getElementById('radarBtnChannel');
          const btnIt = document.getElementById('radarBtnItem');
          if (btnCh && btnIt) {
            btnCh.style.background = '#2563eb'; btnCh.style.color = '#fff';
            btnIt.style.background = '#e5e7eb'; btnIt.style.color = '#374151';
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì§ì ‘ ë“±ë¡
            btnCh.onclick = ()=>{ window.radarChartType='channel'; initRadarToggle(); updateRadarStaticOrDynamic(); };
            btnIt.onclick = ()=>{ window.radarChartType='item'; initRadarToggle(); updateRadarStaticOrDynamic(); };
          }
        }
        
        // â˜…â˜…â˜… ê° í•¨ìˆ˜ë¥¼ try-catchë¡œ ê°ì‹¸ì„œ í•˜ë‚˜ê°€ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ ì‹¤í–‰ â˜…â˜…â˜…
        console.log('===== ë¸Œëœë“œ ë³€ê²½ ì‹œì‘ =====', currentBrand);
        console.log('window.brandKPI:', !!window.brandKPI, Object.keys(window.brandKPI || {}));
        console.log('window.brandData:', !!window.brandData, Object.keys(window.brandData || {}));
        console.log('window.channelProfitLossData:', !!window.channelProfitLossData);
        console.log('window.weeklySalesTrend:', !!window.weeklySalesTrend);
        
        try { console.log('1. renderInsights ì‹œì‘'); renderInsights(); console.log('1. renderInsights ì™„ë£Œ'); } catch(e) { console.error('renderInsights ì—ëŸ¬:', e); }
        
        try { console.log('2. updateBrandView ì‹œì‘'); updateBrandView(); console.log('2. updateBrandView ì™„ë£Œ'); } catch(e) { console.error('updateBrandView ì—ëŸ¬:', e); }
        
        // â˜… í• ì¸ë‚´ì—­ ì—…ë°ì´íŠ¸ (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼í•˜ê²Œ ë¸Œëœë“œ ë³€ê²½ ì‹œ í•­ìƒ ì—…ë°ì´íŠ¸) â˜…
        try { 
          console.log('2-1. updateDiscountTable ì‹œì‘ - currentBrand:', currentBrand); 
          if(typeof updateDiscountTable === 'function') {
            console.log('2-1. í• ì¸ë‚´ì—­ ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ë¸Œëœë“œ ë³€ê²½ ì‹œ)');
            updateDiscountTable().catch(err => console.error('updateDiscountTable ë¹„ë™ê¸° ì—ëŸ¬:', err)); 
          }
          console.log('2-1. updateDiscountTable í˜¸ì¶œ ì™„ë£Œ (ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘)'); 
        } catch(e) { 
          console.error('updateDiscountTable ì—ëŸ¬:', e); 
        }
        
        // â˜… í”„ë¡œëª¨ì…˜ ë‚´ìš© ì—…ë°ì´íŠ¸ (ë¸Œëœë“œ ë³€ê²½ ì‹œ í•­ìƒ ì—…ë°ì´íŠ¸) â˜…
        try { 
          console.log('2-2. updatePromotionContent ì‹œì‘ - currentBrand:', currentBrand); 
          if(typeof window.updatePromotionContent === 'function') {
            console.log('2-2. í”„ë¡œëª¨ì…˜ ë‚´ìš© ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ë¸Œëœë“œ ë³€ê²½ ì‹œ)');
            window.updatePromotionContent();
          } else {
            console.error('2-2. updatePromotionContent í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ!');
          }
          console.log('2-2. updatePromotionContent í˜¸ì¶œ ì™„ë£Œ'); 
        } catch(e) { 
          console.error('updatePromotionContent ì—ëŸ¬:', e); 
        }
        
        // â˜… ì†ìµê³„ì‚°ì„œ ë³„ë„ í˜¸ì¶œ (updateBrandViewì™€ ë…ë¦½ì ìœ¼ë¡œ)
        try { console.log('3. updateBrandPL ì‹œì‘'); if(typeof updateBrandPL === 'function') updateBrandPL(); console.log('3. updateBrandPL ì™„ë£Œ'); } catch(e) { console.error('updateBrandPL ì—ëŸ¬:', e); }
        
        // â˜… ë¸Œëœë“œ ë³€ê²½ ì‹œ ì°¨íŠ¸ ì™„ì „ ìƒˆë¡œê³ ì¹¨: ë¨¼ì € initBrandChartsë¡œ ì´ˆê¸°í™”í•œ í›„ updateBrandCharts í˜¸ì¶œ
        try { 
          if (typeof initBrandCharts === 'function') {
            console.log('4. ë¸Œëœë“œ ì°¨íŠ¸ ìƒˆë¡œê³ ì¹¨ - initBrandCharts ì‹œì‘'); 
            initBrandCharts(); 
            console.log('4. initBrandCharts ì™„ë£Œ'); 
          }
        } catch(e) { console.error('initBrandCharts ì—ëŸ¬:', e); }
        
        try { console.log('5. updateBrandCharts ì‹œì‘'); updateBrandCharts(); console.log('5. updateBrandCharts ì™„ë£Œ'); } catch(e) { console.error('updateBrandCharts ì—ëŸ¬:', e); }
        
        try { 
          console.log('6. renderItemDiffTable ì‹œì‘');
          if(typeof renderItemDiffTable === 'function') renderItemDiffTable(); 
          console.log('6. renderItemDiffTable ì™„ë£Œ');
        } catch(e) { console.error('renderItemDiffTable ì—ëŸ¬:', e); }
        
        // â˜… ì¬ê³ ì£¼ìˆ˜ ì°¨íŠ¸ë„ ë³„ë„ í˜¸ì¶œ
        try { console.log('7. updateInventoryChart ì‹œì‘'); if(typeof updateInventoryChart === 'function') updateInventoryChart(); console.log('7. updateInventoryChart ì™„ë£Œ'); } catch(e) { console.error('updateInventoryChart ì—ëŸ¬:', e); }
        
        try { console.log('8. updateWeeklyTrendChart ì‹œì‘'); updateWeeklyTrendChart(); console.log('8. updateWeeklyTrendChart ì™„ë£Œ'); } catch(e) { console.error('updateWeeklyTrendChart ì—ëŸ¬:', e); }
        
        try { console.log('9. updateBrandChannels ì‹œì‘'); updateBrandChannels(); console.log('9. updateBrandChannels ì™„ë£Œ'); } catch(e) { console.error('updateBrandChannels ì—ëŸ¬:', e); }
        
        console.log('===== ë¸Œëœë“œ ë³€ê²½ ì™„ë£Œ =====');
        
        // â˜…â˜…â˜… updateBrandView ì´í›„ì— loadEdits í˜¸ì¶œí•˜ì—¬ localStorage ë®ì–´ì“°ê¸° ë°©ì§€ â˜…â˜…â˜…
        // ëª¨ë“  KPI ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ ê°’ì´ JSONì—ì„œ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ëœ í›„ì— loadEdits í˜¸ì¶œ
        setTimeout(() => {
          // â˜…â˜…â˜… ëª¨ë“  KPI ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ ê°’ì€ JSONì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ ê°•ì œ ì„¤ì • (localStorage ë¬´ì‹œ) â˜…â˜…â˜…
          if (window.brandKPI) {
            const brandCode = brandCodeMap[currentBrand] || 'M';
            const kpi = window.brandKPI[brandCode] || window.brandKPI[currentBrand];
            if (kpi) {
              // ì˜ì—…ì´ìµ ê°’
              const opProfitForecast = (kpi.operatingProfitForecast || 0) / 100000000;
              const opProfitCurrent = (kpi.operatingProfit || 0) / 100000000;
              const opProfitRateForecast = kpi.operatingProfitRateForecast || 0;
              const opProfitRateCurrent = kpi.operatingProfitRate || 0;
              
              const opprofitEl = document.getElementById('brand-opprofit');
              const currentOpprofitEl = document.getElementById('brand-current-opprofit');
              const opprofitRateEl = document.getElementById('brand-opprofit-margin-rate');
              const currentOpprofitRateEl = document.getElementById('brand-current-opprofit-margin-rate');
              
              if (opprofitEl) opprofitEl.textContent = `${opProfitForecast.toFixed(1)}ì–µì›`;
              if (currentOpprofitEl) currentOpprofitEl.textContent = `${opProfitCurrent.toFixed(1)}ì–µì›`;
              if (opprofitRateEl) opprofitRateEl.textContent = `(${opProfitRateForecast.toFixed(1)}%)`;
              if (currentOpprofitRateEl) currentOpprofitRateEl.textContent = `(${opProfitRateCurrent.toFixed(1)}%)`;
              
              // ë§¤ì¶œ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
              const revenueVsPlanDiff = kpi.revenueVsPlan || 0;  // ì°¨ì´ê°’ (ì˜ˆ: -1.5)
              const revenueVsPreviousDiff = kpi.revenueVsPrevious || 0;  // ì°¨ì´ê°’ (ì˜ˆ: +0.4)
              const revenueVsPlanRatio = 100 + revenueVsPlanDiff;  // ëª©í‘œëŒ€ë¹„ ë¹„ìœ¨ (ì˜ˆ: 98.5%)
              const revenueVsPreviousRatio = 100 + revenueVsPreviousDiff;  // ì „ë…„ëŒ€ë¹„ ë¹„ìœ¨ (ì˜ˆ: 100.4%)
              const revenueChangeEl = document.getElementById('brand-revenue-change');
              const revenueYoyEl = document.getElementById('brand-revenue-yoy');
              if (revenueChangeEl) {
                revenueChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${revenueVsPlanRatio.toFixed(1)}%`;
                revenueChangeEl.className = 'kpi-change-line editable ' + (revenueVsPlanRatio >= 100 ? 'kpi-positive' : 'kpi-negative');
              }
              if (revenueYoyEl) {
                revenueYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${revenueVsPreviousRatio.toFixed(1)}%`;
                revenueYoyEl.className = 'kpi-change editable ' + (revenueVsPreviousRatio >= 100 ? 'kpi-positive' : revenueVsPreviousRatio === 100 ? 'kpi-neutral' : 'kpi-negative');
              }
              
              // ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
              const profitVsPlanDiff = kpi.profitVsPlan || 0;  // ì°¨ì´ê°’
              const profitVsPreviousDiff = kpi.profitVsPrevious || 0;  // ì°¨ì´ê°’
              const profitVsPlanRatio = 100 + profitVsPlanDiff;  // ëª©í‘œëŒ€ë¹„ ë¹„ìœ¨
              const profitVsPreviousRatio = 100 + profitVsPreviousDiff;  // ì „ë…„ëŒ€ë¹„ ë¹„ìœ¨
              const profitChangeEl = document.getElementById('brand-profit-change');
              const profitYoyEl = document.getElementById('brand-profit-yoy');
              if (profitChangeEl) {
                profitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${profitVsPlanRatio.toFixed(1)}%`;
                profitChangeEl.className = 'kpi-change-line editable ' + (profitVsPlanRatio >= 100 ? 'kpi-positive' : 'kpi-negative');
              }
              if (profitYoyEl) {
                profitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${profitVsPreviousRatio.toFixed(1)}%`;
                profitYoyEl.className = 'kpi-change editable ' + (profitVsPreviousRatio >= 100 ? 'kpi-positive' : profitVsPreviousRatio === 100 ? 'kpi-neutral' : 'kpi-negative');
              }
              
              // ì˜ì—…ì´ìµ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - ì†ìµê³„ì‚°ì„œì™€ ë™ì¼í•œ ì¡°ê±´ë¶€ í‘œì‹œ ë¡œì§ ì ìš©
              const formatOperatingProfitYoyKPI = (forecast, prev) => {
                if (!prev || prev === 0) {
                  return '-';
                }
                if (prev > 0 && forecast < 0) {
                  return 'ì ìì „í™˜';
                }
                if (prev < 0 && forecast > 0) {
                  return 'í‘ìì „í™˜';
                }
                if (prev < 0 && forecast < 0) {
                  return forecast > prev ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
                }
                return Math.round((forecast / prev) * 100) + '%';
              };
              
              const formatOperatingProfitAchievementKPI = (forecast, target) => {
                if (!target || target === 0) {
                  return '-';
                }
                if (target > 0 && forecast < 0) {
                  return 'ì ì';
                }
                if (target < 0 && forecast > 0) {
                  return 'í‘ì';
                }
                if (target < 0 && forecast < 0) {
                  return forecast > target ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
                }
                return Math.round((forecast / target) * 100) + '%';
              };
              
              // ì˜ì—…ì´ìµ ê°’ (ì› ë‹¨ìœ„ -> ì–µì› ë‹¨ìœ„)
              const opProfitForecastKPI2 = (kpi.operatingProfitForecast || 0) / 100000000;
              const opProfitPreviousKPI2 = (kpi.operatingProfitPrevious || 0) / 100000000;
              const opProfitPlanKPI2 = (kpi.operatingProfitPlan || 0) / 100000000;
              
              const opProfitVsPlanText = formatOperatingProfitAchievementKPI(opProfitForecastKPI2, opProfitPlanKPI2);
              const opProfitVsPreviousText = formatOperatingProfitYoyKPI(opProfitForecastKPI2, opProfitPreviousKPI2);
              
              const opprofitChangeEl = document.getElementById('brand-opprofit-change');
              const opprofitYoyEl = document.getElementById('brand-opprofit-yoy');
              
              // ìŠ¤ì½”í”„ ë°–ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ ë¯¸ë¦¬ ì„ ì–¸
              let opProfitVsPlanRatio = 0;
              let opProfitVsPreviousRatio = 0;
              
              if (opprofitChangeEl) {
                if (opProfitVsPlanText === '-' || opProfitVsPlanText === 'ì ì' || opProfitVsPlanText === 'í‘ì' || opProfitVsPlanText.includes('ì ì')) {
                  opprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${opProfitVsPlanText}`;
                  opprofitChangeEl.className = 'kpi-change-line editable ' + (opProfitVsPlanText.includes('í‘ì') || opProfitVsPlanText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
              } else {
                // ì˜ì—…ì´ìµ ê³„íšì´ ìˆìœ¼ë©´ ì§ì ‘ ê³„ì‚°, ì—†ìœ¼ë©´ ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„ ì‚¬ìš©
                if (opProfitPlanKPI2 > 0 && opProfitForecastKPI2 !== 0) {
                  opProfitVsPlanRatio = (opProfitForecastKPI2 / opProfitPlanKPI2) * 100;
                  opprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${opProfitVsPlanRatio.toFixed(1)}%`;
                  opprofitChangeEl.className = 'kpi-change-line editable ' + (opProfitVsPlanRatio >= 100 ? 'kpi-positive' : 'kpi-negative');
                } else {
                  const opProfitVsPlanDiff = kpi.profitVsPlan || 0;
                  opProfitVsPlanRatio = 100 + opProfitVsPlanDiff;
                  opprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${opProfitVsPlanRatio.toFixed(1)}%`;
                  opprofitChangeEl.className = 'kpi-change-line editable ' + (opProfitVsPlanRatio >= 100 ? 'kpi-positive' : 'kpi-negative');
                }
              }
              }
              
              if (opprofitYoyEl) {
                if (opProfitVsPreviousText === '-' || opProfitVsPreviousText === 'ì ìì „í™˜' || opProfitVsPreviousText === 'í‘ìì „í™˜' || opProfitVsPreviousText.includes('ì ì')) {
                  opprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${opProfitVsPreviousText}`;
                  opprofitYoyEl.className = 'kpi-change editable ' + (opProfitVsPreviousText.includes('í‘ì') || opProfitVsPreviousText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
                } else {
                  if (kpi.operatingProfitPrevious && kpi.operatingProfitPrevious !== 0) {
                    opProfitVsPreviousRatio = ((kpi.operatingProfitForecast || 0) / Math.abs(kpi.operatingProfitPrevious)) * 100;
                  }
                  if (opProfitVsPreviousRatio > 0) {
                    opprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${opProfitVsPreviousRatio.toFixed(1)}%`;
                    opprofitYoyEl.className = 'kpi-change editable ' + (opProfitVsPreviousRatio >= 100 ? 'kpi-positive' : opProfitVsPreviousRatio === 100 ? 'kpi-neutral' : 'kpi-negative');
                  }
                }
              }
              
              console.log('[KPI ê°•ì œ ì—…ë°ì´íŠ¸] JSONì—ì„œ ì§ì ‘ ì„¤ì • ì™„ë£Œ:', {
                revenueVsPlanRatio,
                revenueVsPreviousRatio,
                profitVsPlanRatio,
                profitVsPreviousRatio,
                opProfitVsPlanRatio,
                opProfitVsPreviousRatio
              });
            }
          }
          
          // ê·¸ ë‹¤ìŒì— loadEdits í˜¸ì¶œ (KPI ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ ë° ì£¼ìš” ì±„ë„ë³„ ì†ìµ ê°’ì€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë®ì–´ì“°ì§€ ì•ŠìŒ)
          loadEdits();
          if(isEditMode) applyEditMode();
          if (window.aiPartMode) { renderAIPartNotes(); }
          
          // â˜…â˜…â˜… ì£¼ìš” ì±„ë„ë³„ ì†ìµ í…Œì´ë¸”ë„ JSON ë°ì´í„°ë¡œ ê°•ì œ ì—…ë°ì´íŠ¸ (loadEdits ì´í›„ì— ë‹¤ì‹œ ì„¤ì •) â˜…â˜…â˜…
          // loadEditsê°€ localStorageì—ì„œ ê°’ì„ ë¶ˆëŸ¬ì™€ ë®ì–´ì“¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í™•ì‹¤í•˜ê²Œ JSON ë°ì´í„°ë¡œ ë‹¤ì‹œ ì„¤ì •
          requestAnimationFrame(() => {
            if (typeof updateBrandChannels === 'function') {
              console.log('[ë¸Œëœë“œ ë²„íŠ¼] loadEdits ì´í›„ updateBrandChannels ì¬í˜¸ì¶œ (JSON ë°ì´í„°ë¡œ ë®ì–´ì“°ê¸°)');
              updateBrandChannels();
            }
            
            // â˜…â˜…â˜… ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ ì¶”ê°€ (ë¸Œëœë“œ ì „í™˜ ì‹œ ë ˆì´ì•„ì›ƒ ê¹œë¹¡ì„ ë°©ì§€) â˜…â˜…â˜…
            try {
              const treemapWrapperChannel = document.getElementById('treemapWrapperChannel');
              const treemapWrapperItem = document.getElementById('treemapWrapperItem');
              
              if(treemapWrapperChannel && window.Plotly && window.Plotly.Plots){
                window.Plotly.Plots.resize(treemapWrapperChannel);
              }
              if(treemapWrapperItem && window.Plotly && window.Plotly.Plots){
                window.Plotly.Plots.resize(treemapWrapperItem);
              }
              
              // Chart.js ë ˆì´ë” ì°¨íŠ¸ resize
              if(charts.radar){
                charts.radar.resize();
                charts.radar.update();
              }
            } catch(e) { console.warn('ë¸Œëœë“œ ì „í™˜ ì‹œ ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ ì‹¤íŒ¨:', e); }
          });
        }, 100);
      });
    });
    }, 100); // â˜… setTimeout ë - DOM ì¤€ë¹„ ëŒ€ê¸°

    // -------- ì±„ë„ë³„ ì†ìµ ë²„íŠ¼ (ë§¤ì¶œ / ì§ì ‘ì´ìµ) --------
    document.querySelectorAll('.channel-pl-toggle-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.channel-pl-toggle-btn').forEach(b => {
          b.style.background = '#e5e7eb';
          b.style.color = '#374151';
        });
        
        // í˜„ì¬ ë²„íŠ¼ í™œì„±í™”
        this.style.background = '#4f46e5';
        this.style.color = 'white';
        
        // ëª¨ë“œ ë³€ê²½
        if (this.id === 'channelPlRevenue') {
          channelPlMode = 'revenue';
        } else if (this.id === 'channelPlProfit') {
          channelPlMode = 'profit';
        }
        
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        updateBrandChannels();
      });
    });

    // -------- ì‹¤ì‹œê°„ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ì¸ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ê¸° --------
    async function fetchRealtimeInsights() {
      try {
        console.log('[fetchRealtimeInsights] API í˜¸ì¶œ ì‹œì‘');
        
        // ì¬ê³ ì£¼ìˆ˜ ë° íŒë§¤ìœ¨ API í˜¸ì¶œ
        const [stockWeeksResponse, salesRateResponse] = await Promise.all([
          fetch('/api/stock-weeks').then(r => r.json()).catch(() => null),
          fetch('/api/sales-rate').then(r => r.json()).catch(() => null)
        ]);
        
        if (!stockWeeksResponse?.success || !salesRateResponse?.success) {
          console.warn('[fetchRealtimeInsights] API ì‘ë‹µ ì‹¤íŒ¨');
          return null;
        }
        
        const apiDate = stockWeeksResponse.asof_dt || stockWeeksResponse.date;
        const datePrefix = `(í˜„ì¬ê¸°ì¤€ ${apiDate})`;
        
        const cyData = stockWeeksResponse.data?.CY || [];
        const pyData = stockWeeksResponse.data?.PY || [];
        const curSalesData = salesRateResponse.data?.CUR || [];
        const pySalesData = salesRateResponse.data?.PY || [];
        
        console.log('[fetchRealtimeInsights] API ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
          cyCount: cyData.length,
          pyCount: pyData.length,
          curSalesCount: curSalesData.length,
          pySalesCount: pySalesData.length,
          apiDate
        });
        
        // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
        const BRAND_NAME_MAP = {
          'M': 'MLB', 'I': 'MLB_KIDS', 'X': 'DISCOVERY', 
          'V': 'DUVETICA', 'ST': 'SERGIO', 'W': 'SUPRA'
        };
        
        // ë°ì´í„° ì§‘ê³„
        const itemMap = {};
        
        // CY ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°
        cyData.forEach(row => {
          const brd_cd = row.BRD_CD;
          const item_cd = row.ITEM_CD || row.ITEM;
          if (!brd_cd || !item_cd || brd_cd === 'W') return; // SUPRA ì œì™¸
          
          const key = `${brd_cd}_${item_cd}`;
          if (!itemMap[key]) {
            itemMap[key] = {
              brand: brd_cd,
              itemCode: item_cd,
              itemName: row.ITEM_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0 }
            };
          }
          itemMap[key].cy.saleQty28d += row.SALE_QTY_28D || 0;
          itemMap[key].cy.saleTag7d += row.SALE_TAG_7D || 0;
          itemMap[key].cy.stockQty += row.STOCK_QTY || 0;
        });
        
        // PY ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°
        pyData.forEach(row => {
          const brd_cd = row.BRD_CD;
          const item_cd = row.ITEM_CD || row.ITEM;
          if (!brd_cd || !item_cd || brd_cd === 'W') return;
          
          const key = `${brd_cd}_${item_cd}`;
          if (!itemMap[key]) {
            itemMap[key] = {
              brand: brd_cd,
              itemCode: item_cd,
              itemName: row.ITEM_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0 }
            };
          }
          itemMap[key].py.saleQty28d += row.SALE_QTY_28D || 0;
          itemMap[key].py.stockQty += row.STOCK_QTY || 0;
        });
        
        // CUR íŒë§¤ìœ¨ ë°ì´í„°
        curSalesData.forEach(row => {
          const brd_cd = row.BRD_CD;
          const item_cd = row.ITEM_CD;
          if (!brd_cd || !item_cd || brd_cd === 'W') return;
          
          const key = `${brd_cd}_${item_cd}`;
          if (itemMap[key]) {
            const ordQty = row.AC_ORD_QTY_KOR || 0;
            const saleQty = row.SALE_QTY || 0;
            const saleTag = row.SALE_TAG || 0;
            itemMap[key].salesRate.cur = ordQty > 0 ? (saleQty / ordQty) : 0;
            itemMap[key].salesRate.curTag = saleTag;
          }
        });
        
        // PY íŒë§¤ìœ¨ ë°ì´í„°
        pySalesData.forEach(row => {
          const brd_cd = row.BRD_CD;
          const item_cd = row.ITEM_CD;
          if (!brd_cd || !item_cd || brd_cd === 'W') return;
          
          const key = `${brd_cd}_${item_cd}`;
          if (itemMap[key]) {
            const ordQty = row.AC_ORD_QTY_KOR || 0;
            const saleQty = row.SALE_QTY || 0;
            itemMap[key].salesRate.py = ordQty > 0 ? (saleQty / ordQty) : 0;
          }
        });
        
        // ì¸ì‚¬ì´íŠ¸ ìƒì„±ìš© ë°ì´í„° ë³€í™˜
        const allItems = Object.values(itemMap).map(item => {
          const avg4w = item.cy.saleQty28d / 4;
          const stockWeeks = avg4w > 0 ? item.cy.stockQty / avg4w : 0;
          
          const pyAvg4w = item.py.saleQty28d / 4;
          const pyStockWeeks = pyAvg4w > 0 ? item.py.stockQty / pyAvg4w : 0;
          
          const yoyRate = pyAvg4w > 0 ? (avg4w / pyAvg4w) * 100 : 0;
          
          return {
            brand: BRAND_NAME_MAP[item.brand] || item.brand,
            brandCode: item.brand,
            itemName: item.itemName,
            salesRate: item.salesRate.cur,
            salesRateDiff: item.salesRate.cur - item.salesRate.py,
            salesTag: item.salesRate.curTag || 0,
            salesAmt: item.cy.saleTag7d,
            stockWeeks: stockWeeks,
            stockWeeksDiff: stockWeeks - pyStockWeeks,
            yoyRate: yoyRate
          };
        }).filter(item => item.salesRate > 0 || item.stockWeeks > 0);
        
        console.log('[fetchRealtimeInsights] ë³€í™˜ëœ ì•„ì´í…œ ìˆ˜:', allItems.length);
        
        // ì¸ì‚¬ì´íŠ¸ ìƒì„±
        const insights = [];
        
        // 1. íŒë§¤ìœ¨ì´ ê°€ì¥ ë†’ì€ ê²ƒ, ë‚®ì€ ê²ƒ
        const validSalesItems = allItems.filter(item => item.salesRate > 0);
        if (validSalesItems.length > 0) {
          const highest = validSalesItems.reduce((max, item) => 
            item.salesRate > max.salesRate ? item : max
          );
          const lowest = validSalesItems.reduce((min, item) => 
            item.salesRate < min.salesRate ? item : min
          );
          
          insights.push(
            `${datePrefix}íŒë§¤ìœ¨ì´ ê°€ì¥ ë†’ì€ ê²ƒì€ <strong>${highest.brand} ${highest.itemName}</strong> (${(highest.salesRate * 100).toFixed(1)}%)ì´ë©°, ` +
            `ë‚®ì€ ê²ƒì€ <strong>${lowest.brand} ${lowest.itemName}</strong> (${(lowest.salesRate * 100).toFixed(1)}%)ì…ë‹ˆë‹¤.`
          );
        }
        
        // 2. ì¬ê³ ì£¼ìˆ˜ ì ê·¹ë°œì£¼/ê¸´ê¸‰ì¡°ì¹˜
        const activeOrderItems = allItems.filter(item => 
          item.stockWeeks > 0 && item.stockWeeks < 30 && item.yoyRate >= 120
        );
        const urgentActionItems = allItems.filter(item => 
          item.stockWeeks >= 50 && item.yoyRate < 100 && item.salesAmt >= 100000000
        );
        
        let inventoryText = '';
        if (activeOrderItems.length > 0) {
          const shortest = activeOrderItems.reduce((min, item) => 
            item.stockWeeks < min.stockWeeks ? item : min
          );
          const salesMillions = Math.round(shortest.salesAmt / 1000000);
          inventoryText = `<strong>${shortest.brand} ${shortest.itemName}</strong>(ë§¤ì¶œ: ${salesMillions}ë°±ë§Œì›) ${shortest.stockWeeks.toFixed(1)}ì£¼ë¡œ ì ê·¹ ë°œì£¼ê°€ í•„ìš”í•˜ë©°`;
        }
        
        if (urgentActionItems.length > 0) {
          const longest = urgentActionItems.reduce((max, item) => 
            item.stockWeeks > max.stockWeeks ? item : max
          );
          const salesMillions = Math.round(longest.salesAmt / 1000000);
          if (inventoryText) {
            inventoryText += `, <strong>${longest.brand} ${longest.itemName}</strong>(ë§¤ì¶œ: ${salesMillions}ë°±ë§Œì›) ${longest.stockWeeks.toFixed(1)}ì£¼ë¡œ ê¸´ê¸‰ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤`;
          } else {
            inventoryText = `<strong>${longest.brand} ${longest.itemName}</strong>(ë§¤ì¶œ: ${salesMillions}ë°±ë§Œì›) ${longest.stockWeeks.toFixed(1)}ì£¼ë¡œ ê¸´ê¸‰ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤`;
          }
        }
        
        if (inventoryText) {
          insights.push(`${datePrefix}ì•„ì´í…œ ì¤‘ ${inventoryText}.`);
        }
        
        console.log('[fetchRealtimeInsights] ìƒì„±ëœ ì¸ì‚¬ì´íŠ¸:', insights);
        
        return insights.length > 0 ? insights : null;
        
      } catch (error) {
        console.error('[fetchRealtimeInsights] ì˜¤ë¥˜ ë°œìƒ:', error);
        return null;
      }
    }

    // -------- ë¸Œëœë“œë³„ ì‹¤ì‹œê°„ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ì¸ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ê¸° --------
    async function fetchBrandRealtimeInsights(brandName) {
      try {
        console.log('[fetchBrandRealtimeInsights] API í˜¸ì¶œ ì‹œì‘:', brandName);
        
        // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
        const BRAND_CODE_MAP = {
          'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X', 
          'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W'
        };
        const brandCode = BRAND_CODE_MAP[brandName];
        if (!brandCode) {
          console.warn('[fetchBrandRealtimeInsights] ë¸Œëœë“œ ì½”ë“œ ì—†ìŒ:', brandName);
          return null;
        }
        
        // ì¬ê³ ì£¼ìˆ˜ ë° íŒë§¤ìœ¨ API í˜¸ì¶œ
        const [stockWeeksResponse, salesRateResponse] = await Promise.all([
          fetch('/api/stock-weeks').then(r => r.json()).catch(() => null),
          fetch('/api/sales-rate').then(r => r.json()).catch(() => null)
        ]);
        
        if (!stockWeeksResponse?.success || !salesRateResponse?.success) {
          console.warn('[fetchBrandRealtimeInsights] API ì‘ë‹µ ì‹¤íŒ¨');
          return null;
        }
        
        const apiDate = stockWeeksResponse.asof_dt || stockWeeksResponse.date;
        const datePrefix = `(í˜„ì¬ê¸°ì¤€ ${apiDate})`;
        
        const cyData = (stockWeeksResponse.data?.CY || []).filter(row => row.BRD_CD === brandCode);
        const pyData = (stockWeeksResponse.data?.PY || []).filter(row => row.BRD_CD === brandCode);
        const curSalesData = (salesRateResponse.data?.CUR || []).filter(row => row.BRD_CD === brandCode);
        const pySalesData = (salesRateResponse.data?.PY || []).filter(row => row.BRD_CD === brandCode);
        
        console.log('[fetchBrandRealtimeInsights] ë¸Œëœë“œ ë°ì´í„° ë¡œë“œ:', {
          brandName,
          brandCode,
          cyCount: cyData.length,
          pyCount: pyData.length,
          curSalesCount: curSalesData.length
        });
        
        // ë°ì´í„° ì§‘ê³„
        const itemMap = {};
        
        // CY ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°
        cyData.forEach(row => {
          const item_cd = row.ITEM_CD || row.ITEM;
          if (!item_cd) return;
          
          const key = item_cd;
          if (!itemMap[key]) {
            itemMap[key] = {
              itemName: row.ITEM_NM || '',
              prdtKindNm: row.PRDT_KIND_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0, curTag: 0 }
            };
          }
          itemMap[key].cy.saleQty28d += row.SALE_QTY_28D || 0;
          itemMap[key].cy.saleTag7d += row.SALE_TAG_7D || 0;
          itemMap[key].cy.stockQty += row.STOCK_QTY || 0;
        });
        
        // PY ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°
        pyData.forEach(row => {
          const item_cd = row.ITEM_CD || row.ITEM;
          if (!item_cd) return;
          
          const key = item_cd;
          if (!itemMap[key]) {
            itemMap[key] = {
              itemName: row.ITEM_NM || '',
              prdtKindNm: row.PRDT_KIND_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0, curTag: 0 }
            };
          }
          itemMap[key].py.saleQty28d += row.SALE_QTY_28D || 0;
          itemMap[key].py.stockQty += row.STOCK_QTY || 0;
        });
        
        // CUR íŒë§¤ìœ¨ ë°ì´í„°
        curSalesData.forEach(row => {
          const item_cd = row.ITEM_CD;
          if (!item_cd) return;
          
          const key = item_cd;
          
          // itemMapì— ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
          if (!itemMap[key]) {
            itemMap[key] = {
              itemName: row.ITEM_NM || '',
              prdtKindNm: row.PRDT_KIND_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0, curTag: 0 }
            };
          }
          
          const ordQty = row.AC_ORD_QTY_KOR || 0;
          const saleQty = row.SALE_QTY || 0;
          const saleTag = row.SALE_TAG || 0;
          itemMap[key].salesRate.cur = ordQty > 0 ? (saleQty / ordQty) : 0;
          itemMap[key].salesRate.curTag = saleTag;
        });
        
        // PY íŒë§¤ìœ¨ ë°ì´í„°
        pySalesData.forEach(row => {
          const item_cd = row.ITEM_CD;
          if (!item_cd) return;
          
          const key = item_cd;
          
          // itemMapì— ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
          if (!itemMap[key]) {
            itemMap[key] = {
              itemName: row.ITEM_NM || '',
              prdtKindNm: row.PRDT_KIND_NM || '',
              cy: { saleQty28d: 0, saleTag7d: 0, stockQty: 0 },
              py: { saleQty28d: 0, stockQty: 0 },
              salesRate: { cur: 0, py: 0, curTag: 0 }
            };
          }
          
          const ordQty = row.AC_ORD_QTY_KOR || 0;
          const saleQty = row.SALE_QTY || 0;
          itemMap[key].salesRate.py = ordQty > 0 ? (saleQty / ordQty) : 0;
        });
        
        // ì¸ì‚¬ì´íŠ¸ ìƒì„±ìš© ë°ì´í„° ë³€í™˜
        const brandItems = Object.values(itemMap).map(item => {
          const avg4w = item.cy.saleQty28d / 4;
          const stockWeeks = avg4w > 0 ? item.cy.stockQty / avg4w : 0;
          
          const pyAvg4w = item.py.saleQty28d / 4;
          const pyStockWeeks = pyAvg4w > 0 ? item.py.stockQty / pyAvg4w : 0;
          
          return {
            itemName: item.itemName,
            prdtKindNm: item.prdtKindNm,
            salesRate: item.salesRate.cur,
            salesRateDiff: item.salesRate.cur - item.salesRate.py,
            salesTag: item.salesRate.curTag,
            salesAmt: item.cy.saleTag7d,
            stockWeeks: stockWeeks,
            stockWeeksDiff: stockWeeks - pyStockWeeks
          };
        });
        
        console.log('[fetchBrandRealtimeInsights] ë³€í™˜ëœ ì•„ì´í…œ ìˆ˜:', brandItems.length);
        
        // ë””ë²„ê¹…: ìƒìœ„ 5ê°œ ì•„ì´í…œ í™•ì¸
        console.log('[fetchBrandRealtimeInsights] ìƒìœ„ 5ê°œ ì•„ì´í…œ (TAGë§¤ì¶œìˆœ):', 
          brandItems
            .sort((a, b) => b.salesTag - a.salesTag)
            .slice(0, 5)
            .map(item => ({
              itemName: item.itemName,
              salesTag: item.salesTag,
              salesRate: (item.salesRate * 100).toFixed(1) + '%',
              salesAmt: item.salesAmt
            }))
        );
        
        // ì¸ì‚¬ì´íŠ¸ ìƒì„±
        const insights = [];
        
        // 1. ë‹¹ë…„ ëˆ„ì  TAG ë§¤ì¶œ 1ìœ„/2ìœ„ (íŒë§¤ìœ¨ í¬í•¨)
        const clothingItems = brandItems.filter(item => 
          item.salesTag > 0
        ).sort((a, b) => b.salesTag - a.salesTag);
        
        console.log('[fetchBrandRealtimeInsights] ëˆ„ì TAGë§¤ì¶œ í•„í„°ë§ í›„:', clothingItems.length, 'ê°œ');
        if (clothingItems.length > 0) {
          console.log('[fetchBrandRealtimeInsights] 1ìœ„:', clothingItems[0].itemName, 
            'íŒë§¤ìœ¨:', (clothingItems[0].salesRate * 100).toFixed(1) + '%',
            'TAGë§¤ì¶œ:', clothingItems[0].salesTag);
        }
        
        if (clothingItems.length >= 2) {
          const item1 = clothingItems[0];
          const item2 = clothingItems[1];
          
          // ìƒìœ„ 30% ì¤‘ íŒë§¤ìœ¨ ì°¨ì´ê°€ ê°€ì¥ ì‘ì€ ê²ƒ
          const top30Count = Math.max(1, Math.floor(clothingItems.length * 0.3));
          const top30Items = clothingItems.slice(0, top30Count);
          const minDiffItem = top30Items.reduce((min, item) => 
            Math.abs(item.salesRateDiff) < Math.abs(min.salesRateDiff) ? item : min
          );
          
          if (minDiffItem.itemName !== item1.itemName && minDiffItem.itemName !== item2.itemName) {
            insights.push(
              `- ${datePrefix}ë‹¹ë…„ ëˆ„ì  TAG ë§¤ì¶œ 1ìœ„: <strong>${item1.itemName}</strong>ë¡œ íŒë§¤ìœ¨ ${(item1.salesRate * 100).toFixed(1)}%(ì „ë…„ëŒ€ë¹„ ${(item1.salesRateDiff * 100 >= 0 ? '+' : '')}${(item1.salesRateDiff * 100).toFixed(1)}%p), ` +
              `2ìœ„: <strong>${item2.itemName}</strong> íŒë§¤ìœ¨ ${(item2.salesRate * 100).toFixed(1)}%(ì „ë…„ëŒ€ë¹„ ${(item2.salesRateDiff * 100 >= 0 ? '+' : '')}${(item2.salesRateDiff * 100).toFixed(1)}%p), ` +
              `ë°˜ë©´ <strong>${minDiffItem.itemName}</strong>ëŠ” ëˆ„ì íŒë§¤ìœ¨ ì „ë…„ëŒ€ë¹„ ${(minDiffItem.salesRateDiff * 100 >= 0 ? '+' : '')}${(minDiffItem.salesRateDiff * 100).toFixed(1)}%pë¡œ ì¡°ì¹˜ í•„ìš”í•©ë‹ˆë‹¤.`
            );
          } else {
            insights.push(
              `- ${datePrefix}ë‹¹ë…„ ëˆ„ì  TAG ë§¤ì¶œ 1ìœ„: <strong>${item1.itemName}</strong>ë¡œ íŒë§¤ìœ¨ ${(item1.salesRate * 100).toFixed(1)}%(ì „ë…„ëŒ€ë¹„ ${(item1.salesRateDiff * 100 >= 0 ? '+' : '')}${(item1.salesRateDiff * 100).toFixed(1)}%p), ` +
              `2ìœ„: <strong>${item2.itemName}</strong> íŒë§¤ìœ¨ ${(item2.salesRate * 100).toFixed(1)}%(ì „ë…„ëŒ€ë¹„ ${(item2.salesRateDiff * 100 >= 0 ? '+' : '')}${(item2.salesRateDiff * 100).toFixed(1)}%p)ì…ë‹ˆë‹¤.`
            );
          }
        } else if (clothingItems.length === 1) {
          const item1 = clothingItems[0];
          insights.push(
            `- ${datePrefix}ë‹¹ë…„ ëˆ„ì  TAG ë§¤ì¶œ 1ìœ„: <strong>${item1.itemName}</strong>ë¡œ íŒë§¤ìœ¨ ${(item1.salesRate * 100).toFixed(1)}%(ì „ë…„ëŒ€ë¹„ ${(item1.salesRateDiff * 100 >= 0 ? '+' : '')}${(item1.salesRateDiff * 100).toFixed(1)}%p)ì…ë‹ˆë‹¤.`
          );
        }
        
        // 2. ì•„ì´í…œ ëˆ„ì íŒë§¤ë§¤ì¶œ 1ìœ„/2ìœ„ (ì¬ê³ ì£¼ìˆ˜ í¬í•¨)
        const allValidItems = brandItems.filter(item => item.salesAmt > 0)
          .sort((a, b) => b.salesAmt - a.salesAmt);
        
        if (allValidItems.length >= 2) {
          const acc1 = allValidItems[0];
          const acc2 = allValidItems[1];
          
          // ìƒìœ„ 30% ì¤‘ ì¬ê³ ì£¼ìˆ˜ê°€ ê°€ì¥ ë†’ì€ ê²ƒ
          const top30Count = Math.max(1, Math.floor(allValidItems.length * 0.3));
          const top30Items = allValidItems.slice(0, top30Count);
          const maxStockItem = top30Items.reduce((max, item) => 
            item.stockWeeks > max.stockWeeks ? item : max
          );
          
          insights.push(
            `- ${datePrefix}ì•„ì´í…œ ëˆ„ì íŒë§¤ë§¤ì¶œ 1ìœ„: <strong>${acc1.itemName}</strong> ì¬ê³ ì£¼ìˆ˜ ${acc1.stockWeeks.toFixed(1)}ì£¼(ì „ë…„ëŒ€ë¹„ ${(acc1.stockWeeksDiff >= 0 ? '+' : '')}${acc1.stockWeeksDiff.toFixed(1)}ì£¼) ` +
            `2ìœ„: <strong>${acc2.itemName}</strong> ì¬ê³ ì£¼ìˆ˜ ${acc2.stockWeeks.toFixed(1)}ì£¼(ì „ë…„ëŒ€ë¹„ ${(acc2.stockWeeksDiff >= 0 ? '+' : '')}${acc2.stockWeeksDiff.toFixed(1)}ì£¼), ` +
            `ë°˜ë©´ <strong>${maxStockItem.itemName}</strong>ëŠ” ì¬ê³ ì£¼ìˆ˜ ${maxStockItem.stockWeeks.toFixed(1)}ì£¼(ì „ë…„ëŒ€ë¹„ ${(maxStockItem.stockWeeksDiff >= 0 ? '+' : '')}${maxStockItem.stockWeeksDiff.toFixed(1)}ì£¼)ë¡œ ê´€ë¦¬í•„ìš”í•©ë‹ˆë‹¤.`
          );
        } else if (allValidItems.length === 1) {
          const acc1 = allValidItems[0];
          insights.push(
            `- ${datePrefix}ì•„ì´í…œ ëˆ„ì íŒë§¤ë§¤ì¶œ 1ìœ„: <strong>${acc1.itemName}</strong> ì¬ê³ ì£¼ìˆ˜ ${acc1.stockWeeks.toFixed(1)}ì£¼(ì „ë…„ëŒ€ë¹„ ${(acc1.stockWeeksDiff >= 0 ? '+' : '')}${acc1.stockWeeksDiff.toFixed(1)}ì£¼)ì…ë‹ˆë‹¤.`
          );
        }
        
        console.log('[fetchBrandRealtimeInsights] ìƒì„±ëœ ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸:', insights);
        
        return insights.length > 0 ? insights : null;
        
      } catch (error) {
        console.error('[fetchBrandRealtimeInsights] ì˜¤ë¥˜ ë°œìƒ:', error);
        return null;
      }
    }

    // -------- ì¸ì‚¬ì´íŠ¸ ë Œë”ë§ --------
    function renderInsights(){
      const overviewInsights = document.getElementById('overview-insights');
      const brandInsights = document.getElementById('brand-insights');

      // window.insightsDataë¥¼ ì§ì ‘ ì‚¬ìš© (JSON ë¡œë“œ í›„ ì—…ë°ì´íŠ¸ë¨)
      const currentInsightsData = window.insightsData || {};

      console.log('renderInsights í˜¸ì¶œ:', {currentSection, currentBrand});
      console.log('renderInsights insightsData:', currentInsightsData);
      console.log('renderInsights currentBrand ë°ì´í„°:', currentInsightsData[currentBrand]);

      if(currentSection==='overview'){
        let content = (currentInsightsData.overview?.content)||'';
        let keyPoints = (currentInsightsData.overview?.keyPoints)||'';
        
        console.log('[renderInsights] overview ì„¹ì…˜ ë°ì´í„°:', {
          hasContent: !!content,
          hasKeyPoints: !!keyPoints,
          contentLength: content.length,
          keyPointsLength: keyPoints.length
        });
        
        // overview ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì „ì²´ í˜„í™© KPI ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì•½ ìƒì„±
        if (!content && !keyPoints) {
          console.log('[renderInsights] overview ë°ì´í„° ì—†ìŒ, KPI ê¸°ë°˜ ìƒì„± ì‹œì‘');
          const overviewKPI = window.overviewKPI?.OVERVIEW || {};
          const overviewPL = window.overviewPL || {};
          
          // ì£¼ìš” ì§€í‘œ ì¶”ì¶œ
          const revenue = overviewKPI.revenueForecast || overviewKPI.revenue || 0;
          const revenueInHundredMillion = Math.round(revenue / 100000000);
          const directProfit = overviewKPI.directProfitForecast || overviewKPI.directProfit || 0;
          const directProfitInHundredMillion = Math.round(directProfit / 100000000);
          const directProfitRate = overviewKPI.directProfitRateForecast || overviewKPI.directProfitRate || 0;
          const discountRate = overviewKPI.discountRateForecast || overviewKPI.discountRate || 0;
          const progressRate = overviewKPI.progressRateForecast || overviewKPI.progressRate || 0;
          const revenueVsPlan = overviewKPI.revenueVsPlan || 0;
          const revenueVsPrevious = overviewKPI.revenueVsPrevious || 0;
          const profitVsPlan = overviewKPI.profitVsPlan || 0;
          const profitVsPrevious = overviewKPI.profitVsPrevious || 0;
          const operatingProfit = overviewKPI.operatingProfitForecast || overviewKPI.operatingProfit || 0;
          const operatingProfitInHundredMillion = Math.round(operatingProfit / 100000000);
          const operatingProfitRate = overviewKPI.operatingProfitRateForecast || overviewKPI.operatingProfitRate || 0;
          
          // ì£¼ìš”ë‚´ìš© ìƒì„±
          const revenueVsPlanText = revenueVsPlan >= 0 ? `${revenueVsPlan.toFixed(1)}%` : `${revenueVsPlan.toFixed(1)}%`;
          const revenueVsPreviousText = revenueVsPrevious >= 0 ? `${revenueVsPrevious.toFixed(1)}%` : `${revenueVsPrevious.toFixed(1)}%`;
          const profitVsPlanText = profitVsPlan >= 0 ? `${profitVsPlan.toFixed(1)}%` : `${profitVsPlan.toFixed(1)}%`;
          const profitVsPreviousText = profitVsPrevious >= 0 ? `${profitVsPrevious.toFixed(1)}%` : `${profitVsPrevious.toFixed(1)}%`;
          
          content = `ì „ì²´ ì‹¤íŒë§¤ì•¡ì€ ${revenueInHundredMillion}ì–µì›ìœ¼ë¡œ ëª©í‘œ ëŒ€ë¹„ ${revenueVsPlanText}, ì „ë…„ ëŒ€ë¹„ ${revenueVsPreviousText}ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. ` +
                   `ì§ì ‘ì´ìµì€ ${directProfitInHundredMillion}ì–µì›(ì§ì ‘ì´ìµìœ¨ ${directProfitRate.toFixed(1)}%)ìœ¼ë¡œ ëª©í‘œ ëŒ€ë¹„ ${profitVsPlanText}, ì „ë…„ ëŒ€ë¹„ ${profitVsPreviousText}ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ` +
                   `ì˜ì—…ì´ìµì€ ${operatingProfitInHundredMillion}ì–µì›(ì˜ì—…ì´ìµìœ¨ ${operatingProfitRate.toFixed(1)}%)ì´ë©°, í• ì¸ìœ¨ì€ ${discountRate.toFixed(1)}%ì…ë‹ˆë‹¤. ` +
                   `í˜„ì¬ ì§„ì²™ìœ¨ì€ ${progressRate.toFixed(1)}%ë¡œ ì›”ë§ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
          
          // í•µì‹¬ì¸ì‚¬ì´íŠ¸ ìƒì„±
          const insights = [];
          
          if (revenueVsPlan < -5) {
            insights.push(`â€¢ ëª©í‘œ ëŒ€ë¹„ ë§¤ì¶œ ë¶€ì¡±(${Math.abs(revenueVsPlan).toFixed(1)}%)ì´ ì»¤ ë§¤ì¶œ íšŒë³µ ì „ëµ ìˆ˜ë¦½ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`);
          } else if (revenueVsPlan > 0) {
            insights.push(`â€¢ ëª©í‘œ ëŒ€ë¹„ ${revenueVsPlan.toFixed(1)}% ì´ˆê³¼ ë‹¬ì„±ìœ¼ë¡œ ì–‘í˜¸í•œ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`);
          }
          
          if (revenueVsPrevious < -3) {
            insights.push(`â€¢ ì „ë…„ ëŒ€ë¹„ ë§¤ì¶œ í•˜ë½(${Math.abs(revenueVsPrevious).toFixed(1)}%)ìœ¼ë¡œ ì‹œì¥ ëŒ€ì‘ ì „ëµ ì¬ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
          } else if (revenueVsPrevious > 3) {
            insights.push(`â€¢ ì „ë…„ ëŒ€ë¹„ ${revenueVsPrevious.toFixed(1)}% ì„±ì¥ìœ¼ë¡œ ì„±ì¥ì„¸ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.`);
          }
          
          if (profitVsPlan < -5) {
            insights.push(`â€¢ ì§ì ‘ì´ìµ ëª©í‘œ ëŒ€ë¹„ ${Math.abs(profitVsPlan).toFixed(1)}% ë¶€ì¡±ìœ¼ë¡œ ìˆ˜ìµì„± ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
          }
          
          if (directProfitRate < 25) {
            insights.push(`â€¢ ì§ì ‘ì´ìµìœ¨ ${directProfitRate.toFixed(1)}%ë¡œ ìˆ˜ìµì„± ê°œì„ ì„ ìœ„í•œ ë¹„ìš© ìµœì í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
          } else if (directProfitRate > 30) {
            insights.push(`â€¢ ì§ì ‘ì´ìµìœ¨ ${directProfitRate.toFixed(1)}%ë¡œ ì–‘í˜¸í•œ ìˆ˜ìµì„±ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.`);
          }
          
          if (discountRate > 30) {
            insights.push(`â€¢ í• ì¸ìœ¨ ${discountRate.toFixed(1)}%ë¡œ í”„ë¦¬ë¯¸ì—„ í¬ì§€ì…”ë‹ ìœ ì§€ë¥¼ ìœ„í•œ í• ì¸ìœ¨ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
          }
          
          if (progressRate < 80) {
            insights.push(`â€¢ ì§„ì²™ìœ¨ ${progressRate.toFixed(1)}%ë¡œ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì¶”ê°€ ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
          } else if (progressRate > 95) {
            insights.push(`â€¢ ì§„ì²™ìœ¨ ${progressRate.toFixed(1)}%ë¡œ ëª©í‘œ ë‹¬ì„±ì— ê·¼ì ‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.`);
          }
          
          if (insights.length === 0) {
            insights.push(`â€¢ ì „ë°˜ì ì¸ ì„±ê³¼ê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆìœ¼ë©°, ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•´ ëª©í‘œ ë‹¬ì„±ì„ ì¶”ì§„í•˜ê² ìŠµë‹ˆë‹¤.`);
          }
          
          keyPoints = insights.join('<br>');
        }
        
        // ë¨¼ì € ë¡œë”© í‘œì‹œì™€ í•¨ê»˜ ë Œë”ë§
        overviewInsights.innerHTML = `
          <div style="margin-bottom: 20px;">
            <div style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 10px;">ğŸ“‹ ì£¼ìš”ë‚´ìš©</div>
            <div style="margin-left: 10px; color: #78350f; line-height: 1.5;">
              ${content || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
            </div>
          </div>
          <div>
            <div style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 10px;">ğŸ’¡ í•µì‹¬ì¸ì‚¬ì´íŠ¸</div>
            <div id="overview-key-points-content" style="margin-left: 10px; color: #78350f; line-height: 1.5;">
              <div style="color: #94a3b8; font-style: italic;">ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
          </div>
        `;
        
        // APIì—ì„œ ì‹¤ì‹œê°„ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ê°€ì ¸ì™€ì„œ keyPoints ì—…ë°ì´íŠ¸
        fetchRealtimeInsights().then(realtimeKeyPoints => {
          // ê¸°ì¡´ keyPointsì™€ ë³‘í•© (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ê´€ë ¨ í•­ëª©ë§Œ êµì²´)
          const keyPointsLines = keyPoints.split('<br>').filter(line => line.trim());
          const nonRealtimeLines = keyPointsLines.filter(line => 
            !line.includes('íŒë§¤ìœ¨ì´ ê°€ì¥ ë†’ì€') && 
            !line.includes('ì•„ì´í…œ ì¤‘') &&
            !line.includes('í˜„ì¬ê¸°ì¤€')
          );
          
          // ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€, ì—†ìœ¼ë©´ ê¸°ì¡´ ë°ì´í„° ì‚¬ìš©
          let finalKeyPoints;
          if (realtimeKeyPoints && realtimeKeyPoints.length > 0) {
            finalKeyPoints = [...nonRealtimeLines, ...realtimeKeyPoints].join('<br>');
          } else {
            finalKeyPoints = keyPoints;
          }
          
          // DOM ì—…ë°ì´íŠ¸ (í•œ ë²ˆë§Œ)
          const keyPointsElement = document.getElementById('overview-key-points-content');
          if (keyPointsElement) {
            keyPointsElement.innerHTML = finalKeyPoints || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
          }
        }).catch(error => {
          console.error('[fetchRealtimeInsights] ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          // ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ keyPoints í‘œì‹œ
          const keyPointsElement = document.getElementById('overview-key-points-content');
          if (keyPointsElement) {
            keyPointsElement.innerHTML = keyPoints || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
          }
        });
      }else{
        const bi = currentInsightsData[currentBrand] || currentInsightsData.MLB || {};
        const content = bi.content||'';
        let keyPoints = bi.keyPoints||'';
        console.log('ë¸Œëœë“œ ì¸ì‚¬ì´íŠ¸ ë°ì´í„°:', {currentBrand, bi, content, keyPoints});
        
        // ë¡œë”© í‘œì‹œë¥¼ ë¨¼ì € ë Œë”ë§
        brandInsights.innerHTML = `
          <div style="margin-bottom: 20px;">
            <div style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 10px;">ğŸ“‹ ì£¼ìš”ë‚´ìš©</div>
            <div style="margin-left: 10px; color: #78350f; line-height: 1.5;">
              ${content}
            </div>
          </div>
          <div>
            <div style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 10px;">ğŸ’¡ í•µì‹¬ì¸ì‚¬ì´íŠ¸</div>
            <div id="brand-key-points-content" style="margin-left: 10px; color: #78350f; line-height: 1.5;">
              <div style="color: #94a3b8; font-style: italic;">ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
          </div>
        `;
        
        // APIì—ì„œ ì‹¤ì‹œê°„ ë¸Œëœë“œë³„ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ê°€ì ¸ì™€ì„œ keyPoints ì—…ë°ì´íŠ¸
        fetchBrandRealtimeInsights(currentBrand).then(realtimeKeyPoints => {
          // ê¸°ì¡´ keyPointsì™€ ë³‘í•© (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ê´€ë ¨ í•­ëª©ë§Œ êµì²´)
          const keyPointsLines = keyPoints.split('<br>').filter(line => line.trim());
          const nonRealtimeLines = keyPointsLines.filter(line => 
            !line.includes('ëˆ„ì  TAG ë§¤ì¶œ') &&
            !line.includes('ì˜ë¥˜ ëˆ„ì  ë§¤ì¶œ') && 
            !line.includes('ì•„ì´í…œ ëˆ„ì íŒë§¤ë§¤ì¶œ') &&
            !line.includes('í˜„ì¬ê¸°ì¤€')
          );
          
          // ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€, ì—†ìœ¼ë©´ ê¸°ì¡´ ë°ì´í„° ì‚¬ìš©
          let finalKeyPoints;
          if (realtimeKeyPoints && realtimeKeyPoints.length > 0) {
            finalKeyPoints = [...nonRealtimeLines, ...realtimeKeyPoints].join('<br>');
          } else {
            finalKeyPoints = keyPoints;
          }
          
          // DOM ì—…ë°ì´íŠ¸ (í•œ ë²ˆë§Œ)
          const keyPointsElement = document.getElementById('brand-key-points-content');
          if (keyPointsElement) {
            keyPointsElement.innerHTML = finalKeyPoints || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
          }
        }).catch(error => {
          console.error('[fetchBrandRealtimeInsights] ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          // ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ keyPoints í‘œì‹œ
          const keyPointsElement = document.getElementById('brand-key-points-content');
          if (keyPointsElement) {
            keyPointsElement.innerHTML = keyPoints || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
          }
        });
      }
      
      // ë Œë”ë§ í›„ í¸ì§‘ ë‚´ìš© ë‹¤ì‹œ ì ìš©
      setTimeout(() => {
        loadEdits();
      }, 50);
    }

    // -------- ë¸Œëœë“œë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ --------
    function updateBrandCharts() {
      console.log('ë¸Œëœë“œë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸:', currentBrand);
      
      // â˜… Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ â˜…
      if (currentBrand && typeof updateBrandTreemaps === 'function') {
        try { 
          updateBrandTreemaps(currentBrand); 
        } catch(e) { 
          console.error('íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', e); 
        }
      }
      
      // ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ (ì°¨íŠ¸ê°€ ì—†ìœ¼ë©´ ìƒì„±)
      if (!charts.radar) {
        // ë ˆì´ë” ì°¨íŠ¸ê°€ ì—†ìœ¼ë©´ initBrandCharts í˜¸ì¶œ
        try {
          if (typeof initBrandCharts === 'function') {
            initBrandCharts();
            return; // initBrandChartsì—ì„œ ì´ë¯¸ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ ì—¬ê¸°ì„œ ì¢…ë£Œ
          }
        } catch(e) {
          console.error('ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” ì—ëŸ¬:', e);
        }
      }
      
      if (charts.radar) { try {
        const type = window.radarChartType || 'channel';
        const radarData = (type === 'channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand);
        
        // ë””ë²„ê¹…: ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œ ë°ì´í„° í™•ì¸
        if (type === 'channel' && currentBrand === 'MLB') {
          console.log('[ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸] MLB ì±„ë„ ë°ì´í„°:', {
            
            labels: radarData.labels,
            labelsLength: radarData.labels.length,
            plan: radarData.plan,
            yoy: radarData.yoy,
            hasRF: radarData.labels.includes('RF'),
            hasì‚¬ì…: radarData.labels.includes('ì‚¬ì…'),
            hasê¸°íƒ€: radarData.labels.includes('ê¸°íƒ€')
          });
        }
        
        charts.radar.data.labels = radarData.labels;
        charts.radar.data.datasets[0].data = radarData.plan;
        charts.radar.data.datasets[1].data = radarData.yoy;
        // ë¸Œëœë“œë³„ ê³„íš ë°ì´í„°ì…‹ ì¶”ê°€/ì—…ë°ì´íŠ¸
        if (radarData.brandPlan) {
          if (charts.radar.data.datasets.length < 3) {
            charts.radar.data.datasets.push({
              label: 'ë¸Œëœë“œê³„íš',
              data: radarData.brandPlan,
              borderColor: '#F59E0B',
              backgroundColor: 'rgba(245,158,11,0.2)',
              borderWidth: 2,
              pointRadius: 2,
              borderDash: [5, 5]
            });
          } else {
            charts.radar.data.datasets[2].data = radarData.brandPlan;
          }
        } else if (charts.radar.data.datasets.length > 2) {
          // ë¸Œëœë“œë³„ ê³„íš ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì œê±°
          charts.radar.data.datasets.pop();
        }
        
        // onClick ì´ë²¤íŠ¸ ì¬ì„¤ì •
        charts.radar.options.onClick = function(event, elements) {
          try {
            console.log('[ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í›„ í´ë¦­]', {event, elements});
            if (elements && elements.length > 0) {
              const element = elements[0];
              const index = element.index;
              if (index !== undefined && radarData && radarData.labels && radarData.labels[index]) {
                const label = radarData.labels[index];
                if (typeof showRadarChannelToggle === 'function') {
                  showRadarChannelToggle(event, label, currentBrand, type, radarData);
                }
              }
            } else {
              if (typeof hideRadarChannelToggle === 'function') {
                hideRadarChannelToggle();
              }
            }
          } catch (e) {
            console.warn('[ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸ onClick ì—ëŸ¬]', e);
          }
        };
        
        // onHover ì´ë²¤íŠ¸ ì¬ì„¤ì •
        charts.radar.options.onHover = function(event, elements) {
          try {
            if (elements && elements.length > 0) {
              const element = elements[0];
              const index = element.index;
              if (index !== undefined && radarData && radarData.labels && radarData.labels[index]) {
                const label = radarData.labels[index];
                
                // ì»¤ì„œ ë³€ê²½
                if (event && event.native && event.native.target) {
                  event.native.target.style.cursor = 'pointer';
                } else if (event && event.target) {
                  event.target.style.cursor = 'pointer';
                }
                
                // í† ê¸€ í‘œì‹œ (hover)
                if (typeof showRadarChannelToggle === 'function') {
                  showRadarChannelToggle(event, label, currentBrand, type, radarData);
                }
              }
            } else {
              // ì»¤ì„œ ë³€ê²½
              if (event && event.native && event.native.target) {
                event.native.target.style.cursor = 'default';
              } else if (event && event.target) {
                event.target.style.cursor = 'default';
              }
              
              // í† ê¸€ ìˆ¨ê¸°ê¸°
              if (typeof hideRadarChannelToggle === 'function') {
                hideRadarChannelToggle();
              }
            }
          } catch (e) {
            console.warn('[ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸ onHover ì—ëŸ¬]', e);
          }
        };
        
        charts.radar.update();
        
        // canvas hover ì´ë²¤íŠ¸ë„ ì¬ì„¤ì •
        const radarCtx = document.getElementById('radarChart');
        if (radarCtx) {
          // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
          const existingHoverHandler = radarCtx._radarHoverHandler;
          const existingLeaveHandler = radarCtx._radarLeaveHandler;
          if (existingHoverHandler) {
            radarCtx.removeEventListener('mousemove', existingHoverHandler);
          }
          if (existingLeaveHandler) {
            radarCtx.removeEventListener('mouseleave', existingLeaveHandler);
          }
          
          // ìƒˆë¡œìš´ hover í•¸ë“¤ëŸ¬ ìƒì„±
          const hoverHandler = function(e) {
            try {
              if (!charts.radar) return;
              
              const canvasPosition = Chart.helpers.getRelativePosition(e, charts.radar);
              const labels = charts.radar.data.labels;
              if (!labels || !Array.isArray(labels)) return;
              
              let closestIndex = -1;
              let minDistance = Infinity;
              
              // ê° ë°ì´í„° í¬ì¸íŠ¸ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
              labels.forEach((label, index) => {
                try {
                  const meta = charts.radar.getDatasetMeta(0);
                  if (meta && meta.data && meta.data[index]) {
                    const point = meta.data[index];
                    const distance = Math.sqrt(
                      Math.pow(canvasPosition.x - point.x, 2) + 
                      Math.pow(canvasPosition.y - point.y, 2)
                    );
                    if (distance < minDistance && distance < 50) { // 50px ì´ë‚´
                      minDistance = distance;
                      closestIndex = index;
                    }
                  }
                } catch (err) {
                  console.warn('[hoverHandler í¬ì¸íŠ¸ ê³„ì‚° ì—ëŸ¬]', err);
                }
              });
              
              if (closestIndex !== -1 && labels[closestIndex]) {
                const label = labels[closestIndex];
                // í˜„ì¬ radarChartTypeì— ë§ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                const currentType = window.radarChartType || 'channel';
                const currentRadarData = (currentType === 'channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand);
                if (typeof showRadarChannelToggle === 'function') {
                  showRadarChannelToggle(e, label, currentBrand, currentType, currentRadarData);
                }
                if (e && e.target) {
                  e.target.style.cursor = 'pointer';
                }
              } else {
                if (typeof hideRadarChannelToggle === 'function') {
                  hideRadarChannelToggle();
                }
                if (e && e.target) {
                  e.target.style.cursor = 'default';
                }
              }
            } catch (err) {
              console.warn('[hoverHandler ì—ëŸ¬]', err);
            }
          };
          
          const leaveHandler = function(e) {
            try {
              if (typeof hideRadarChannelToggle === 'function') {
                hideRadarChannelToggle();
              }
              if (e && e.target) {
                e.target.style.cursor = 'default';
              }
            } catch (err) {
              console.warn('[leaveHandler ì—ëŸ¬]', err);
            }
          };
          
          // í•¸ë“¤ëŸ¬ë¥¼ canvasì— ì €ì¥ (ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´)
          radarCtx._radarHoverHandler = hoverHandler;
          radarCtx._radarLeaveHandler = leaveHandler;
          radarCtx.addEventListener('mousemove', hoverHandler);
          radarCtx.addEventListener('mouseleave', leaveHandler);
        }
      } catch(e) { console.error('ë ˆì´ë” ì°¨íŠ¸ ì—ëŸ¬:', e); } }
      
      // íˆíŠ¸ë§µ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      try { if (charts.heatmap) updateHeatmapChart(); } catch(e) { console.error('íˆíŠ¸ë§µ ì—ëŸ¬:', e); }
      
      // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë²„íŠ¼ í•¸ë“¤ëŸ¬ì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì¤‘ë³µ ì œê±°)
      // try { if (charts.weeklyTrend || charts.weeklyTrendChart) updateWeeklyTrendChart(); } catch(e) { console.error('ì£¼ì°¨ë³„ ì¶”ì„¸ ì—ëŸ¬:', e); }
      
      // ì£¼ìš” ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë²„íŠ¼ í•¸ë“¤ëŸ¬ì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì¤‘ë³µ ì œê±°)
      // try { updateBrandChannels(); } catch(e) { console.error('ì±„ë„ì†ìµ ì—ëŸ¬:', e); }
      
      // ë¸Œëœë“œë³„ ì•„ì´í…œ íŒë§¤ìœ¨ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë²„íŠ¼ í•¸ë“¤ëŸ¬ì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì¤‘ë³µ ì œê±°)
      // try { if(typeof renderItemDiffTable === 'function') renderItemDiffTable(); } catch(e) { console.error('íŒë§¤ìœ¨ í…Œì´ë¸” ì—ëŸ¬:', e); }
    }

    // -------- ë¸Œëœë“œ ë·° ì—…ë°ì´íŠ¸ --------
    function updateBrandView(){
      try {
      // â˜…â˜…â˜… window.brandDataì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° (ë¡œì»¬ ë³€ìˆ˜ ì‚¬ìš© ì•ˆí•¨) â˜…â˜…â˜…
      // window.brandDataê°€ ì—†ìœ¼ë©´ window.brandKPIì—ì„œ ì§ì ‘ ìƒì„±
      let data = window.brandData?.[currentBrand];
      
      if (!data && window.brandKPI) {
        // brandDataê°€ ì—†ìœ¼ë©´ brandKPIì—ì„œ ì§ì ‘ ìƒì„±
        const brandCodeMap = { 'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X', 'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W' };
        const kpi = window.brandKPI[currentBrand] || window.brandKPI[brandCodeMap[currentBrand]];
        if (kpi) {
          data = {
            current: { 
              revenue: { value: kpi.revenue / 100000000, discountRate: kpi.discountRate || 0 }, 
              profit: { value: kpi.directProfit / 100000000 }, 
              margin: { value: kpi.directProfitRate || 0 }, 
              progress: { value: kpi.progressRate || 0 } 
            },
            revenue: { 
              forecast: kpi.revenueForecast / 100000000, 
              discountRate: kpi.discountRateForecast || kpi.discountRate || 0,
              achievement: kpi.progressRateForecast || kpi.progressRate || 0,
              vsPlan: kpi.revenueVsPlan || 0,
              vsPrevious: kpi.revenueVsPrevious || 0
            }, 
            profit: { 
              forecast: kpi.directProfitForecast / 100000000,
              marginForecast: kpi.directProfitRateForecast || kpi.directProfitRate || 0,
              achievement: kpi.progressRateForecast || kpi.progressRate || 0,
              vsPlan: kpi.profitVsPlan || 0,
              vsPrevious: kpi.profitVsPrevious || 0
            }, 
            opProfit: {
              current: (kpi.operatingProfit || 0) / 100000000,
              forecast: (kpi.operatingProfitForecast || 0) / 100000000,
              rate: kpi.operatingProfitRate || 0,
              rateForecast: kpi.operatingProfitRateForecast || 0,
              // â˜… JSON ë°ì´í„° ê¸°ë°˜ ê³„ì‚°: ì˜ì—…ì´ìµ ëª©í‘œëŒ€ë¹„ëŠ” ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„ ì‚¬ìš© (JSONì— operatingProfitVsPlan ì—†ìŒ)
              vsPlan: kpi.profitVsPlan || 0,
              // â˜… JSON ë°ì´í„° ê¸°ë°˜ ê³„ì‚°: ì˜ì—…ì´ìµ ì „ë…„ëŒ€ë¹„ = (ì›”ë§ì˜ˆìƒ - ì „ë…„) / ì „ë…„ * 100
              vsPrevious: kpi.operatingProfitPrevious ? ((kpi.operatingProfitForecast || 0) - (kpi.operatingProfitPrevious || 0)) / Math.abs(kpi.operatingProfitPrevious) * 100 : 0
            }
          };
          // window.brandDataì—ë„ ì €ì¥ (ë‹¤ìŒ í˜¸ì¶œ ì‹œ ì¬ì‚¬ìš©)
          if (!window.brandData) window.brandData = {};
          window.brandData[currentBrand] = data;
          console.log('[updateBrandView] brandKPIì—ì„œ ë°ì´í„° ìƒì„±:', currentBrand, data.current.revenue.value.toFixed(1), 'ì–µì›');
        }
      }
      
      console.log('updateBrandView í˜¸ì¶œ:', {currentBrand, hasData: !!data, revenue: data?.current?.revenue?.value});
      if(!data) {
        console.warn('[updateBrandView] ë°ì´í„° ì—†ìŒ! currentBrand:', currentBrand, 'brandKPI:', !!window.brandKPI);
        return;
      }

      // ì§ì ‘ DOM ì—…ë°ì´íŠ¸ (localStorage ë¬´ì‹œ) - ì•ˆì „í•œ ìˆ«ì ì²˜ë¦¬
      const safeNumber = (val) => {
        const num = parseFloat(val);
        return isNaN(num) ? 0 : num;
      };
      const setTextDirect = (id, text) => {
        try {
          const el = document.getElementById(id);
          if(el) el.textContent = text;
        } catch(e) { console.warn('setTextDirect ì—ëŸ¬:', id, e); }
      };
      // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ (ì†Œìˆ˜ì  ê³ ë ¤)
      const formatWithComma = (num) => {
        const formatted = num.toFixed(1);
        const parts = formatted.split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return parts.join('.');
      };
      const setDeltaDirect = (id, val, isPctPt=false) => {
        try {
          const el = document.getElementById(id);
          if(!el) return;
          const numVal = safeNumber(val);
          // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨ë¡œ í‘œì‹œ, ì˜ˆ: 98.5%)
          el.textContent = `ëª©í‘œëŒ€ë¹„ ${numVal.toFixed(1)}${isPctPt?'%p':'%'}`;
          el.className = 'kpi-change-line editable ' + (numVal>=100?'kpi-positive':'kpi-negative');
        } catch(e) { console.warn('setDeltaDirect ì—ëŸ¬:', id, e); }
      };
      const setYoYDirect = (id, val, isPctPt=false) => {
        try {
          const el = document.getElementById(id);
          if(!el) return;
          const numVal = safeNumber(val);
          // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨ë¡œ í‘œì‹œ, ì˜ˆ: 100.4%)
          el.textContent = `ì „ë…„ëŒ€ë¹„ ${numVal.toFixed(1)}${isPctPt?'%p':'%'}`;
          el.className = 'kpi-change editable ' + (numVal>=100?'kpi-positive':numVal===100?'kpi-neutral':'kpi-negative');
        } catch(e) { console.warn('setYoYDirect ì—ëŸ¬:', id, e); }
      };

      // ì‹¤íŒë§¤ì¶œ(í• ì¸ìœ¨) í†µí•© KPI (í˜„ì‹œì  + ì›”ë§ì˜ˆìƒ) - ì•ˆì „í•œ ì ‘ê·¼
      const revenueCurrent = parseFloat(data?.current?.revenue?.value) || 0;
      const revenueForecast = parseFloat(data?.revenue?.forecast) || 0;
      setTextDirect('brand-current-revenue', `${formatWithComma(revenueCurrent)}ì–µì›`);
      setTextDirect('brand-revenue', `${formatWithComma(revenueForecast)}ì–µì›`);
      // í• ì¸ìœ¨ ê³„ì‚° (ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ ê³„ì‚°)
      const discountRateCurrent = data?.current?.revenue?.discountRate || 0;
      const discountRateForecast = data?.revenue?.discountRate || 0;
      setTextDirect('brand-current-discount-rate', `(${discountRateCurrent.toFixed(1)}%)`);
      setTextDirect('brand-discount-rate', `(${discountRateForecast.toFixed(1)}%)`);
      // í• ì¸ìœ¨ íŒŒë€ìƒ‰ ìŠ¤íƒ€ì¼ ì ìš©
      const discountRateCurrentEl = document.getElementById('brand-current-discount-rate');
      const discountRateEl = document.getElementById('brand-discount-rate');
      if (discountRateCurrentEl) {
        discountRateCurrentEl.style.color = '#8b5cf6';
        discountRateCurrentEl.style.fontWeight = '600';
      }
      if (discountRateEl) {
        discountRateEl.style.color = '#8b5cf6';
        discountRateEl.style.fontWeight = '600';
      }
      // â˜…â˜…â˜… ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - brand_kpi.jsonì˜ revenueVsPlan, revenueVsPrevious ì§ì ‘ ì‚¬ìš© â˜…â˜…â˜…
      // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
      const revenueVsPlanDiff = data?.revenue?.vsPlan ?? 0;      // brand_kpi.jsonì˜ revenueVsPlan (ì°¨ì´%)
      const revenueVsPreviousDiff = data?.revenue?.vsPrevious ?? 0; // brand_kpi.jsonì˜ revenueVsPrevious (ì°¨ì´%)
      const revenueVsPlan = 100 + revenueVsPlanDiff;      // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
      const revenueVsPrevious = 100 + revenueVsPreviousDiff; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
      const revenueAchievement = data?.revenue?.achievement || 0; // ì§„ì²™ìœ¨ë°”ìš©
      setDeltaDirect('brand-revenue-change', revenueVsPlan);
      setYoYDirect('brand-revenue-yoy', revenueVsPrevious);
      // ì§„ì²™ìœ¨ë°” ì—…ë°ì´íŠ¸
      const revenueProgressBar = document.getElementById('brand-revenue-progress');
      if (revenueProgressBar) {
        revenueProgressBar.style.width = `${Math.min(revenueAchievement, 100)}%`;
      }

      // ì§ì ‘ì´ìµ(ì´ìµìœ¨) í†µí•© KPI (í˜„ì‹œì  + ì›”ë§ì˜ˆìƒ) - ì•ˆì „í•œ ì ‘ê·¼
      const profitCurrent = parseFloat(data?.current?.profit?.value) || 0;
      const profitForecastValue = parseFloat(data?.profit?.forecast) || 0;
      setTextDirect('brand-current-profit', `${formatWithComma(profitCurrent)}ì–µì›`);
      setTextDirect('brand-profit', `${formatWithComma(profitForecastValue)}ì–µì›`);
      // ì§ì ‘ì´ìµìœ¨ ê³„ì‚°
      const profitMarginRateCurrent = data?.current?.margin?.value || 0;
      const profitMarginRateForecast = data?.profit?.marginForecast || data?.current?.margin?.value || 0;
      setTextDirect('brand-current-profit-margin-rate', `(${profitMarginRateCurrent.toFixed(1)}%)`);
      setTextDirect('brand-profit-margin-rate', `(${profitMarginRateForecast.toFixed(1)}%)`);
      // ì´ìµìœ¨ íŒŒë€ìƒ‰ ìŠ¤íƒ€ì¼ ì ìš©
      const profitMarginRateCurrentEl = document.getElementById('brand-current-profit-margin-rate');
      const profitMarginRateEl = document.getElementById('brand-profit-margin-rate');
      if (profitMarginRateCurrentEl) {
        profitMarginRateCurrentEl.style.color = '#8b5cf6';
        profitMarginRateCurrentEl.style.fontWeight = '600';
      }
      if (profitMarginRateEl) {
        profitMarginRateEl.style.color = '#8b5cf6';
        profitMarginRateEl.style.fontWeight = '600';
      }
      // â˜…â˜…â˜… ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - brand_kpi.jsonì˜ profitVsPlan, profitVsPrevious ì§ì ‘ ì‚¬ìš© â˜…â˜…â˜…
      // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
      const profitVsPlanDiff = data?.profit?.vsPlan ?? 0;       // brand_kpi.jsonì˜ profitVsPlan (ì°¨ì´%)
      const profitVsPreviousDiff = data?.profit?.vsPrevious ?? 0; // brand_kpi.jsonì˜ profitVsPrevious (ì°¨ì´%)
      const profitVsPlan = 100 + profitVsPlanDiff;       // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
      const profitVsPrevious = 100 + profitVsPreviousDiff; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
      setDeltaDirect('brand-profit-change', profitVsPlan);
      setYoYDirect('brand-profit-yoy', profitVsPrevious);
      // ì§„ì²™ìœ¨ë°” ì—…ë°ì´íŠ¸
      const profitProgressBar = document.getElementById('brand-profit-progress');
      if (profitProgressBar) {
        profitProgressBar.style.width = `${Math.min(data?.profit?.achievement || 0, 100)}%`;
      }

      // â˜… ì˜ì—…ì´ìµ(ì´ìµìœ¨) í†µí•© KPI (í˜„ì‹œì  + ì›”ë§ì˜ˆìƒ) - brand_kpi.jsonì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° â˜…
      // â˜…â˜…â˜… window.brandKPIì—ì„œ ì§ì ‘ ê°€ì ¸ì™€ì„œ í•˜ë“œì½”ë”© ë° window.brandData ì™„ì „ ì œê±° â˜…â˜…â˜…
      let opProfitCurrentValue = 0;
      let opProfitForecastValue = 0;
      let opProfitMarginRateCurrent = 0;
      let opProfitMarginRateForecast = 0;
      
      // â˜…â˜…â˜… ë°˜ë“œì‹œ brandKPIì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° (window.brandData ë¬´ì‹œ) â˜…â˜…â˜…
      if (!window.brandKPI) {
        console.warn('[ì˜ì—…ì´ìµ] window.brandKPIê°€ ì—†ìŠµë‹ˆë‹¤!');
      } else {
        const brandCode = brandCodeMap[currentBrand] || 'M';
        const kpi = window.brandKPI[brandCode] || window.brandKPI[currentBrand];
        if (!kpi) {
          console.warn('[ì˜ì—…ì´ìµ] KPI ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', {currentBrand, brandCode, availableKeys: Object.keys(window.brandKPI)});
        } else {
          // â˜… JSONì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° (í•˜ë“œì½”ë”© ì—†ìŒ, window.brandData ë¬´ì‹œ) â˜…
          opProfitCurrentValue = (kpi.operatingProfit || 0) / 100000000;
          opProfitForecastValue = (kpi.operatingProfitForecast || 0) / 100000000;
          opProfitMarginRateCurrent = kpi.operatingProfitRate || 0;
          opProfitMarginRateForecast = kpi.operatingProfitRateForecast || 0;
          
          console.log('[ì˜ì—…ì´ìµ] JSONì—ì„œ ì§ì ‘ ë¡œë“œ:', {
            currentBrand,
            brandCode,
            opProfitCurrentValue,
            opProfitForecastValue,
            opProfitMarginRateCurrent,
            opProfitMarginRateForecast
          });
        }
      }
      
      // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ë¡œ ê°•ì œ ë³€í™˜
      opProfitCurrentValue = Math.round(opProfitCurrentValue * 10) / 10;
      opProfitForecastValue = Math.round(opProfitForecastValue * 10) / 10;
      
      // ë°˜ë“œì‹œ ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ë¡œ í‘œì‹œ (ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€)
      setTextDirect('brand-current-opprofit', `${formatWithComma(opProfitCurrentValue)}ì–µì›`);
      setTextDirect('brand-opprofit', `${formatWithComma(opProfitForecastValue)}ì–µì›`);
      setTextDirect('brand-current-opprofit-margin-rate', `(${opProfitMarginRateCurrent.toFixed(1)}%)`);
      setTextDirect('brand-opprofit-margin-rate', `(${opProfitMarginRateForecast.toFixed(1)}%)`);
      
      // ì˜ì—…ì´ìµ ì´ìµìœ¨ íŒŒë€ìƒ‰ ìŠ¤íƒ€ì¼ ì ìš©
      const opprofitMarginRateCurrentEl = document.getElementById('brand-current-opprofit-margin-rate');
      const opprofitMarginRateEl = document.getElementById('brand-opprofit-margin-rate');
      if (opprofitMarginRateCurrentEl) {
        opprofitMarginRateCurrentEl.style.color = '#8b5cf6';
        opprofitMarginRateCurrentEl.style.fontWeight = '600';
      }
      if (opprofitMarginRateEl) {
        opprofitMarginRateEl.style.color = '#8b5cf6';
        opprofitMarginRateEl.style.fontWeight = '600';
      }
      
      // â˜…â˜…â˜… ì˜ì—…ì´ìµ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ - brand_kpi.jsonì—ì„œ ì§ì ‘ ê³„ì‚° (window.brandData ë¬´ì‹œ) â˜…â˜…â˜…
      // ì†ìµê³„ì‚°ì„œì™€ ë™ì¼í•œ ì¡°ê±´ë¶€ í‘œì‹œ ë¡œì§ ì ìš©
      const formatOperatingProfitYoy = (forecast, prev) => {
        if (!prev || prev === 0) {
          return '-';
        }
        if (prev > 0 && forecast < 0) {
          return 'ì ìì „í™˜';
        }
        if (prev < 0 && forecast > 0) {
          return 'í‘ìì „í™˜';
        }
        if (prev < 0 && forecast < 0) {
          // ì „ë…„ ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
          return forecast > prev ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
        }
        // ì „ë…„ ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
        return Math.round((forecast / prev) * 100) + '%';
      };
      
      const formatOperatingProfitAchievement = (forecast, target, fallbackVsPlan = null) => {
        // targetì´ ì—†ê±°ë‚˜ 0ì´ë©´ fallback ì‚¬ìš© (ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„)
        if (!target || target === 0) {
          if (fallbackVsPlan !== null) {
            // fallbackì´ ìˆìœ¼ë©´ ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„ ì‚¬ìš©
            return fallbackVsPlan >= 100 ? `${fallbackVsPlan.toFixed(1)}%` : `${fallbackVsPlan.toFixed(1)}%`;
          }
          return '-';
        }
        if (target > 0 && forecast < 0) {
          return 'ì ì';
        }
        if (target < 0 && forecast > 0) {
          return 'í‘ì';
        }
        if (target < 0 && forecast < 0) {
          // ê³„íš ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
          return forecast > target ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
        }
        // ê³„íš ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
        return Math.round((forecast / target) * 100) + '%';
      };
      
      let opProfitVsPlan = 0;
      let opProfitVsPrevious = 0;
      let opProfitVsPlanText = '-';
      let opProfitVsPreviousText = '-';
      
      // â˜…â˜…â˜… ë°˜ë“œì‹œ brandKPIì—ì„œ ì§ì ‘ ê³„ì‚° (í•˜ë“œì½”ë”© ì—†ìŒ, window.brandData ë¬´ì‹œ) â˜…â˜…â˜…
      if (window.brandKPI) {
        const brandCode = brandCodeMap[currentBrand] || 'M';
        const kpi = window.brandKPI[brandCode] || window.brandKPI[currentBrand];
        if (kpi) {
          // ì˜ì—…ì´ìµ ê°’ (ì› ë‹¨ìœ„ -> ì–µì› ë‹¨ìœ„)
          const opProfitForecast = (kpi.operatingProfitForecast || 0) / 100000000;
          const opProfitPrevious = (kpi.operatingProfitPrevious || 0) / 100000000;
          const opProfitPlan = (kpi.operatingProfitPlan || 0) / 100000000;
          
          // ëª©í‘œëŒ€ë¹„: ì¡°ê±´ë¶€ í‘œì‹œ
          opProfitVsPlanText = formatOperatingProfitAchievement(opProfitForecast, opProfitPlan);
          
          // ì „ë…„ëŒ€ë¹„: ì¡°ê±´ë¶€ í‘œì‹œ
          opProfitVsPreviousText = formatOperatingProfitYoy(opProfitForecast, opProfitPrevious);
          
          // ìˆ«ì ê°’ë„ ê³„ì‚° (ì¼ë°˜ í¼ì„¼íŠ¸ì¸ ê²½ìš°)
          if (opProfitVsPlanText !== '-' && opProfitVsPlanText !== 'ì ì' && opProfitVsPlanText !== 'í‘ì' && !opProfitVsPlanText.includes('ì ì')) {
            // ì˜ì—…ì´ìµ ê³„íšì´ ìˆìœ¼ë©´ ì§ì ‘ ê³„ì‚°
            if (opProfitPlan > 0 && opProfitForecast !== 0) {
              opProfitVsPlan = (opProfitForecast / opProfitPlan) * 100;
            }
          }
          if (opProfitVsPreviousText !== '-' && opProfitVsPreviousText !== 'ì ìì „í™˜' && opProfitVsPreviousText !== 'í‘ìì „í™˜' && !opProfitVsPreviousText.includes('ì ì')) {
            if (kpi.operatingProfitPrevious && kpi.operatingProfitPrevious !== 0) {
              opProfitVsPrevious = ((kpi.operatingProfitForecast || 0) / Math.abs(kpi.operatingProfitPrevious)) * 100;
            }
          }
          
          console.log('[ì˜ì—…ì´ìµ ëŒ€ë¹„ê°’] JSONì—ì„œ ì§ì ‘ ê³„ì‚°:', {
            currentBrand,
            brandCode,
            opProfitForecast,
            opProfitPrevious,
            opProfitPlan,
            opProfitVsPlanText,
            opProfitVsPreviousText
          });
        }
      }
      
      // ëª©í‘œëŒ€ë¹„ í‘œì‹œ
      const opprofitChangeEl = document.getElementById('brand-opprofit-change');
      if (opprofitChangeEl) {
        if (opProfitVsPlanText === '-' || opProfitVsPlanText === 'ì ì' || opProfitVsPlanText === 'í‘ì' || opProfitVsPlanText.includes('ì ì')) {
          opprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${opProfitVsPlanText}`;
          opprofitChangeEl.className = 'kpi-change-line editable ' + (opProfitVsPlanText.includes('í‘ì') || opProfitVsPlanText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
        } else {
          opprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${opProfitVsPlan.toFixed(1)}%`;
          opprofitChangeEl.className = 'kpi-change-line editable ' + (opProfitVsPlan >= 100 ? 'kpi-positive' : 'kpi-negative');
        }
      }
      
      // ì „ë…„ëŒ€ë¹„ í‘œì‹œ
      const opprofitYoyEl = document.getElementById('brand-opprofit-yoy');
      if (opprofitYoyEl) {
        if (opProfitVsPreviousText === '-' || opProfitVsPreviousText === 'ì ìì „í™˜' || opProfitVsPreviousText === 'í‘ìì „í™˜' || opProfitVsPreviousText.includes('ì ì')) {
          opprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${opProfitVsPreviousText}`;
          opprofitYoyEl.className = 'kpi-change editable ' + (opProfitVsPreviousText.includes('í‘ì') || opProfitVsPreviousText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
        } else {
          opprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${opProfitVsPrevious.toFixed(1)}%`;
          opprofitYoyEl.className = 'kpi-change editable ' + (opProfitVsPrevious >= 100 ? 'kpi-positive' : opProfitVsPrevious === 100 ? 'kpi-neutral' : 'kpi-negative');
        }
      }
      // ì§„ì²™ìœ¨ë°” (ì§ì ‘ì´ìµ ì§„ì²™ìœ¨ ì‚¬ìš©)
      const opprofitProgressBar = document.getElementById('brand-opprofit-progress');
      if (opprofitProgressBar) {
        const opProfitAchievement = data?.profit?.achievement || 0;
        opprofitProgressBar.style.width = `${Math.min(opProfitAchievement, 100)}%`;
      }
      
      // â˜…â˜…â˜… localStorage ë®ì–´ì“°ê¸° ë°©ì§€: updateBrandView ì´í›„ì— ë‹¤ì‹œ í•œ ë²ˆ ê°•ì œ ì—…ë°ì´íŠ¸ â˜…â˜…â˜…
      // loadEdits()ê°€ localStorageì—ì„œ ê°’ì„ ë¶ˆëŸ¬ì™€ ë®ì–´ì“¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì•½ê°„ì˜ ì§€ì—° í›„ ë‹¤ì‹œ ì„¤ì •
      setTimeout(() => {
        if (window.brandKPI) {
          const brandCode = brandCodeMap[currentBrand] || 'M';
          const kpi = window.brandKPI[brandCode] || window.brandKPI[currentBrand];
          if (kpi) {
            const forcedOpProfitForecast = (kpi.operatingProfitForecast || 0) / 100000000;
            const forcedOpProfitCurrent = (kpi.operatingProfit || 0) / 100000000;
            const forcedOpProfitRateForecast = kpi.operatingProfitRateForecast || 0;
            const forcedOpProfitRateCurrent = kpi.operatingProfitRate || 0;
            
            setTextDirect('brand-opprofit', `${formatWithComma(forcedOpProfitForecast)}ì–µì›`);
            setTextDirect('brand-current-opprofit', `${formatWithComma(forcedOpProfitCurrent)}ì–µì›`);
            setTextDirect('brand-opprofit-margin-rate', `(${forcedOpProfitRateForecast.toFixed(1)}%)`);
            setTextDirect('brand-current-opprofit-margin-rate', `(${forcedOpProfitRateCurrent.toFixed(1)}%)`);
            
            // ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ë„ ë‹¤ì‹œ ì„¤ì • (ì¡°ê±´ë¶€ í‘œì‹œ ë¡œì§ ì ìš©)
            const forcedOpProfitForecast2 = (kpi.operatingProfitForecast || 0) / 100000000;
            const forcedOpProfitPrevious2 = (kpi.operatingProfitPrevious || 0) / 100000000;
            const forcedOpProfitPlan2 = (kpi.operatingProfitPlan || 0) / 100000000;
            
            const forcedVsPlanText = formatOperatingProfitAchievement(forcedOpProfitForecast2, forcedOpProfitPlan2);
            const forcedVsPreviousText = formatOperatingProfitYoy(forcedOpProfitForecast2, forcedOpProfitPrevious2);
            
            const forcedOpprofitChangeEl = document.getElementById('brand-opprofit-change');
            if (forcedOpprofitChangeEl) {
              if (forcedVsPlanText === '-' || forcedVsPlanText === 'ì ì' || forcedVsPlanText === 'í‘ì' || forcedVsPlanText.includes('ì ì')) {
                forcedOpprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${forcedVsPlanText}`;
                forcedOpprofitChangeEl.className = 'kpi-change-line editable ' + (forcedVsPlanText.includes('í‘ì') || forcedVsPlanText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
              } else {
                // ì˜ì—…ì´ìµ ê³„íšì´ ìˆìœ¼ë©´ ì§ì ‘ ê³„ì‚°
                if (forcedOpProfitPlan2 > 0 && forcedOpProfitForecast2 !== 0) {
                  const forcedVsPlan = (forcedOpProfitForecast2 / forcedOpProfitPlan2) * 100;
                  forcedOpprofitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${forcedVsPlan.toFixed(1)}%`;
                  forcedOpprofitChangeEl.className = 'kpi-change-line editable ' + (forcedVsPlan >= 100 ? 'kpi-positive' : 'kpi-negative');
                }
              }
            }
            
            const forcedOpprofitYoyEl = document.getElementById('brand-opprofit-yoy');
            if (forcedOpprofitYoyEl) {
              if (forcedVsPreviousText === '-' || forcedVsPreviousText === 'ì ìì „í™˜' || forcedVsPreviousText === 'í‘ìì „í™˜' || forcedVsPreviousText.includes('ì ì')) {
                forcedOpprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${forcedVsPreviousText}`;
                forcedOpprofitYoyEl.className = 'kpi-change editable ' + (forcedVsPreviousText.includes('í‘ì') || forcedVsPreviousText.includes('ê°œì„ ') ? 'kpi-positive' : 'kpi-negative');
              } else {
                let forcedVsPrevious = 0;
                if (kpi.operatingProfitPrevious && kpi.operatingProfitPrevious !== 0) {
                  forcedVsPrevious = ((kpi.operatingProfitForecast || 0) / Math.abs(kpi.operatingProfitPrevious)) * 100;
                }
                forcedOpprofitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${forcedVsPrevious.toFixed(1)}%`;
                forcedOpprofitYoyEl.className = 'kpi-change editable ' + (forcedVsPrevious >= 100 ? 'kpi-positive' : forcedVsPrevious === 100 ? 'kpi-neutral' : 'kpi-negative');
              }
            }
            
            console.log('[ì˜ì—…ì´ìµ] localStorage ë®ì–´ì“°ê¸° ë°©ì§€ - ê°•ì œ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
              forcedOpProfitForecast,
              forcedOpProfitCurrent
            });
          }
        }
      }, 100);

      // â˜… ì§„ì²™ìœ¨ í†µí•© KPI (í˜„ì‹œì  + ì›”ë§ì˜ˆìƒ) - ì§ì ‘ì´ìµ ê¸°ì¤€ â˜…
      const progressCurrentValue = data?.current?.progress?.value || 0;
      setTextDirect('brand-current-progress', `${progressCurrentValue.toFixed(1)}%`);
      // ì›”ë§ì˜ˆìƒ ì§„ì²™ìœ¨ (progressRateForecast ì‚¬ìš©)
      const progressForecastValue = data?.profit?.achievement || data?.revenue?.achievement || 0;
      setTextDirect('brand-progress', `${progressForecastValue.toFixed(1)}%`);
      // ì§„ì²™ìœ¨ ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ ê³„ì‚° (ë‹¤ë¥¸ KPI ì¹´ë“œì™€ ë™ì¼í•œ ìœ„ì¹˜ì— í‘œì‹œ)
      // ëª©í‘œëŒ€ë¹„: progressForecastValueê°€ ì´ë¯¸ ì§„ì²™ìœ¨(%)ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš© (100% ê¸°ì¤€)
      const progressVsPlan = progressForecastValue; // ì§„ì²™ìœ¨ ìì²´ê°€ ëª©í‘œ ëŒ€ë¹„ ê°’
      // ì „ë…„ëŒ€ë¹„: ì§ì ‘ì´ìµì˜ ì „ë…„ëŒ€ë¹„ ì‚¬ìš© (ì§„ì²™ìœ¨ì€ ì§ì ‘ì´ìµ ê¸°ì¤€ì´ë¯€ë¡œ)
      const progressVsPreviousDiff = data?.profit?.vsPrevious ?? 0;
      const progressVsPrevious = 100 + progressVsPreviousDiff; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
      // ëª©í‘œ ëŒ€ë¹„ì™€ ì „ë…„ëŒ€ë¹„ ìˆ¨ê¹€ ì²˜ë¦¬ (ìë¦¬ëŠ” ê³µë°±ìœ¼ë¡œ ìœ ì§€ - ìµœì†Œ ë†’ì´ ë³´ì¥)
      const progressChangeEl = document.getElementById('brand-progress-change');
      const progressYoyEl = document.getElementById('brand-progress-yoy');
      if (progressChangeEl) {
        progressChangeEl.textContent = '\u00A0'; // non-breaking space
        progressChangeEl.style.minHeight = '20px'; // ìµœì†Œ ë†’ì´ ë³´ì¥
        progressChangeEl.style.display = 'block'; // ë¸”ë¡ ìš”ì†Œë¡œ í™•ì‹¤íˆ í‘œì‹œ
      }
      if (progressYoyEl) {
        progressYoyEl.textContent = '\u00A0'; // non-breaking space
        progressYoyEl.style.minHeight = '20px'; // ìµœì†Œ ë†’ì´ ë³´ì¥
        progressYoyEl.style.display = 'block'; // ë¸”ë¡ ìš”ì†Œë¡œ í™•ì‹¤íˆ í‘œì‹œ
      }
      // ì§„ì²™ìœ¨ë°” ì—…ë°ì´íŠ¸
      const progressProgressBar = document.getElementById('brand-progress-progress');
      if (progressProgressBar) {
        progressProgressBar.style.width = `${Math.min(progressForecastValue, 100)}%`;
      }

      // ë¸Œëœë“œë³„ ì†ìµê³„ì‚°ì„œ ì—…ë°ì´íŠ¸
      updateBrandPL();
      
      // RF ì±„ë„ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ (MLB ë¸Œëœë“œë§Œ í‘œì‹œ)
      const rfBtn = document.getElementById('weeklyChannelFilterRF');
      if (rfBtn) {
        rfBtn.style.display = (currentBrand === 'MLB') ? 'block' : 'none';
      }

      // ë¸Œëœë“œë³„ ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      if (typeof updateWeeklyTrendChart === 'function') {
        updateWeeklyTrendChart();
      }

      // ë¸Œëœë“œë³„ íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ
      if (typeof renderSalesRateTable === 'function') {
        // ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ í…Œì´ë¸”ë§Œ ë Œë”ë§ (ìºì‹œ í™œìš©)
        if (window.salesRateData) {
          console.log('[íŒë§¤ìœ¨] ìºì‹œëœ ë°ì´í„° ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” ë Œë”ë§');
          renderSalesRateTable();
        } else if (typeof loadSalesRateData === 'function') {
          // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìµœì´ˆ ë¡œë“œ
          console.log('[íŒë§¤ìœ¨] ìµœì´ˆ ë°ì´í„° ë¡œë“œ');
        loadSalesRateData();
        }
      }

      setTimeout(()=>{ initBrandCharts(); initRadarToggle(); },100);
      } catch(e) {
        console.error('[updateBrandView] ì—ëŸ¬ ë°œìƒ:', e);
      }
    }

    // ë¸Œëœë“œë³„ ì†ìµê³„ì‚°ì„œ ì—…ë°ì´íŠ¸
    function updateBrandPL() {
      // data.js ë¡œë“œ í›„ ì—…ë°ì´íŠ¸ëœ brandPLData ì‚¬ìš© (window.brandPLData ìš°ì„ )
      const currentBrandPLData = window.brandPLData || brandPLData;
      
      console.log('[updateBrandPL] currentBrand:', currentBrand);
      console.log('[updateBrandPL] window.brandPLData:', !!window.brandPLData);
      console.log('[updateBrandPL] window.brandPLData:', !!window.brandPLData);
      console.log('[updateBrandPL] brandPLData keys:', Object.keys(currentBrandPLData));
      
      const plData = currentBrandPLData[currentBrand];
      console.log('[updateBrandPL] plData:', plData);
      
      if (!plData) {
        console.warn('[updateBrandPL] plDataê°€ ì—†ìŠµë‹ˆë‹¤! currentBrand:', currentBrand);
        return;
      }

      // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[currentBrand] || 'M';
      
      // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ (ì–µì› ë‹¨ìœ„, ì†Œìˆ˜ì  í•œ ìë¦¬, ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€)
      const formatNumber = (num) => {
        if (num === null || num === undefined || isNaN(num)) return '0.0';
        const ì–µì› = num / 100000000;
        const formatted = ì–µì›.toFixed(1);
        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
        return formatted.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      };
      
      // í¼ì„¼íŠ¸ ê³„ì‚° í•¨ìˆ˜ (0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€)
      const calcPercent = (forecast, prev, isAchievement = false) => {
        if (!prev || prev === 0) {
          return isAchievement ? 0 : '#DIV/0!';
        }
        return Math.round((forecast / prev) * 100);
      };

      // ì†ìµê³„ì‚°ì„œ ì œëª© ì—…ë°ì´íŠ¸
      const plTitle = document.querySelector('#brand-pl h3');
      if (plTitle) {
        plTitle.textContent = `ğŸ“Š ${currentBrand} ì†ìµê³„ì‚°ì„œ`;
      }

      // ì†ìµê³„ì‚°ì„œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      const tableBody = document.querySelector('#brand-pl .pl-table tbody');
      if (tableBody) {
        // TAGë§¤ì¶œ ë°ì´í„° (brandPLDataì—ì„œ ê°€ì ¸ì˜¤ê¸°, ì› ë‹¨ìœ„)
        const tagRevenuePrev_ì› = (plData.tagRevenue?.prev || 0) * 100000000;
        const tagRevenueTarget_ì› = (plData.tagRevenue?.target || 0) * 100000000;
        const tagRevenueForecast_ì› = (plData.tagRevenue?.forecast || 0) * 100000000;
        
        // ì‹¤íŒë§¤ì¶œ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const revenuePrev_ì› = plData.revenue.prev * 100000000;
        const revenueTarget_ì› = plData.revenue.target * 100000000;
        const revenueForecast_ì› = plData.revenue.forecast * 100000000;
        
        // í• ì¸ìœ¨ (brandPLDataì—ì„œ ê°€ì ¸ì˜¤ê¸°)
        const discountRatePrev = plData.discountRate?.prev || 0;
        const discountRateTarget = plData.discountRate?.target || 0;
        const discountRateForecast = plData.discountRate?.forecast || 0;
        
        // ë§¤ì¶œì›ê°€ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const cogPrev_ì› = plData.cog.prev * 100000000;
        const cogTarget_ì› = plData.cog.target * 100000000;
        const cogForecast_ì› = plData.cog.forecast * 100000000;
        
        // ë§¤ì¶œì´ì´ìµ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const grossProfitPrev_ì› = plData.grossProfit.prev * 100000000;
        const grossProfitTarget_ì› = plData.grossProfit.target * 100000000;
        const grossProfitForecast_ì› = plData.grossProfit.forecast * 100000000;
        
        // ì§ì ‘ë¹„ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const directCostPrev_ì› = plData.directCost.prev * 100000000;
        const directCostTarget_ì› = plData.directCost.target * 100000000;
        const directCostForecast_ì› = plData.directCost.forecast * 100000000;
        
        // ì§ì ‘ë¹„ ì„¸ë¶€ í•­ëª© (brandPLDataì—ì„œ ê°€ì ¸ì˜¤ê¸°, ì› ë‹¨ìœ„)
        const getDirectCostDetail = (name) => {
          const detail = plData.directCostDetail?.[name] || {};
          return {
            prev: (detail.prev || 0) * 100000000,
            target: (detail.target || 0) * 100000000,
            forecast: (detail.forecast || 0) * 100000000,
            yoy: detail.yoy || 0,
            achievement: detail.achievement || 0
          };
        };
        
        const ì¸ê±´ë¹„ = getDirectCostDetail('ì¸ê±´ë¹„');
        const ì„ì°¨ê´€ë¦¬ë¹„ = getDirectCostDetail('ì„ì°¨ê´€ë¦¬ë¹„');
        const ë¬¼ë¥˜ìš´ì†¡ë¹„ = getDirectCostDetail('ë¬¼ë¥˜ìš´ì†¡ë¹„');
        const ë¡œì—´í‹° = getDirectCostDetail('ë¡œì—´í‹°');
        const ê°ê°€ìƒê°ë¹„ = getDirectCostDetail('ê°ê°€ìƒê°ë¹„');
        const ê¸°íƒ€ = getDirectCostDetail('ê¸°íƒ€');
        
        // ì§ì ‘ì´ìµ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const directProfitPrev_ì› = plData.directProfit.prev * 100000000;
        const directProfitTarget_ì› = plData.directProfit.target * 100000000;
        const directProfitForecast_ì› = plData.directProfit.forecast * 100000000;
        
        // ì˜ì—…ë¹„ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const operatingExpensePrev_ì› = (plData.operatingExpense?.prev || 0) * 100000000;
        const operatingExpenseTarget_ì› = (plData.operatingExpense?.target || 0) * 100000000;
        const operatingExpenseForecast_ì› = (plData.operatingExpense?.forecast || 0) * 100000000;
        
        // ì˜ì—…ì´ìµ (ì–µì› ë‹¨ìœ„ -> ì› ë‹¨ìœ„)
        const opProfitPrev_ì› = plData.opProfit.prev * 100000000;
        const opProfitTarget_ì› = plData.opProfit.target * 100000000;
        const opProfitForecast_ì› = plData.opProfit.forecast * 100000000;
        
        // ì˜ì—…ì´ìµ ì¡°ê±´ë¶€ í‘œì‹œ í•¨ìˆ˜
        const formatOperatingProfitYoy = (forecast, prev) => {
          if (!prev || prev === 0) {
            return '-';
          }
          if (prev > 0 && forecast < 0) {
            return 'ì ìì „í™˜';
          }
          if (prev < 0 && forecast > 0) {
            return 'í‘ìì „í™˜';
          }
          if (prev < 0 && forecast < 0) {
            // ì „ë…„ ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
            // ë‹¹ë…„ì´ ì „ë…„ë³´ë‹¤ ë‚˜ì•„ì§€ë©´(ì ìê°€ ì¤„ì–´ë“¤ë©´) ê°œì„ , ë‚˜ë¹ ì§€ë©´(ì ìê°€ ëŠ˜ì–´ë‚˜ë©´) ì•…í™”
            return forecast > prev ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
          }
          // ì „ë…„ ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
          return Math.round((forecast / prev) * 100) + '%';
        };
        
        const formatOperatingProfitAchievement = (forecast, target) => {
          if (!target || target === 0) {
            return '-';
          }
          if (target > 0 && forecast < 0) {
            return 'ì ì';
          }
          if (target < 0 && forecast > 0) {
            return 'í‘ì';
          }
          if (target < 0 && forecast < 0) {
            // ê³„íš ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
            // ë‹¹ë…„ì´ ê³„íšë³´ë‹¤ ë‚˜ì•„ì§€ë©´(ì ìê°€ ì¤„ì–´ë“¤ë©´) ê°œì„ , ë‚˜ë¹ ì§€ë©´(ì ìê°€ ëŠ˜ì–´ë‚˜ë©´) ì•…í™”
            return forecast > target ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
          }
          // ê³„íš ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
          return Math.round((forecast / target) * 100) + '%';
        };
        
        // ê³„ì‚° í•¨ìˆ˜ë“¤
        const tagRevenueYoy = plData.tagRevenue?.yoy || calcPercent(tagRevenueForecast_ì›, tagRevenuePrev_ì›);
        const tagRevenueAchievement = plData.tagRevenue?.achievement || calcPercent(tagRevenueForecast_ì›, tagRevenueTarget_ì›, true);
        const revenueYoy = calcPercent(revenueForecast_ì›, revenuePrev_ì›);
        const revenueAchievement = calcPercent(revenueForecast_ì›, revenueTarget_ì›, true);
        const cogYoy = calcPercent(cogForecast_ì›, cogPrev_ì›);
        const cogAchievement = calcPercent(cogForecast_ì›, cogTarget_ì›, true);
        const grossProfitYoy = calcPercent(grossProfitForecast_ì›, grossProfitPrev_ì›);
        const grossProfitAchievement = calcPercent(grossProfitForecast_ì›, grossProfitTarget_ì›, true);
        const directCostYoy = calcPercent(directCostForecast_ì›, directCostPrev_ì›);
        const directCostAchievement = calcPercent(directCostForecast_ì›, directCostTarget_ì›, true);
        const directProfitYoy = calcPercent(directProfitForecast_ì›, directProfitPrev_ì›);
        const directProfitAchievement = calcPercent(directProfitForecast_ì›, directProfitTarget_ì›, true);
        const operatingExpenseYoy = calcPercent(operatingExpenseForecast_ì›, operatingExpensePrev_ì›);
        const operatingExpenseAchievement = calcPercent(operatingExpenseForecast_ì›, operatingExpenseTarget_ì›, true);
        const opProfitYoy = formatOperatingProfitYoy(opProfitForecast_ì›, opProfitPrev_ì›);
        const opProfitAchievement = formatOperatingProfitAchievement(opProfitForecast_ì›, opProfitTarget_ì›);
        
        // ì§„ì²™ìœ¨ ê³„ì‚° (ì§ì ‘ì´ìµ ê¸°ì¤€)
        const progressPrev = directProfitTarget_ì› > 0 ? (directProfitPrev_ì› / directProfitTarget_ì›) * 100 : 0;
        const progressForecast = directProfitTarget_ì› > 0 ? (directProfitForecast_ì› / directProfitTarget_ì›) * 100 : 0;
        const progressYoy = progressPrev > 0 ? (progressForecast / progressPrev) * 100 : 0;
        const progressAchievement = progressForecast;
        
        // í• ì¸ìœ¨ ì „ë…„ëŒ€ë¹„ ë° ë‹¬ì„±ë¥  ê³„ì‚° í•¨ìˆ˜
        const formatDiscountRateDiff = (forecast, prev, target) => {
          const yoyDiff = forecast - prev; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„í• ì¸ìœ¨ - ì „ë…„í• ì¸ìœ¨
          const achievementDiff = forecast - target; // ë‹¬ì„±ë¥  = ë‹¹ë…„í• ì¸ìœ¨ - ê³„íší• ì¸ìœ¨
          
          const formatDiff = (diff) => {
            if (isNaN(diff) || diff === 0) return '0.0%p';
            const sign = diff > 0 ? '+' : '';
            return `${sign}${diff.toFixed(1)}%p`;
          };
          
          return {
            yoy: formatDiff(yoyDiff),
            achievement: formatDiff(achievementDiff)
          };
        };
        
        const discountRateDiff = formatDiscountRateDiff(discountRateForecast, discountRatePrev, discountRateTarget);
        
        // ì§ì ‘ë¹„ ì„¸ë¶€ í•­ëª©ì€ ìœ„ì—ì„œ brandPLDataì—ì„œ ê°€ì ¸ì˜¨ ê°’ ì‚¬ìš©
        
        tableBody.innerHTML = `
          <tr><td class="item-name">TAGë§¤ì¶œ</td><td class="editable" contenteditable="false">${formatNumber(tagRevenuePrev_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(tagRevenueTarget_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(tagRevenueForecast_ì›)}</td><td class="editable" contenteditable="false">${tagRevenueYoy === '#DIV/0!' ? tagRevenueYoy : tagRevenueYoy + '%'}</td><td class="editable" contenteditable="false">${tagRevenueAchievement}%</td></tr>
          <tr><td class="item-name">ì‹¤íŒë§¤ì¶œ(V+)</td><td class="editable" contenteditable="false">${formatNumber(revenuePrev_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(revenueTarget_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(revenueForecast_ì›)}</td><td class="editable" contenteditable="false">${revenueYoy === '#DIV/0!' ? revenueYoy : revenueYoy + '%'}</td><td class="editable" contenteditable="false">${revenueAchievement}%</td></tr>
          <tr><td class="item-name">í• ì¸ìœ¨</td><td class="editable" contenteditable="false">${discountRatePrev.toFixed(1)}%</td><td class="editable" contenteditable="false">${discountRateTarget.toFixed(1)}%</td><td class="editable" contenteditable="false">${discountRateForecast.toFixed(1)}%</td><td class="editable" contenteditable="false">${discountRateDiff.yoy}</td><td class="editable" contenteditable="false">${discountRateDiff.achievement}</td></tr>
          <tr><td class="item-name sub-item">(ë§¤ì¶œì›ê°€)</td><td class="editable" contenteditable="false">(${formatNumber(cogPrev_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(cogTarget_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(cogForecast_ì›)})</td><td class="editable" contenteditable="false">${cogYoy === '#DIV/0!' ? cogYoy : cogYoy + '%'}</td><td class="editable" contenteditable="false">${cogAchievement}%</td></tr>
          <tr class="total-row"><td class="item-name">ë§¤ì¶œì´ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(grossProfitPrev_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(grossProfitTarget_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(grossProfitForecast_ì›)}</td><td class="editable" contenteditable="false">${grossProfitYoy === '#DIV/0!' ? grossProfitYoy : grossProfitYoy + '%'}</td><td class="editable" contenteditable="false">${grossProfitAchievement}%</td></tr>
          <tr><td class="item-name sub-item">(ì§ì ‘ë¹„)</td><td class="editable" contenteditable="false">(${formatNumber(directCostPrev_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(directCostTarget_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(directCostForecast_ì›)})</td><td class="editable" contenteditable="false">${directCostYoy === '#DIV/0!' ? directCostYoy : directCostYoy + '%'}</td><td class="editable" contenteditable="false">${directCostAchievement}%</td></tr>
          <tr><td class="item-name sub-item">- ì¸ê±´ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(ì¸ê±´ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ì¸ê±´ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ì¸ê±´ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ì¸ê±´ë¹„.yoy === '#DIV/0!' ? ì¸ê±´ë¹„.yoy : ì¸ê±´ë¹„.yoy + '%'}</td><td class="editable" contenteditable="false">${ì¸ê±´ë¹„.achievement === '#DIV/0!' ? ì¸ê±´ë¹„.achievement : ì¸ê±´ë¹„.achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ì„ì°¨ê´€ë¦¬ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(ì„ì°¨ê´€ë¦¬ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ì„ì°¨ê´€ë¦¬ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ì„ì°¨ê´€ë¦¬ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ì„ì°¨ê´€ë¦¬ë¹„.yoy === '#DIV/0!' ? ì„ì°¨ê´€ë¦¬ë¹„.yoy : ì„ì°¨ê´€ë¦¬ë¹„.yoy + '%'}</td><td class="editable" contenteditable="false">${ì„ì°¨ê´€ë¦¬ë¹„.achievement === '#DIV/0!' ? ì„ì°¨ê´€ë¦¬ë¹„.achievement : ì„ì°¨ê´€ë¦¬ë¹„.achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ë¬¼ë¥˜ìš´ì†¡ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(ë¬¼ë¥˜ìš´ì†¡ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ë¬¼ë¥˜ìš´ì†¡ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ë¬¼ë¥˜ìš´ì†¡ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ë¬¼ë¥˜ìš´ì†¡ë¹„.yoy === '#DIV/0!' ? ë¬¼ë¥˜ìš´ì†¡ë¹„.yoy : ë¬¼ë¥˜ìš´ì†¡ë¹„.yoy + '%'}</td><td class="editable" contenteditable="false">${ë¬¼ë¥˜ìš´ì†¡ë¹„.achievement === '#DIV/0!' ? ë¬¼ë¥˜ìš´ì†¡ë¹„.achievement : ë¬¼ë¥˜ìš´ì†¡ë¹„.achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ë¡œì—´í‹°</td><td class="editable" contenteditable="false">(${formatNumber(ë¡œì—´í‹°.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ë¡œì—´í‹°.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ë¡œì—´í‹°.forecast)})</td><td class="editable" contenteditable="false">${ë¡œì—´í‹°.yoy === '#DIV/0!' ? ë¡œì—´í‹°.yoy : ë¡œì—´í‹°.yoy + '%'}</td><td class="editable" contenteditable="false">${ë¡œì—´í‹°.achievement === '#DIV/0!' ? ë¡œì—´í‹°.achievement : ë¡œì—´í‹°.achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ê°ê°€ìƒê°ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(ê°ê°€ìƒê°ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ê°ê°€ìƒê°ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ê°ê°€ìƒê°ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ê°ê°€ìƒê°ë¹„.yoy === '#DIV/0!' ? ê°ê°€ìƒê°ë¹„.yoy : ê°ê°€ìƒê°ë¹„.yoy + '%'}</td><td class="editable" contenteditable="false">${ê°ê°€ìƒê°ë¹„.achievement === '#DIV/0!' ? ê°ê°€ìƒê°ë¹„.achievement : ê°ê°€ìƒê°ë¹„.achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ê¸°íƒ€</td><td class="editable" contenteditable="false">(${formatNumber(ê¸°íƒ€.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(ê¸°íƒ€.target)})</td><td class="editable" contenteditable="false">(${formatNumber(ê¸°íƒ€.forecast)})</td><td class="editable" contenteditable="false">${ê¸°íƒ€.yoy === '#DIV/0!' ? ê¸°íƒ€.yoy : ê¸°íƒ€.yoy + '%'}</td><td class="editable" contenteditable="false">${ê¸°íƒ€.achievement === '#DIV/0!' ? ê¸°íƒ€.achievement : ê¸°íƒ€.achievement + '%'}</td></tr>
          <tr class="total-row"><td class="item-name">ì§ì ‘ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(directProfitPrev_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(directProfitTarget_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(directProfitForecast_ì›)}</td><td class="editable" contenteditable="false">${directProfitYoy === '#DIV/0!' ? directProfitYoy : directProfitYoy + '%'}</td><td class="editable" contenteditable="false">${directProfitAchievement}%</td></tr>
          <tr><td class="item-name sub-item">(ì˜ì—…ë¹„)</td><td class="editable" contenteditable="false">(${formatNumber(operatingExpensePrev_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(operatingExpenseTarget_ì›)})</td><td class="editable" contenteditable="false">(${formatNumber(operatingExpenseForecast_ì›)})</td><td class="editable" contenteditable="false">${operatingExpenseYoy === '#DIV/0!' ? operatingExpenseYoy : operatingExpenseYoy + '%'}</td><td class="editable" contenteditable="false">${operatingExpenseAchievement === '#DIV/0!' ? operatingExpenseAchievement : operatingExpenseAchievement + '%'}</td></tr>
          <tr class="total-row"><td class="item-name">ì˜ì—…ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(opProfitPrev_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(opProfitTarget_ì›)}</td><td class="editable" contenteditable="false">${formatNumber(opProfitForecast_ì›)}</td><td class="editable" contenteditable="false">${opProfitYoy}</td><td class="editable" contenteditable="false">${opProfitAchievement}</td></tr>
        `;
        
        // â˜…â˜…â˜… ì†ìµê³„ì‚°ì„œëŠ” localStorageì—ì„œ ë¡œë“œí•˜ì§€ ì•ŠìŒ (JSON ë°ì´í„°ë§Œ ì‚¬ìš©) â˜…â˜…â˜…
        // loadEdits() í˜¸ì¶œ ì œê±° - ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ í‘œì‹œ
        if(isEditMode) applyEditMode();
      }

      // ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      updateBrandChannels();
    }

    // ì „ì²´í˜„í™© ì†ìµê³„ì‚°ì„œ ì—…ë°ì´íŠ¸ - window.overviewPL íŒŒì´ì¬ ë°ì´í„° ì§ì ‘ ì‚¬ìš©
    function updateOverviewPL() {
      // â˜… window.overviewPL ë°ì´í„° ì§ì ‘ ì‚¬ìš© (íŒŒì´ì¬ì—ì„œ ê³„ì‚°ëœ ì „ì²´í˜„í™© ë°ì´í„°)
      const overviewPL = window.overviewPL || null;
      
      if (!overviewPL) {
        console.warn('[ì „ì²´ì†ìµ] window.overviewPL ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        console.warn('[ì „ì²´ì†ìµ] window.overviewPL í™•ì¸:', window.overviewPL);
        console.warn('[ì „ì²´ì†ìµ] window.D.overviewPL í™•ì¸:', window.D?.overviewPL);
        // window.D.overviewPLë„ í™•ì¸ (data_20251201.jsì—ì„œ ë¡œë“œëœ ê²½ìš°)
        if (window.D && window.D.overviewPL) {
          console.log('[ì „ì²´ì†ìµ] window.D.overviewPL ì‚¬ìš©');
          window.overviewPL = window.D.overviewPL;
          return updateOverviewPL(); // ì¬ê·€ í˜¸ì¶œ
        }
        return;
      }
      
      console.log('[ì „ì²´ì†ìµ] window.overviewPL ë°ì´í„° ì‚¬ìš©:', overviewPL);
      
      // window.overviewPL ë°ì´í„°ëŠ” ì´ë¯¸ ì–µì› ë‹¨ìœ„ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      const aggregated = {
        tagRevenue: { 
          prev: (overviewPL.tagRevenue?.prev || 0), 
          target: (overviewPL.tagRevenue?.target || 0), 
          forecast: (overviewPL.tagRevenue?.forecast || 0) 
        },
        revenue: { 
          prev: (overviewPL.revenue?.prev || 0), 
          target: (overviewPL.revenue?.target || 0), 
          forecast: (overviewPL.revenue?.forecast || 0) 
        },
        discountRate: { prev: 0, target: 0, forecast: 0 },
        cog: { 
          prev: (overviewPL.cog?.prev || 0), 
          target: (overviewPL.cog?.target || 0), 
          forecast: (overviewPL.cog?.forecast || 0) 
        },
        grossProfit: { 
          prev: (overviewPL.grossProfit?.prev || 0), 
          target: (overviewPL.grossProfit?.target || 0), 
          forecast: (overviewPL.grossProfit?.forecast || 0) 
        },
        directCost: { 
          prev: (overviewPL.directCost?.prev || 0), 
          target: (overviewPL.directCost?.target || 0), 
          forecast: (overviewPL.directCost?.forecast || 0) 
        },
        directCostDetail: {
          ì¸ê±´ë¹„: { prev: 0, target: 0, forecast: 0 },
          ì„ì°¨ê´€ë¦¬ë¹„: { prev: 0, target: 0, forecast: 0 },
          ë¬¼ë¥˜ìš´ì†¡ë¹„: { prev: 0, target: 0, forecast: 0 },
          ë¡œì—´í‹°: { prev: 0, target: 0, forecast: 0 },
          ê°ê°€ìƒê°ë¹„: { prev: 0, target: 0, forecast: 0 },
          ê¸°íƒ€: { prev: 0, target: 0, forecast: 0 }
        },
        directProfit: { 
          prev: (overviewPL.directProfit?.prev || 0), 
          target: (overviewPL.directProfit?.target || 0), 
          forecast: (overviewPL.directProfit?.forecast || 0) 
        },
        operatingExpense: { 
          prev: (overviewPL.operatingExpense?.prev || 0), 
          target: (overviewPL.operatingExpense?.target || 0), 
          forecast: (overviewPL.operatingExpense?.forecast || 0) 
        },
        opProfit: { 
          prev: (overviewPL.opProfit?.prev || 0), 
          target: (overviewPL.opProfit?.target || 0), 
          forecast: (overviewPL.opProfit?.forecast || 0) 
        }
      };
      
      // ì§ì ‘ë¹„ ì„¸ë¶€ í•­ëª©ì´ ìˆìœ¼ë©´ ì‚¬ìš©
      if (overviewPL.directCostDetail) {
        Object.keys(aggregated.directCostDetail).forEach(key => {
          if (overviewPL.directCostDetail[key]) {
            aggregated.directCostDetail[key] = overviewPL.directCostDetail[key];
          }
        });
      }

      // í• ì¸ìœ¨ ê³„ì‚°
      aggregated.discountRate.prev = aggregated.tagRevenue.prev > 0 ? (1 - aggregated.revenue.prev / aggregated.tagRevenue.prev) * 100 : 0;
      aggregated.discountRate.target = aggregated.tagRevenue.target > 0 ? (1 - aggregated.revenue.target / aggregated.tagRevenue.target) * 100 : 0;
      aggregated.discountRate.forecast = aggregated.tagRevenue.forecast > 0 ? (1 - aggregated.revenue.forecast / aggregated.tagRevenue.forecast) * 100 : 0;

      // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ (window.overviewPLì€ ì´ë¯¸ ì–µì› ë‹¨ìœ„, ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€)
      const formatNumber = (num) => {
        if (num === null || num === undefined || isNaN(num)) return '0.0';
        const formatted = Number(num).toFixed(1);
        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ (ì†Œìˆ˜ì  ê³ ë ¤)
        const parts = formatted.split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return parts.join('.');
      };

      // í¼ì„¼íŠ¸ ê³„ì‚° í•¨ìˆ˜
      const calcPercent = (forecast, prev, isAchievement = false) => {
        if (!prev || prev === 0) {
          return isAchievement ? 0 : '#DIV/0!';
        }
        return Math.round((forecast / prev) * 100);
      };

      // ì†ìµê³„ì‚°ì„œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
      const tableBody = document.querySelector('#overview-pl .pl-table tbody');
      if (tableBody) {
        const tagRevenueYoy = calcPercent(aggregated.tagRevenue.forecast, aggregated.tagRevenue.prev);
        const tagRevenueAchievement = calcPercent(aggregated.tagRevenue.forecast, aggregated.tagRevenue.target, true);
        const revenueYoy = calcPercent(aggregated.revenue.forecast, aggregated.revenue.prev);
        const revenueAchievement = calcPercent(aggregated.revenue.forecast, aggregated.revenue.target, true);
        const cogYoy = calcPercent(aggregated.cog.forecast, aggregated.cog.prev);
        const cogAchievement = calcPercent(aggregated.cog.forecast, aggregated.cog.target, true);
        const grossProfitYoy = calcPercent(aggregated.grossProfit.forecast, aggregated.grossProfit.prev);
        const grossProfitAchievement = calcPercent(aggregated.grossProfit.forecast, aggregated.grossProfit.target, true);
        const directCostYoy = calcPercent(aggregated.directCost.forecast, aggregated.directCost.prev);
        const directCostAchievement = calcPercent(aggregated.directCost.forecast, aggregated.directCost.target, true);
        // ì˜ì—…ì´ìµ ì¡°ê±´ë¶€ í‘œì‹œ í•¨ìˆ˜
        const formatOperatingProfitYoy = (forecast, prev) => {
          if (!prev || prev === 0) {
            return '-';
          }
          if (prev > 0 && forecast < 0) {
            return 'ì ìì „í™˜';
          }
          if (prev < 0 && forecast > 0) {
            return 'í‘ìì „í™˜';
          }
          if (prev < 0 && forecast < 0) {
            // ì „ë…„ ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
            return forecast > prev ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
          }
          // ì „ë…„ ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
          return Math.round((forecast / prev) * 100) + '%';
        };
        
        const formatOperatingProfitAchievement = (forecast, target) => {
          if (!target || target === 0) {
            return '-';
          }
          if (target > 0 && forecast < 0) {
            return 'ì ì';
          }
          if (target < 0 && forecast > 0) {
            return 'í‘ì';
          }
          if (target < 0 && forecast < 0) {
            // ê³„íš ìŒìˆ˜ â†’ ë‹¹ë…„ ìŒìˆ˜: ì ìê°œì„  or ì ìì•…í™”
            return forecast > target ? 'ì ìê°œì„ ' : 'ì ìì•…í™”';
          }
          // ê³„íš ì–‘ìˆ˜ â†’ ë‹¹ë…„ ì–‘ìˆ˜: ì¼ë°˜ í¼ì„¼íŠ¸ ê³„ì‚°
          return Math.round((forecast / target) * 100) + '%';
        };
        
        const directProfitYoy = calcPercent(aggregated.directProfit.forecast, aggregated.directProfit.prev);
        const directProfitAchievement = calcPercent(aggregated.directProfit.forecast, aggregated.directProfit.target, true);
        const operatingExpenseYoy = calcPercent(aggregated.operatingExpense.forecast, aggregated.operatingExpense.prev);
        const operatingExpenseAchievement = calcPercent(aggregated.operatingExpense.forecast, aggregated.operatingExpense.target, true);
        const opProfitYoy = formatOperatingProfitYoy(aggregated.opProfit.forecast, aggregated.opProfit.prev);
        const opProfitAchievement = formatOperatingProfitAchievement(aggregated.opProfit.forecast, aggregated.opProfit.target);

        // ì§ì ‘ë¹„ ì„¸ë¶€ í•­ëª© YOY ë° Achievement
        const ì¸ê±´ë¹„Yoy = calcPercent(aggregated.directCostDetail.ì¸ê±´ë¹„.forecast, aggregated.directCostDetail.ì¸ê±´ë¹„.prev);
        const ì¸ê±´ë¹„Achievement = calcPercent(aggregated.directCostDetail.ì¸ê±´ë¹„.forecast, aggregated.directCostDetail.ì¸ê±´ë¹„.target, true);
        const ì„ì°¨ê´€ë¦¬ë¹„Yoy = calcPercent(aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.forecast, aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.prev);
        const ì„ì°¨ê´€ë¦¬ë¹„Achievement = calcPercent(aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.forecast, aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.target, true);
        const ë¬¼ë¥˜ìš´ì†¡ë¹„Yoy = calcPercent(aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.forecast, aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.prev);
        const ë¬¼ë¥˜ìš´ì†¡ë¹„Achievement = calcPercent(aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.forecast, aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.target, true);
        const ë¡œì—´í‹°Yoy = calcPercent(aggregated.directCostDetail.ë¡œì—´í‹°.forecast, aggregated.directCostDetail.ë¡œì—´í‹°.prev);
        const ë¡œì—´í‹°Achievement = calcPercent(aggregated.directCostDetail.ë¡œì—´í‹°.forecast, aggregated.directCostDetail.ë¡œì—´í‹°.target, true);
        const ê°ê°€ìƒê°ë¹„Yoy = calcPercent(aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.forecast, aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.prev);
        const ê°ê°€ìƒê°ë¹„Achievement = calcPercent(aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.forecast, aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.target, true);
        const ê¸°íƒ€Yoy = calcPercent(aggregated.directCostDetail.ê¸°íƒ€.forecast, aggregated.directCostDetail.ê¸°íƒ€.prev);
        const ê¸°íƒ€Achievement = calcPercent(aggregated.directCostDetail.ê¸°íƒ€.forecast, aggregated.directCostDetail.ê¸°íƒ€.target, true);

        // í• ì¸ìœ¨ ì „ë…„ëŒ€ë¹„ ë° ë‹¬ì„±ë¥  ê³„ì‚° í•¨ìˆ˜
        const formatDiscountRateDiff = (forecast, prev, target) => {
          const yoyDiff = forecast - prev; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„í• ì¸ìœ¨ - ì „ë…„í• ì¸ìœ¨
          const achievementDiff = forecast - target; // ë‹¬ì„±ë¥  = ë‹¹ë…„í• ì¸ìœ¨ - ê³„íší• ì¸ìœ¨
          
          const formatDiff = (diff) => {
            if (isNaN(diff) || diff === 0) return '0.0%p';
            const sign = diff > 0 ? '+' : '';
            return `${sign}${diff.toFixed(1)}%p`;
          };
          
          return {
            yoy: formatDiff(yoyDiff),
            achievement: formatDiff(achievementDiff)
          };
        };
        
        const discountRateDiff = formatDiscountRateDiff(aggregated.discountRate.forecast, aggregated.discountRate.prev, aggregated.discountRate.target);

        tableBody.innerHTML = `
          <tr><td class="item-name">TAGë§¤ì¶œ</td><td class="editable" contenteditable="false">${formatNumber(aggregated.tagRevenue.prev)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.tagRevenue.target)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.tagRevenue.forecast)}</td><td class="editable" contenteditable="false">${tagRevenueYoy === '#DIV/0!' ? tagRevenueYoy : tagRevenueYoy + '%'}</td><td class="editable" contenteditable="false">${tagRevenueAchievement}%</td></tr>
          <tr><td class="item-name">ì‹¤íŒë§¤ì¶œ(V+)</td><td class="editable" contenteditable="false">${formatNumber(aggregated.revenue.prev)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.revenue.target)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.revenue.forecast)}</td><td class="editable" contenteditable="false">${revenueYoy === '#DIV/0!' ? revenueYoy : revenueYoy + '%'}</td><td class="editable" contenteditable="false">${revenueAchievement}%</td></tr>
          <tr><td class="item-name">í• ì¸ìœ¨</td><td class="editable" contenteditable="false">${aggregated.discountRate.prev.toFixed(1)}%</td><td class="editable" contenteditable="false">${aggregated.discountRate.target.toFixed(1)}%</td><td class="editable" contenteditable="false">${aggregated.discountRate.forecast.toFixed(1)}%</td><td class="editable" contenteditable="false">${discountRateDiff.yoy}</td><td class="editable" contenteditable="false">${discountRateDiff.achievement}</td></tr>
          <tr><td class="item-name sub-item">(ë§¤ì¶œì›ê°€)</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.cog.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.cog.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.cog.forecast)})</td><td class="editable" contenteditable="false">${cogYoy === '#DIV/0!' ? cogYoy : cogYoy + '%'}</td><td class="editable" contenteditable="false">${cogAchievement}%</td></tr>
          <tr class="total-row"><td class="item-name">ë§¤ì¶œì´ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(aggregated.grossProfit.prev)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.grossProfit.target)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.grossProfit.forecast)}</td><td class="editable" contenteditable="false">${grossProfitYoy === '#DIV/0!' ? grossProfitYoy : grossProfitYoy + '%'}</td><td class="editable" contenteditable="false">${grossProfitAchievement}%</td></tr>
          <tr><td class="item-name sub-item">(ì§ì ‘ë¹„)</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCost.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCost.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCost.forecast)})</td><td class="editable" contenteditable="false">${directCostYoy === '#DIV/0!' ? directCostYoy : directCostYoy + '%'}</td><td class="editable" contenteditable="false">${directCostAchievement}%</td></tr>
          <tr><td class="item-name sub-item">- ì¸ê±´ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì¸ê±´ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì¸ê±´ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì¸ê±´ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ì¸ê±´ë¹„Yoy === '#DIV/0!' ? ì¸ê±´ë¹„Yoy : ì¸ê±´ë¹„Yoy + '%'}</td><td class="editable" contenteditable="false">${ì¸ê±´ë¹„Achievement === '#DIV/0!' ? ì¸ê±´ë¹„Achievement : ì¸ê±´ë¹„Achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ì„ì°¨ê´€ë¦¬ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ì„ì°¨ê´€ë¦¬ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ì„ì°¨ê´€ë¦¬ë¹„Yoy === '#DIV/0!' ? ì„ì°¨ê´€ë¦¬ë¹„Yoy : ì„ì°¨ê´€ë¦¬ë¹„Yoy + '%'}</td><td class="editable" contenteditable="false">${ì„ì°¨ê´€ë¦¬ë¹„Achievement === '#DIV/0!' ? ì„ì°¨ê´€ë¦¬ë¹„Achievement : ì„ì°¨ê´€ë¦¬ë¹„Achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ë¬¼ë¥˜ìš´ì†¡ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¬¼ë¥˜ìš´ì†¡ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ë¬¼ë¥˜ìš´ì†¡ë¹„Yoy === '#DIV/0!' ? ë¬¼ë¥˜ìš´ì†¡ë¹„Yoy : ë¬¼ë¥˜ìš´ì†¡ë¹„Yoy + '%'}</td><td class="editable" contenteditable="false">${ë¬¼ë¥˜ìš´ì†¡ë¹„Achievement === '#DIV/0!' ? ë¬¼ë¥˜ìš´ì†¡ë¹„Achievement : ë¬¼ë¥˜ìš´ì†¡ë¹„Achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ë¡œì—´í‹°</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¡œì—´í‹°.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¡œì—´í‹°.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ë¡œì—´í‹°.forecast)})</td><td class="editable" contenteditable="false">${ë¡œì—´í‹°Yoy === '#DIV/0!' ? ë¡œì—´í‹°Yoy : ë¡œì—´í‹°Yoy + '%'}</td><td class="editable" contenteditable="false">${ë¡œì—´í‹°Achievement === '#DIV/0!' ? ë¡œì—´í‹°Achievement : ë¡œì—´í‹°Achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ê°ê°€ìƒê°ë¹„</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê°ê°€ìƒê°ë¹„.forecast)})</td><td class="editable" contenteditable="false">${ê°ê°€ìƒê°ë¹„Yoy === '#DIV/0!' ? ê°ê°€ìƒê°ë¹„Yoy : ê°ê°€ìƒê°ë¹„Yoy + '%'}</td><td class="editable" contenteditable="false">${ê°ê°€ìƒê°ë¹„Achievement === '#DIV/0!' ? ê°ê°€ìƒê°ë¹„Achievement : ê°ê°€ìƒê°ë¹„Achievement + '%'}</td></tr>
          <tr><td class="item-name sub-item">- ê¸°íƒ€</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê¸°íƒ€.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê¸°íƒ€.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.directCostDetail.ê¸°íƒ€.forecast)})</td><td class="editable" contenteditable="false">${ê¸°íƒ€Yoy === '#DIV/0!' ? ê¸°íƒ€Yoy : ê¸°íƒ€Yoy + '%'}</td><td class="editable" contenteditable="false">${ê¸°íƒ€Achievement === '#DIV/0!' ? ê¸°íƒ€Achievement : ê¸°íƒ€Achievement + '%'}</td></tr>
          <tr class="total-row"><td class="item-name">ì§ì ‘ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(aggregated.directProfit.prev)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.directProfit.target)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.directProfit.forecast)}</td><td class="editable" contenteditable="false">${directProfitYoy === '#DIV/0!' ? directProfitYoy : directProfitYoy + '%'}</td><td class="editable" contenteditable="false">${directProfitAchievement}%</td></tr>
          <tr><td class="item-name sub-item">(ì˜ì—…ë¹„)</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.operatingExpense.prev)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.operatingExpense.target)})</td><td class="editable" contenteditable="false">(${formatNumber(aggregated.operatingExpense.forecast)})</td><td class="editable" contenteditable="false">${operatingExpenseYoy === '#DIV/0!' ? operatingExpenseYoy : operatingExpenseYoy + '%'}</td><td class="editable" contenteditable="false">${operatingExpenseAchievement === '#DIV/0!' ? operatingExpenseAchievement : operatingExpenseAchievement + '%'}</td></tr>
          <tr class="total-row"><td class="item-name">ì˜ì—…ì´ìµ</td><td class="editable" contenteditable="false">${formatNumber(aggregated.opProfit.prev)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.opProfit.target)}</td><td class="editable" contenteditable="false">${formatNumber(aggregated.opProfit.forecast)}</td><td class="editable" contenteditable="false">${opProfitYoy}</td><td class="editable" contenteditable="false">${opProfitAchievement}</td></tr>
        `;

        // í…Œì´ë¸” ìƒì„± í›„ í¸ì§‘ ë‚´ìš© ì ìš©
        loadEdits();
        if(isEditMode) applyEditMode();
      }
    }

    // ì±„ë„ë³„ ì†ìµ í‘œì‹œ ëª¨ë“œ (revenue ë˜ëŠ” profit)
    let channelPlMode = 'revenue';

    // ë¸Œëœë“œë³„ ì±„ë„ ì†ìµ ì—…ë°ì´íŠ¸
    function updateBrandChannels() {
      console.log('[ì±„ë„ì†ìµ] updateBrandChannels í˜¸ì¶œ');
      console.log('[ì±„ë„ì†ìµ] channelProfitLossData ì¡´ì¬:', !!window.channelProfitLossData);
      console.log('[ì±„ë„ì†ìµ] í˜„ì¬ ë¸Œëœë“œ:', currentBrand);
      
      const inlineBody = document.getElementById('channel-pl-inline-body');
      
      // â˜…â˜…â˜… ì•ˆì „í•œ ë°ì´í„° ë¡œë“œ í™•ì¸ â˜…â˜…â˜…
      // channel_profit_loss.jsonì—ì„œ ë¡œë“œëœ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
      const hasValidData = window.channelProfitLossData && 
                           window.channelProfitLossData.channelRevenueData &&
                           Object.keys(window.channelProfitLossData.channelRevenueData).length > 0;
      
      if (!hasValidData) {
        console.warn('[ì±„ë„ì†ìµ] âš ï¸ channel_profit_loss.json ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ');
        if (inlineBody) {
          inlineBody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:20px;color:#888;"><span style="animation:pulse 1.5s infinite;">ë°ì´í„° ë¡œë”© ì¤‘...</span></td></tr>';
        }
        // ë°ì´í„° ë¡œë“œ ëŒ€ê¸° í›„ ì¬ì‹œë„ (ìµœëŒ€ 5íšŒ)
        if (!window._channelUpdateRetry) window._channelUpdateRetry = 0;
        if (window._channelUpdateRetry < 5) {
          window._channelUpdateRetry++;
          console.log(`[ì±„ë„ì†ìµ] ì¬ì‹œë„ ${window._channelUpdateRetry}/5 (500ms í›„)`);
          setTimeout(() => updateBrandChannels(), 500);
        } else {
          console.error('[ì±„ë„ì†ìµ] âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ - channel_profit_loss.json í™•ì¸ í•„ìš”');
          if (inlineBody) {
            inlineBody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:20px;color:#ef4444;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</td></tr>';
          }
        }
        return;
      }
      
      // ì„±ê³µì ìœ¼ë¡œ ë°ì´í„° ë¡œë“œë¨ - ì¬ì‹œë„ ì¹´ìš´í„° ì´ˆê¸°í™”
      window._channelUpdateRetry = 0;
      
      console.log('[ì±„ë„ì†ìµ] âœ“ channel_profit_loss.json ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
      console.log('[ì±„ë„ì†ìµ] ë¸Œëœë“œ ëª©ë¡:', Object.keys(window.channelProfitLossData.channelRevenueData));
      
      if (window.channelProfitLossData) {
        console.log('[ì±„ë„ì†ìµ] MLB í•©ê³„:', window.channelProfitLossData.brandRevenueTotals?.MLB);
      }
      
      // â˜… channel_profit_loss.json ë°ì´í„° ì§ì ‘ ì‚¬ìš© (ì•ˆì „í•˜ê²Œ) â˜…
      const channelRevenueData = window.channelProfitLossData.channelRevenueData || {};
      const channelProfitData = window.channelProfitLossData.channelProfitData || {};
      const brandRevenueTotals = window.channelProfitLossData.brandRevenueTotals || {};
      const brandProfitTotals = window.channelProfitLossData.brandProfitTotals || {};
      
      // â˜… channel_profit_loss.json ë°ì´í„°ë§Œ ì‚¬ìš© (í´ë°± ì—†ìŒ) â˜…
      // channelPlModeì— ë”°ë¼ ë°ì´í„° ì„ íƒ
      const isRevenueMode = channelPlMode === 'revenue';
      const channelData = isRevenueMode ? channelRevenueData : channelProfitData;
      const totalsData = isRevenueMode ? brandRevenueTotals : brandProfitTotals;
      
      // â˜…â˜…â˜… ë¸Œëœë“œ í‚¤ ë§¤í•‘: JSON íŒŒì¼ì˜ í‚¤ì™€ currentBrand ë§¤ì¹­ â˜…â˜…â˜…
      // JSON íŒŒì¼ í‚¤: 'MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'
      // currentBrand: 'MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'
      // ë™ì¼í•˜ë¯€ë¡œ ì§ì ‘ ì‚¬ìš©
      const brandKey = currentBrand; // JSON í‚¤ì™€ ë™ì¼
      
      console.log('[ì±„ë„ì†ìµ] ë¸Œëœë“œ í‚¤ ë§¤í•‘:', {
        currentBrand,
        brandKey,
        availableKeys: Object.keys(channelData),
        hasData: !!channelData[brandKey]
      });
      
      const channels = channelData[brandKey] || channelData.MLB || [];
      const totals = totalsData[brandKey] || totalsData.MLB || { prev: 0, target: 0, forecast: 0 };
      
      console.log('[ì±„ë„ì†ìµ] ì‚¬ìš©í•  ì±„ë„ ë°ì´í„°:', channels.length, 'ê°œ');
      console.log('[ì±„ë„ì†ìµ] ì²« ë²ˆì§¸ ì±„ë„:', channels[0]);
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ í…Œì´ë¸” í‘œì‹œ
      if (!channels.length) {
        console.warn('[ì±„ë„ì†ìµ] ì±„ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
        if (inlineBody) {
          inlineBody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:20px;color:#888;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
        }
        return;
      }
      
      // í—¤ë” í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ë§¤ì¶œ/ì§ì ‘ì´ìµ, í• ì¸ìœ¨/ì´ìµìœ¨)
      const valueLabel = isRevenueMode ? 'ë§¤ì¶œ' : 'ì§ì ‘ì´ìµ';
      const rateLabel = isRevenueMode ? 'í• ì¸ìœ¨' : 'ì´ìµìœ¨';
      const yoyLabel = isRevenueMode ? 'ë§¤ì¶œ YOY' : 'ì§ì ‘ì´ìµ YOY';
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      const valueHeaders = ['channel-pl-value-header-1', 'channel-pl-value-header-2', 'channel-pl-value-header-3'];
      const rateHeaders = ['channel-pl-rate-header-1', 'channel-pl-rate-header-2', 'channel-pl-rate-header-3'];
      valueHeaders.forEach(id => { const el = document.getElementById(id); if(el) el.textContent = valueLabel; });
      rateHeaders.forEach(id => { const el = document.getElementById(id); if(el) el.textContent = rateLabel; });
      const yoyHeader = document.getElementById('channel-pl-yoy-header');
      if(yoyHeader) yoyHeader.textContent = yoyLabel;
      
      if (inlineBody) {
        // â˜…â˜…â˜… ì§ì ‘ì´ìµ ëª¨ë“œì¼ ë•Œ brand_pl.jsonì˜ ì§ì ‘ì´ìµ ê°’ ì‚¬ìš© (ê³µí†µì±„ë„ í¬í•¨ ì „ì²´ ì§‘ê³„) â˜…â˜…â˜…
        let totalPrev = totals.prev;
        let totalTarget = totals.target;
        let totalForecast = totals.forecast;
        
        // ì§ì ‘ì´ìµ ëª¨ë“œì´ê³  brand_pl.json ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
        if (!isRevenueMode && window.brandPLData && window.brandPLData[brandKey]) {
          const brandPL = window.brandPLData[brandKey];
          if (brandPL.directProfit) {
            // brand_pl.jsonì˜ ì§ì ‘ì´ìµ ê°’ ì‚¬ìš© (ê³µí†µì±„ë„ í¬í•¨ ì „ì²´ ì§‘ê³„)
            totalPrev = brandPL.directProfit.prev || totalPrev;
            totalTarget = brandPL.directProfit.target || totalTarget;
            totalForecast = brandPL.directProfit.forecast || totalForecast;
            
            console.log('[ì±„ë„ì†ìµ] brand_pl.json ì§ì ‘ì´ìµ ê°’ ì‚¬ìš©:', {
              brandKey,
              prev: totalPrev,
              target: totalTarget,
              forecast: totalForecast
            });
          }
        }
        
        const totalYoy = totalPrev !== 0 ? Math.round((totalForecast / totalPrev) * 100) : 0;
        const totalAchievement = totalTarget !== 0 ? Math.round((totalForecast / totalTarget) * 100) : 0;
        
        // â˜…â˜…â˜… í•©ê³„ ì´ìµìœ¨(í• ì¸ìœ¨) ê³„ì‚° â˜…â˜…â˜…
        let totalPrevRate = '-';
        let totalTargetRate = '-';
        let totalForecastRate = '-';
        
        if (isRevenueMode) {
          // ë§¤ì¶œ ëª¨ë“œ: í• ì¸ìœ¨ = brand_pl.jsonì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° (TAGë§¤ì¶œê³¼ ì‹¤íŒë§¤ì•¡ìœ¼ë¡œ ê³„ì‚°ëœ ê°’)
          if (window.brandPLData && window.brandPLData[brandKey]) {
            const brandPL = window.brandPLData[brandKey];
            if (brandPL.discountRate) {
              totalPrevRate = brandPL.discountRate.prev !== undefined ? brandPL.discountRate.prev.toFixed(1) + '%' : '-';
              totalTargetRate = brandPL.discountRate.target !== undefined ? brandPL.discountRate.target.toFixed(1) + '%' : '-';
              totalForecastRate = brandPL.discountRate.forecast !== undefined ? brandPL.discountRate.forecast.toFixed(1) + '%' : '-';
              
              console.log('[ì±„ë„ì†ìµ] brand_pl.json í• ì¸ìœ¨ ì‚¬ìš©:', {
                brandKey,
                prev: totalPrevRate,
                target: totalTargetRate,
                forecast: totalForecastRate
              });
            } else {
              // brand_pl.jsonì— í• ì¸ìœ¨ì´ ì—†ìœ¼ë©´ ê°€ì¤‘ í‰ê· ìœ¼ë¡œ ê³„ì‚° (í´ë°±)
              const prevRateSum = channels.reduce((sum, ch) => sum + (ch.prev * (ch.prevRate || 0) / 100), 0);
              const targetRateSum = channels.reduce((sum, ch) => sum + (ch.target * (ch.targetRate || 0) / 100), 0);
              const forecastRateSum = channels.reduce((sum, ch) => sum + (ch.forecast * (ch.forecastRate || 0) / 100), 0);
              
              if (totalPrev > 0) totalPrevRate = (prevRateSum / totalPrev * 100).toFixed(1) + '%';
              if (totalTarget > 0) totalTargetRate = (targetRateSum / totalTarget * 100).toFixed(1) + '%';
              if (totalForecast > 0) totalForecastRate = (forecastRateSum / totalForecast * 100).toFixed(1) + '%';
            }
          } else {
            // brand_pl.jsonì´ ì—†ìœ¼ë©´ ê°€ì¤‘ í‰ê· ìœ¼ë¡œ ê³„ì‚° (í´ë°±)
            const prevRateSum = channels.reduce((sum, ch) => sum + (ch.prev * (ch.prevRate || 0) / 100), 0);
            const targetRateSum = channels.reduce((sum, ch) => sum + (ch.target * (ch.targetRate || 0) / 100), 0);
            const forecastRateSum = channels.reduce((sum, ch) => sum + (ch.forecast * (ch.forecastRate || 0) / 100), 0);
            
            if (totalPrev > 0) totalPrevRate = (prevRateSum / totalPrev * 100).toFixed(1) + '%';
            if (totalTarget > 0) totalTargetRate = (targetRateSum / totalTarget * 100).toFixed(1) + '%';
            if (totalForecast > 0) totalForecastRate = (forecastRateSum / totalForecast * 100).toFixed(1) + '%';
          }
        } else {
          // ì§ì ‘ì´ìµ ëª¨ë“œ: ì´ìµìœ¨ = (ì§ì ‘ì´ìµ í•©ê³„ / ë§¤ì¶œ í•©ê³„) * 1.1 * 100
          const revenueTotals = brandRevenueTotals[brandKey] || brandRevenueTotals.MLB || { prev: 0, target: 0, forecast: 0 };
          const revenuePrev = revenueTotals.prev;
          const revenueTarget = revenueTotals.target;
          const revenueForecast = revenueTotals.forecast;
          
          if (revenuePrev > 0) totalPrevRate = (totalPrev / revenuePrev * 1.1 * 100).toFixed(1) + '%';
          if (revenueTarget > 0) totalTargetRate = (totalTarget / revenueTarget * 1.1 * 100).toFixed(1) + '%';
          if (revenueForecast > 0) totalForecastRate = (totalForecast / revenueForecast * 1.1 * 100).toFixed(1) + '%';
        }
        
        // í•©ê³„ í–‰ê³¼ ì±„ë„ í–‰ì„ í•¨ê»˜ ìƒì„±
        inlineBody.innerHTML = `
          <tr class="total-row">
            <td class="item-name">í•©ê³„</td>
            <td class="editable" contenteditable="false">${totalPrev.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${totalPrevRate}</td>
            <td class="editable" contenteditable="false">${totalTarget.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${totalTargetRate}</td>
            <td class="editable" contenteditable="false">${totalForecast.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${totalForecastRate}</td>
            <td class="editable" contenteditable="false">${totalYoy}%</td>
            <td class="editable" contenteditable="false">${totalAchievement}%</td>
          </tr>
        ` + channels.map(ch => {
          const channelYoy = ch.yoy || (ch.prev !== 0 ? Math.round((ch.forecast / ch.prev) * 100) : 0);
          const prevRate = ch.prevRate !== undefined ? ch.prevRate.toFixed(1) + '%' : '-';
          const forecastRate = ch.forecastRate !== undefined ? ch.forecastRate.toFixed(1) + '%' : '-';
          
          // â˜…â˜…â˜… ê°œë³„ ì±„ë„ì˜ ê³„íš ë°ì´í„°: ë¸Œëœë“œ í•©ê³„ì˜ ê³„íš ë°ì´í„°ë¥¼ ë‹¹ë…„ ë¹„ìœ¨ë¡œ ë¶„ë°° â˜…â˜…â˜…
          let channelTarget = ch.target || 0;
          let channelTargetRate = ch.targetRate !== undefined ? ch.targetRate.toFixed(1) + '%' : '-';
          let channelAchievement = ch.achievement || 0;
          
          // ê³„íš ë°ì´í„°ê°€ 0ì´ê³  ë¸Œëœë“œ í•©ê³„ì— ê³„íš ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¹„ìœ¨ë¡œ ë¶„ë°°
          if (channelTarget === 0 && totalTarget > 0 && totalForecast > 0) {
            // ë‹¹ë…„ ë¹„ìœ¨ = ì±„ë„ ë‹¹ë…„ / ì „ì²´ ë‹¹ë…„
            const channelRatio = ch.forecast / totalForecast;
            channelTarget = totalTarget * channelRatio;
            
            // ê³„íšëŒ€ë¹„ ì¬ê³„ì‚°
            channelAchievement = channelTarget > 0 ? Math.round((ch.forecast / channelTarget) * 100) : 0;
            
            // ê³„íš ì´ìµìœ¨ ê³„ì‚° (ì§ì ‘ì´ìµ ëª¨ë“œì¼ ë•Œ)
            if (!isRevenueMode) {
              // ë§¤ì¶œ í•©ê³„ì—ì„œ í•´ë‹¹ ì±„ë„ì˜ ë§¤ì¶œ ë¹„ìœ¨ì„ êµ¬í•´ì„œ ê³„íš ì´ìµìœ¨ ê³„ì‚°
              const revenueTotals = brandRevenueTotals[brandKey] || brandRevenueTotals.MLB || { prev: 0, target: 0, forecast: 0 };
              const revenueForecast = revenueTotals.forecast;
              if (revenueForecast > 0) {
                // ì±„ë„ì˜ ë§¤ì¶œ ë¹„ìœ¨ ì¶”ì • (ì§ì ‘ì´ìµ ë¹„ìœ¨ê³¼ ë™ì¼í•˜ë‹¤ê³  ê°€ì •)
                const revenueChannelRatio = channelRatio;
                const revenueTarget = revenueTotals.target;
                const channelRevenueTarget = revenueTarget * revenueChannelRatio;
                if (channelRevenueTarget > 0) {
                  channelTargetRate = ((channelTarget / channelRevenueTarget) * 100).toFixed(1) + '%';
                }
              }
            } else {
              // ë§¤ì¶œ ëª¨ë“œ: í• ì¸ìœ¨ì€ ì›ë³¸ ë°ì´í„° ì‚¬ìš©
              channelTargetRate = ch.targetRate !== undefined ? ch.targetRate.toFixed(1) + '%' : '-';
            }
          }
          
          return `<tr>
            <td class="item-name">${ch.channel}</td>
            <td class="editable" contenteditable="false">${ch.prev.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${prevRate}</td>
            <td class="editable" contenteditable="false">${channelTarget.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${channelTargetRate}</td>
            <td class="editable" contenteditable="false">${ch.forecast.toFixed(1)}</td>
            <td class="editable" contenteditable="false">${forecastRate}</td>
            <td class="editable" contenteditable="false">${channelYoy}%</td>
            <td class="editable" contenteditable="false">${channelAchievement}%</td>
          </tr>`;
        }).join('');
        
        // â˜…â˜…â˜… í…Œì´ë¸” ìƒì„± í›„ í¸ì§‘ ë‚´ìš© ì ìš© ì œê±° (ë¸Œëœë“œ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ì—ì„œ ì²˜ë¦¬) â˜…â˜…â˜…
        // loadEdits()ëŠ” ë¸Œëœë“œ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
        // loadEdits();
        if(isEditMode) applyEditMode();
      }
    }

    function setText(id, text){ 
      const el=document.getElementById(id); 
      if(el) {
        // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš© (localStorage ë¬´ì‹œ) â˜…â˜…â˜…
        const isKPI = el.closest('.kpi-card') !== null || 
                     el.closest('#overview-kpi-4') !== null || 
                     el.closest('#overview-kpi-9') !== null ||
                     el.closest('#brand-kpi') !== null ||
                     (id && (id.includes('overview-') || id.includes('brand-')) && 
                      (id.includes('revenue') || id.includes('profit') || id.includes('opprofit') || id.includes('progress')));
        
        const isPL = el.closest('#overview-pl') !== null || 
                     el.closest('#brand-pl') !== null ||
                     el.closest('.pl-table') !== null;
        
        if (isKPI || isPL) {
          // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš©
          el.textContent = text;
          return;
        }
        
        // ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸
        const edits = localStorage.getItem(STORAGE_KEY);
        if (edits) {
          const data = JSON.parse(edits);
          const key = getElementKey(el);
          // í¸ì§‘ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ ì‚¬ìš©
          const finalText = data[key] !== undefined ? data[key] : text;
          console.log(`setText ${id}:`, {text, finalText, hasEdit: data[key] !== undefined});
          el.textContent = finalText;
        } else {
          console.log(`setText ${id}:`, {text, finalText: text, hasEdit: false});
          el.textContent = text;
        }
      }
    }
    function setDelta(id, val, isPctPt=false){
      const el=document.getElementById(id); if(!el) return;
      const sign = val>=0?'+':'';
      const defaultText = `ëª©í‘œ ëŒ€ë¹„ ${sign}${parseFloat(val).toFixed(1)}${isPctPt?'%p':'%'}`;
      
      // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš© (localStorage ë¬´ì‹œ) â˜…â˜…â˜…
      const isKPI = el.closest('.kpi-card') !== null || 
                   el.closest('#overview-kpi-4') !== null || 
                   el.closest('#overview-kpi-9') !== null ||
                   el.closest('#brand-kpi') !== null ||
                   (id && (id.includes('overview-') || id.includes('brand-')) && 
                    (id.includes('revenue') || id.includes('profit') || id.includes('opprofit') || id.includes('progress')));
      
      const isPL = el.closest('#overview-pl') !== null || 
                   el.closest('#brand-pl') !== null ||
                   el.closest('.pl-table') !== null;
      
      if (isKPI || isPL) {
        // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš©
        el.textContent = defaultText;
        el.className = 'kpi-change-line editable ' + (val>=0?'kpi-positive':'kpi-negative');
        return;
      }
      
      // ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸
      const edits = localStorage.getItem(STORAGE_KEY);
      if (edits) {
        const data = JSON.parse(edits);
        const key = getElementKey(el);
        el.textContent = data[key] !== undefined ? data[key] : defaultText;
      } else {
        el.textContent = defaultText;
      }
      el.className = 'kpi-change-line editable ' + (val>=0?'kpi-positive':'kpi-negative');
    }
    function setYoY(id, val, isPctPt=false){
      const el=document.getElementById(id); if(!el) return;
      const sign = val>=0?'+':'';
      const defaultText = `ì „ë…„ ëŒ€ë¹„ ${sign}${parseFloat(val).toFixed(1)}${isPctPt?'%p':'%'}`;
      
      // â˜…â˜…â˜… KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš© (localStorage ë¬´ì‹œ) â˜…â˜…â˜…
      const isKPI = el.closest('.kpi-card') !== null || 
                   el.closest('#overview-kpi-4') !== null || 
                   el.closest('#overview-kpi-9') !== null ||
                   el.closest('#brand-kpi') !== null ||
                   (id && (id.includes('overview-') || id.includes('brand-')) && 
                    (id.includes('revenue') || id.includes('profit') || id.includes('opprofit') || id.includes('progress')));
      
      const isPL = el.closest('#overview-pl') !== null || 
                   el.closest('#brand-pl') !== null ||
                   el.closest('.pl-table') !== null;
      
      if (isKPI || isPL) {
        // KPIì™€ ì†ìµê³„ì‚°ì„œëŠ” í•­ìƒ JSON ë°ì´í„°ë§Œ ì‚¬ìš©
        el.textContent = defaultText;
        el.className = 'kpi-change editable ' + (val>=0?'kpi-positive':'kpi-negative');
        return;
      }
      
      // ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸
      const edits = localStorage.getItem(STORAGE_KEY);
      if (edits) {
        const data = JSON.parse(edits);
        const key = getElementKey(el);
        el.textContent = data[key] !== undefined ? data[key] : defaultText;
      } else {
        el.textContent = defaultText;
      }
      el.className = 'kpi-change editable ' + (val>=0?'kpi-positive':'kpi-negative');
    }

    // -------- ë¸Œëœë“œ ê¸°ì—¬ë„ ì°¨íŠ¸ (ë“œë¦´ë‹¤ìš´ ê¸°ëŠ¥) --------
    function createBrandContributionChart(labels, sales) {
      // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
      if(charts.brandContribution){ 
        charts.brandContribution.destroy(); 
        delete charts.brandContribution; 
      }
      
      charts.brandContribution = new Chart(document.getElementById('brandContributionChart').getContext('2d'),{
        type:'doughnut',
        data:{ 
          labels, 
          datasets:[{
            data:sales,
            backgroundColor:[
              'rgba(79,70,229,0.8)','rgba(124,58,237,0.8)','rgba(59,130,246,0.8)',
              'rgba(16,185,129,0.8)','rgba(245,158,11,0.8)','rgba(239,68,68,0.8)',
              'rgba(168,85,247,0.8)','rgba(34,197,94,0.8)','rgba(251,146,60,0.8)',
              'rgba(244,63,94,0.8)','rgba(156,163,175,0.8)'
            ],
            borderWidth:2
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{
            legend:{position:'bottom',labels:{font:{size:10}}},
            tooltip:{
              callbacks:{
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value.toFixed(1)}ì–µì› (${percentage}%)`;
                }
              }
            }
          },
          onClick: function(evt, elements) {
            if (elements.length > 0 && !isDrilledDown) {
              const index = elements[0].index;
              const brandName = labels[index];
              drillDownToChannels(brandName);
            }
          }
        }
      });
    }

    // ì±„ë„ë³„ ë“œë¦´ë‹¤ìš´
    function drillDownToChannels(brandName) {
      // brandDataì—ì„œ í•´ë‹¹ ë¸Œëœë“œì˜ ì±„ë„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandKey = getBrandKey(brandName);
      if (!brandData[brandKey] || !brandData[brandKey].channels) {
        alert('í•´ë‹¹ ë¸Œëœë“œì˜ ì±„ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const channels = brandData[brandKey].channels;
      // ACC, ë‹¹ì‹œì¦Œ, ê³¼ì‹œì¦Œì€ ì•„ì´í…œ ë¶„ë¥˜ì´ë¯€ë¡œ ì œì™¸
      const itemCategories = ['ACC', 'ë‹¹ì‹œì¦Œ', 'ê³¼ì‹œì¦Œ'];
      const channelNames = Object.keys(channels).filter(ch => !itemCategories.includes(ch));
      const channelSales = channelNames.map(ch => channels[ch].forecast || 0);
      
      // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      isDrilledDown = true;
      currentDrillBrand = brandName;
      
      if(charts.brandContribution){ 
        charts.brandContribution.destroy(); 
        delete charts.brandContribution; 
      }
      
      charts.brandContribution = new Chart(document.getElementById('brandContributionChart').getContext('2d'),{
        type:'doughnut',
        data:{ 
          labels: channelNames, 
          datasets:[{
            data: channelSales,
            backgroundColor:[
              'rgba(79,70,229,0.8)','rgba(124,58,237,0.8)','rgba(59,130,246,0.8)',
              'rgba(16,185,129,0.8)','rgba(245,158,11,0.8)','rgba(239,68,68,0.8)',
              'rgba(168,85,247,0.8)','rgba(34,197,94,0.8)','rgba(251,146,60,0.8)',
              'rgba(244,63,94,0.8)','rgba(156,163,175,0.8)'
            ],
            borderWidth:2
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{
            legend:{position:'bottom',labels:{font:{size:9}}},
            tooltip:{
              callbacks:{
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  const achievement = channels[label]?.achievement || '-';
                  return [
                    `${label}: ${value.toFixed(1)}ì–µì›`,
                    `ë¹„ì¤‘: ${percentage}%`,
                    `ë‹¬ì„±ë¥ : ${achievement}%`
                  ];
                }
              }
            }
          }
        }
      });
      
      // íƒ€ì´í‹€ ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸
      document.getElementById('contributionChartTitle').textContent = `${brandName} ì±„ë„ë³„ ë§¤ì¶œ ë¹„ì¤‘`;
      document.getElementById('drillbackBtn').style.display = 'inline-block';
    }

    // ë¸Œëœë“œëª…ì„ brandDataì˜ í‚¤ë¡œ ë³€í™˜
    function getBrandKey(brandName) {
      const mapping = {
        'MLB': 'MLB',
        'MLB KIDS': 'MLB_KIDS',
        'DISCOVERY': 'DISCOVERY',
        'DUVETICA': 'DUVETICA',
        'SERGIO': 'SERGIO',
        'SUPRA': 'SUPRA'
      };
      return mapping[brandName] || brandName;
    }

    // -------- ì „ì²´ í˜„í™© KPI í¬ë§·íŒ… ì¬ì ìš© (loadEdits í›„ í˜¸ì¶œ) --------
    function applyOverviewKPIFormatting() {
      // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ (ì†Œìˆ˜ì  ê³ ë ¤)
      const formatWithComma = (num) => {
        if (num === null || num === undefined || isNaN(num)) return '0.0';
        const formatted = Number(num).toFixed(1);
        const parts = formatted.split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return parts.join('.');
      };
      
      // overview KPI ìš”ì†Œë“¤ ì°¾ê¸°
      const revenueEl = document.getElementById('overview-revenue');
      const currentRevenueEl = document.getElementById('overview-current-revenue');
      const profitEl = document.getElementById('overview-profit');
      const currentProfitEl = document.getElementById('overview-current-profit');
      const opProfitEl = document.getElementById('overview-opprofit');
      const currentOpProfitEl = document.getElementById('overview-current-opprofit');
      
      // ê° ìš”ì†Œì˜ í˜„ì¬ í…ìŠ¤íŠ¸ì—ì„œ ìˆ«ì ì¶”ì¶œ í›„ í¬ë§·íŒ… ì¬ì ìš©
      if (revenueEl) {
        const text = revenueEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          revenueEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
      if (currentRevenueEl) {
        const text = currentRevenueEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          currentRevenueEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
      if (profitEl) {
        const text = profitEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          profitEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
      if (currentProfitEl) {
        const text = currentProfitEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          currentProfitEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
      if (opProfitEl) {
        const text = opProfitEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          opProfitEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
      if (currentOpProfitEl) {
        const text = currentOpProfitEl.textContent;
        const match = text.match(/([\d,]+\.?\d*)/);
        if (match) {
          const num = parseFloat(match[1].replace(/,/g, ''));
          currentOpProfitEl.textContent = `${formatWithComma(num)}ì–µì›`;
        }
      }
    }

    // -------- ì „ì²´ í˜„í™© ì°¨íŠ¸ --------
    function initOverviewCharts(){
      // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
      ['brandRevenue','brandContribution','brandAllRadar','waterfall','cumulativeTrend'].forEach(n=>{
        if(charts[n]){ charts[n].destroy(); delete charts[n]; }
      });

      // KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ - overviewKPI ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ window.overviewPL ì‚¬ìš©
      const kpi = (typeof window.overviewKPI !== 'undefined' && window.overviewKPI.OVERVIEW) ? window.overviewKPI.OVERVIEW : null;
      const pl = (window.overviewPL) ? window.overviewPL : null;
      
      if (kpi) {
        // overviewKPI ë°ì´í„° ì‚¬ìš© (brand_kpiì™€ ë™ì¼í•œ êµ¬ì¡°)
        // ì› ë‹¨ìœ„ â†’ ì–µì› ë‹¨ìœ„ ë³€í™˜
        const revenueForecast = (kpi.revenueForecast || 0) / 100000000;
        const revenueCurrent = (kpi.revenue || 0) / 100000000;
        const revenuePlan = (kpi.revenuePlan || 0) / 100000000;
        const revenuePrev = (kpi.revenuePrevious || 0) / 100000000;
        
        const profitForecast = (kpi.directProfitForecast || 0) / 100000000;
        const profitCurrent = (kpi.directProfit || 0) / 100000000;
        const profitPrev = (kpi.directProfitPrevious || 0) / 100000000;
        
        // ì˜ì—…ì´ìµ (overviewKPI ì‚¬ìš©)
        const opProfitForecast = (kpi.operatingProfitForecast || 0) / 100000000;
        const opProfitCurrent = (kpi.operatingProfit || 0) / 100000000;
        const opProfitPlan = (pl && pl.opProfit && pl.opProfit.target) ? pl.opProfit.target : 0;
        const opProfitPrev = (kpi.operatingProfitPrevious || 0) / 100000000;
        
        // ì‹¤íŒë§¤ì¶œ
        const revenueEl = document.getElementById('overview-revenue');
        const currentRevenueEl = document.getElementById('overview-current-revenue');
        const discountRateEl = document.getElementById('overview-discount-rate');
        const currentDiscountRateEl = document.getElementById('overview-current-discount-rate');
        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ (ì†Œìˆ˜ì  ê³ ë ¤)
        const formatWithComma = (num) => {
          const formatted = num.toFixed(1);
          const parts = formatted.split('.');
          parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          return parts.join('.');
        };
        if (revenueEl) revenueEl.textContent = `${formatWithComma(revenueForecast)}ì–µì›`;
        if (currentRevenueEl) currentRevenueEl.textContent = `${formatWithComma(revenueCurrent)}ì–µì›`;
        // í• ì¸ìœ¨ í‘œì‹œ (ë³´ë¼ìƒ‰)
        if (discountRateEl && kpi.discountRateForecast !== undefined) {
          discountRateEl.textContent = `(${kpi.discountRateForecast.toFixed(1)}%)`;
          discountRateEl.style.color = '#8b5cf6';
          discountRateEl.style.fontWeight = '600';
        }
        if (currentDiscountRateEl && kpi.discountRate !== undefined) {
          currentDiscountRateEl.textContent = `(${kpi.discountRate.toFixed(1)}%)`;
          currentDiscountRateEl.style.color = '#8b5cf6';
          currentDiscountRateEl.style.fontWeight = '600';
        }
        
        // ì§ì ‘ì´ìµ
        const profitEl = document.getElementById('overview-profit');
        const currentProfitEl = document.getElementById('overview-current-profit');
        const profitMarginRateEl = document.getElementById('overview-profit-margin-rate');
        const currentProfitMarginRateEl = document.getElementById('overview-current-profit-margin-rate');
        if (profitEl) profitEl.textContent = `${formatWithComma(profitForecast)}ì–µì›`;
        if (currentProfitEl) currentProfitEl.textContent = `${formatWithComma(profitCurrent)}ì–µì›`;
        // ì§ì ‘ì´ìµìœ¨ í‘œì‹œ
        if (profitMarginRateEl && kpi.directProfitRateForecast !== undefined) {
          profitMarginRateEl.textContent = `(${kpi.directProfitRateForecast.toFixed(1)}%)`;
          profitMarginRateEl.style.color = '#8b5cf6';
          profitMarginRateEl.style.fontWeight = '600';
        }
        if (currentProfitMarginRateEl && kpi.directProfitRate !== undefined) {
          currentProfitMarginRateEl.textContent = `(${kpi.directProfitRate.toFixed(1)}%)`;
          currentProfitMarginRateEl.style.color = '#8b5cf6';
          currentProfitMarginRateEl.style.fontWeight = '600';
        }
        
        // ì˜ì—…ì´ìµ
        const opProfitEl = document.getElementById('overview-opprofit');
        const currentOpProfitEl = document.getElementById('overview-current-opprofit');
        const opProfitMarginRateEl = document.getElementById('overview-opprofit-margin-rate');
        const currentOpProfitMarginRateEl = document.getElementById('overview-current-opprofit-margin-rate');
        if (opProfitEl) opProfitEl.textContent = `${formatWithComma(opProfitForecast)}ì–µì›`;
        if (currentOpProfitEl) currentOpProfitEl.textContent = `${formatWithComma(opProfitCurrent)}ì–µì›`;
        // ì˜ì—…ì´ìµìœ¨ í‘œì‹œ
        if (opProfitMarginRateEl && kpi.operatingProfitRateForecast !== undefined) {
          opProfitMarginRateEl.textContent = `(${kpi.operatingProfitRateForecast.toFixed(1)}%)`;
          opProfitMarginRateEl.style.color = '#8b5cf6';
          opProfitMarginRateEl.style.fontWeight = '600';
        }
        if (currentOpProfitMarginRateEl && kpi.operatingProfitRate !== undefined) {
          currentOpProfitMarginRateEl.textContent = `(${kpi.operatingProfitRate.toFixed(1)}%)`;
          currentOpProfitMarginRateEl.style.color = '#8b5cf6';
          currentOpProfitMarginRateEl.style.fontWeight = '600';
        }
        
        // ëª©í‘œ ëŒ€ë¹„, ì „ë…„ ëŒ€ë¹„ ê³„ì‚° (JSONì˜ ê³„ì‚°ê°’ ì‚¬ìš©)
        const revenueChangeEl = document.getElementById('overview-revenue-change');
        const revenueYoyEl = document.getElementById('overview-revenue-yoy');
        const revenueProgressEl = document.getElementById('overview-revenue-progress');
        if (revenueChangeEl && kpi.revenueVsPlan !== undefined) {
          // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
          const revenueVsPlanRatio = 100 + kpi.revenueVsPlan; // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          revenueChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${revenueVsPlanRatio.toFixed(1)}%`;
          revenueChangeEl.className = revenueVsPlanRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (revenueYoyEl && kpi.revenueVsPrevious !== undefined) {
          // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
          const revenueVsPreviousRatio = 100 + kpi.revenueVsPrevious; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          revenueYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${revenueVsPreviousRatio.toFixed(1)}%`;
          revenueYoyEl.className = revenueVsPreviousRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (revenueProgressEl && revenuePlan > 0) {
          const progress = Math.min(100, (revenueForecast / revenuePlan) * 100);
          revenueProgressEl.style.width = `${progress}%`;
        }
        
        const profitChangeEl = document.getElementById('overview-profit-change');
        const profitYoyEl = document.getElementById('overview-profit-yoy');
        const profitProgressEl = document.getElementById('overview-profit-progress');
        if (profitChangeEl && kpi.profitVsPlan !== undefined) {
          // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
          const profitVsPlanRatio = 100 + kpi.profitVsPlan; // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          profitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${profitVsPlanRatio.toFixed(1)}%`;
          profitChangeEl.className = profitVsPlanRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (profitYoyEl && kpi.profitVsPrevious !== undefined) {
          // ì°¨ì´(%)ë¥¼ ë¹„ìœ¨(%)ë¡œ ë³€í™˜: ë¹„ìœ¨ = 100 + ì°¨ì´
          const profitVsPreviousRatio = 100 + kpi.profitVsPrevious; // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          profitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${profitVsPreviousRatio.toFixed(1)}%`;
          profitYoyEl.className = profitVsPreviousRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (profitProgressEl && revenuePlan > 0 && kpi.directProfitPlan > 0) {
          const progress = Math.min(100, (profitForecast / (kpi.directProfitPlan / 100000000)) * 100);
          profitProgressEl.style.width = `${progress}%`;
        }
        
        const opProfitChangeEl = document.getElementById('overview-opprofit-change');
        const opProfitYoyEl = document.getElementById('overview-opprofit-yoy');
        const opProfitProgressEl = document.getElementById('overview-opprofit-progress');
        if (opProfitChangeEl && opProfitPlan > 0) {
          // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          const vsTargetRatio = (opProfitForecast / opProfitPlan) * 100;
          opProfitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${vsTargetRatio.toFixed(1)}%`;
          opProfitChangeEl.className = vsTargetRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (opProfitYoyEl && opProfitPrev > 0) {
          // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          const vsYoyRatio = (opProfitForecast / opProfitPrev) * 100;
          opProfitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${vsYoyRatio.toFixed(1)}%`;
          opProfitYoyEl.className = vsYoyRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (opProfitProgressEl && opProfitPlan > 0) {
          const progress = Math.min(100, (opProfitForecast / opProfitPlan) * 100);
          opProfitProgressEl.style.width = `${progress}%`;
        }
        
        // ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ (ì§ì ‘ì´ìµ ê¸°ì¤€: ì§ì ‘ì´ìµ/ê³„íšì§ì ‘ì´ìµ*100)
        const progressEl = document.getElementById('overview-progress');
        const currentProgressEl = document.getElementById('overview-current-progress');
        const progressProgressEl = document.getElementById('overview-progress-progress');
        const progressChangeEl = document.getElementById('overview-progress-change');
        const progressYoyEl = document.getElementById('overview-progress-yoy');
        
        // JSONì— ì´ë¯¸ ê³„ì‚°ëœ ì§„ì²™ìœ¨ ê°’ ì‚¬ìš©
        // í˜„ì‹œì  ì§ì ‘ì´ìµ ì§„ì²™ìœ¨ = ke30 ì§ì ‘ì´ìµ / ê³„íš ì§ì ‘ì´ìµ Ã— 100
        // ì›”ë§ì˜ˆìƒ ì§ì ‘ì´ìµ ì§„ì²™ìœ¨ = forecast ì§ì ‘ì´ìµ / ê³„íš ì§ì ‘ì´ìµ Ã— 100
        const directProfitPlan = (kpi.directProfitPlan || 0) / 100000000; // ì› â†’ ì–µì› ë³€í™˜
        const progressRateCurrent = directProfitPlan > 0 ? (profitCurrent / directProfitPlan) * 100 : 0;
        const progressRateForecast = directProfitPlan > 0 ? (profitForecast / directProfitPlan) * 100 : 0;
        
        console.log('[Dashboard] ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ (kpi ë¸”ë¡) - progressRate:', progressRateCurrent, 'progressRateForecast:', progressRateForecast);
        
        if (progressEl) progressEl.textContent = `${progressRateForecast.toFixed(1)}%`;
        if (currentProgressEl) currentProgressEl.textContent = `${progressRateCurrent.toFixed(1)}%`;
        if (progressProgressEl) {
          progressProgressEl.style.width = `${Math.min(100, progressRateForecast)}%`;
        }
        // ëª©í‘œ ëŒ€ë¹„ì™€ ì „ë…„ëŒ€ë¹„ ìˆ¨ê¹€ ì²˜ë¦¬ (ìë¦¬ëŠ” ê³µë°±ìœ¼ë¡œ ìœ ì§€ - ìµœì†Œ ë†’ì´ ë³´ì¥)
        if (progressChangeEl) {
          progressChangeEl.textContent = '\u00A0'; // non-breaking space
          progressChangeEl.style.minHeight = '20px'; // ìµœì†Œ ë†’ì´ ë³´ì¥
          progressChangeEl.style.display = 'block'; // ë¸”ë¡ ìš”ì†Œë¡œ í™•ì‹¤íˆ í‘œì‹œ
        }
        if (progressYoyEl) {
          progressYoyEl.textContent = '\u00A0'; // non-breaking space
          progressYoyEl.style.minHeight = '20px'; // ìµœì†Œ ë†’ì´ ë³´ì¥
          progressYoyEl.style.display = 'block'; // ë¸”ë¡ ìš”ì†Œë¡œ í™•ì‹¤íˆ í‘œì‹œ
        }
        
        console.log('[Dashboard] ì „ì²´ í˜„í™© KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ (overviewKPI ì‚¬ìš©) - ì‹¤íŒë§¤ì¶œ:', revenueForecast.toFixed(1), 'ì–µì›');
      } else if (pl) {
        // í´ë°±: window.overviewPL ë°ì´í„° ì‚¬ìš© (ê¸°ì¡´ ë°©ì‹)
        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ (ì†Œìˆ˜ì  ê³ ë ¤)
        const formatWithComma = (num) => {
          const formatted = num.toFixed(1);
          const parts = formatted.split('.');
          parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          return parts.join('.');
        };
        // ì‹¤íŒë§¤ì¶œ (ì›”ë§ì˜ˆìƒ)
        const revenueEl = document.getElementById('overview-revenue');
        const currentRevenueEl = document.getElementById('overview-current-revenue');
        if (revenueEl && pl.revenue) {
          revenueEl.textContent = `${formatWithComma(pl.revenue.forecast)}ì–µì›`;
        }
        if (currentRevenueEl && pl.revenue) {
          currentRevenueEl.textContent = `${formatWithComma(pl.revenue.forecast)}ì–µì›`;
        }
        // ëª©í‘œ ëŒ€ë¹„, ì „ë…„ ëŒ€ë¹„
        const revenueChangeEl = document.getElementById('overview-revenue-change');
        const revenueYoyEl = document.getElementById('overview-revenue-yoy');
        const revenueProgressEl = document.getElementById('overview-revenue-progress');
        if (revenueChangeEl && pl.revenue.target > 0) {
          // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          const vsTargetRatio = (pl.revenue.forecast / pl.revenue.target) * 100;
          revenueChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${vsTargetRatio.toFixed(1)}%`;
          revenueChangeEl.className = vsTargetRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (revenueYoyEl && pl.revenue.prev > 0) {
          // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          const vsYoyRatio = (pl.revenue.forecast / pl.revenue.prev) * 100;
          revenueYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${vsYoyRatio.toFixed(1)}%`;
          revenueYoyEl.className = vsYoyRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (revenueProgressEl && pl.revenue.target > 0) {
          const progress = Math.min(100, (pl.revenue.forecast / pl.revenue.target) * 100);
          revenueProgressEl.style.width = `${progress}%`;
        }
        
        // ì§ì ‘ì´ìµ
        const profitEl = document.getElementById('overview-profit');
        const currentProfitEl = document.getElementById('overview-current-profit');
        if (profitEl && pl.directProfit) {
          profitEl.textContent = `${formatWithComma(pl.directProfit.forecast)}ì–µì›`;
        }
        if (currentProfitEl && pl.directProfit) {
          currentProfitEl.textContent = `${formatWithComma(pl.directProfit.forecast)}ì–µì›`;
        }
        const profitChangeEl = document.getElementById('overview-profit-change');
        const profitYoyEl = document.getElementById('overview-profit-yoy');
        const profitProgressEl = document.getElementById('overview-profit-progress');
        if (profitChangeEl && pl.directProfit.target > 0) {
          // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          const vsTargetRatio = (pl.directProfit.forecast / pl.directProfit.target) * 100;
          profitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${vsTargetRatio.toFixed(1)}%`;
          profitChangeEl.className = vsTargetRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (profitYoyEl && pl.directProfit.prev > 0) {
          // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          const vsYoyRatio = (pl.directProfit.forecast / pl.directProfit.prev) * 100;
          profitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${vsYoyRatio.toFixed(1)}%`;
          profitYoyEl.className = vsYoyRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (profitProgressEl && pl.directProfit.target > 0) {
          const progress = Math.min(100, (pl.directProfit.forecast / pl.directProfit.target) * 100);
          profitProgressEl.style.width = `${progress}%`;
        }
        
        // ì˜ì—…ì´ìµ
        const opProfitEl = document.getElementById('overview-opprofit');
        const currentOpProfitEl = document.getElementById('overview-current-opprofit');
        if (opProfitEl && pl.opProfit) {
          opProfitEl.textContent = `${formatWithComma(pl.opProfit.forecast)}ì–µì›`;
        }
        if (currentOpProfitEl && pl.opProfit) {
          currentOpProfitEl.textContent = `${formatWithComma(pl.opProfit.forecast)}ì–µì›`;
        }
        const opProfitChangeEl = document.getElementById('overview-opprofit-change');
        const opProfitYoyEl = document.getElementById('overview-opprofit-yoy');
        const opProfitProgressEl = document.getElementById('overview-opprofit-progress');
        if (opProfitChangeEl && pl.opProfit.target > 0) {
          // ëª©í‘œëŒ€ë¹„ = ë‹¹ë…„/ê³„íš (ë¹„ìœ¨%)
          const vsTargetRatio = (pl.opProfit.forecast / pl.opProfit.target) * 100;
          opProfitChangeEl.textContent = `ëª©í‘œëŒ€ë¹„ ${vsTargetRatio.toFixed(1)}%`;
          opProfitChangeEl.className = vsTargetRatio >= 100 ? 'kpi-change-line kpi-positive' : 'kpi-change-line kpi-negative';
        }
        if (opProfitYoyEl && pl.opProfit.prev > 0) {
          // ì „ë…„ëŒ€ë¹„ = ë‹¹ë…„/ì „ë…„ (ë¹„ìœ¨%)
          const vsYoyRatio = (pl.opProfit.forecast / pl.opProfit.prev) * 100;
          opProfitYoyEl.textContent = `ì „ë…„ëŒ€ë¹„ ${vsYoyRatio.toFixed(1)}%`;
          opProfitYoyEl.className = vsYoyRatio >= 100 ? 'kpi-change kpi-positive' : 'kpi-change kpi-negative';
        }
        if (opProfitProgressEl && pl.opProfit.target > 0) {
          const progress = Math.min(100, (pl.opProfit.forecast / pl.opProfit.target) * 100);
          opProfitProgressEl.style.width = `${progress}%`;
        }
        
        // ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ (ì§ì ‘ì´ìµ ê¸°ì¤€: ì§ì ‘ì´ìµ/ê³„íšì§ì ‘ì´ìµ*100)
        const progressEl = document.getElementById('overview-progress');
        const currentProgressEl = document.getElementById('overview-current-progress');
        const progressProgressEl = document.getElementById('overview-progress-progress');
        const progressChangeEl = document.getElementById('overview-progress-change');
        const progressYoyEl = document.getElementById('overview-progress-yoy');
        
        if (pl && pl.directProfit && pl.directProfit.target > 0) {
          // í´ë°±: window.overviewPL ì‚¬ìš© (ì§ì ‘ì´ìµ ê¸°ì¤€)
          // í˜„ì‹œì  ì§ì ‘ì´ìµ ì§„ì²™ìœ¨ = ke30 ì§ì ‘ì´ìµ / ê³„íš ì§ì ‘ì´ìµ Ã— 100
          const directProfitCurrent = pl.directProfit.current || pl.directProfit.forecast || 0;
          const directProfitPlan = pl.directProfit.target || 0;
          const progressRateCurrent = directProfitPlan > 0 ? (directProfitCurrent / directProfitPlan) * 100 : 0;
          
          // ì›”ë§ì˜ˆìƒ ì§ì ‘ì´ìµ ì§„ì²™ìœ¨ = forecast ì§ì ‘ì´ìµ / ê³„íš ì§ì ‘ì´ìµ Ã— 100
          const directProfitForecast = pl.directProfit.forecast || 0;
          const progressRateForecast = directProfitPlan > 0 ? (directProfitForecast / directProfitPlan) * 100 : 0;
          
          console.log('[Dashboard] ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ (í´ë°±) - pl:', pl, 'progressRate:', progressRateCurrent, 'progressRateForecast:', progressRateForecast);
          
          if (progressEl) progressEl.textContent = `${progressRateForecast.toFixed(1)}%`;
          if (currentProgressEl) currentProgressEl.textContent = `${progressRateCurrent.toFixed(1)}%`;
          if (progressProgressEl) {
            progressProgressEl.style.width = `${Math.min(100, progressRateForecast)}%`;
          }
          // ëª©í‘œ ëŒ€ë¹„ì™€ ì „ë…„ëŒ€ë¹„ ìˆ¨ê¹€ ì²˜ë¦¬ (ìë¦¬ëŠ” ê³µë°±ìœ¼ë¡œ ìœ ì§€)
          if (progressChangeEl) progressChangeEl.textContent = ' ';
          if (progressYoyEl) progressYoyEl.textContent = ' ';
        } else {
          console.warn('[Dashboard] ì§„ì²™ìœ¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ - pl:', pl);
          // ëª©í‘œ ëŒ€ë¹„ì™€ ì „ë…„ëŒ€ë¹„ ìˆ¨ê¹€ ì²˜ë¦¬ (ìë¦¬ëŠ” ê³µë°±ìœ¼ë¡œ ìœ ì§€)
          if (progressChangeEl) progressChangeEl.textContent = ' ';
          if (progressYoyEl) progressYoyEl.textContent = ' ';
        }
        
        console.log('[Dashboard] KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ (overviewPL ì‚¬ìš©) - ì‹¤íŒë§¤ì¶œ:', pl.revenue.forecast.toFixed(1), 'ì–µì›');
      } else {
        console.warn('[Dashboard] window.overviewPL ë°ì´í„°ê°€ ì—†ì–´ KPI ì¹´ë“œë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.log('[Dashboard] overviewPL:', window.overviewPL, 'overviewKPI:', window.overviewKPI);
      }

      // ë°ì´í„° ì†ŒìŠ¤: ìš°ì„ ìˆœìœ„ data.js â†’ í´ë°± í•˜ë“œì½”ë”©
      // SUPRA ë¸Œëœë“œëŠ” ë°ì´í„°ì—ëŠ” í¬í•¨í•˜ë˜ ì°¨íŠ¸ì—ì„œëŠ” ì œì™¸
      const rows = Array.isArray(window.by_brand) ? window.by_brand : null;
      const allLabels = rows ? rows.map(r=> (r.BRAND||r.brand||r.name) ) : ['MLB','MLB KIDS','DISCOVERY','DUVETICA','SERGIO','SUPRA'];
      const allSales  = rows ? rows.map(r=> Number(r.SALES||r.sales||r.revenue||0) ) : [349.3,79.5,403.2,38.7,8.4,2.5];
      const allProfit = rows ? rows.map(r=> Number(r.OPERATING_PROFIT||r.operatingProfit||r.profit||0) ) : [51.1,-4.5,26.7,1.9,-8.5,-3.2];
      const allAchieve = rows ? rows.map(r=> Number(r.ACHIEVEMENT||r.achievement||0) ) : [88,93,92,89,108,92];
      const allYoyGrowth = rows ? rows.map(r=> Number(r.YOY_SALES||r.yoy||100)-100 ) : [ -15, 12, -2, -15, 25, -12 ];
      
      // SUPRA ì œì™¸í•œ ë°ì´í„° (ì°¨íŠ¸ í‘œì‹œìš©)
      const labels = allLabels.filter(l => l !== 'SUPRA');
      const sales = allSales.filter((s, idx) => allLabels[idx] !== 'SUPRA');
      const profit = allProfit.filter((p, idx) => allLabels[idx] !== 'SUPRA');
      const achieve = allAchieve.filter((a, idx) => allLabels[idx] !== 'SUPRA');
      const yoyGrowth = allYoyGrowth.filter((y, idx) => allLabels[idx] !== 'SUPRA');

      // ë¸Œëœë“œë³„ ë§¤ì¶œ/ì´ìµ
      charts.brandRevenue = new Chart(document.getElementById('brandRevenueChart').getContext('2d'),{
        type:'bar',
        data:{ labels, datasets:[
          {label:'ë§¤ì¶œ (ì–µì›)',data:sales,backgroundColor:'rgba(79,70,229,0.8)',borderColor:'rgba(79,70,229,1)',borderWidth:1,yAxisID:'y'},
          {label:'ì˜ì—…ì´ìµ (ì–µì›)',data:profit,backgroundColor:'rgba(124,58,237,0.8)',borderColor:'rgba(124,58,237,1)',borderWidth:1,yAxisID:'y1'}
        ]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{font:{size:11}}}},scales:{
          y:{type:'linear',display:true,position:'left',title:{display:true,text:'ë§¤ì¶œ (ì–µì›)',font:{size:10}},ticks:{font:{size:9}}},
          y1:{type:'linear',display:true,position:'right',title:{display:true,text:'ì˜ì—…ì´ìµ (ì–µì›)',font:{size:10}},grid:{drawOnChartArea:false},ticks:{font:{size:9}}},
          x:{ticks:{font:{size:9}}}
        }}
      });

      // ì „ì²´ ë¸Œëœë“œ ë ˆì´ë” ì°¨íŠ¸
      initAllBrandsRadarChart();
      

      // Waterfall ì°¨íŠ¸ (ì†ìµ êµ¬ì¡°) - window.overviewPL ë°ì´í„° ì‚¬ìš©
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ì§€ ì•ŠìŒ
      if (window.overviewPL && window.overviewPL.revenue) {
        const plData = window.overviewPL;
        const plRevenue = plData.revenue.forecast || 0;
        const plCogs = plData.cog.forecast || 0;
        const plGrossProfit = plData.grossProfit.forecast || (plRevenue - plCogs);
        const plDirectCost = plData.directCost.forecast || 0;
        const plDirectProfit = plData.directProfit.forecast || (plGrossProfit - plDirectCost);
        const plOpExpense = plData.operatingExpense.forecast || 0;
        const plOpProfit = plData.opProfit.forecast || (plDirectProfit - plOpExpense);
        
        // ë§¤ì¶œëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜ (ê° í•­ëª© / ì‹¤íŒë§¤ì¶œ * 1.1)
        const calcRevenueRate = (value) => {
          if (plRevenue === 0) return 0;
          return (value / plRevenue) * 1.1 * 100;
        };
        
        // Waterfall ë°ì´í„° ê³„ì‚° (7ë‹¨ê³„) - ì‹¤íŒë§¤ì¶œ ê¸°ì¤€ ìœ„ì—ì„œ ì°¨ê°
        const waterfallData = [
          {label: 'ì‹¤íŒë§¤ì¶œ', value: plRevenue, base: 0, amount: plRevenue, type: 'total', display: plRevenue.toFixed(1), rate: calcRevenueRate(plRevenue)},
          {label: 'ë§¤ì¶œì›ê°€\n(-)', value: plCogs, base: plGrossProfit, amount: plCogs, type: 'decrease', display: plCogs.toFixed(1), startVal: plRevenue, endVal: plGrossProfit, rate: calcRevenueRate(plCogs)},
          {label: 'ë§¤ì¶œì´ì´ìµ', value: plGrossProfit, base: 0, amount: plGrossProfit, type: 'subtotal', display: plGrossProfit.toFixed(1), rate: calcRevenueRate(plGrossProfit)},
          {label: 'ì§ì ‘ë¹„\n(-)', value: plDirectCost, base: plDirectProfit, amount: plDirectCost, type: 'decrease', display: plDirectCost.toFixed(1), startVal: plGrossProfit, endVal: plDirectProfit, rate: calcRevenueRate(plDirectCost)},
          {label: 'ì§ì ‘ì´ìµ', value: plDirectProfit, base: 0, amount: plDirectProfit, type: 'subtotal', display: plDirectProfit.toFixed(1), rate: calcRevenueRate(plDirectProfit)},
          {label: 'ì˜ì—…ë¹„\n(-)', value: plOpExpense, base: plOpProfit, amount: plOpExpense, type: 'decrease', display: plOpExpense === 0 ? '0.0' : plOpExpense.toFixed(1), startVal: plDirectProfit, endVal: plOpProfit, rate: calcRevenueRate(plOpExpense)},
          {label: 'ì˜ì—…ì´ìµ', value: plOpProfit, base: 0, amount: plOpProfit, type: 'result', display: plOpProfit.toFixed(1), rate: calcRevenueRate(plOpProfit)}
        ];
        
        // Chart.js Waterfall êµ¬í˜„ (ì‹¤íŒë§¤ì¶œ ê¸°ì¤€ ìœ„ì—ì„œ ì°¨ê°)
        charts.waterfall = new Chart(document.getElementById('waterfallChart').getContext('2d'),{
          type:'bar',
          data:{
            labels: waterfallData.map(d => {
              // ë¼ë²¨ì— ë§¤ì¶œëŒ€ë¹„ ë¹„ìœ¨ ì¶”ê°€ (ì‹¤íŒë§¤ì¶œ ì œì™¸)
              if (d.type === 'total') {
                return d.label;
              }
              const rateText = d.rate.toFixed(1) + '%';
              return d.label.includes('\n') 
                ? d.label.replace('\n', `\n(${rateText})\n`) 
                : `${d.label}\n(${rateText})`;
            }),
            datasets: [
              {
                label: 'ê¸°ì¤€ì„  (íˆ¬ëª…)',
                data: waterfallData.map(d => d.base),
                backgroundColor: 'rgba(0,0,0,0)',
                borderWidth: 0
              },
              {
                label: 'ê¸ˆì•¡',
                data: waterfallData.map(d => d.amount),
                backgroundColor: waterfallData.map(d => {
                  if (d.type === 'total') return 'rgba(16,185,129,0.85)';
                  if (d.type === 'decrease') return 'rgba(239,68,68,0.85)';
                  if (d.type === 'subtotal') return 'rgba(59,130,246,0.85)';
                  return 'rgba(79,70,229,0.85)';
                }),
                borderColor: waterfallData.map(d => {
                  if (d.type === 'total') return 'rgba(16,185,129,1)';
                  if (d.type === 'decrease') return 'rgba(239,68,68,1)';
                  if (d.type === 'subtotal') return 'rgba(59,130,246,1)';
                  return 'rgba(79,70,229,1)';
                }),
                borderWidth: 2,
                barThickness: 50
              }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{display:false},
              tooltip:{
                callbacks:{
                  title: function(context) {
                    return waterfallData[context[0].dataIndex].label.replace('\n', ' ');
                  },
                  label: function(context) {
                    const idx = context.dataIndex;
                    const d = waterfallData[idx];
                    if (d.type === 'decrease') {
                      return [
                        `${d.startVal.toFixed(1)}ì–µì› â†’ ${d.endVal.toFixed(1)}ì–µì›`,
                        `ì°¨ê°: -${d.display}ì–µì›`
                      ];
                    }
                    return `ê¸ˆì•¡: ${d.display}ì–µì›`;
                  },
                  afterLabel: function(context) {
                    const idx = context.dataIndex;
                    const d = waterfallData[idx];
                    if (d.type === 'decrease') {
                      return `ë§¤ì¶œëŒ€ë¹„: ${d.rate.toFixed(1)}%`;
                    }
                    if (d.type === 'result') {
                      return `ë§¤ì¶œëŒ€ë¹„: ${d.rate.toFixed(1)}%`;
                    }
                    if (d.type === 'subtotal' || d.type === 'total') {
                      return `ë§¤ì¶œëŒ€ë¹„: ${d.rate.toFixed(1)}%`;
                    }
                    return '';
                  }
                }
              }
            },
            scales:{
              x:{
                stacked:true,
                ticks:{font:{size:9}, maxRotation: 0, minRotation: 0}
              },
              y:{
                stacked:true,
                beginAtZero:true,
                max: plRevenue,  // ì‹¤íŒë§¤ì¶œê¹Œì§€ë§Œ í‘œì‹œ
                title:{display:true,text:'ê¸ˆì•¡ (ì–µì›)',font:{size:11}},
                ticks:{
                  font:{size:9},
                  callback: function(value) {
                    return value.toFixed(0);
                  }
                },
                grid:{
                  color: function(context) {
                    // Yì¶• ì£¼ìš” ë¼ì¸ ê°•ì¡°
                    if (Math.abs(context.tick.value - plRevenue) < 0.1 || 
                        Math.abs(context.tick.value - plGrossProfit) < 0.1 || 
                        Math.abs(context.tick.value - plDirectProfit) < 0.1 ||
                        context.tick.value === 0) {
                      return 'rgba(0,0,0,0.2)';
                    }
                    return 'rgba(0,0,0,0.05)';
                  }
                }
              }
            }
          }
        });
      } else {
        console.warn('[Dashboard] window.overviewPL ë°ì´í„°ê°€ ì—†ì–´ Waterfall ì°¨íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }

      // ì›”ì¤‘ ëˆ„ì  ë§¤ì¶œ ì¶”ì´ - window.cumulativeTrendData ì‚¬ìš©
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ì§€ ì•ŠìŒ
      if (window.cumulativeTrendData && window.cumulativeTrendData.weeks) {
        const trendData = window.cumulativeTrendData;
        const weeks = trendData.weeks;
        const forecastActual = trendData.cumulative_current;
        const prevSales = trendData.cumulative_prev;
        
        charts.cumulativeTrend = new Chart(document.getElementById('cumulativeTrendChart').getContext('2d'),{
          type:'line',
          data:{
            labels: weeks,
            datasets:[
              {
                label:'ë‹¹ë…„ ëˆ„ì ',
                data: forecastActual,
                borderColor:'rgba(124,58,237,1)',
                backgroundColor:'rgba(124,58,237,0.1)',
                borderWidth:3,
                fill:false,
                tension:0.3,
                pointRadius:5,
                pointHoverRadius:7,
                spanGaps:false
              },
              {
                label:'ì „ë…„ ëˆ„ì ',
                data: prevSales,
                borderColor:'rgba(220,38,38,1)',
                backgroundColor:'rgba(220,38,38,0.1)',
                borderWidth:2.5,
                fill:false,
                tension:0.3,
                pointRadius:4,
                pointHoverRadius:6
              }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{
                position:'top',
                labels:{font:{size:10}}
              },
              tooltip:{
                callbacks:{
                  label: function(context) {
                    const label = context.dataset.label || '';
                    const value = context.parsed.y;
                    if (value === null) return '';
                    // ë°±ë§Œì› ë‹¨ìœ„ â†’ ì–µì› ë‹¨ìœ„ë¡œ í‘œì‹œ
                    return `${label}: ${(value / 100).toFixed(1)}ì–µì›`;
                  }
                }
              }
            },
            scales:{
              y:{
                type:'linear',
                display:true,
                position:'left',
                title:{display:true,text:'ëˆ„ì  ë§¤ì¶œ (ë°±ë§Œì›)',font:{size:11}},
                ticks:{font:{size:10}},
                beginAtZero:true
              },
              x:{ticks:{font:{size:10}}}
            }
          }
        });
      } else {
        console.warn('[Dashboard] window.cumulativeTrendData ë°ì´í„°ê°€ ì—†ì–´ ì›”ì¤‘ëˆ„ì ë§¤ì¶œì¶”ì´ ì°¨íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }

      // ê°œìš” ì„¹ì…˜: ì£¼ì°¨ë³„/ëˆ„ì  í† ê¸€ UI/ë¡œì§ ë³´ê°•
      ensureOverviewToggleUI();
      
      // ë²„ë¸” ì°¨íŠ¸ ì´ˆê¸°í™” (ë°ì´í„° ë¡œë“œ í›„ì—ë§Œ ì‹¤í–‰)
      // jsonDataLoaded ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ìŠ¤í‚µ
      // initOverviewBubbleChart();
      
      // ì „ì²´í˜„í™© íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ë²„íŠ¼ ì´ˆê¸°í™”
      initOverviewModeButtons();
    }
    
    // -------- ì „ì²´í˜„í™© íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ ê´€ë¦¬ --------
    let overviewMode = 'sale'; // 'sale' | 'inventory' (ê¸°ë³¸ê°’: íŒë§¤ìœ¨)
    
    function initOverviewModeButtons(){
      const btnSaleRate = document.getElementById('overviewBtnSaleRate');
      const btnInventory = document.getElementById('overviewBtnInventory');
      
      if(btnSaleRate && !btnSaleRate.hasAttribute('data-listener')){
        btnSaleRate.setAttribute('data-listener','true');
        btnSaleRate.addEventListener('click', ()=>{ 
          overviewMode = 'sale'; 
          updateOverviewModeButtons(); 
          updateOverviewModeView(); 
        });
      }
      if(btnInventory && !btnInventory.hasAttribute('data-listener')){
        btnInventory.setAttribute('data-listener','true');
        btnInventory.addEventListener('click', ()=>{ 
          overviewMode = 'inventory'; 
          updateOverviewModeButtons(); 
          updateOverviewModeView(); 
        });
      }
      updateOverviewModeButtons();
      updateOverviewModeView();
    }
    
    function updateOverviewModeButtons(){
      const btnSaleRate = document.getElementById('overviewBtnSaleRate');
      const btnInventory = document.getElementById('overviewBtnInventory');
      
      if(btnSaleRate){
        if(overviewMode==='sale'){ 
          btnSaleRate.style.background='#2563eb'; 
          btnSaleRate.style.color='#fff'; 
        } else { 
          btnSaleRate.style.background='#e5e7eb'; 
          btnSaleRate.style.color='#374151'; 
        }
      }
      if(btnInventory){
        if(overviewMode==='inventory'){ 
          btnInventory.style.background='#2563eb'; 
          btnInventory.style.color='#fff'; 
        } else { 
          btnInventory.style.background='#e5e7eb'; 
          btnInventory.style.color='#374151'; 
        }
      }
    }
    
    async function updateOverviewModeView(){
      console.log('[ì „ì²´í˜„í™©] updateOverviewModeView í˜¸ì¶œ, ëª¨ë“œ:', overviewMode);
      
      const heatmapContainer = document.getElementById('overviewHeatmapContainer');
      const bubbleContainer = document.getElementById('overviewBubbleContainer');
      const bubbleControls = document.getElementById('bubbleControlsContainer');
      const kpi4 = document.getElementById('overviewKpi4');
      const kpi9 = document.getElementById('overviewKpi9');
      
      if(overviewMode==='sale'){
        // íŒë§¤ìœ¨ ëª¨ë“œ: íˆíŠ¸ë§µ í‘œì‹œ, ë²„ë¸” ì°¨íŠ¸ ìˆ¨ê¹€
        if(heatmapContainer) heatmapContainer.style.display = 'block';
        if(bubbleContainer) bubbleContainer.style.display = 'none';
        if(bubbleControls) bubbleControls.style.display = 'none';
        if(kpi4) kpi4.style.display = 'none';
        if(kpi9) kpi9.style.display = 'none';
        
        // íˆíŠ¸ë§µ ìƒì„± (async)
        await createOverviewHeatmap();
    } else {
      // ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ: ë²„ë¸” ì°¨íŠ¸ í‘œì‹œ, íˆíŠ¸ë§µ ìˆ¨ê¹€
      if(heatmapContainer) heatmapContainer.style.display = 'none';
      if(bubbleContainer) bubbleContainer.style.display = 'block';
      if(bubbleControls) bubbleControls.style.display = 'block';
      if(kpi4) kpi4.style.display = 'grid';
      if(kpi9) kpi9.style.display = overviewBubbleView === '9quadrant' ? 'grid' : 'none';
      
      // ì¬ê³ ì£¼ìˆ˜ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
      await updateOverviewStockWeeksDateInfo();
      
      // ë²„ë¸”ì°¨íŠ¸ ì´ˆê¸°í™” ë° ë Œë”ë§
      if (typeof initOverviewBubbleChart === 'function') {
        console.log('[ì „ì²´í˜„í™©] ë²„ë¸”ì°¨íŠ¸ ë Œë”ë§ ì‹œì‘');
        await initOverviewBubbleChart();
      } else {
        console.error('[ì „ì²´í˜„í™©] initOverviewBubbleChart í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }
    }
    
    // ì „ì²´í˜„í™© ì¬ê³ ì£¼ìˆ˜ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
    async function updateOverviewStockWeeksDateInfo() {
      try {
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        const response = await fetch(`/api/stock-weeks?date=${apiDate}`);
        
        if (!response.ok) {
          console.warn('âš ï¸ /api/stock-weeks í˜¸ì¶œ ì‹¤íŒ¨');
          return;
        }
        
        const result = await response.json();
        
        if (!result.success) {
          console.warn('âš ï¸ stock-weeks API ì—ëŸ¬:', result.error);
          return;
        }
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        const updateDateEl = document.getElementById('overview-stock-weeks-update-date');
        const sevenDStartEl = document.getElementById('overview-stock-weeks-7d-start');
        const sevenDEndEl = document.getElementById('overview-stock-weeks-7d-end');
        const twentyEightDStartEl = document.getElementById('overview-stock-weeks-28d-start');
        const twentyEightDEndEl = document.getElementById('overview-stock-weeks-28d-end');
        
        // ì—…ë°ì´íŠ¸ ì¼ì: ì˜¤ëŠ˜ ë‚ ì§œ (Snowflake ë°ì´í„°ë¥¼ ë•¡ê¸°ëŠ” ë‚ )
        if (updateDateEl) {
          const today = new Date().toISOString().split('T')[0];
          updateDateEl.textContent = today;
        }
        
        // ê¸°ì¤€ì¼ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ê³„ì‚°
        if (result.asof_dt) {
          const asofDate = new Date(result.asof_dt);
          
          // ì£¼ê°„ë§¤ì¶œ: ìµœê·¼ 7ì¼ (asof_dt - 6 ~ asof_dt)
          const sevenDStart = new Date(asofDate);
          sevenDStart.setDate(sevenDStart.getDate() - 6);
          
          // 4ì£¼: ìµœê·¼ 28ì¼ (asof_dt - 27 ~ asof_dt)
          const twentyEightDStart = new Date(asofDate);
          twentyEightDStart.setDate(twentyEightDStart.getDate() - 27);
          
          const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
          };
          
          if (sevenDStartEl) sevenDStartEl.textContent = formatDate(sevenDStart);
          if (sevenDEndEl) sevenDEndEl.textContent = result.asof_dt;
          if (twentyEightDStartEl) twentyEightDStartEl.textContent = formatDate(twentyEightDStart);
          if (twentyEightDEndEl) twentyEightDEndEl.textContent = result.asof_dt;
          
          console.log('âœ… ì „ì²´í˜„í™© ì¬ê³ ì£¼ìˆ˜ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
            ì—…ë°ì´íŠ¸ì¼ì_ì˜¤ëŠ˜: updateDateEl?.textContent,
            Snowflakeê¸°ì¤€ì¼: result.asof_dt,
            ì£¼ê°„ë§¤ì¶œ: `${formatDate(sevenDStart)} ~ ${result.asof_dt}`,
            ì¬ê³ ì£¼ìˆ˜ì‚°ì •: `${formatDate(twentyEightDStart)} ~ ${result.asof_dt}`
          });
        }
      } catch (error) {
        console.error('âš ï¸ updateOverviewStockWeeksDateInfo ì—ëŸ¬:', error);
      }
    }
    
    async function createOverviewHeatmap(sortBy = 'sale'){
      const table = document.getElementById('overviewHeatmapTable');
      if(!table) return;
      
      console.log('[íˆíŠ¸ë§µ] API ê¸°ë°˜ íˆíŠ¸ë§µ ìƒì„± ì‹œì‘, ì •ë ¬:', sortBy);
      
      // API ë°ì´í„° ë¡œë“œ
      const salesRateData = await loadOverviewSalesRateData();
      if (!salesRateData || !salesRateData.success) {
        console.error('[íˆíŠ¸ë§µ] API ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        return;
      }
      
      // ë¸Œëœë“œ/ITEM_CDë³„ ì§‘ê³„
      const aggregated = aggregateSalesRateForHeatmap(salesRateData);
      if (!aggregated) {
        console.error('[íˆíŠ¸ë§µ] ë°ì´í„° ì§‘ê³„ ì‹¤íŒ¨');
        return;
      }
      
      console.log('[íˆíŠ¸ë§µ] API ì§‘ê³„ ì™„ë£Œ:', aggregated);
      
      // ë¸Œëœë“œ ëª©ë¡ (SUPRA ì œì™¸)
      const brands = ['MLB', 'MLB KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO'];
      
      // ITEM_CD ëª©ë¡ ì •ë ¬ (ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼)
      let itemCodes;
      if (sortBy === 'sale') {
        // ë§¤ì¶œ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
        itemCodes = Object.keys(aggregated.byItem).sort((a, b) => {
          const saleA = aggregated.byItem[a].sale || 0;
          const saleB = aggregated.byItem[b].sale || 0;
          return saleB - saleA; // ë‚´ë¦¼ì°¨ìˆœ (ë†’ì€ ë§¤ì¶œ ë¨¼ì €)
        });
        console.log('[íˆíŠ¸ë§µ] ITEM_CD ëª©ë¡ (ë§¤ì¶œìˆœ):', itemCodes.map(cd => ({ 
          code: cd, 
          sale: (aggregated.byItem[cd].sale / 1000000).toFixed(1) + 'ë°±ë§Œ' 
        })));
      } else {
        // íŒë§¤ìœ¨ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬ (ê¸°ë³¸ê°’)
        itemCodes = Object.keys(aggregated.byItem).sort((a, b) => {
          const rateA = aggregated.byItem[a].avgSalesRate || 0;
          const rateB = aggregated.byItem[b].avgSalesRate || 0;
          return rateB - rateA; // ë‚´ë¦¼ì°¨ìˆœ (ë†’ì€ íŒë§¤ìœ¨ ë¨¼ì €)
        });
        console.log('[íˆíŠ¸ë§µ] ITEM_CD ëª©ë¡ (íŒë§¤ìœ¨ìˆœ):', itemCodes.map(cd => ({ 
          code: cd, 
          rate: aggregated.byItem[cd].avgSalesRate.toFixed(1) 
        })));
      }
      
      // ë¸Œëœë“œë³„ íŒë§¤ìœ¨ ë°ì´í„° ìˆ˜ì§‘ - API ì§‘ê³„ ë°ì´í„° ì‚¬ìš©
      const heatmapData = {};
      brands.forEach(brandName => {
        const brandRates = {};
        itemCodes.forEach(itemCd => {
          // API ì§‘ê³„ ë°ì´í„°ì—ì„œ ë¸Œëœë“œ-ITEM_CDë³„ íŒë§¤ìœ¨ ê°€ì ¸ì˜¤ê¸°
          if (aggregated.byBrand[brandName] && aggregated.byBrand[brandName].items) {
            brandRates[itemCd] = aggregated.byBrand[brandName].items[itemCd] || null;
          } else {
            brandRates[itemCd] = null;
          }
        });
        heatmapData[brandName] = brandRates;
      });
      
      // ìƒ‰ìƒ ê²°ì • í•¨ìˆ˜
      function getCellClass(value) {
        if(value == null || isNaN(value)) return 'cell-empty';
        if (value >= 20) return 'cell-excellent';
        if (value >= 15) return 'cell-good';
        if (value >= 10) return 'cell-average';
        return 'cell-poor';
      }
      
      // í…Œì´ë¸” ìƒì„± - ë¸Œëœë“œë¥¼ í–‰, ì•„ì´í…œì„ ì—´ë¡œ
      let html = '<thead><tr><th style="background:#2d3748;color:white;padding:12px 8px;font-weight:600;text-align:center;position:sticky;top:0;z-index:10;border-radius:8px 0 0 0;">ë¸Œëœë“œ</th>';
      
      // â˜… 25F ì—´ì„ ë§¨ ì•ì— ë°°ì¹˜ â˜…
      html += '<th style="background:#6366f1;color:white;padding:12px 8px;font-weight:600;text-align:center;position:sticky;top:0;z-index:10;">25F</th>';
      
      // í—¤ë” ìƒì„± (ITEM_CD) - í´ë¦­ ê°€ëŠ¥í•˜ê²Œ
      itemCodes.forEach(itemCd => {
        const itemNm = aggregated.itemInfo[itemCd] || itemCd;
        html += `<th style="background:#2d3748;color:white;padding:12px 8px;font-weight:600;text-align:center;position:sticky;top:0;z-index:10;cursor:pointer;" 
          class="item-code-header" 
          onclick="showItemDetail('${itemCd}', '${itemNm.replace(/'/g, "\\'")}')"
          title="í´ë¦­: ${itemNm}"
          data-item-code="${itemCd}"
          data-item-name="${itemNm}">${itemCd}</th>`;
      });
      html += '</tr></thead><tbody>';
      
      // ê° ë¸Œëœë“œë³„ í–‰ ìƒì„±
      brands.forEach(brand => {
        html += `<tr><td style="text-align:left;padding-left:15px;font-weight:700;background:#f7fafc;position:sticky;left:0;z-index:5;border-bottom:1px solid #e2e8f0;">${brand}</td>`;
        const rates = heatmapData[brand];
        
        // â˜… ë¸Œëœë“œë³„ 25F(í‰ê· ) ê³„ì‚° - API ì§‘ê³„ ë°ì´í„° ì‚¬ìš© â˜…
        let avg = null;
        if (aggregated.byBrand[brand] && aggregated.byBrand[brand].avgSalesRate != null) {
          avg = aggregated.byBrand[brand].avgSalesRate; // ì´ë¯¸ í¼ì„¼íŠ¸ ë‹¨ìœ„
        }
        
        if(avg != null && avg > 0){
          const avgClass = getCellClass(avg);
          html += `<td style="padding:15px 8px;text-align:center;font-weight:600;font-size:14px;border-bottom:1px solid #e2e8f0;background:#ddd6fe;"><span class="cell ${avgClass}" style="display:inline-block;padding:8px 12px;border-radius:6px;min-width:50px;">${avg.toFixed(1)}%</span></td>`;
        } else {
          html += '<td style="padding:15px 8px;text-align:center;font-weight:600;font-size:14px;border-bottom:1px solid #e2e8f0;background:#ddd6fe;">-</td>';
        }
        
        // ê°œë³„ ITEM_CD ì¶œë ¥
        itemCodes.forEach(itemCd => {
          const value = rates[itemCd];
          if(value == null || isNaN(value)){
            html += '<td style="padding:15px 8px;text-align:center;font-weight:600;font-size:14px;border-bottom:1px solid #e2e8f0;background:#f9fafb;">-</td>';
          } else {
            const cellClass = getCellClass(value);
            html += `<td style="padding:15px 8px;text-align:center;font-weight:600;font-size:14px;border-bottom:1px solid #e2e8f0;"><span class="cell ${cellClass}" style="display:inline-block;padding:8px 12px;border-radius:6px;min-width:50px;">${value.toFixed(1)}%</span></td>`;
          }
        });
        
        html += '</tr>';
      });
      
      // ì•„ì´í…œë³„ í‰ê·  í–‰ - API ì§‘ê³„ ë°ì´í„° ì‚¬ìš©
      html += '<tr style="background:#edf2f7;font-weight:700;"><td style="text-align:left;padding-left:15px;background:#edf2f7;position:sticky;left:0;z-index:5;border-top:2px solid #cbd5e0;padding-top:15px;">ì•„ì´í…œ í‰ê· </td>';
      
      // â˜… ì „ì²´ í‰ê· (25F) ê³„ì‚° - ëª¨ë“  ë¸Œëœë“œ í•©ì‚° í›„ ì¬ê³„ì‚° â˜…
      let totalSale = 0;
      let totalStor = 0;
      Object.keys(aggregated.byBrand).forEach(brand => {
        const data = aggregated.byBrand[brand];
        totalSale += data.sale || 0;
        totalStor += data.stor || 0;
      });
      const totalAvg = totalStor > 0 ? (totalSale / totalStor) * 100 : 0;
      
      if(totalAvg > 0){
        const totalClass = getCellClass(totalAvg);
        html += `<td style="padding:15px 8px;text-align:center;font-weight:700;font-size:14px;border-top:2px solid #cbd5e0;padding-top:15px;background:#ddd6fe;"><span class="cell ${totalClass}" style="display:inline-block;padding:8px 12px;border-radius:6px;min-width:50px;">${totalAvg.toFixed(1)}%</span></td>`;
      } else {
        html += '<td style="padding:15px 8px;text-align:center;font-weight:700;font-size:14px;border-top:2px solid #cbd5e0;padding-top:15px;background:#ddd6fe;">-</td>';
      }
      
      // ITEM_CDë³„ í‰ê· 
      itemCodes.forEach(itemCd => {
        const itemData = aggregated.byItem[itemCd];
        const avgRate = itemData ? itemData.avgSalesRate : null;
        
        if(avgRate != null && avgRate > 0){
          const cellClass = getCellClass(avgRate);
          html += `<td style="padding:15px 8px;text-align:center;font-weight:700;font-size:14px;border-top:2px solid #cbd5e0;padding-top:15px;"><span class="cell ${cellClass}" style="display:inline-block;padding:8px 12px;border-radius:6px;min-width:50px;">${avgRate.toFixed(1)}%</span></td>`;
        } else {
          html += '<td style="padding:15px 8px;text-align:center;font-weight:700;font-size:14px;border-top:2px solid #cbd5e0;padding-top:15px;">-</td>';
        }
      });
      
      html += '</tr></tbody>';
      
      table.innerHTML = html;
      
      // ì•„ì´í…œ ì½”ë“œ í—¤ë”ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const itemCodeHeaders = table.querySelectorAll('th.item-code-header');
      console.log('[íˆíŠ¸ë§µ] íˆ´íŒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€:', itemCodeHeaders.length, 'ê°œ í—¤ë”');
      itemCodeHeaders.forEach(header => {
        header.addEventListener('mouseenter', function(e) {
          console.log('[íˆíŠ¸ë§µ] íˆ´íŒ í‘œì‹œ:', this.getAttribute('data-item-code'));
          if (typeof window.showItemCodeTooltip === 'function') {
            window.showItemCodeTooltip(e, this);
          }
        });
        header.addEventListener('mouseleave', function(e) {
          if (typeof window.hideItemCodeTooltip === 'function') {
            window.hideItemCodeTooltip();
          }
        });
      });
      
      // ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
      await updateOverviewAnalysisDateInfo();
      
      // ë¸Œëœë“œ ì…€ íˆ´íŒ ìŠ¤íƒ€ì¼ ì¶”ê°€
      if (!document.getElementById('brand-tooltip-style')) {
        const style = document.createElement('style');
        style.id = 'brand-tooltip-style';
        style.textContent = `
          #item-code-tooltip {
            position: fixed !important;
            background: white !important;
            border: 2px solid #4f46e5 !important;
            border-radius: 8px !important;
            padding: 12px 16px !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3) !important;
            z-index: 99999 !important;
            pointer-events: none !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
            min-width: 220px !important;
            white-space: nowrap !important;
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
          }
        `;
        document.head.appendChild(style);
      }
      
      console.log('[íˆíŠ¸ë§µ] API ê¸°ë°˜ íˆíŠ¸ë§µ ìƒì„± ì™„ë£Œ');
    }
    
    // ì „ì²´í˜„í™© íŒë§¤ìœ¨ íˆíŠ¸ë§µ - ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
    async function updateOverviewAnalysisDateInfo() {
      const overviewUpdateDateEl = document.getElementById('overviewUpdateDate');
      const overviewCyPeriodEl = document.getElementById('overviewCyPeriod');
      const overviewPyPeriodEl = document.getElementById('overviewPyPeriod');
      
      // ì—…ë°ì´íŠ¸ ì¼ì: ì˜¤ëŠ˜
      const today = new Date().toISOString().split('T')[0];
      if (overviewUpdateDateEl) {
        overviewUpdateDateEl.textContent = today;
      }
      
      // API ë°ì´í„°ì—ì„œ ë‹¹ë…„/ì „ë…„ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
      try {
        const salesRateData = await loadOverviewSalesRateData();
        if (salesRateData && salesRateData.success && salesRateData.data) {
          const curSample = salesRateData.data.CUR?.[0];
          const pySample = salesRateData.data.PY?.[0];
          
          if (overviewCyPeriodEl && curSample?.ASOF_DT) {
            overviewCyPeriodEl.textContent = curSample.ASOF_DT;
          }
          
          if (overviewPyPeriodEl && pySample?.ASOF_DT) {
            overviewPyPeriodEl.textContent = pySample.ASOF_DT;
          }
          
          console.log('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
            ì—…ë°ì´íŠ¸ì¼ì: today,
            ë‹¹ë…„: curSample?.ASOF_DT,
            ì „ë…„: pySample?.ASOF_DT
          });
        }
      } catch (error) {
        console.error('[ì „ì²´í˜„í™©] ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      }
    }
    
    // ITEM_CD í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
    function showItemDetail(itemCd, itemNm) {
      const message = `ğŸ“¦ ì•„ì´í…œ ì •ë³´\n\n` +
                      `â€¢ ITEM_CD: ${itemCd}\n` +
                      `â€¢ ITEM_NM: ${itemNm}`;
      
      alert(message);
      
      console.log('[íˆíŠ¸ë§µ] ì•„ì´í…œ í´ë¦­:', { itemCd, itemNm });
    }
    
    // ì•„ì´í…œ ì½”ë“œ íˆ´íŒ í‘œì‹œ í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    window.showItemCodeTooltip = function(event, cell) {
      const itemCode = cell.getAttribute('data-item-code') || cell.textContent.trim();
      let itemName = cell.getAttribute('data-item-name') || '';
      
      // data-item-nameì´ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìœ¼ë©´ ë‹¤ì‹œ ì°¾ê¸°
      if (!itemName || itemName === '') {
        const brandCodeMap = {
          'MLB': 'M',
          'MLB KIDS': 'I',
          'DISCOVERY': 'X',
          'DUVETICA': 'V',
          'SERGIO': 'ST'
        };
        const brands = ['MLB', 'MLB KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO'];
        
        for (let i = 0; i < brands.length; i++) {
          const brandName = brands[i];
          const brandCode = brandCodeMap[brandName];
          const brandItems = window.clothingBrandStatus && window.clothingBrandStatus[brandCode] ? window.clothingBrandStatus[brandCode] : [];
          const item = brandItems.find(i => i.itemCode === itemCode);
          if (item && item.itemName) {
            itemName = item.itemName;
            break;
          }
        }
      }
      
      if (!itemCode) {
        console.log('[íˆ´íŒ] ì•„ì´í…œ ì½”ë“œê°€ ì—†ì–´ì„œ ì¢…ë£Œ');
        return;
      }
      
      console.log('[íˆ´íŒ] ìƒì„± ì‹œì‘ - ì½”ë“œ:', itemCode, 'ì´ë¦„:', itemName);
      
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      const existingTooltip = document.getElementById('item-code-tooltip');
      if (existingTooltip) {
        console.log('[íˆ´íŒ] ê¸°ì¡´ íˆ´íŒ ì œê±°');
        existingTooltip.remove();
      }
      
      // íˆ´íŒ ìƒì„±
      const tooltip = document.createElement('div');
      tooltip.id = 'item-code-tooltip';
      tooltip.innerHTML = `
        <div style="padding:8px 0;">
          <div style="margin-bottom:6px;">
            <span style="font-weight:600;color:#4f46e5;">ì•„ì´í…œì½”ë“œ:</span> ${itemCode.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
          </div>
          <div>
            <span style="font-weight:600;color:#4f46e5;">ì•„ì´í…œëª…:</span> ${(itemName || '-').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
          </div>
        </div>
      `;
      
      document.body.appendChild(tooltip);
      console.log('[íˆ´íŒ] DOMì— ì¶”ê°€ë¨');
      
      // íˆ´íŒ ìœ„ì¹˜ ì„¤ì • (fixed í¬ì§€ì…˜ ì‚¬ìš©)
      const rect = cell.getBoundingClientRect();
      const tooltipLeft = rect.left + rect.width / 2 - 110;
      const tooltipTop = rect.bottom + 10;
      
      tooltip.style.left = tooltipLeft + 'px';
      tooltip.style.top = tooltipTop + 'px';
      
      console.log('[íˆ´íŒ] ìœ„ì¹˜ ì„¤ì •:', { left: tooltipLeft, top: tooltipTop, rect });
      
      // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      setTimeout(() => {
        const tooltipRect = tooltip.getBoundingClientRect();
        if (tooltipRect.right > window.innerWidth) {
          tooltip.style.left = (window.innerWidth - tooltipRect.width - 10) + 'px';
        }
        if (tooltipRect.left < 0) {
          tooltip.style.left = '10px';
        }
        if (tooltipRect.bottom > window.innerHeight) {
          tooltip.style.top = (rect.top - tooltipRect.height - 10) + 'px';
        }
      }, 0);
    };
    
    // ì•„ì´í…œ ì½”ë“œ íˆ´íŒ ìˆ¨ê¸°ê¸° í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    window.hideItemCodeTooltip = function() {
      const tooltip = document.getElementById('item-code-tooltip');
      if (tooltip) tooltip.remove();
    };

    // -------- ë¸Œëœë“œ ì°¨íŠ¸ --------
    function initBrandCharts(){
      // â˜… window.brandData ìš°ì„  ì‚¬ìš© â˜…
      const data = window.brandData?.[currentBrand] || brandData[currentBrand];
      console.log('[initBrandCharts] currentBrand:', currentBrand, 'data:', !!data);
      
      // ê¸°ì¡´ ì°¨íŠ¸ ì •ë¦¬ (brandData ì²´í¬ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰)
      ['treemap','radar','heatmap','weeklyTrend','itemHeatmap'].forEach(n=>{
        if(charts[n]){ 
          if(charts[n].type === 'plotly') {
            Plotly.purge(charts[n].container);
          } else {
            charts[n].destroy();
          }
          delete charts[n]; 
        }
      });

      // â˜… Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” â˜…
      initTreemap();

      // ë ˆì´ë” ì°¨íŠ¸: ê³„íš(ë‹¬ì„±ë¥ ) vs ì „ë…„ë¹„
      const radarCtx = document.getElementById('radarChart');
      if (radarCtx) {
        const type = window.radarChartType || 'channel';
        let channelRadar;
        try {
          channelRadar = (type === 'channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand);
          // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
          if (!channelRadar || !channelRadar.labels || channelRadar.labels.length === 0) {
            console.warn('[ë ˆì´ë” ì°¨íŠ¸] ìœ íš¨í•œ ë°ì´í„° ì—†ìŒ, ì •ì  ë°ì´í„° ì‚¬ìš©');
            channelRadar = (type === 'channel') ? getStaticRadarData() : getStaticItemRadarData();
          }
        } catch (e) {
          console.error('[ë ˆì´ë” ì°¨íŠ¸] ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', e);
          channelRadar = (type === 'channel') ? getStaticRadarData() : getStaticItemRadarData();
        }
        console.log('[ë ˆì´ë” ì°¨íŠ¸] ì‚¬ìš© ë°ì´í„°:', channelRadar);
        
        // ë””ë²„ê¹…: ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„° í™•ì¸
        if (currentBrand === 'MLB' && type === 'channel') {
          console.log('[ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™”] MLB ì±„ë„ ë°ì´í„°:', {
            labels: channelRadar.labels,
            plan: channelRadar.plan,
            yoy: channelRadar.yoy,
            sales: channelRadar.sales,
            hasRF: channelRadar.labels.includes('RF')
          });
        }
        
        // ë””ë²„ê¹…: MLBì¸ ê²½ìš° RF ë°ì´í„° í™•ì¸
        if (currentBrand === 'MLB') {
          const rfIndex = channelRadar.labels.indexOf('RF');
          console.log('[ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™”] MLB RF ë°ì´í„° í™•ì¸:', {
            labels: channelRadar.labels,
            hasRF: rfIndex !== -1,
            rfIndex: rfIndex,
            rfPlan: rfIndex !== -1 ? channelRadar.plan[rfIndex] : 'N/A',
            rfYoy: rfIndex !== -1 ? channelRadar.yoy[rfIndex] : 'N/A',
            rfSales: rfIndex !== -1 ? channelRadar.sales[rfIndex] : 'N/A',
            allPlan: channelRadar.plan,
            allYoy: channelRadar.yoy
          });
        }
        
        charts.radar = new Chart(radarCtx.getContext('2d'), {
          type: 'radar',
          data: {
            labels: channelRadar.labels,
            datasets: [
              { label: 'ê³„íš', data: channelRadar.plan, borderColor: '#3B82F6', backgroundColor: 'rgba(59,130,246,0.2)', borderWidth: 2, pointRadius: 2 },
              { label: 'ì „ë…„', data: channelRadar.yoy, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.2)', borderWidth: 2, pointRadius: 2 },
              ...(channelRadar.brandPlan ? [{ label: 'ë¸Œëœë“œê³„íš', data: channelRadar.brandPlan, borderColor: '#F59E0B', backgroundColor: 'rgba(245,158,11,0.2)', borderWidth: 2, pointRadius: 2, borderDash: [5, 5] }] : [])
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            onClick: function(event, elements) {
              try {
                console.log('[ë ˆì´ë” ì°¨íŠ¸ í´ë¦­]', {event, elements, hasElements: elements && elements.length > 0});
                if (elements && elements.length > 0) {
                  const element = elements[0];
                  const index = element.index;
                  if (index !== undefined && channelRadar && channelRadar.labels && channelRadar.labels[index]) {
                    const label = channelRadar.labels[index];
                    const datasetIndex = element.datasetIndex;
                    
                    console.log('[ë ˆì´ë” ì°¨íŠ¸ í´ë¦­] ì±„ë„ ì„ íƒ:', {label, index, datasetIndex});
                    
                    // ì±„ë„ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (typeof showRadarChannelToggle === 'function') {
                      showRadarChannelToggle(event, label, currentBrand, type, channelRadar);
                    }
                  }
                } else {
                  // í´ë¦­í•œ ê³³ì´ ì°¨íŠ¸ ìš”ì†Œê°€ ì•„ë‹ˆë©´ í† ê¸€ ìˆ¨ê¸°ê¸°
                  if (typeof hideRadarChannelToggle === 'function') {
                    hideRadarChannelToggle();
                  }
                }
              } catch (e) {
                console.warn('[ë ˆì´ë” ì°¨íŠ¸ onClick ì—ëŸ¬]', e);
              }
            },
            onHover: function(event, elements) {
              try {
                if (elements && elements.length > 0) {
                  const element = elements[0];
                  const index = element.index;
                  if (index !== undefined && channelRadar && channelRadar.labels && channelRadar.labels[index]) {
                    const label = channelRadar.labels[index];
                    
                    // ì»¤ì„œ ë³€ê²½
                    if (event && event.native && event.native.target) {
                      event.native.target.style.cursor = 'pointer';
                    } else if (event && event.target) {
                      event.target.style.cursor = 'pointer';
                    }
                    
                    // í† ê¸€ í‘œì‹œ (hover)
                    if (typeof showRadarChannelToggle === 'function') {
                      showRadarChannelToggle(event, label, currentBrand, type, channelRadar);
                    }
                  }
                } else {
                  // ì»¤ì„œ ë³€ê²½
                  if (event && event.native && event.native.target) {
                    event.native.target.style.cursor = 'default';
                  } else if (event && event.target) {
                    event.target.style.cursor = 'default';
                  }
                  
                  // í† ê¸€ ìˆ¨ê¸°ê¸°
                  if (typeof hideRadarChannelToggle === 'function') {
                    hideRadarChannelToggle();
                  }
                }
              } catch (e) {
                console.warn('[ë ˆì´ë” ì°¨íŠ¸ onHover ì—ëŸ¬]', e);
              }
            },
            plugins: { 
              legend: { 
                display: false  // HTML ë²”ë¡€ ì‚¬ìš© (ì „ì²´í˜„í™©ê³¼ ë™ì¼)
              }, 
              tooltip: { 
                enabled: false  // Chart.js ê¸°ë³¸ tooltip ë¹„í™œì„±í™” (ì»¤ìŠ¤í…€ íˆ´íŒ ì‚¬ìš©)
              },
              afterDraw: function(chart) {
                // 100% êµ¬ë¶„ì„  ê·¸ë¦¬ê¸° (ì „ì²´í˜„í™©ê³¼ ë™ì¼í•œ ë°©ì‹)
                const ctx = chart.ctx;
                const meta = chart.getDatasetMeta(0);
                if (!meta || !meta.data || meta.data.length === 0) return;
                
                const centerX = meta.data[0].x;
                const centerY = meta.data[0].y;
                const maxRadius = Math.sqrt(
                  Math.pow(meta.data[0].x - centerX, 2) + 
                  Math.pow(meta.data[0].y - centerY, 2)
                );
                
                // 100% ìœ„ì¹˜ ê³„ì‚° (120ì´ ìµœëŒ€ê°’ì´ë¯€ë¡œ 100/120 ë¹„ìœ¨)
                const radius100 = (maxRadius * 100) / 120;
                
                ctx.save();
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                // ê° ì¶•ì— ëŒ€í•´ 100% ìœ„ì¹˜ì— ì ì„ ì°ê³  ì—°ê²°
                meta.data.forEach((point, index) => {
                  const angle = Math.atan2(point.y - centerY, point.x - centerX);
                  const x = centerX + Math.cos(angle) * radius100;
                  const y = centerY + Math.sin(angle) * radius100;
                  
                  if (index === 0) {
                    ctx.moveTo(x, y);
                  } else {
                    ctx.lineTo(x, y);
                  }
                });
                
                ctx.closePath();
                ctx.stroke();
                ctx.restore();
              }
            },
            scales: { 
              r: { 
                suggestedMin: 0, 
                suggestedMax: 120, 
                ticks: { 
                  stepSize: 30, 
                  backdropColor: 'transparent', 
                  font: { size: 9 },
                  callback: function(value) {
                    // 100% êµ¬ë¶„ì„  ê°•ì¡°
                    if (value === 100) {
                      return '100%';
                    }
                    return value;
                  }
                }
              } 
            }
          }
        });
        
        
        // ë ˆì´ë” ì°¨íŠ¸ hover ì´ë²¤íŠ¸ ì§ì ‘ ì¶”ê°€ (Chart.js onHoverê°€ ì‘ë™í•˜ì§€ ì•Šì„ ê²½ìš° ëŒ€ë¹„)
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        const existingHoverHandler = radarCtx._radarHoverHandler;
        if (existingHoverHandler) {
          radarCtx.removeEventListener('mousemove', existingHoverHandler);
          radarCtx.removeEventListener('mouseleave', existingHoverHandler);
        }
        
        // ìƒˆë¡œìš´ hover í•¸ë“¤ëŸ¬ ìƒì„±
        const hoverHandler = function(e) {
          if (!charts.radar) return;
          
          const canvasPosition = Chart.helpers.getRelativePosition(e, charts.radar);
          const labels = charts.radar.data.labels;
          let closestIndex = -1;
          let minDistance = Infinity;
          
          // ê° ë°ì´í„° í¬ì¸íŠ¸ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
          labels.forEach((label, index) => {
            const meta = charts.radar.getDatasetMeta(0);
            if (meta && meta.data && meta.data[index]) {
              const point = meta.data[index];
              const distance = Math.sqrt(
                Math.pow(canvasPosition.x - point.x, 2) + 
                Math.pow(canvasPosition.y - point.y, 2)
              );
              if (distance < minDistance && distance < 50) { // 50px ì´ë‚´
                minDistance = distance;
                closestIndex = index;
              }
            }
          });
          
          if (closestIndex !== -1) {
            const label = labels[closestIndex];
            const currentType = window.radarChartType || 'channel';
            const currentRadarData = window.uiStaticMode 
              ? ((currentType === 'channel') ? getStaticRadarData() : getStaticItemRadarData())
              : ((currentType === 'channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand));
            showRadarChannelToggle(e, label, currentBrand, currentType, currentRadarData);
            e.target.style.cursor = 'pointer';
          } else {
            hideRadarChannelToggle();
            e.target.style.cursor = 'default';
          }
        };
        
        const leaveHandler = function(e) {
          hideRadarChannelToggle();
          if (e.target) {
            e.target.style.cursor = 'default';
          }
        };
        
        // í•¸ë“¤ëŸ¬ë¥¼ canvasì— ì €ì¥ (ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´)
        radarCtx._radarHoverHandler = hoverHandler;
        radarCtx._radarLeaveHandler = leaveHandler;
        radarCtx.addEventListener('mousemove', hoverHandler);
        radarCtx.addEventListener('mouseleave', leaveHandler);
      }

      // íˆíŠ¸ë§µ ì°¨íŠ¸ ë¹„í™œì„±í™” (ê³µë€ ìœ ì§€)
      // initHeatmapChart();
      // ì•„ì´í…œ íˆíŠ¸ë§µ ê·¸ë˜í”„ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬(ì´ˆê¸°í™” ìƒëµ)
      // initItemHeatmapChart();

      // ì£¼ì°¨ ì¶”ì„¸ (ì£¼ì°¨ë³„/ëˆ„ì  í† ê¸€)
      initWeeklyTrendChart();
    }

    // -------- íˆíŠ¸ë§µ ì°¨íŠ¸ ì´ˆê¸°í™” ë° í† ê¸€ --------
    let heatmapType = 'apparel'; // 'apparel' or 'acc'
    
    function initHeatmapChart() {
      updateHeatmapChart();
      
      const apparelBtn = document.getElementById('heatmapBtnApparel');
      const accBtn = document.getElementById('heatmapBtnAcc');
      
      if (apparelBtn && !apparelBtn.hasAttribute('data-listener')) {
        apparelBtn.setAttribute('data-listener', 'true');
        apparelBtn.addEventListener('click', () => {
          heatmapType = 'apparel';
          updateHeatmapButtons();
          updateHeatmapChart();
        });
      }
      
      if (accBtn && !accBtn.hasAttribute('data-listener')) {
        accBtn.setAttribute('data-listener', 'true');
        accBtn.addEventListener('click', () => {
          heatmapType = 'acc';
          updateHeatmapButtons();
          updateHeatmapChart();
        });
      }
    }
    
    function updateHeatmapButtons() {
      const apparelBtn = document.getElementById('heatmapBtnApparel');
      const accBtn = document.getElementById('heatmapBtnAcc');
      
      if (apparelBtn && accBtn) {
        if (heatmapType === 'apparel') {
          apparelBtn.style.background = '#2563eb';
          apparelBtn.style.color = '#fff';
          accBtn.style.background = '#e5e7eb';
          accBtn.style.color = '#374151';
        } else {
          apparelBtn.style.background = '#e5e7eb';
          apparelBtn.style.color = '#374151';
          accBtn.style.background = '#2563eb';
          accBtn.style.color = '#fff';
        }
      }
    }
    
    function updateHeatmapChart() {
      const container = document.getElementById('heatmapChart');
      if (!container) return;
      
      // ê¸°ì¡´ Plotly ì°¨íŠ¸ ì‚­ì œ
      if (container.data) {
        Plotly.purge(container);
      }
      
      let labels, data, title;
      
      if (heatmapType === 'apparel') {
        // ì˜ë¥˜: íŒë§¤ìœ¨ íˆíŠ¸ë§µ (ì‹¤ì œ ë°ì´í„° ì‚¬ìš©)
        if (window.overviewSalesRateData) {
          const aggregated = aggregateSalesRateForHeatmap(window.overviewSalesRateData);
          
          if (aggregated && aggregated.byCategory) {
            // ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  íŒë§¤ìœ¨
            const categories = Object.keys(aggregated.byCategory)
              .filter(cat => cat !== 'ETC')
              .sort();
            
            labels = categories.map(cat => cat);
            data = categories.map(cat => [Math.round(aggregated.byCategory[cat].avgSalesRate)]);
            title = 'íŒë§¤ìœ¨ (%)';
          } else {
            // ë°ì´í„° ì§‘ê³„ ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„°
            labels = ['Outer', 'Inner', 'Bottom'];
            data = [[85], [92], [78]];
            title = 'íŒë§¤ìœ¨ (%)';
          }
        } else {
          // ë°ì´í„° ë¡œë“œ ì•ˆë¨ - ë”ë¯¸ ë°ì´í„°
          labels = ['Outer', 'Inner', 'Bottom'];
          data = [[85], [92], [78]];
          title = 'íŒë§¤ìœ¨ (%)';
        }
      } else {
        // ACC: ì¬ê³ ì£¼ìˆ˜ íˆíŠ¸ë§µ (ì‹¤ì œ ë°ì´í„° ì‚¬ìš©)
        if (window.overviewStockWeeksData) {
          const aggregated = aggregateStockWeeksForHeatmap(window.overviewStockWeeksData);
          
          if (aggregated && aggregated.byCategory) {
            // ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  ì¬ê³ ì£¼ìˆ˜
            const categories = Object.keys(aggregated.byCategory)
              .filter(cat => cat !== 'ETC')
              .sort();
            
            labels = categories.map(cat => cat);
            data = categories.map(cat => [Math.round(aggregated.byCategory[cat].avgStockWeeks)]);
            title = 'ì¬ê³ ì£¼ìˆ˜';
          } else {
            // ë°ì´í„° ì§‘ê³„ ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„°
            labels = ['ì‹ ë°œ', 'ê°€ë°©', 'ëª¨ì', 'ê¸°íƒ€'];
            data = [[25], [32], [18], [15]];
            title = 'ì¬ê³ ì£¼ìˆ˜';
          }
        } else {
          // ë°ì´í„° ë¡œë“œ ì•ˆë¨ - ë”ë¯¸ ë°ì´í„°
          labels = ['ì‹ ë°œ', 'ê°€ë°©', 'ëª¨ì', 'ê¸°íƒ€'];
          data = [[25], [32], [18], [15]];
          title = 'ì¬ê³ ì£¼ìˆ˜';
        }
      }
      
      // Plotly íˆíŠ¸ë§µ ìƒì„±
      const heatmapData = [{
        z: data,
        x: [title],
        y: labels,
        type: 'heatmap',
        colorscale: heatmapType === 'apparel' 
          ? [[0, '#ef4444'], [0.5, '#fbbf24'], [1, '#22c55e']]  // íŒë§¤ìœ¨: ë‚®ìŒ(ë¹¨ê°•) -> ë†’ìŒ(ì´ˆë¡)
          : [[0, '#22c55e'], [0.5, '#fbbf24'], [1, '#ef4444']], // ì¬ê³ ì£¼ìˆ˜: ë‚®ìŒ(ì´ˆë¡) -> ë†’ìŒ(ë¹¨ê°•)
        showscale: true,
        colorbar: {
          title: title,
          titleside: 'right',
          titlefont: { size: 10 },
          tickfont: { size: 9 }
        }
      }];
      
      const layout = {
        margin: { l: 100, r: 20, t: 20, b: 40 },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { size: 10 },
        yaxis: { 
          automargin: true,
          tickfont: { size: 9 },
          showgrid: false
        },
        xaxis: { 
          tickfont: { size: 9 },
          showgrid: false
        }
      };
      
      const config = {
        responsive: true,
        displayModeBar: false
      };
      
      Plotly.newPlot(container, heatmapData, layout, config);
      
      // Plotly ì°¨íŠ¸ë¥¼ charts ê°ì²´ì— ì €ì¥
      charts.heatmap = { type: 'plotly', container: container };
    }
    
    // -------- ì•„ì´í…œ íˆíŠ¸ë§µ ì°¨íŠ¸ ì´ˆê¸°í™” ë° í† ê¸€ --------
    let itemHeatmapCategory = 'Outer'; // 'Outer', 'Inner', 'Bottom'
    
    function initItemHeatmapChart() {
      updateItemHeatmapChart();
      
      const outerBtn = document.getElementById('itemHeatmapBtnOuter');
      const innerBtn = document.getElementById('itemHeatmapBtnInner');
      const bottomBtn = document.getElementById('itemHeatmapBtnBottom');
      
      if (outerBtn && !outerBtn.hasAttribute('data-listener')) {
        outerBtn.setAttribute('data-listener', 'true');
        outerBtn.addEventListener('click', () => {
          itemHeatmapCategory = 'Outer';
          updateItemHeatmapButtons();
          updateItemHeatmapChart();
          renderItemDiffTable();
        });
      }
      
      if (innerBtn && !innerBtn.hasAttribute('data-listener')) {
        innerBtn.setAttribute('data-listener', 'true');
        innerBtn.addEventListener('click', () => {
          itemHeatmapCategory = 'Inner';
          updateItemHeatmapButtons();
          updateItemHeatmapChart();
          renderItemDiffTable();
        });
      }
      
      if (bottomBtn && !bottomBtn.hasAttribute('data-listener')) {
        bottomBtn.setAttribute('data-listener', 'true');
        bottomBtn.addEventListener('click', () => {
          itemHeatmapCategory = 'Bottom';
          updateItemHeatmapButtons();
          updateItemHeatmapChart();
          renderItemDiffTable();
        });
      }
    }
    
    function updateItemHeatmapButtons() {
      const outerBtn = document.getElementById('itemHeatmapBtnOuter');
      const innerBtn = document.getElementById('itemHeatmapBtnInner');
      const bottomBtn = document.getElementById('itemHeatmapBtnBottom');
      
      const buttons = [outerBtn, innerBtn, bottomBtn];
      const categories = ['Outer', 'Inner', 'Bottom'];
      
      buttons.forEach((btn, idx) => {
        if (btn) {
          if (itemHeatmapCategory === categories[idx]) {
            btn.style.background = '#2563eb';
            btn.style.color = '#fff';
          } else {
            btn.style.background = '#e5e7eb';
            btn.style.color = '#374151';
          }
        }
      });
      
      // ê°œìš” ì„¹ì…˜: ì£¼ì°¨ë³„/ëˆ„ì  í† ê¸€ UI/ë¡œì§ ë³´ê°• í˜¸ì¶œ
      ensureOverviewToggleUI();
    }
    
    function updateItemHeatmapChart() {
      const container = document.getElementById('itemHeatmapChart');
      if (!container) return;
      
      // ê¸°ì¡´ Plotly ì°¨íŠ¸ ì‚­ì œ
      if (container.data) {
        Plotly.purge(container);
      }
      
      // ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
      let items, brands, data;
      
      if (window.overviewSalesRateData) {
        const aggregated = aggregateSalesRateForHeatmap(window.overviewSalesRateData);
        
        if (aggregated && aggregated.byCategory && aggregated.byCategory[itemHeatmapCategory]) {
          const categoryData = aggregated.byCategory[itemHeatmapCategory];
          
          // ë¸Œëœë“œ ëª©ë¡
          brands = ['MLB', 'MLB KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
          
          // ì´ ì¹´í…Œê³ ë¦¬ì—ì„œ ë¸Œëœë“œë³„ íŒë§¤ìœ¨
          items = [itemHeatmapCategory];
          data = [brands.map(brand => {
            const rate = categoryData.brands[brand];
            return rate !== undefined ? Math.round(rate) : 0;
          })];
          
        } else {
          // ì§‘ê³„ ì‹¤íŒ¨ - ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
          brands = ['MLB', 'MLB KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
          items = [itemHeatmapCategory];
          data = [[85, 92, 78, 88, 75, 82]];
        }
      } else {
        // ë°ì´í„° ë¡œë“œ ì•ˆë¨ - ë”ë¯¸ ë°ì´í„°
        brands = ['MLB', 'MLB KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
        items = [itemHeatmapCategory];
        data = [[85, 92, 78, 88, 75, 82]];
      }
      
      // Plotly íˆíŠ¸ë§µ ìƒì„±
      const heatmapData = [{
        z: data,
        x: brands,
        y: items,
        type: 'heatmap',
        colorscale: [[0, '#ef4444'], [0.5, '#fbbf24'], [1, '#22c55e']],
        showscale: true,
        colorbar: {
          title: 'íŒë§¤ìœ¨ (%)',
          titleside: 'right',
          titlefont: { size: 10 },
          tickfont: { size: 9 }
        }
      }];
      
      const layout = {
        margin: { l: 80, r: 20, t: 20, b: 60 },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { size: 10 },
        yaxis: { 
          automargin: true,
          tickfont: { size: 9 },
          showgrid: false
        },
        xaxis: { 
          tickfont: { size: 9 },
          showgrid: false,
          tickangle: -45
        }
      };
      
      const config = {
        responsive: true,
        displayModeBar: false
      };
      
      Plotly.newPlot(container, heatmapData, layout, config);
      
      // Plotly ì°¨íŠ¸ë¥¼ charts ê°ì²´ì— ì €ì¥
      charts.itemHeatmap = { type: 'plotly', container: container };
    }

    // -------- ì•„ì´í…œë³„ íŒë§¤ìœ¨ ì°¨ì´ í…Œì´ë¸” ë°ì´í„°/ë Œë”ë§ --------
    // ë¸Œëœë“œë³„ ì•„ì´í…œ íŒë§¤ìœ¨ ë°ì´í„° - JS íŒŒì¼(brand_stock_analysis_YYYYMMDD.js)ì—ì„œ ë™ì  ë¡œë“œ
    const itemTableData = { Outer: [], Inner: [], Bottom: [] };
    
    // ë¸Œëœë“œë³„ ì•„ì´í…œ íŒë§¤ìœ¨ ë°ì´í„° (M=MLB, I=MLB_KIDS, X=DISCOVERY, V=DUVETICA, ST=SERGIO, W=SUPRA)
    // JS íŒŒì¼(brand_stock_analysis_YYYYMMDD.js)ì—ì„œ ë™ì  ë¡œë“œë¨ - convertClothingDataToTableFormat() í•¨ìˆ˜ ì°¸ì¡°
    const itemTableDataByBrand = {};
    // ë¸Œëœë“œë³„ ì•„ì´í…œ ë°ì´í„° ë°˜í™˜: ë¸Œëœë“œë³„ ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
    function getBrandItemTableData(brand){
      try{
        let brandKey = brand || currentBrand || 'MLB';
        // ë¸Œëœë“œëª…ì„ brandCodeMapì˜ í‚¤ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        if(brandKey === 'MLB KIDS') brandKey = 'MLB_KIDS';
        // brandCodeMapì—ì„œ ì§ì ‘ ì°¾ê¸° (MLB_KIDS ë˜ëŠ” MLB KIDS ëª¨ë‘ ì§€ì›)
        let brandCode = brandCodeMap[brandKey];
        if(!brandCode && brandKey.includes('_')) {
          brandCode = brandCodeMap[brandKey.replace('_', ' ')];
        }
        if(!brandCode) {
          brandCode = 'M'; // ê¸°ë³¸ê°’
        }
        
        console.log('getBrandItemTableData í˜¸ì¶œ:', {
          brand: brand, 
          brandKey: brandKey, 
          brandCode: brandCode, 
          currentBrand: currentBrand,
          brandCodeMapKeys: Object.keys(brandCodeMap),
          brandCodeMapValue: brandCodeMap[brandKey]
        });
        
        // â˜… window.itemTableDataByBrand ì‚¬ìš© (ì•ˆì „í•œ ì ‘ê·¼) â˜…
        const itemTableByBrand = window.itemTableDataByBrand || itemTableDataByBrand || {};
        
        // ë¸Œëœë“œë³„ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
        if(itemTableByBrand[brandCode]){
          const brandData = itemTableByBrand[brandCode];
          const result = {
            Outer: brandData.Outer || [],
            Inner: brandData.Inner || [],
            Bottom: brandData.Bottom || [],
            Wear_etc: brandData.Wear_etc || []
          };
          console.log('ë¸Œëœë“œë³„ ë°ì´í„° ë°˜í™˜:', {
            brandCode: brandCode,
            outerCount: result.Outer.length,
            firstOuter: result.Outer[0]?.name,
            firstOuterPo: result.Outer[0]?.poNow,
            innerCount: result.Inner.length,
            bottomCount: result.Bottom.length
          });
          return result;
        }
        
        console.warn('ë¸Œëœë“œë³„ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©:', brandCode);
        
        // í´ë°±: ê¸°ë³¸ ë°ì´í„° ì‚¬ìš© (ê°€ì¤‘ì¹˜ ì ìš©)
        const base = itemTableData;
        // â˜… window.brandData ì‚¬ìš© (ì•ˆì „í•œ ì ‘ê·¼) â˜…
        const brandDataRef = window.brandData || brandData || {};
        const baseTotal = brandDataRef.MLB?.revenue?.forecast || 236.9;
        const brandTotal = brandDataRef[brandKey]?.revenue?.forecast || baseTotal;
        const k = baseTotal ? (brandTotal / baseTotal) : 1;
        const scaleRow = (r)=>({
          ...r,
          weekly: Math.round((r.weekly||0) * k),
          cum: Math.round((r.cum||0) * k)
        });
        return {
          Outer: (base.Outer||[]).map(scaleRow),
          Inner: (base.Inner||[]).map(scaleRow),
          Bottom: (base.Bottom||[]).map(scaleRow),
          Wear_etc: (base.Wear_etc||[]).map(scaleRow)
        };
      }catch(e){ return JSON.parse(JSON.stringify(itemTableData)); }
    }

    let itemTableCategory = 'ALL';
    let itemTableSort = 'cum'; // íŒë§¤ìœ¨ ëª¨ë“œ ê¸°ë³¸ê°’ (ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œì—ì„œëŠ” updateItemModeButtonsì—ì„œ 'sales'ë¡œ ë³€ê²½ë¨)
    let itemTableAlertOnly = false; // ì£¼ì˜ í•­ëª©ë§Œ ë³´ê¸° í† ê¸€

    // -------- JSON ê¸°ë°˜ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ê´€ë ¨ í•¨ìˆ˜ ì œê±°ë¨ --------
    // initItemDiffTable(), updateItemTableButtons(), updateItemModeButtons(), 
    // updateItemTablePeriodInfo(), renderItemDiffTable() ë“±ì€ 
    // ë¸Œëœë“œë³„ ëŒ€ì‹œë³´ë“œì˜ JSON ê¸°ë°˜ UI ì œê±°ë¡œ ì¸í•´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.

    
    // -------- íŒë§¤ìœ¨ ì°¨íŠ¸ (Dual Axis) --------
    let saleRateChartInstance = null;
    let saleRateYoyMaxValue = 30; // YOY ì¶• ìµœëŒ€ê°’ ê¸°ë³¸ê°’
    let saleRateBarMaxValue = 40; // íŒë§¤ìœ¨ ë§‰ëŒ€ ê·¸ë˜í”„(y0) ìµœëŒ€ê°’ ê¸°ë³¸ê°’
    
    function updateSaleRateChart(){
      const chartContainer = document.getElementById('saleRateChartContainer');
      if(!chartContainer) return;
      
      // íŒë§¤ìœ¨ ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ
      chartContainer.style.display = 'block';
      
      // YOY ì¶• ìµœëŒ€ê°’ ì¡°ì ˆ ì»¨íŠ¸ë¡¤ í‘œì‹œ
      const yoyControl = document.getElementById('inventoryYoyMaxControl');
      const yoyLabel = document.getElementById('yoyMaxLabel');
      const yoyUnit = document.getElementById('yoyMaxUnit');
      const yoySlider = document.getElementById('inventoryYoyMaxSlider');
      const yoyInput = document.getElementById('inventoryYoyMaxInput');
      if(yoyControl) {
        yoyControl.style.display = 'flex';
        // íŒë§¤ìœ¨ ëª¨ë“œ ë¼ë²¨ ì—…ë°ì´íŠ¸
        if(yoyLabel) yoyLabel.textContent = 'íŒë§¤ìœ¨ ìµœëŒ€ê°’:';
        if(yoyUnit) yoyUnit.textContent = '%';
        // íŒë§¤ìœ¨ ëª¨ë“œ ë²”ìœ„ ì„¤ì • (ë§‰ëŒ€ ê·¸ë˜í”„ y0 ì¶•)
        if(yoySlider) {
          yoySlider.min = 10;
          yoySlider.max = 100;
          yoySlider.value = saleRateBarMaxValue;
        }
        if(yoyInput) {
          yoyInput.min = 10;
          yoyInput.max = 100;
          yoyInput.value = saleRateBarMaxValue;
        }
      }
      
      // í˜„ì¬ í•„í„°ë§ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const computed = getBrandItemTableData(currentBrand);
      const sourceRows = itemTableCategory==='ALL'
        ? [...(computed.Outer||[]), ...(computed.Inner||[]), ...(computed.Bottom||[]), ...(computed.Wear_etc||[])]
        : (computed[itemTableCategory]||[]);
      const rows = sourceRows.map(r=>({ ...r }));
      
      // ì „ë…„ë¹„ ì°¨ì´ê°’ ê³„ì‚° í•¨ìˆ˜
      const getDiffValue = (r)=>{
        if (r.diffText && typeof r.diffText === 'string'){
          const m = r.diffText.match(/[+â–³-]?\s*([0-9]+(?:\.[0-9]+)?)%p/);
          if (m){
            const n = parseFloat(m[1]);
            const neg = r.diffText.trim().startsWith('â–³') || r.diffText.trim().startsWith('-');
            return neg ? -n : +n;
          }
        }
        if(r.rateNow!=null && r.rateLast!=null && !isNaN(r.rateNow) && !isNaN(r.rateLast)){
          return Number(r.rateNow) - Number(r.rateLast);
        }
        return 0;
      };
      
      // í‘œì™€ ë™ì¼í•œ ì •ë ¬ ë¡œì§ ì ìš©
      const sorters = {
        category: (a,b)=> (a.category===b.category ? (b.weekly - a.weekly) : (a.category > b.category ? 1 : -1)),
        po:       (a,b)=> ((b.poNow??-1) - (a.poNow??-1)),
        weekly:   (a,b)=> (b.weekly - a.weekly),
        cum:      (a,b)=> (b.cum - a.cum),
        rateNow:  (a,b)=> ((b.rateNow??-1) - (a.rateNow??-1))
      };
      // í‘œì˜ ì •ë ¬ ì˜µì…˜ì— ë”°ë¼ ì •ë ¬í•˜ì—¬ ìƒìœ„ 15ê°œ ì„ íƒ
      const sorted = [...rows].sort(sorters[itemTableSort] || sorters.cum).slice(0, 15);
      
      // ë°ì´í„° ì¤€ë¹„
      const labels = sorted.map(d => d.code);
      const salesRates = sorted.map(d => d.rateNow || 0);
      const yearDiffs = sorted.map(d => getDiffValue(d));
      
      // ë°” ìƒ‰ìƒ ê²°ì • (íŒë§¤ìœ¨ ê¸°ì¤€)
      const barColors = salesRates.map(rate => {
        if (rate >= 20) return 'rgba(104, 211, 145, 0.8)'; // ê³ íš¨ìœ¨: ì´ˆë¡
        if (rate >= 10) return 'rgba(102, 126, 234, 0.8)'; // ë³´í†µ: íŒŒë‘
        return 'rgba(252, 129, 129, 0.8)'; // ì €íš¨ìœ¨: ë¹¨ê°•
      });
      
      // ë¼ì¸ ìƒ‰ìƒ ê²°ì • (ì „ë…„ë¹„ íŒë§¤ìœ¨ ì¦ê°)
      const lineColors = yearDiffs.map(diff => {
        if (diff > 0) return 'rgba(104, 211, 145, 1)'; // íš¨ìœ¨ ê°œì„ : ì´ˆë¡
        if (diff >= -5) return 'rgba(246, 173, 85, 1)'; // ì†Œí­ ë‘”í™”: ì£¼í™©
        return 'rgba(252, 129, 129, 1)'; // ê¸‰ê²© ë‘”í™”: ë¹¨ê°•
      });
      
      const ctx = document.getElementById('saleRateChart');
      if(!ctx) return;
      
      // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
      if(saleRateChartInstance){
        saleRateChartInstance.destroy();
        saleRateChartInstance = null;
      }
      
      // ìƒˆ ì°¨íŠ¸ ìƒì„±
      saleRateChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ëˆ„ì íŒë§¤ìœ¨',
              data: salesRates,
              backgroundColor: barColors,
              borderColor: barColors.map(c => c.replace('0.8', '1')),
              borderWidth: 2,
              borderRadius: 8,
              yAxisID: 'y',
              order: 2
            },
            {
              label: 'ì „ë…„ì°¨ì´',
              data: yearDiffs,
              type: 'line',
              borderColor: '#f6ad55',
              backgroundColor: 'rgba(246, 173, 85, 0.1)',
              borderWidth: 3,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointBackgroundColor: lineColors,
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              tension: 0.3,
              yAxisID: 'y1',
              order: 1,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: {
              right: 20
            }
          },
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              bodySpacing: 6,
              callbacks: {
                title: function(context) {
                  const index = context[0].dataIndex;
                  return sorted[index].name;
                },
                label: function(context) {
                  const index = context.dataIndex;
                  const item = sorted[index];
                  
                  if (context.dataset.label === 'ëˆ„ì íŒë§¤ìœ¨') {
                    const rateVal = Number(item.rateNow) || 0;
                    return `íŒë§¤ìœ¨: ${rateVal.toFixed(1)}%`;
                  } else {
                    const diff = getDiffValue(item);
                    const sign = diff > 0 ? '+' : '';
                    return `ì „ë…„ë¹„ íŒë§¤ìœ¨: ${sign}${diff.toFixed(1)}%p`;
                  }
                }
              }
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'íŒë§¤ìœ¨ (%)',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              beginAtZero: true,
              max: saleRateBarMaxValue,
              grid: {
                drawOnChartArea: true,
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return value + '%';
                },
                font: {
                  size: 12
                }
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'ì „ë…„ ëŒ€ë¹„ íŒë§¤ìœ¨ ì¦ê° (p)',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              min: -saleRateYoyMaxValue,
              max: saleRateYoyMaxValue,
              grid: {
                drawOnChartArea: false,
              },
              ticks: {
                callback: function(value) {
                  const sign = value > 0 ? '+' : '';
                  return sign + value + 'p';
                },
                font: {
                  size: 12
                }
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: {
                  size: 13,
                  weight: 'bold'
                },
                maxRotation: 0,
                autoSkip: false
              },
              offset: true
            }
          }
        }
      });
    }
    
    // -------- ì¬ê³ ì£¼ìˆ˜ ì°¨íŠ¸ (Dual Axis) --------
    let inventoryChartInstance = null;
    let inventoryYoyMaxValue = 200; // YOY ì¶• ìµœëŒ€ê°’ ê¸°ë³¸ê°’
    let inventoryBarMaxValue = 150; // ì¬ê³ ì£¼ìˆ˜ ë§‰ëŒ€ ê·¸ë˜í”„(y0) ìµœëŒ€ê°’ ê¸°ë³¸ê°’
    
    function updateInventoryChart(){
      const chartContainer = document.getElementById('saleRateChartContainer');
      if(!chartContainer) return;
      
      // ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œì¼ ë•Œ í‘œì‹œ
      chartContainer.style.display = 'block';
      
      // YOY ì¶• ìµœëŒ€ê°’ ì¡°ì ˆ ì»¨íŠ¸ë¡¤ í‘œì‹œ
      const yoyControl = document.getElementById('inventoryYoyMaxControl');
      const yoyLabel = document.getElementById('yoyMaxLabel');
      const yoyUnit = document.getElementById('yoyMaxUnit');
      const yoySlider = document.getElementById('inventoryYoyMaxSlider');
      const yoyInput = document.getElementById('inventoryYoyMaxInput');
      if(yoyControl) {
        yoyControl.style.display = 'flex';
        // ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ ë¼ë²¨ ì—…ë°ì´íŠ¸
        if(yoyLabel) yoyLabel.textContent = 'ì¬ê³ ì£¼ìˆ˜ ìµœëŒ€ê°’:';
        if(yoyUnit) yoyUnit.textContent = 'ì£¼';
        // ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ ë²”ìœ„ ì„¤ì • (10~500, ì˜ˆ: 150 ì„¤ì • ê°€ëŠ¥) - ë§‰ëŒ€ ê·¸ë˜í”„ y0 ì¶•
        if(yoySlider) {
          yoySlider.min = 10;
          yoySlider.max = 500;
          yoySlider.value = inventoryBarMaxValue;
        }
        if(yoyInput) {
          yoyInput.min = 10;
          yoyInput.max = 500;
          yoyInput.value = inventoryBarMaxValue;
        }
      }
      
      // â˜… ì „ì—­ brandCodeMap ì‚¬ìš© â˜…
      // í˜„ì¬ ë¸Œëœë“œì— ë§ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì•ˆì „í•œ ì ‘ê·¼)
      const brandCode = brandCodeMap[currentBrand] || 'X';
      const inventoryDataByBrand = window.inventoryTableDataByBrand || inventoryTableDataByBrand || {};
      const dataToRender = inventoryDataByBrand[brandCode] || inventoryDataByBrand['X'] || [];
      
      // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
      const filtered = itemTableCategory==='ALL' 
        ? dataToRender 
        : dataToRender.filter(r => {
            const cat = r.category || '';
            if(itemTableCategory==='Shoes') return cat==='Shoes';
            if(itemTableCategory==='Headwear') return cat==='Headwear';
            if(itemTableCategory==='Bag') return cat==='Bag';
            if(itemTableCategory==='Acc_etc') return cat==='Acc_etc';
            return true;
          });
      
      // í‘œì™€ ë™ì¼í•œ ì •ë ¬ ë¡œì§ ì ìš© (ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ)
      const sorters = {
        category: (a,b)=> (a.category===b.category ? (b.sales||0) - (a.sales||0) : (a.category > b.category ? 1 : -1)),
        sales: (a,b)=> ((b.sales||0) - (a.sales||0)),
        stockQty: (a,b)=> ((b.stockQty||0) - (a.stockQty||0)),
        stockWeeks: (a,b)=> ((b.stockWeeks||0) - (a.stockWeeks||0))
      };
      // í‘œì˜ ì •ë ¬ ì˜µì…˜ì— ë”°ë¼ ì •ë ¬í•˜ì—¬ ìƒìœ„ 15ê°œ ì„ íƒ
      const sorted = [...filtered]
        .filter(r => r.sales != null && !isNaN(r.sales)) // ë§¤ì¶œì´ ìˆëŠ” ê²ƒë§Œ
        .sort(sorters[itemTableSort] || sorters.sales)
        .slice(0, 15);
      
      // ë°ì´í„° ì¤€ë¹„
      const labels = sorted.map(d => d.item);
      const stockWeeksData = sorted.map(d => d.stockWeeks || 0);
      const diffData = sorted.map(d => {
        const diff = d.diff;
        return (diff != null && !isNaN(diff)) ? diff : 0;
      });
      
      // ë°” ìƒ‰ìƒ ê²°ì • (ì¬ê³ ì£¼ìˆ˜ ê¸°ì¤€: ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)
      const barColors = stockWeeksData.map(weeks => {
        if (weeks <= 30) return 'rgba(104, 211, 145, 0.8)'; // ì–‘í˜¸: ì´ˆë¡
        if (weeks <= 60) return 'rgba(102, 126, 234, 0.8)'; // ë³´í†µ: íŒŒë‘
        return 'rgba(252, 129, 129, 0.8)'; // ë†’ìŒ: ë¹¨ê°•
      });
      
      // ë¼ì¸ ìƒ‰ìƒ ê²°ì • (ì¬ê³ ì£¼ìˆ˜ ì°¨ì´)
      const lineColors = diffData.map(diff => {
        if (diff <= -50) return 'rgba(104, 211, 145, 1)'; // ë§ì´ ê°œì„ : ì´ˆë¡
        if (diff <= 0) return 'rgba(246, 173, 85, 1)'; // ì†Œí­ ê°œì„ /ìœ ì§€: ì£¼í™©
        return 'rgba(252, 129, 129, 1)'; // ì¦ê°€: ë¹¨ê°•
      });
      
      const ctx = document.getElementById('saleRateChart');
      if(!ctx) return;
      
      // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
      if(inventoryChartInstance){
        inventoryChartInstance.destroy();
        inventoryChartInstance = null;
      }
      
      // ì¬ê³ ì£¼ìˆ˜ ìµœëŒ“ê°’ ê³„ì‚° (Yì¶• ë²”ìœ„ ì„¤ì •) - ì‚¬ìš©ìê°€ ì„¤ì •í•œ ê°’ ì‚¬ìš©
      const maxStockWeeks = Math.max(...stockWeeksData.filter(w => w != null && !isNaN(w) && w > 0), 100);
      const yAxisMax = inventoryBarMaxValue || Math.ceil(maxStockWeeks * 1.1);
      // inventoryBarMaxValueê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°ëœ ê°’ ì‚¬ìš©
      const finalYAxisMax = inventoryBarMaxValue || yAxisMax;
      
      // ìƒˆ ì°¨íŠ¸ ìƒì„±
      inventoryChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ì¬ê³ ì£¼ìˆ˜',
              data: stockWeeksData,
              backgroundColor: barColors,
              borderColor: barColors.map(c => c.replace('0.8', '1')),
              borderWidth: 2,
              borderRadius: 8,
              yAxisID: 'y',
              order: 2
            },
            {
              label: 'ì¬ê³ ì£¼ìˆ˜ì°¨ì´',
              data: diffData,
              type: 'line',
              borderColor: '#60a5fa',
              backgroundColor: 'rgba(96, 165, 250, 0.1)',
              borderWidth: 3,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointBackgroundColor: lineColors,
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              tension: 0.3,
              yAxisID: 'y1',
              order: 1,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              bodySpacing: 6,
              callbacks: {
                title: function(context) {
                  const index = context[0].dataIndex;
                  return sorted[index].name;
                },
                label: function(context) {
                  const index = context.dataIndex;
                  const item = sorted[index];
                  
                  if (context.dataset.label === 'ì¬ê³ ì£¼ìˆ˜') {
                    return `ì¬ê³ ì£¼ìˆ˜: ${(item.stockWeeks || 0).toFixed(1)}ì£¼`;
                  } else {
                    const diff = item.diff;
                    const diffValue = (diff != null && !isNaN(diff)) ? diff : 0;
                    const sign = diffValue > 0 ? '+' : '';
                    return `ì „ë…„ë¹„ ì°¨ì´: ${sign}${diffValue.toFixed(1)}`;
                  }
                },
                afterLabel: function(context) {
                  const index = context.dataIndex;
                  const item = sorted[index];
                  
                  if (context.dataset.label === 'ì¬ê³ ì£¼ìˆ˜') {
                    return `ë§¤ì¶œ: ${((item.sales || 0)).toFixed(1)}ë°±ë§Œì›`;
                  }
                }
              }
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'ì¬ê³ ì£¼ìˆ˜ (ì£¼)',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              beginAtZero: true,
              max: finalYAxisMax,
              grid: {
                drawOnChartArea: true,
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return value + 'ì£¼';
                },
                font: {
                  size: 12
                }
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'ì¬ê³ ì£¼ìˆ˜ ì°¨ì´',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                drawOnChartArea: false,
              },
              ticks: {
                callback: function(value) {
                  const sign = value > 0 ? '+' : '';
                  return sign + value;
                },
                font: {
                  size: 12
                }
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: {
                  size: 13,
                  weight: 'bold'
                }
              }
            }
          }
        }
      });
    }
    
    // YOY ì¶• ìµœëŒ€ê°’ ì¡°ì ˆ í•¨ìˆ˜ (ì¬ê³ ì£¼ìˆ˜)
    function updateInventoryYoyMax() {
      if (!inventoryChartInstance) return;
      
      // ì°¨íŠ¸ì˜ y1 ì¶• ìµœëŒ€ê°’ ì—…ë°ì´íŠ¸
      if (inventoryChartInstance.options && inventoryChartInstance.options.scales && inventoryChartInstance.options.scales.y1) {
        inventoryChartInstance.options.scales.y1.min = -inventoryYoyMaxValue;
        inventoryChartInstance.options.scales.y1.max = inventoryYoyMaxValue;
        inventoryChartInstance.update();
      }
    }
    
    // YOY ì¶• ìµœëŒ€ê°’ ì¡°ì ˆ í•¨ìˆ˜ (íŒë§¤ìœ¨)
    function updateSaleRateYoyMax() {
      if (!saleRateChartInstance) return;
      
      // ì°¨íŠ¸ì˜ y1 ì¶• ìµœëŒ€ê°’ ì—…ë°ì´íŠ¸
      if (saleRateChartInstance.options && saleRateChartInstance.options.scales && saleRateChartInstance.options.scales.y1) {
        saleRateChartInstance.options.scales.y1.min = -saleRateYoyMaxValue;
        saleRateChartInstance.options.scales.y1.max = saleRateYoyMaxValue;
        saleRateChartInstance.update();
      }
    }
    
    // íŒë§¤ìœ¨ ë§‰ëŒ€ ê·¸ë˜í”„(y0) ìµœëŒ€ê°’ ì¡°ì ˆ í•¨ìˆ˜
    function updateSaleRateBarMax() {
      if (!saleRateChartInstance) return;
      
      // ì°¨íŠ¸ì˜ y0 ì¶• ìµœëŒ€ê°’ ì—…ë°ì´íŠ¸
      if (saleRateChartInstance.options && saleRateChartInstance.options.scales && saleRateChartInstance.options.scales.y) {
        saleRateChartInstance.options.scales.y.max = saleRateBarMaxValue;
        saleRateChartInstance.update();
      }
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ë§‰ëŒ€ ê·¸ë˜í”„(y0) ìµœëŒ€ê°’ ì¡°ì ˆ í•¨ìˆ˜
    function updateInventoryBarMax() {
      if (!inventoryChartInstance) return;
      
      // ì°¨íŠ¸ì˜ y0 ì¶• ìµœëŒ€ê°’ ì—…ë°ì´íŠ¸
      if (inventoryChartInstance.options && inventoryChartInstance.options.scales && inventoryChartInstance.options.scales.y) {
        inventoryChartInstance.options.scales.y.max = inventoryBarMaxValue;
        inventoryChartInstance.update();
      }
    }
    
    // YOY ì¶• ìµœëŒ€ê°’ ì¡°ì ˆ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
    function initInventoryYoyMaxControl() {
      const slider = document.getElementById('inventoryYoyMaxSlider');
      const input = document.getElementById('inventoryYoyMaxInput');
      
      if (slider) {
        slider.addEventListener('input', function(e) {
          const value = parseInt(e.target.value);
          // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì ì ˆí•œ ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (ë§‰ëŒ€ ê·¸ë˜í”„ y0 ì¶•)
          if (itemTableMode === 'inventory') {
            inventoryBarMaxValue = value;
            if (input) input.value = value;
            updateInventoryBarMax();
          } else if (itemTableMode === 'sale') {
            saleRateBarMaxValue = value;
            if (input) input.value = value;
            updateSaleRateBarMax();
          }
        });
      }
      
      if (input) {
        input.addEventListener('change', function(e) {
          let value = parseInt(e.target.value);
          // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì ì ˆí•œ ë²”ìœ„ì™€ ë³€ìˆ˜ ì„¤ì • (ë§‰ëŒ€ ê·¸ë˜í”„ y0 ì¶•)
          if (itemTableMode === 'inventory') {
            if (isNaN(value) || value < 10) value = 10;
            if (value > 500) value = 500;
            inventoryBarMaxValue = value;
            if (slider) {
              slider.value = value;
              slider.min = 10;
              slider.max = 500;
            }
            updateInventoryBarMax();
          } else if (itemTableMode === 'sale') {
            if (isNaN(value) || value < 10) value = 10;
            if (value > 100) value = 100;
            saleRateBarMaxValue = value;
            if (slider) {
              slider.value = value;
              slider.min = 10;
              slider.max = 100;
            }
            updateSaleRateBarMax();
          }
        });
      }
    }
    
    // -------- íŠ¸ë¦¬ë§µ ê´€ë ¨ ë³€ìˆ˜ --------
    let treemapCurrentType = 'channel'; // 'channel' or 'item'
    let treemapCurrentPath = []; // ë“œë¦´ë‹¤ìš´ ê²½ë¡œ
    let treemapChartInstance = null;
    let channelTreemapPath = []; // ì±„ë„ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ
    let itemTreemapPath = []; // ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ
    
    // íŠ¸ë¦¬ë§µ í¬ê¸° ì €ì¥ í‚¤
    const TREEMAP_SIZE_STORAGE_KEY = 'treemap_sizes';
    
    // íŠ¸ë¦¬ë§µ í¬ê¸° ê°€ì ¸ì˜¤ê¸° (ì €ì¥ëœ í¬ê¸°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ í˜„ì¬ í¬ê¸° ê³„ì‚° í›„ ì €ì¥)
    function getTreemapSize(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return null;
      
      const storedSizes = JSON.parse(localStorage.getItem(TREEMAP_SIZE_STORAGE_KEY) || '{}');
      
      // ì €ì¥ëœ í¬ê¸°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
      if (storedSizes[containerId]) {
        return storedSizes[containerId];
      }
      
      // ì €ì¥ëœ í¬ê¸°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ í¬ê¸° ê³„ì‚°
      const rect = container.getBoundingClientRect();
      const size = {
        width: rect.width,
        height: rect.height
      };
      
      // localStorageì— ì €ì¥
      storedSizes[containerId] = size;
      localStorage.setItem(TREEMAP_SIZE_STORAGE_KEY, JSON.stringify(storedSizes));
      
      return size;
    }
    
    // ì±„ë„ ëª©ë¡ ì •ì˜
    const channelList = ['ë°±í™”ì ', 'ë©´ì„¸ì ', 'ì§ì˜ì (ê°€ë‘)', 'ëŒ€ë¦¬ì ', 'ì•„ìš¸ë ›', 'ì‚¬ì…', 'ì§ì˜ëª°', 'ê¸°íƒ€', 'ì œíœ´ëª°', 'ìì‚¬ëª°'];
    
    // ì•„ì´í…œ ëª©ë¡ ì •ì˜ (í‘œì‹œ ìˆœì„œ)
    const itemList = ['ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜', 'ëª¨ì', 'ì‹ ë°œ', 'ê°€ë°©', 'ê¸°íƒ€ACC'];
    
    // ì±„ë„ ë§ˆìŠ¤í„° ì •ì˜ (ì±„ë„ë²ˆí˜¸_SF, ì±„ë„ë²ˆí˜¸_SAP, ì±„ë„ëª…, ìµœì¢…ì±„ë„)
    const channelMaster = {
      '1': { sap: '01', name: 'ë°±í™”ì ', final: 'ë°±í™”ì ' },
      '2': { sap: '02', name: 'ë©´ì„¸ì ', final: 'ë©´ì„¸ì ' },
      '3': { sap: '03', name: 'ì§ì˜(ê°€ë‘)', final: 'ì§ì˜ì (ê°€ë‘)' },
      '4': { sap: '04', name: 'ì˜¨ë¼ì¸(ì§)', final: 'ìì‚¬ëª°' },
      '5': { sap: '05', name: 'ì˜¨ë¼ì¸(ëŒ€)', final: 'ì œíœ´ëª°' },
      '6': { sap: '06', name: 'ëŒ€ë¦¬ì ', final: 'ëŒ€ë¦¬ì ' },
      '7': { sap: '07', name: 'ì•„ìš¸ë ›(ì§)', final: 'ì•„ìš¸ë ›' },
      '8': { sap: '08', name: 'ì‚¬ì…', final: 'ì‚¬ì…' },
      '9': { sap: '09', name: 'ìˆ˜ì¶œ', final: 'ìˆ˜ì¶œ' },
      '11': { sap: '11', name: 'ì§ì˜(ê°€ë‘)2', final: 'ì§ì˜ëª°' },
      '12': { sap: '12', name: 'ì•„ìš¸ë ›(ì§)2', final: 'ì•„ìš¸ë ›' },
      '99': { sap: '99', name: 'ê¸°íƒ€', final: 'ê¸°íƒ€' }
    };
    
    // ì±„ë„ëª… â†’ ìµœì¢…ì±„ë„ ë§¤í•‘ (ì›ë³¸ ì±„ë„ëª… â†’ ìµœì¢…ì±„ë„ëª…)
    const channelNameToFinal = {
      'ë°±í™”ì ': 'ë°±í™”ì ',
      'ë©´ì„¸ì ': 'ë©´ì„¸ì ',
      'ì§ì˜(ê°€ë‘)': 'ì§ì˜ì (ê°€ë‘)',
      'ì§ì˜ê°€ë‘': 'ì§ì˜ì (ê°€ë‘)',
      'ì§ì˜ì ': 'ì§ì˜ì (ê°€ë‘)',
      'ì˜¨ë¼ì¸(ì§)': 'ìì‚¬ëª°',
      'ì˜¨ë¼ì¸ìì‚¬': 'ìì‚¬ëª°',
      'ì˜¨ë¼ì¸(ëŒ€)': 'ì œíœ´ëª°',
      'ì˜¨ë¼ì¸ì œíœ´': 'ì œíœ´ëª°',
      'ëŒ€ë¦¬ì ': 'ëŒ€ë¦¬ì ',
      'ì•„ìš¸ë ›(ì§)': 'ì•„ìš¸ë ›',
      'ì•„ìš¸ë ›(ì§)2': 'ì•„ìš¸ë ›',
      'ì‚¬ì…': 'ì‚¬ì…',
      'ìˆ˜ì¶œ': 'ìˆ˜ì¶œ',
      'ì§ì˜(ê°€ë‘)2': 'ì§ì˜ëª°',
      'ê¸°íƒ€': 'ê¸°íƒ€',
      // ìµœì¢…ì±„ë„ëª…ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
      'ìì‚¬ëª°': 'ìì‚¬ëª°',
      'ì œíœ´ëª°': 'ì œíœ´ëª°',
      'ì§ì˜ëª°': 'ì§ì˜ëª°',
      'ì•„ìš¸ë ›': 'ì•„ìš¸ë ›',
      'ì§ì˜ì (ê°€ë‘)': 'ì§ì˜ì (ê°€ë‘)'
    };
    
    // ì±„ë„ í‚¤ ë§¤í•‘ (ë°ì´í„°ì—ì„œ ì‚¬ìš©í•˜ëŠ” í‚¤ â†’ í‘œì‹œëª…) - ìµœì¢…ì±„ë„ëª… ì‚¬ìš©
    const channelKeyMap = {
      'ë°±í™”ì ': 'ë°±í™”ì ',
      'ë©´ì„¸ì ': 'ë©´ì„¸ì ',
      'ì§ì˜ê°€ë‘': 'ì§ì˜ì (ê°€ë‘)',
      'ì§ì˜ì ': 'ì§ì˜ì (ê°€ë‘)',
      'ì§ì˜ì (ê°€ë‘)': 'ì§ì˜ì (ê°€ë‘)',
      'ëŒ€ë¦¬ì ': 'ëŒ€ë¦¬ì ',
      'ì•„ìš¸ë ›': 'ì•„ìš¸ë ›',
      'ì‚¬ì…': 'ì‚¬ì…',
      'ì§ì˜ëª°': 'ì§ì˜ëª°',
      'ê¸°íƒ€': 'ê¸°íƒ€',
      'ì˜¨ë¼ì¸ì œíœ´': 'ì œíœ´ëª°',
      'ì œíœ´ëª°': 'ì œíœ´ëª°',
      'ì˜¨ë¼ì¸ìì‚¬': 'ìì‚¬ëª°',
      'ìì‚¬ëª°': 'ìì‚¬ëª°',
      'ì˜¨ë¼ì¸': 'ìì‚¬ëª°',
      'ìˆ˜ì¶œ': 'ìˆ˜ì¶œ'
    };
    
    // ì•„ì´í…œ í‚¤ ë§¤í•‘ (ë°ì´í„° í‚¤ â†’ í‘œì‹œëª…)
    const itemKeyMap = {
      // ì˜ë¥˜ ì¹´í…Œê³ ë¦¬
      'ë‹¹ì‹œì¦Œ': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
      'ì°¨ì‹œì¦Œ': 'ì°¨ì‹œì¦Œì˜ë¥˜',
      'ê³¼ì‹œì¦Œ': 'ê³¼ì‹œì¦Œì˜ë¥˜',
      // ACC ì¹´í…Œê³ ë¦¬ (ë°ì´í„° í‚¤ â†’ í‘œì‹œëª…)
      'Shoes': 'ì‹ ë°œ',
      'Headwear': 'ê°€ë°©',
      'Cap': 'ëª¨ì',
      'Bag': 'ê°€ë°©', // í˜¹ì‹œ Bag í‚¤ë„ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ
      'ACC_etc': 'ê¸°íƒ€ACC',
      'ACC': 'ê¸°íƒ€ACC',
      'ê¸°íƒ€ACC': 'ê¸°íƒ€ACC',
      // í‘œì‹œëª…ìœ¼ë¡œ ì§ì ‘ ë§¤í•‘
      'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
      'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜',
      'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜',
      'ì‹ ë°œ': 'ì‹ ë°œ',
      'ê°€ë°©': 'ê°€ë°©',
      'ëª¨ì': 'ëª¨ì'
    };
    
    // ë¸Œëœë“œë³„ ì±„ë„-ì•„ì´í…œ ë§¤ì¶œ ìƒì„¸ ë°ì´í„° (íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ìš©) - ì™¸ë¶€(data.js)ë§Œ ì‚¬ìš©
    // í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½ (ë°ì´í„° ë¡œë“œ í›„ ì‚¬ìš© ë³´ì¥)
    function getChannelItemSalesData() {
      // â˜… JSON ê¸°ë°˜ íŠ¸ë¦¬ë§µ ë¹„í™œì„±í™” - Snowflake API ì‚¬ìš© â˜…
      return {}; // í•­ìƒ ë¹ˆ ê°ì²´ ë°˜í™˜í•˜ì—¬ ì˜›ë‚  íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” ë°©ì§€
    }
    // (ì°¸ê³ ) ì•„ë˜ í•˜ë“œì½”ë”© ë°ì´í„°ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•„ìš” ì‹œ __HARDCODED ì°¸ì¡°
    const __HARDCODED = {
      'I': { // MLB KIDS
        'ê¸°íƒ€': { 'Acc_etc': 71850, 'Bag': 31090, 'Headwear': 187920, 'Shoes': 138500, 'ê³¼ì‹œì¦Œì˜ë¥˜': 640590, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 1740610 },
        'ëŒ€ë¦¬ì ': { 'Acc_etc': 3066380, 'Bag': 52048790, 'Headwear': 70906760, 'Shoes': 122850940, 'ê³¼ì‹œì¦Œì˜ë¥˜': 1737650, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 647585430 },
        'ë©´ì„¸ì ': { 'Acc_etc': 9493440, 'Bag': 71785770, 'Headwear': 208536820, 'Shoes': 49094000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 1373000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 377373000 },
        'ë°±í™”ì ': { 'Acc_etc': 17704810, 'Bag': 309370570, 'Headwear': 213772050, 'Shoes': 394011940, 'ê³¼ì‹œì¦Œì˜ë¥˜': 164331970, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 1982851910 },
        'ì‚¬ì…': { 'Acc_etc': 6949610, 'Bag': -64950, 'Headwear': 51516960, 'Shoes': 9969050, 'ê³¼ì‹œì¦Œì˜ë¥˜': 1380477890 },
        'ì œíœ´ëª°': { 'Acc_etc': 12714200, 'Bag': 11835000, 'Headwear': 61108000, 'Shoes': 141761940, 'ê³¼ì‹œì¦Œì˜ë¥˜': 75853490, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 699073160 },
        'ìì‚¬ëª°': { 'Acc_etc': 2814110, 'Bag': 4015280, 'Headwear': 17766200, 'Shoes': 44416780, 'ê³¼ì‹œì¦Œì˜ë¥˜': 12390560, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 254329750 },
        'ì§ì˜ì (ê°€ë‘)': { 'Acc_etc': 1400430, 'Bag': 3234000, 'Headwear': 18683340, 'Shoes': 14990960, 'ê³¼ì‹œì¦Œì˜ë¥˜': 1475000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 81776060 },
        'ì§ì˜ëª°': { 'Acc_etc': 3418660, 'Bag': 5418370, 'Headwear': 55990400, 'Shoes': 58269100, 'ê³¼ì‹œì¦Œì˜ë¥˜': 3130960, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 216290810 }
      },
      'M': { // MLB
        'ê¸°íƒ€': { 'Acc_etc': 273280, 'Bag': 124000, 'Headwear': 1126000, 'Shoes': 1780990, 'ê³¼ì‹œì¦Œì˜ë¥˜': 1352000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 5494000 },
        'ëŒ€ë¦¬ì ': { 'Acc_etc': 17859300, 'Bag': 152707820, 'Headwear': 2132571080, 'Shoes': 1187845070, 'ê³¼ì‹œì¦Œì˜ë¥˜': 134895010, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 2077764810 },
        'ë©´ì„¸ì ': { 'Acc_etc': 10917700, 'Bag': 353734650, 'Headwear': 7716959750, 'Shoes': 1613206900, 'ê³¼ì‹œì¦Œì˜ë¥˜': 121250580, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 1204148170 },
        'ë°±í™”ì ': { 'Acc_etc': 21562060, 'Bag': 962703160, 'Headwear': 2036653800, 'Shoes': 1601231230, 'ê³¼ì‹œì¦Œì˜ë¥˜': 112463110, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 2586454600 },
        'ì‚¬ì…': { 'Acc_etc': 1859210, 'Bag': 53454740, 'Headwear': 9295780, 'Shoes': 266500490, 'ê³¼ì‹œì¦Œì˜ë¥˜': 2707466670 },
        'ì œíœ´ëª°': { 'Acc_etc': 5886300, 'Bag': 37742000, 'Headwear': 887108220, 'Shoes': 315598480, 'ê³¼ì‹œì¦Œì˜ë¥˜': 34630000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 587293990 },
        'ìì‚¬ëª°': { 'Acc_etc': 4254632, 'Bag': 39616384, 'Headwear': 368560394, 'Shoes': 173530809, 'ê³¼ì‹œì¦Œì˜ë¥˜': 20698230, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 371457659 },
        'ì§ì˜ì (ê°€ë‘)': { 'Acc_etc': 17653940, 'Bag': 92602910, 'Headwear': 1103128350, 'Shoes': 389390590, 'ê³¼ì‹œì¦Œì˜ë¥˜': 26739700, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 768505630 },
        'ì§ì˜ëª°': { 'Acc_etc': 2074730, 'Bag': 11994950, 'Headwear': 179785180, 'Shoes': 83792830, 'ê³¼ì‹œì¦Œì˜ë¥˜': 13769090, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 283439560 },
        'RF': { 'Acc_etc': 7969260, 'Bag': 107621010, 'Headwear': 802879500, 'Shoes': 407418540, 'ê³¼ì‹œì¦Œì˜ë¥˜': 19394480, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 681523800 }
      },
      'ST': { // SERGIO
        'ê¸°íƒ€': { 'Acc_etc': 15000, 'Bag': 0, 'Headwear': 0, 'Shoes': 58080, 'ê³¼ì‹œì¦Œì˜ë¥˜': 145150, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 0 },
        'ë©´ì„¸ì ': { 'Acc_etc': 2406120, 'Bag': 3221300, 'Headwear': 2255600, 'Shoes': 2182400, 'ê³¼ì‹œì¦Œì˜ë¥˜': 32084640, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 34243090, 'ì°¨ì‹œì¦Œì˜ë¥˜': 824300 },
        'ë°±í™”ì ': { 'Acc_etc': 367600, 'Bag': 1111900, 'Headwear': 525100, 'Shoes': 1405290, 'ê³¼ì‹œì¦Œì˜ë¥˜': 3759240, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 8547200, 'ì°¨ì‹œì¦Œì˜ë¥˜': 634500 },
        'ì•„ìš¸ë ›': { 'Acc_etc': 1765960, 'Bag': 7580620, 'Headwear': 4110660, 'Shoes': 3444640, 'ê³¼ì‹œì¦Œì˜ë¥˜': 125173350, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 5516990 },
        'ì œíœ´ëª°': { 'Acc_etc': 2366000, 'Bag': 5626700, 'Headwear': 3053000, 'Shoes': 28006300, 'ê³¼ì‹œì¦Œì˜ë¥˜': 205958110, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 24053000, 'ì°¨ì‹œì¦Œì˜ë¥˜': 1102000 },
        'ìì‚¬ëª°': { 'Acc_etc': 4862500, 'Bag': 11594940, 'Headwear': 8743870, 'Shoes': 15234110, 'ê³¼ì‹œì¦Œì˜ë¥˜': 88513750, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 102029000, 'ì°¨ì‹œì¦Œì˜ë¥˜': 3240780 },
        'ì§ì˜ì (ê°€ë‘)': { 'Acc_etc': 797700, 'Bag': 1810600, 'Headwear': 2617900, 'Shoes': 1269600, 'ê³¼ì‹œì¦Œì˜ë¥˜': 21580970, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 56290400, 'ì°¨ì‹œì¦Œì˜ë¥˜': 4017100 },
        'ì§ì˜ëª°': { 'Acc_etc': 2317640, 'Bag': 7229700, 'Headwear': 5602580, 'Shoes': 3813000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 88698180, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 51693700, 'ì°¨ì‹œì¦Œì˜ë¥˜': 3840400 }
      },
      'V': { // DUVETICA
        'ê¸°íƒ€': { 'Bag': 0, 'Shoes': 0, 'ê³¼ì‹œì¦Œì˜ë¥˜': 453000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 229680 },
        'ë°±í™”ì ': { 'Acc_etc': 6115300, 'Bag': 27074010, 'Headwear': 13397750, 'Shoes': 5980000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 291684870, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 988206070 },
        'ì•„ìš¸ë ›': { 'Acc_etc': 429480, 'Bag': 4973300, 'Headwear': 5568640, 'Shoes': 6537900, 'ê³¼ì‹œì¦Œì˜ë¥˜': 907242650, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 25280500 },
        'ì œíœ´ëª°': { 'Acc_etc': 5574500, 'Bag': 22305500, 'Headwear': 11336800, 'Shoes': 36691800, 'ê³¼ì‹œì¦Œì˜ë¥˜': 879062010, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 242398000 },
        'ìì‚¬ëª°': { 'Acc_etc': 629070, 'Bag': 5903170, 'Headwear': 1986710, 'Shoes': 5524600, 'ê³¼ì‹œì¦Œì˜ë¥˜': 81258820, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 118253540 },
        'ì§ì˜ì (ê°€ë‘)': { 'Acc_etc': 910000, 'Bag': 1480000, 'Headwear': 210000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 961000, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 20132000 },
        'ì§ì˜ëª°': { 'Bag': 4438500, 'Headwear': 1267600, 'Shoes': 1768100, 'ê³¼ì‹œì¦Œì˜ë¥˜': 12201200, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 154262000 }
      },
      'W': { // SUPRA
        'ê¸°íƒ€': { 'Shoes': 70580, 'ê³¼ì‹œì¦Œì˜ë¥˜': 380460 },
        'ëŒ€ë¦¬ì ': { 'Bag': 371000, 'Headwear': 257000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 133000 },
        'ì œíœ´ëª°': { 'Acc_etc': 117000, 'Bag': 3995000, 'Headwear': 3473000, 'Shoes': 9452000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 130452990, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 38000 },
        'ìì‚¬ëª°': { 'Acc_etc': 103000, 'Bag': 2308800, 'Headwear': 4349790, 'Shoes': 5201632, 'ê³¼ì‹œì¦Œì˜ë¥˜': 92450170 }
      },
      'X': { // DISCOVERY
        'ê¸°íƒ€': { 'Acc_etc': 40310, 'Bag': 191630, 'Headwear': 82020, 'Shoes': 1973750, 'ê³¼ì‹œì¦Œì˜ë¥˜': 4390350, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 6022050 },
        'ëŒ€ë¦¬ì ': { 'Acc_etc': 44048620, 'Bag': 304235220, 'Headwear': 164147810, 'Shoes': 976777330, 'ê³¼ì‹œì¦Œì˜ë¥˜': 2663278400, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 8202507240 },
        'ë©´ì„¸ì ': { 'Acc_etc': 1921480, 'Bag': 84710930, 'Headwear': 7850290, 'Shoes': 165922970, 'ê³¼ì‹œì¦Œì˜ë¥˜': 15463590, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 961895850 },
        'ë°±í™”ì ': { 'Acc_etc': 31200940, 'Bag': 295956680, 'Headwear': 64365970, 'Shoes': 811087930, 'ê³¼ì‹œì¦Œì˜ë¥˜': 3608324580, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 4289795870 },
        'ì‚¬ì…': { 'Acc_etc': 350, 'Bag': 7950, 'Headwear': 8600, 'Shoes': 4212000, 'ê³¼ì‹œì¦Œì˜ë¥˜': 298130650 },
        'ì•„ìš¸ë ›': { 'Acc_etc': 12970520, 'Bag': 203146330, 'Headwear': 46073020, 'Shoes': 395684220, 'ê³¼ì‹œì¦Œì˜ë¥˜': 9298718550, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 725062240 },
        'ì œíœ´ëª°': { 'Acc_etc': 61454140, 'Bag': 128956890, 'Headwear': 14492800, 'Shoes': 392638120, 'ê³¼ì‹œì¦Œì˜ë¥˜': 2205004150, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 1124906670 },
        'ìì‚¬ëª°': { 'Acc_etc': 8020248, 'Bag': 40610799, 'Headwear': 8832710, 'Shoes': 251932187, 'ê³¼ì‹œì¦Œì˜ë¥˜': 93298259, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 1081913390 },
        'ì§ì˜ì (ê°€ë‘)': { 'Acc_etc': 1668710, 'Bag': 12912480, 'Headwear': 11362590, 'Shoes': 30872010, 'ê³¼ì‹œì¦Œì˜ë¥˜': 8006050, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 281260630 },
        'ì§ì˜ëª°': { 'Acc_etc': 1791870, 'Bag': 21465200, 'Headwear': 7708430, 'Shoes': 80686080, 'ê³¼ì‹œì¦Œì˜ë¥˜': 88766170, 'ë‹¹ì‹œì¦Œì˜ë¥˜': 687550840 }
      }
    };
    
    // -------- íŠ¸ë¦¬ë§µ ì´ˆê¸°í™” (ì±„ë„ë³„/ì•„ì´í…œë³„ ë¶„ë¦¬) --------
    function initTreemap() {
      // â˜…â˜…â˜… Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì‚¬ìš© â˜…â˜…â˜…
      console.log('[initTreemap] Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì´ˆê¸°í™”:', currentBrand);
      
      // ë§¤ì¶œêµ¬ì„± ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œë“œ
      if (!window.salesCompositionData) {
        console.log('[initTreemap] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì¤‘...');
        loadSalesCompositionData().then(() => {
          if (currentBrand && typeof updateBrandTreemaps === 'function') {
            updateBrandTreemaps(currentBrand);
          }
        });
      } else {
        // ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ë Œë”ë§
        if (currentBrand && typeof updateBrandTreemaps === 'function') {
          updateBrandTreemaps(currentBrand);
        }
      }
      
      // ë“œë¦´ë°± ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ìƒˆë¡œìš´ íŠ¸ë¦¬ë§µìš©)
      const drillbackChannelBtn = document.getElementById('treemapDrillbackChannel');
      const drillbackItemBtn = document.getElementById('treemapDrillbackItem');
      
      if (drillbackChannelBtn && !drillbackChannelBtn.hasAttribute('data-listener-new')) {
        drillbackChannelBtn.setAttribute('data-listener-new', 'true');
        drillbackChannelBtn.addEventListener('click', () => {
          if (channelTreemapDrilldownPath.length > 0) {
            channelTreemapDrilldownPath.pop();
            renderChannelSalesTreemap('treemapWrapperChannel', currentBrand);
          }
        });
      }
      
      if (drillbackItemBtn && !drillbackItemBtn.hasAttribute('data-listener-new')) {
        drillbackItemBtn.setAttribute('data-listener-new', 'true');
        drillbackItemBtn.addEventListener('click', () => {
          if (itemTreemapDrilldownPath.length > 0) {
            itemTreemapDrilldownPath.pop();
            renderItemSalesTreemap('treemapWrapperItem', currentBrand);
          }
        });
      }
    }
    
    // -------- íŠ¸ë¦¬ë§µ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ --------
    function attachTreemapClickEvent(container, type) {
      if (!container || !window.Plotly) return;
      
      // ê¸°ì¡´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±° ì‹œë„
      try {
        if (typeof container.removeAllListeners === 'function') {
          container.removeAllListeners('plotly_click');
        }
      } catch(e) {
        // removeAllListenersê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ
      }
      
      // ìƒˆ í´ë¦­ í•¸ë“¤ëŸ¬ ìƒì„±
      const clickHandler = function(data) {
        if (!data || !data.points || data.points.length === 0) return;
        
        const point = data.points[0];
        if (!point || !point.label) return;
        
        const label = point.label;
        const parent = point.parent || '';
        
        console.log('íŠ¸ë¦¬ë§µ í´ë¦­:', {type, label, parent, pathLength: type === 'channel' ? channelTreemapPath.length : itemTreemapPath.length, pointData: point});
        
        // ë“œë¦´ë‹¤ìš´ ìƒíƒœ í™•ì¸
        const isDrilldown = (type === 'channel' && channelTreemapPath.length > 0) || (type === 'item' && itemTreemapPath.length > 0);
        
        // ë“œë¦´ë‹¤ìš´ ìƒíƒœê°€ ì•„ë‹ ë•Œ: ë¶€ëª¨ê°€ ì—†ëŠ” í•­ëª©(ìµœìƒìœ„ í•­ëª©)ë§Œ í´ë¦­ ê°€ëŠ¥
        if (!isDrilldown) {
          if (parent && parent !== '') {
            console.log('í•˜ìœ„ í•­ëª© í´ë¦­ ë¬´ì‹œ (ë“œë¦´ë‹¤ìš´ ì•„ë‹˜):', label);
            return;
          }
        }
        
        if (type === 'channel') {
          // ì±„ë„ í´ë¦­ ì‹œ: ì•„ì´í…œë³„ë¡œ ë“œë¦´ë‹¤ìš´
          // RF ì±„ë„ë„ í¬í•¨í•˜ì—¬ ì²´í¬ (MLB ë¸Œëœë“œì˜ ê²½ìš° RF í¬í•¨)
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const isRFChannel = (label === 'RF' && brandCode === 'M');
          const isValidChannel = channelList.includes(label) || isRFChannel;
          console.log('ì±„ë„ ì²´í¬:', {label, inList: channelList.includes(label), isRFChannel, isValidChannel, pathLength: channelTreemapPath.length, isDrilldown, parent});
          
          // ìµœìƒìœ„ ë ˆë²¨ì—ì„œ ì±„ë„ í´ë¦­ (ë¶€ëª¨ê°€ ì—†ê³ , ë“œë¦´ë‹¤ìš´ ê²½ë¡œê°€ ë¹„ì–´ìˆì„ ë•Œ)
          if (channelTreemapPath.length === 0 && (!parent || parent === '') && isValidChannel) {
            console.log('ì±„ë„ ë“œë¦´ë‹¤ìš´ ì‹¤í–‰:', label);
            channelTreemapPath.push(label);
            updateChannelTreemap();
          }
          // ì±„ë„ ë‚´ ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ í´ë¦­ ì‹œ: ì•„ì´í…œ_ì†Œë¶„ë¥˜ë¡œ ë“œë¦´ë‹¤ìš´
          else if (channelTreemapPath.length === 1 && (!parent || parent === '')) {
            // ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ì¸ì§€ í™•ì¸ (ëª¨ì, ì‹ ë°œ, ê°€ë°© ë“±)
            const itemMidCategories = ['ëª¨ì', 'ì‹ ë°œ', 'ê°€ë°©', 'ê¸°íƒ€ACC', 'ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜'];
            const itemMidKeys = ['Headwear', 'Shoes', 'Bag', 'Acc_etc', 'ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜'];
            
            // í‘œì‹œëª… ë˜ëŠ” í‚¤ë¡œ ë§¤ì¹­
            if (itemMidCategories.includes(label) || itemMidKeys.includes(label)) {
              console.log('ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ ë“œë¦´ë‹¤ìš´ ì‹¤í–‰:', label);
              channelTreemapPath.push(label);
              updateChannelTreemap();
            }
          }
        } else if (type === 'item') {
          // ì•„ì´í…œ í´ë¦­ ì‹œ: ì±„ë„ë³„ë¡œ ë“œë¦´ë‹¤ìš´
          console.log('ì•„ì´í…œ ì²´í¬:', {label, inList: itemList.includes(label), pathLength: itemTreemapPath.length, parent});
          
          // ìµœìƒìœ„ ë ˆë²¨ì—ì„œ ì•„ì´í…œ í´ë¦­ (ë¶€ëª¨ê°€ ì—†ê³ , ë“œë¦´ë‹¤ìš´ ê²½ë¡œê°€ ë¹„ì–´ìˆì„ ë•Œ)
          if (itemTreemapPath.length === 0 && (!parent || parent === '') && itemList.includes(label)) {
            console.log('ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ ì‹¤í–‰:', label);
            itemTreemapPath.push(label);
            updateItemTreemap();
          }
        }
      };
      
      // Plotly í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
      container.on('plotly_click', clickHandler);
    }
    
    // -------- íŠ¸ë¦¬ë§µ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸ --------
    function updateTreemapDateInfo() {
      const channelDateInfo = document.getElementById('treemapChannelDateInfo');
      const itemDateInfo = document.getElementById('treemapItemDateInfo');
      
      if (!channelDateInfo && !itemDateInfo) return;
      
      // treemap.jsonì—ì„œ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const metadata = window.channelTreemapData?.metadata || null;
      
      let dateHtml = '';
      if (metadata && metadata.updateDate) {
        const formatDate = (dateStr) => {
          if (!dateStr) return '-';
          const parts = dateStr.split('-');
          return `${parts[0]}ë…„ ${parts[1]}ì›” ${parts[2]}ì¼`;
        };
        
        const cyStart = metadata.cyPeriod?.start || metadata.cyWeekStart;
        const cyEnd = metadata.cyPeriod?.end || metadata.cyWeekEnd;
        const pyStart = metadata.pyPeriod?.start || metadata.pyWeekStart;
        const pyEnd = metadata.pyPeriod?.end || metadata.pyWeekEnd;
        
        dateHtml = `
          <div style="line-height:1.5;">
            <div style="margin-bottom:2px;">ë‹¹í•´ ê¸°ê°„: ${formatDate(cyStart)} ~ ${formatDate(cyEnd)}</div>
            <div style="margin-bottom:2px;">ì „ë…„ ê¸°ê°„: ${formatDate(pyStart)} ~ ${formatDate(pyEnd)}</div>
            <div style="color:#94a3b8;">â€» ì°¸ê³  : ì „ë…„ ê¸°ê°„ì€ ë‹¹í•´ê¸°ê°„ì˜ ë™ì£¼ì°¨</div>
          </div>
        `;
      } else {
        dateHtml = '<div style="font-weight:600;color:#94a3b8;">ë‚ ì§œ ì •ë³´ ì—†ìŒ</div>';
      }
      
      if (channelDateInfo) {
        channelDateInfo.innerHTML = dateHtml;
      }
      if (itemDateInfo) {
        itemDateInfo.innerHTML = dateHtml;
      }
    }
    
    // -------- ì±„ë„ë³„ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ (ì˜›ë‚  JSON ê¸°ë°˜ - ë¹„í™œì„±í™”) --------
    function updateChannelTreemap() {
      // â˜… Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì‚¬ìš©ìœ¼ë¡œ ë¹„í™œì„±í™” â˜…
      console.log('[ì˜›ë‚  íŠ¸ë¦¬ë§µ] updateChannelTreemap í˜¸ì¶œë¨ - ë¬´ì‹œë¨ (Snowflake API ì‚¬ìš©)');
      return;
      
      const container = document.getElementById('treemapWrapperChannel');
      if (!container) return;
      
      const data = getChannelTreemapData();
      
      // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
      updateTreemapDateInfo();
      
      // ë°ì´í„°ê°€ ë¹„ì–´ìˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ë“œë¦´ë‹¤ìš´ ì·¨ì†Œ
      if (!data || data.length === 0 || !data[0] || !data[0].labels || data[0].labels.length === 0) {
        console.error('ì±„ë„ íŠ¸ë¦¬ë§µ ë°ì´í„° ì—†ìŒ, ë“œë¦´ë‹¤ìš´ ì·¨ì†Œ');
        if (channelTreemapPath.length > 0) {
          channelTreemapPath.pop(); // ê²½ë¡œ ë˜ëŒë¦¬ê¸°
        }
        return;
      }
      
      console.log('ì±„ë„ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸:', {
        labels: data[0].labels, 
        values: data[0].values,
        parents: data[0].parents,
        ids: data[0].ids
      });
      
      // ê³ ì • ë„ˆë¹„ ì‚¬ìš©
      const layout = { 
        margin:{ l:0, r:0, t:0, b:0 }, 
        paper_bgcolor:'rgba(0,0,0,0)', 
        plot_bgcolor:'rgba(0,0,0,0)', 
        font:{ size:14, weight:600 },
        height: 280,
        autosize: true
      };
      const config = { responsive:true, displayModeBar:false };
      
      // ìì—°ìŠ¤ëŸ¬ìš´ ì „í™˜ íš¨ê³¼: í˜ì´ë“œì•„ì›ƒ + ì¤Œì•„ì›ƒ
      container.style.opacity = '0';
      container.style.transform = 'scale(0.9)';
      container.style.transition = 'opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
      container.style.filter = 'blur(5px)';
      
      // ê¸°ì¡´ ì°¨íŠ¸ ì™„ì „íˆ ì œê±°í•˜ê³  ìƒˆë¡œ ê·¸ë¦¬ê¸°
      setTimeout(() => {
        try {
          if (window.Plotly) {
            // ê¸°ì¡´ ì°¨íŠ¸ ì •ë¦¬
            window.Plotly.purge(container);
          }
        } catch(e) {
          console.warn('ì°¨íŠ¸ ì •ë¦¬ ì‹¤íŒ¨:', e);
        }
        
        // â˜…â˜…â˜… ì»¨í…Œì´ë„ˆ í¬ê¸°ë¥¼ ê°•ì œë¡œ ì¬ê³„ì‚° (ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° íŠ¸ë¦¬ê±°) â˜…â˜…â˜…
        const tempHeight = container.style.height;
        container.style.height = 'auto';
        void container.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
        container.style.height = tempHeight || '280px';
        
        try{
          if (window.Plotly && typeof window.Plotly.newPlot === 'function'){
            window.Plotly.newPlot(container, data, layout, config).then(() => {
              // í˜ì´ë“œì¸ + ì¤Œì¸ íš¨ê³¼ (ë¸”ëŸ¬ ì œê±° í¬í•¨)
              setTimeout(() => {
                container.style.opacity = '1';
                container.style.transform = 'scale(1)';
                container.style.filter = 'blur(0px)';
              }, 50);
              // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
              attachTreemapClickEvent(container, 'channel');
            }).catch(err => {
              console.error('Channel Treemap render failed:', err);
              container.style.opacity = '1';
              container.style.transform = 'scale(1)';
              container.style.filter = 'blur(0px)';
            });
          }
          if (!charts.treemapChannel) {
            charts.treemapChannel = { type:'plotly', container };
          }
        }catch(err){ 
          console.error('Channel Treemap render failed', err);
          container.style.opacity = '1';
          container.style.transform = 'scale(1)';
          container.style.filter = 'blur(0px)';
        }
      }, 200);  // í˜ì´ë“œì•„ì›ƒ í›„ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
      
      // ë“œë¦´ë°± ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ë° ì œëª© ì—…ë°ì´íŠ¸
      const drillbackBtn = document.getElementById('treemapDrillbackChannel');
      const titleElement = document.getElementById('treemapTitleChannel');
      
      if (drillbackBtn) {
        drillbackBtn.style.display = channelTreemapPath.length > 0 ? 'block' : 'none';
      }
      
      if (titleElement) {
        const dailyBadge = '<span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>';
        if (channelTreemapPath.length === 2) {
          titleElement.innerHTML = `${dailyBadge}ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± > ${channelTreemapPath[0]} > ${channelTreemapPath[1]} (ì†Œë¶„ë¥˜ë³„)`;
        } else if (channelTreemapPath.length === 1) {
          titleElement.innerHTML = `${dailyBadge}ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± > ${channelTreemapPath[0]} (ì•„ì´í…œë³„)`;
        } else {
          titleElement.innerHTML = `${dailyBadge}ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„±(í˜„ì‹œì )`;
        }
      }
    }
    
    // -------- ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ (ì˜›ë‚  JSON ê¸°ë°˜ - ë¹„í™œì„±í™”) --------
    function updateItemTreemap() {
      // â˜… Snowflake API ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì‚¬ìš©ìœ¼ë¡œ ë¹„í™œì„±í™” â˜…
      console.log('[ì˜›ë‚  íŠ¸ë¦¬ë§µ] updateItemTreemap í˜¸ì¶œë¨ - ë¬´ì‹œë¨ (Snowflake API ì‚¬ìš©)');
      return;
      
      const container = document.getElementById('treemapWrapperItem');
      if (!container) return;
      
      const data = getItemTreemapData();
      
      // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
      updateTreemapDateInfo();
      
      // ë°ì´í„°ê°€ ë¹„ì–´ìˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ë“œë¦´ë‹¤ìš´ ì·¨ì†Œ
      if (!data || data.length === 0 || !data[0] || !data[0].labels || data[0].labels.length === 0) {
        console.error('ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë°ì´í„° ì—†ìŒ, ë“œë¦´ë‹¤ìš´ ì·¨ì†Œ');
        if (itemTreemapPath.length > 0) {
          itemTreemapPath.pop(); // ê²½ë¡œ ë˜ëŒë¦¬ê¸°
        }
        return;
      }
      
      console.log('ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸:', {
        labels: data[0].labels, 
        values: data[0].values,
        parents: data[0].parents,
        ids: data[0].ids
      });
      
      // ê³ ì • ë„ˆë¹„ ì‚¬ìš©
      const layout = { 
        margin:{ l:0, r:0, t:0, b:0 }, 
        paper_bgcolor:'rgba(0,0,0,0)', 
        plot_bgcolor:'rgba(0,0,0,0)', 
        font:{ size:14, weight:600 },
        height: 280,
        autosize: true
      };
      const config = { responsive:true, displayModeBar:false };
      
      // ìì—°ìŠ¤ëŸ¬ìš´ ì „í™˜ íš¨ê³¼: í˜ì´ë“œì•„ì›ƒ + ì¤Œì•„ì›ƒ
      container.style.opacity = '0';
      container.style.transform = 'scale(0.9)';
      container.style.transition = 'opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
      container.style.filter = 'blur(5px)';
      
      // ê¸°ì¡´ ì°¨íŠ¸ ì™„ì „íˆ ì œê±°í•˜ê³  ìƒˆë¡œ ê·¸ë¦¬ê¸°
      setTimeout(() => {
        try {
          if (window.Plotly) {
            // ê¸°ì¡´ ì°¨íŠ¸ ì •ë¦¬
            window.Plotly.purge(container);
          }
        } catch(e) {
          console.warn('ì°¨íŠ¸ ì •ë¦¬ ì‹¤íŒ¨:', e);
        }
        
        // â˜…â˜…â˜… ì»¨í…Œì´ë„ˆ í¬ê¸°ë¥¼ ê°•ì œë¡œ ì¬ê³„ì‚° (ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° íŠ¸ë¦¬ê±°) â˜…â˜…â˜…
        const tempHeight = container.style.height;
        container.style.height = 'auto';
        void container.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
        container.style.height = tempHeight || '280px';
        
        try{
          if (window.Plotly && typeof window.Plotly.newPlot === 'function'){
            window.Plotly.newPlot(container, data, layout, config).then(() => {
              // í˜ì´ë“œì¸ + ì¤Œì¸ íš¨ê³¼ (ë¸”ëŸ¬ ì œê±° í¬í•¨)
              setTimeout(() => {
                container.style.opacity = '1';
                container.style.transform = 'scale(1)';
                container.style.filter = 'blur(0px)';
              }, 50);
              // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
              attachTreemapClickEvent(container, 'item');
            }).catch(err => {
              console.error('Item Treemap render failed:', err);
              container.style.opacity = '1';
              container.style.transform = 'scale(1)';
              container.style.filter = 'blur(0px)';
            });
          }
          if (!charts.treemapItem) {
            charts.treemapItem = { type:'plotly', container };
          }
        }catch(err){ 
          console.error('Item Treemap render failed', err);
          container.style.opacity = '1';
          container.style.transform = 'scale(1)';
          container.style.filter = 'blur(0px)';
        }
      }, 200);  // í˜ì´ë“œì•„ì›ƒ í›„ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
      
      // ë“œë¦´ë°± ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ë° ì œëª© ì—…ë°ì´íŠ¸
      const drillbackBtn = document.getElementById('treemapDrillbackItem');
      const titleElement = document.getElementById('treemapTitleItem');
      
      if (drillbackBtn) {
        drillbackBtn.style.display = itemTreemapPath.length > 0 ? 'block' : 'none';
      }
      
      if (titleElement) {
        const dailyBadge = '<span style="display:inline-block;background:#10b981;color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;margin-right:8px;vertical-align:middle;">Daily</span>';
        if (itemTreemapPath.length > 0) {
          titleElement.innerHTML = `${dailyBadge}ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± > ${itemTreemapPath[0]} (ì±„ë„ë³„)`;
        } else {
          titleElement.innerHTML = `${dailyBadge}ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„±(í˜„ì‹œì )`;
        }
      }
    }
    
    // -------- íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„± --------
    function getTreemapData() {
      // ë“œë¦´ë‹¤ìš´ì´ ì—†ëŠ” ê²½ìš°
      if (treemapCurrentPath.length === 0) {
        if (treemapCurrentType === 'channel') {
          return getChannelTreemapData();
        } else {
          return getItemTreemapData();
        }
      }
      
      // ë“œë¦´ë‹¤ìš´ì´ ìˆëŠ” ê²½ìš°
      const path = treemapCurrentPath[treemapCurrentPath.length - 1];
      return getTreemapDrilldownData(treemapCurrentType, path);
    }
    
    // -------- ì±„ë„ íŠ¸ë¦¬ë§µ ë°ì´í„° --------
    function getChannelTreemapData() {
      // ë“œë¦´ë‹¤ìš´ì´ ìˆëŠ” ê²½ìš°
      if (channelTreemapPath.length > 0) {
        return getChannelDrilldownData(channelTreemapPath);
      }
      
      // ë¸Œëœë“œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
      const channelItemSalesData = getChannelItemSalesData();
      const brandSalesData = channelItemSalesData[brandCode];
      
      if (!brandSalesData) {
        console.warn('[getChannelTreemapData] brandSalesDataê°€ ì—†ìŠµë‹ˆë‹¤:', {brandCode, currentBrand});
        return [];
      }
      
      const labels = [];
      const values = [];
      const parents = [];
      const ids = [];
      
      // ì±„ë„ë³„ ë§¤ì¶œ í•©ê³„ ê³„ì‚°
      const channelTotals = {};
      Object.keys(brandSalesData).forEach(channelKey => {
        const channelItems = brandSalesData[channelKey];
        let channelTotal = 0;
        Object.values(channelItems).forEach(value => {
          if (value > 0) channelTotal += value;
        });
        if (channelTotal > 0) {
          // ì±„ë„ëª…ì€ ì´ë¯¸ ìµœì¢…ì±„ë„ëª…ìœ¼ë¡œ ë˜ì–´ ìˆìŒ
          const mappedChannel = channelNameToFinal[channelKey] || channelKey;
          
          if (!channelTotals[mappedChannel]) channelTotals[mappedChannel] = 0;
          channelTotals[mappedChannel] += channelTotal;
        }
      });
      
      // ì „ì²´ ì±„ë„ ëª©ë¡ (MLBì˜ ê²½ìš° RF í¬í•¨)
      let allChannels = [...channelList];
      if (brandCode === 'M' && brandSalesData['RF']) {
        allChannels.push('RF');
      }
      
      // ì±„ë„ì„ ë§¤ì¶œìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      const sortedChannels = allChannels
        .map(channel => ({ channel, value: channelTotals[channel] || 0 }))
        .filter(item => item.value > 0)
        .sort((a, b) => b.value - a.value);
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ë°˜í™˜
      if (sortedChannels.length === 0) {
        console.warn('[getChannelTreemapData] ì •ë ¬ëœ ì±„ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', {brandCode, currentBrand, channelTotals});
        return [];
      }
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚°
      const totalValue = sortedChannels.reduce((sum, item) => sum + item.value, 0);
      
      // ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ ë°ì´í„° ì¶”ê°€
      const customText = [];
      const customDataArray = [];
      sortedChannels.forEach((item, index) => {
        const percentage = totalValue > 0 ? ((item.value / totalValue) * 100).toFixed(1) : 0;
        // í• ì¸ìœ¨ í‘œì‹œë¥¼ ìœ„í•´ channelMetrics ì‚¬ìš©
        let discountRate = 0;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const cm = window.channelMetrics?.[brandCode]?.[item.channel];
          if (cm && typeof cm.discountRate === 'number') {
            discountRate = cm.discountRate * 100;
          }
        } catch (e) {}
        
        // â˜… YOY ê°€ì ¸ì˜¤ê¸° â˜…
        let yoy = null;
        let prevDiscountRate = null;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const treemapRaw = window.treemapRawData?.[brandCode]?.channel?.channels?.[item.channel];
          if (treemapRaw && typeof treemapRaw.yoy === 'number') {
            yoy = treemapRaw.yoy;
          }
          // â˜… ì „ë…„í• ì¸ìœ¨ ê°€ì ¸ì˜¤ê¸° â˜…
          if (treemapRaw && typeof treemapRaw.prevDiscountRate === 'number') {
            prevDiscountRate = treemapRaw.prevDiscountRate;
          }
        } catch (e) {}
        
        labels.push(item.channel);
        values.push(item.value / 100000000); // ì› ë‹¨ìœ„ë¥¼ ì–µì›ìœ¼ë¡œ ë³€í™˜
        parents.push('');
        ids.push(`channel-${index}`);
        // ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOYë¥¼ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
        const percentageNum = parseFloat(percentage);
        const discountRateNum = parseFloat(discountRate.toFixed(1));
        const prevDiscountRateNum = prevDiscountRate !== null ? parseFloat(prevDiscountRate.toFixed(1)) : 0.0;
        const yoyPercentage = yoy !== null ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
        customDataArray.push([percentageNum, discountRateNum, prevDiscountRateNum, yoyPercentage]);
        
        // í• ì¸ìœ¨ í‘œì‹œ
        let discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
        
        // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ (ë³„ë„ ì¤„)
        let prevDiscountText = '';
        if (prevDiscountRate !== null) {
          prevDiscountText = `<br><span style="font-size:12px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateNum.toFixed(1)}%</span>`;
        }
        
        // â˜… YOY í‘œì‹œ ì¶”ê°€ â˜…
        let yoyText = '';
        if (yoy !== null) {
          const yoyDisplay = (100 + yoy).toFixed(1); // -6.7% -> 93.3%, +15.3% -> 115.3%
          yoyText = `<br><span style="font-size:12px;color:#fde68a;">YOY : ${yoyDisplay}%</span>`;
        }
        
        customText.push(`<b style="font-size:15px;color:white;">${item.channel}</b><br><span style="font-size:13px;color:white;">${(item.value / 100000000).toFixed(1)}ì–µì› (${percentage}%)</span>${discountText}${prevDiscountText}${yoyText}`);
      });
      
      // ë°ì´í„° ê²€ì¦: labelsì™€ valuesê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
      if (labels.length !== values.length || labels.length === 0) {
        console.error('[getChannelTreemapData] ë°ì´í„° ë¶ˆì¼ì¹˜:', {
          labelsLength: labels.length,
          valuesLength: values.length,
          labels: labels,
          values: values
        });
        return [];
      }
      
      return [{
        type: 'treemap',
        labels: labels,
        values: values,
        parents: parents,
        ids: ids,
        text: customText,
        textinfo: 'text',
        hovertemplate: labels.length > 0 ? '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}% (ì „ë…„ : %{customdata[2]:.1f}%)<br>YOY : %{customdata[3]:.1f}%<extra></extra>' : '<extra></extra>',
        customdata: customDataArray,
        textfont: { size: 14 },
        marker: {
          colors: [
            'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)', 
            'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)',
            'rgba(168,85,247,0.8)', 'rgba(34,197,94,0.8)', 'rgba(251,146,60,0.8)', 
            'rgba(244,63,94,0.8)'
          ]
        }
      }];
    }
    
    // -------- ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë°ì´í„° --------
    function getItemTreemapData() {
      // ë“œë¦´ë‹¤ìš´ì´ ìˆëŠ” ê²½ìš° (íŠ¹ì • ì•„ì´í…œì˜ ì±„ë„ë³„ ë°ì´í„°)
      if (itemTreemapPath.length > 0) {
        return getItemDrilldownData(itemTreemapPath[itemTreemapPath.length - 1]);
      }
      
      // ë¸Œëœë“œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
      const channelItemSalesData = getChannelItemSalesData();
      const brandSalesData = channelItemSalesData[brandCode];
      
      if (!brandSalesData) {
        // í´ë°± ë°ì´í„°
        const labels = ['ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜', 'ëª¨ì', 'ì‹ ë°œ', 'ê°€ë°©', 'ê¸°íƒ€ACC'];
        const values = [48.3, 27.9, 36.8, 0, 0, 0, 160.7];
        return [{
          type: 'treemap',
          labels: labels,
          values: values,
          parents: ['', '', '', '', '', '', ''],
          ids: labels.map((_, i) => `item-${i}`),
          textinfo: 'label+value',
          texttemplate: '<b style="font-size:15px;">%{label}</b><br><span style="font-size:14px;">%{value:.1f}ì–µì›</span>',
          hovertemplate: '<b style="font-size:14px;">%{label}</b><br>ë§¤ì¶œ: %{value:.1f}ì–µì›<br>%{text|s}<extra></extra>',
          textfont: { size: 14 },
          marker: {
            colors: [
              'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)', 'rgba(16,185,129,0.8)',
              'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)', 'rgba(168,85,247,0.8)'
            ]
          }
        }];
      }
      
      const labels = [];
      const values = [];
      const parents = [];
      const ids = [];
      
      // ì•„ì´í…œë³„ ë§¤ì¶œ í•©ê³„ ê³„ì‚°
      const itemTotals = {};
      Object.keys(brandSalesData).forEach(channelKey => {
        const channelItems = brandSalesData[channelKey];
        Object.entries(channelItems).forEach(([itemKey, value]) => {
          if (value > 0) {
            // ì•„ì´í…œ í‚¤ë¥¼ í‘œì‹œëª…ìœ¼ë¡œ ë§¤í•‘
            let itemDisplayName = itemKey;
            if (itemKey === 'Shoes') itemDisplayName = 'ì‹ ë°œ';
            else if (itemKey === 'Bag') itemDisplayName = 'ê°€ë°©';
            else if (itemKey === 'Headwear') itemDisplayName = 'ëª¨ì'; // HeadwearëŠ” ëª¨ìë¡œ ë§¤í•‘
            else if (itemKey === 'Cap') itemDisplayName = 'ëª¨ì';
            else if (itemKey === 'Acc_etc') itemDisplayName = 'ê¸°íƒ€ACC';
            else if (itemKey === 'ë‹¹ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ë‹¹ì‹œì¦Œì˜ë¥˜';
            else if (itemKey === 'ì°¨ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ì°¨ì‹œì¦Œì˜ë¥˜';
            else if (itemKey === 'ê³¼ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ê³¼ì‹œì¦Œì˜ë¥˜';
            
            if (!itemTotals[itemDisplayName]) itemTotals[itemDisplayName] = 0;
            itemTotals[itemDisplayName] += value;
          }
        });
      });
      
      // ì•„ì´í…œì„ ë§¤ì¶œìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      const sortedItems = itemList
        .map(item => ({ item, value: itemTotals[item] || 0 }))
        .filter(obj => obj.value > 0)
        .sort((a, b) => b.value - a.value);
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚°
      const totalItemValue = sortedItems.reduce((sum, obj) => sum + obj.value, 0);
      
      // ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ ë°ì´í„° ì¶”ê°€
      const customItemText = [];
      const customDataArray = [];
      sortedItems.forEach((obj, index) => {
        const percentage = totalItemValue > 0 ? ((obj.value / totalItemValue) * 100).toFixed(1) : 0;
        labels.push(obj.item);
        values.push(obj.value / 100000000); // ì› ë‹¨ìœ„ë¥¼ ì–µì›ìœ¼ë¡œ ë³€í™˜
        parents.push('');
        ids.push(`item-${index}`);
        // ì•„ì´í…œ ì „ì²´ íŠ¸ë¦¬ë§µ: ë¸Œëœë“œ-ì•„ì´í…œ ê°œë³„ í• ì¸ìœ¨ í‘œì‹œ (itemMetrics ì‚¬ìš©)
        let discountRate = 0;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const metricsRoot = window.itemMetrics?.[brandCode];
          if (metricsRoot) {
            const reverseMap = {
              'ì‹ ë°œ': ['Shoes'],
              'ê°€ë°©': ['Bag'],
              'ëª¨ì': ['Headwear','Cap'],
              'ê¸°íƒ€ACC': ['Acc_etc'],
              'ë‹¹ì‹œì¦Œì˜ë¥˜': ['ë‹¹ì‹œì¦Œì˜ë¥˜'],
              'ì°¨ì‹œì¦Œì˜ë¥˜': ['ì°¨ì‹œì¦Œì˜ë¥˜'],
              'ê³¼ì‹œì¦Œì˜ë¥˜': ['ê³¼ì‹œì¦Œì˜ë¥˜']
            };
            const candidates = reverseMap[obj.item] || [obj.item];
            let rate = null;
            for (const k of candidates) {
              const m = metricsRoot[k];
              if (m && typeof m.discountRate === 'number') { rate = m.discountRate; break; }
            }
            if (rate !== null) {
              discountRate = rate * 100;
            }
          }
        } catch (e) {}
        
        // â˜… YOY ê°€ì ¸ì˜¤ê¸° â˜…
        let yoy = null;
        let prevDiscountRate = null;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          // í•œê¸€ -> ì˜ë¬¸ í‚¤ ë§¤í•‘
          const itemKeyMapForTreemap = {
            'ì‹ ë°œ': 'Shoes',
            'ê°€ë°©': 'Bag',
            'ëª¨ì': 'Headwear',
            'ê¸°íƒ€ACC': 'Acc_etc',
            'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
            'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜',
            'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜'
          };
          const itemKey = itemKeyMapForTreemap[obj.item] || obj.item;
          const treemapRaw = window.treemapRawData?.[brandCode]?.item?.items?.[itemKey];
          if (treemapRaw && typeof treemapRaw.yoy === 'number') {
            yoy = treemapRaw.yoy;
          }
          // â˜… ì „ë…„í• ì¸ìœ¨ ê°€ì ¸ì˜¤ê¸° â˜…
          if (treemapRaw && typeof treemapRaw.prevDiscountRate === 'number') {
            prevDiscountRate = treemapRaw.prevDiscountRate;
          }
        } catch (e) {}
        
        // ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOYë¥¼ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
        const percentageNum = parseFloat(percentage);
        const discountRateNum = parseFloat(discountRate.toFixed(1));
        const prevDiscountRateNum = prevDiscountRate !== null ? parseFloat(prevDiscountRate.toFixed(1)) : 0.0;
        const yoyPercentage = yoy !== null ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
        customDataArray.push([percentageNum, discountRateNum, prevDiscountRateNum, yoyPercentage]);
        
        // í• ì¸ìœ¨ í‘œì‹œ
        let discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
        
        // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ (ë³„ë„ ì¤„)
        let prevDiscountText = '';
        if (prevDiscountRate !== null) {
          prevDiscountText = `<br><span style="font-size:12px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateNum.toFixed(1)}%</span>`;
        }
        
        // â˜… YOY í‘œì‹œ ì¶”ê°€ â˜…
        let yoyText = '';
        if (yoy !== null) {
          const yoyDisplay = (100 + yoy).toFixed(1); // -6.7% -> 93.3%, +15.3% -> 115.3%
          yoyText = `<br><span style="font-size:12px;color:#fde68a;">YOY : ${yoyDisplay}%</span>`;
        }
        
        customItemText.push(`<b style="font-size:15px;color:white;">${obj.item}</b><br><span style="font-size:13px;color:white;">${(obj.value / 100000000).toFixed(1)}ì–µì› (${percentage}%)</span>${discountText}${prevDiscountText}${yoyText}`);
      });
      
      if (labels.length === 0) {
        // í´ë°± ë°ì´í„°
        const fallbackLabels = ['ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜', 'ëª¨ì', 'ì‹ ë°œ', 'ê°€ë°©', 'ê¸°íƒ€ACC'];
        const fallbackValues = [48.3, 27.9, 36.8, 0, 0, 0, 160.7];
        const fallbackTotal = fallbackValues.reduce((a, b) => a + b, 0);
        return [{
          type: 'treemap',
          labels: fallbackLabels,
          values: fallbackValues,
          parents: ['', '', '', '', '', '', ''],
          ids: fallbackLabels.map((_, i) => `item-${i}`),
          text: fallbackLabels.map((label, i) => {
            const pct = fallbackTotal > 0 ? ((fallbackValues[i] / fallbackTotal) * 100).toFixed(1) : 0;
            return `<b style="font-size:15px;color:white;">${label}</b><br><span style="font-size:13px;color:white;">${fallbackValues[i].toFixed(1)}ì–µì› (${pct}%)</span><br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : 0.0%</span>`;
          }),
          textinfo: 'text',
          hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : 0.0%<extra></extra>',
          customdata: fallbackValues.map(val => {
            const share = fallbackTotal > 0 ? ((val / fallbackTotal) * 100) : 0;
            return [parseFloat(share.toFixed(1)), 0];
          }),
          textfont: { size: 14 },
          marker: {
            colors: [
              'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)', 'rgba(16,185,129,0.8)',
              'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)', 'rgba(168,85,247,0.8)'
            ]
          }
        }];
      }
      
      return [{
        type: 'treemap',
        labels: labels,
        values: values,
        parents: parents,
        ids: ids,
        text: customItemText,
        textinfo: 'text',
        hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}% (ì „ë…„ : %{customdata[2]:.1f}%)<br>YOY : %{customdata[3]:.1f}%<extra></extra>',
        customdata: customDataArray,
        textfont: { size: 14 },
        marker: {
          colors: [
            'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)', 'rgba(16,185,129,0.8)',
            'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)', 'rgba(168,85,247,0.8)'
          ]
        }
      }];
    }
    
    
    // -------- ì±„ë„ ë“œë¦´ë‹¤ìš´ ë°ì´í„° (ì±„ë„ ì„ íƒ ì‹œ ì•„ì´í…œë³„ë¡œ ë¶„ë¥˜, ì•„ì´í…œ ì„ íƒ ì‹œ ì†Œë¶„ë¥˜ë¡œ ë¶„ë¥˜) --------
    function getChannelDrilldownData(path) {
      // pathëŠ” ë°°ì—´: [ì±„ë„ëª…] ë˜ëŠ” [ì±„ë„ëª…, ì•„ì´í…œ_ì¤‘ë¶„ë¥˜]
      const selectedChannel = path[0];
      const selectedItemMid = path.length > 1 ? path[1] : null;
      
      // ìƒˆë¡œìš´ ë°ì´í„° êµ¬ì¡° ì‚¬ìš© (channelTreemapData)
      if (typeof window.channelTreemapData !== 'undefined' && window.channelTreemapData.channels) {
        // ë¸Œëœë“œë³„ ë°ì´í„° ìš°ì„  ì‚¬ìš©
        const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
        let channelData = null;
        
        // 1. ë¸Œëœë“œë³„ ë°ì´í„° í™•ì¸ (êµ¬ì¡°: byBrand[brandCode].channel.channels[selectedChannel])
        if (window.channelTreemapData.byBrand && window.channelTreemapData.byBrand[brandCode]) {
          const brandData = window.channelTreemapData.byBrand[brandCode];
          if (brandData.channel && brandData.channel.channels && brandData.channel.channels[selectedChannel]) {
            channelData = brandData.channel.channels[selectedChannel];
            console.log(`[channelTreemapData] ë¸Œëœë“œë³„ ë°ì´í„° ì‚¬ìš©: ${brandCode} - ${selectedChannel}`);
          }
        }
        
        // 2. ë¸Œëœë“œë³„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë°ì´í„° ì‚¬ìš© (í´ë°±)
        if (!channelData && window.channelTreemapData.channels[selectedChannel]) {
          channelData = window.channelTreemapData.channels[selectedChannel];
          console.warn(`[channelTreemapData] ì „ì²´ ë°ì´í„° ì‚¬ìš© (ë¸Œëœë“œë³„ ë°ì´í„° ì—†ìŒ): ${selectedChannel}`);
        }
        
        if (!channelData) {
          console.warn('ì±„ë„ ë°ì´í„° ì—†ìŒ (channelTreemapData):', selectedChannel);
          // ê¸°ì¡´ ë°ì´í„° êµ¬ì¡°ë¡œ í´ë°±
        } else {
          // channelTreemapData ì‚¬ìš©
        
        // 2ë‹¨ê³„: ì•„ì´í…œ_ì†Œë¶„ë¥˜ ë“œë¦´ë‹¤ìš´
        if (selectedItemMid) {
          // ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ í‚¤ ë§¤í•‘
          const itemMidKeyMap = {
            'ëª¨ì': 'Headwear',
            'ì‹ ë°œ': 'Shoes',
            'ê°€ë°©': 'Bag',
            'ê¸°íƒ€ACC': 'Acc_etc',
            'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
            'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜',
            'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜'
          };
          const itemMidKey = itemMidKeyMap[selectedItemMid] || selectedItemMid;
          
          const itemData = channelData.itemCategories[itemMidKey];
          if (!itemData || !itemData.subCategories) {
            console.warn('ì•„ì´í…œ_ì†Œë¶„ë¥˜ ë°ì´í„° ì—†ìŒ:', {selectedItemMid, itemMidKey, available: Object.keys(channelData.itemCategories)});
            return [];
          }
          
          const labels = [];
          const values = [];
          const parents = [];
          const ids = [];
          const customText = [];
          const customDataArray = [];
          const colors = [];
          const colorPalette = [
            'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)',
            'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)',
            'rgba(168,85,247,0.8)', 'rgba(34,197,94,0.8)'
          ];
          
          const subCategories = itemData.subCategories;
          const totalSales = itemData.sales;
          
          Object.entries(subCategories).forEach(([subItem, subData], index) => {
            const salesInHundredMillion = subData.sales / 100000000;
            labels.push(subItem);
            values.push(salesInHundredMillion);
            parents.push('');
            ids.push(`channel-${selectedChannel}-item-${itemMidKey}-sub-${index}`);
            colors.push(colorPalette[index % colorPalette.length]);
            
            // ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOYë¥¼ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
            const shareFormatted = typeof subData.share === 'number' ? subData.share.toFixed(1) : parseFloat(subData.share || 0).toFixed(1);
            const discountRateFormatted = typeof subData.discountRate === 'number' ? subData.discountRate.toFixed(1) : parseFloat(subData.discountRate || 0).toFixed(1);
            const prevDiscountRate = subData.prevDiscountRate;
            const prevDiscountRateFormatted = prevDiscountRate !== null && prevDiscountRate !== undefined ? parseFloat(prevDiscountRate).toFixed(1) : '0.0';
            const yoy = subData.yoy;
            const yoyPercentage = yoy !== null && yoy !== undefined ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
            customDataArray.push([parseFloat(shareFormatted), parseFloat(discountRateFormatted), parseFloat(prevDiscountRateFormatted), yoyPercentage]);
            
            // í• ì¸ìœ¨ í‘œì‹œ
            let discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateFormatted}%</span>`;
            
            // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ (ë³„ë„ ì¤„)
            let prevDiscountText = '';
            if (prevDiscountRateFormatted !== null) {
              prevDiscountText = `<br><span style="font-size:12px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateFormatted}%</span>`;
            }
            
            // YOY í‘œì‹œ ì¶”ê°€
            let yoyText = '';
            if (yoy !== null && yoy !== undefined) {
              const yoyDisplay = (100 + yoy).toFixed(1);
              yoyText = `<br><span style="font-size:12px;color:#fde68a;">YOY : ${yoyDisplay}%</span>`;
            }
            
            customText.push(`<b style="font-size:15px;color:white;">${subItem}</b><br><span style="font-size:13px;color:white;">${salesInHundredMillion.toFixed(1)}ì–µì› (${shareFormatted}%)</span>${discountText}${prevDiscountText}${yoyText}`);
          });
          
          return [{
            type: 'treemap',
            labels: labels,
            values: values,
            parents: parents,
            ids: ids,
            text: customText,
            textinfo: 'text',
            hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}% (ì „ë…„ : %{customdata[2]:.1f}%)<br>YOY : %{customdata[3]:.1f}%<extra></extra>',
            customdata: customDataArray,
            textfont: { size: 14 },
            marker: { colors: colors }
          }];
        }
        
        // 1ë‹¨ê³„: ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ ë“œë¦´ë‹¤ìš´
        const labels = [];
        const values = [];
        const parents = [];
        const ids = [];
        const customText = [];
        const customDataArray = [];
        const colors = [];
        const colorPalette = [
          'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)',
          'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)',
          'rgba(168,85,247,0.8)', 'rgba(34,197,94,0.8)'
        ];
        
        // ì•„ì´í…œ_ì¤‘ë¶„ë¥˜ í‘œì‹œëª… ë§¤í•‘
        const itemMidDisplayMap = {
          'Headwear': 'ëª¨ì',
          'Shoes': 'ì‹ ë°œ',
          'Bag': 'ê°€ë°©',
          'Acc_etc': 'ê¸°íƒ€ACC',
          'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
          'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜',
          'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜'
        };
        
          const itemCategories = channelData.itemCategories;
          console.log(`[channelTreemapData] ì±„ë„ [${selectedChannel}] ì•„ì´í…œ ì¹´í…Œê³ ë¦¬:`, itemCategories);
          Object.entries(itemCategories).forEach(([itemMidKey, itemData], index) => {
            const itemDisplayName = itemMidDisplayMap[itemMidKey] || itemMidKey;
            const salesInHundredMillion = itemData.sales / 100000000;
            
            if (itemDisplayName === 'ë‹¹ì‹œì¦Œì˜ë¥˜') {
              console.log(`  ë‹¹ì‹œì¦Œì˜ë¥˜: ${itemData.sales.toLocaleString()}ì› (${salesInHundredMillion.toFixed(2)}ì–µì›) - ì±„ë„: ${selectedChannel}`);
            }
            
            labels.push(itemDisplayName);
            values.push(salesInHundredMillion);
            parents.push('');
            ids.push(`channel-${selectedChannel}-item-${index}`);
            colors.push(colorPalette[index % colorPalette.length]);
            
            // ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOYë¥¼ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
            const shareFormatted = typeof itemData.share === 'number' ? itemData.share.toFixed(1) : parseFloat(itemData.share || 0).toFixed(1);
            const discountRateFormatted = typeof itemData.discountRate === 'number' ? itemData.discountRate.toFixed(1) : parseFloat(itemData.discountRate || 0).toFixed(1);
            const prevDiscountRate = itemData.prevDiscountRate;
            const prevDiscountRateFormatted = prevDiscountRate !== null && prevDiscountRate !== undefined ? parseFloat(prevDiscountRate).toFixed(1) : '0.0';
            const yoy = itemData.yoy;
            const yoyPercentage = yoy !== null && yoy !== undefined ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
            customDataArray.push([parseFloat(shareFormatted), parseFloat(discountRateFormatted), parseFloat(prevDiscountRateFormatted), yoyPercentage]);
            
            // í• ì¸ìœ¨ í‘œì‹œ
            let discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateFormatted}%</span>`;
            
            // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ (ë³„ë„ ì¤„)
            let prevDiscountText = '';
            if (prevDiscountRateFormatted !== null) {
              prevDiscountText = `<br><span style="font-size:12px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateFormatted}%</span>`;
            }
            
            // YOY í‘œì‹œ ì¶”ê°€
            let yoyText = '';
            if (yoy !== null && yoy !== undefined) {
              const yoyDisplay = (100 + yoy).toFixed(1);
              yoyText = `<br><span style="font-size:12px;color:#fde68a;">YOY : ${yoyDisplay}%</span>`;
            }
            
            customText.push(`<b style="font-size:15px;color:white;">${itemDisplayName}</b><br><span style="font-size:13px;color:white;">${salesInHundredMillion.toFixed(1)}ì–µì› (${shareFormatted}%)</span>${discountText}${prevDiscountText}${yoyText}`);
          });
          
          console.log(`[channelTreemapData] ìµœì¢… values:`, values);
          
          return [{
            type: 'treemap',
            labels: labels,
            values: values,
            parents: parents,
            ids: ids,
            text: customText,
            textinfo: 'text',
            hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}% (ì „ë…„ : %{customdata[2]:.1f}%)<br>YOY : %{customdata[3]:.1f}%<extra></extra>',
            customdata: customDataArray,
            textfont: { size: 14 },
            marker: { colors: colors }
          }];
        }
      }
      
      // ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° ì‚¬ìš© (í•˜ìœ„ í˜¸í™˜)
      const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
      const channelItemSalesData = getChannelItemSalesData();
      const brandSalesData = channelItemSalesData[brandCode];
      
      console.log('ì±„ë„ ë“œë¦´ë‹¤ìš´ ë°ì´í„° ìš”ì²­ (ê¸°ì¡´ êµ¬ì¡°):', {selectedChannel, brandCode, currentBrand, hasData: !!brandSalesData});
      
      if (!brandSalesData) {
        console.warn('ë¸Œëœë“œ ë°ì´í„° ì—†ìŒ:', brandCode);
        return [];
      }
      
      const labels = [];
      const values = [];
      const parents = [];
      const ids = [];
      const colors = [];
      
      // ì„ íƒëœ ì±„ë„ì˜ ì•„ì´í…œë³„ ë§¤ì¶œ ê³„ì‚°
      const itemTotals = {};
      let channelKeys = [selectedChannel];
      
      console.log('ì±„ë„ ë“œë¦´ë‹¤ìš´ - ì„ íƒëœ ì±„ë„:', selectedChannel, 'channelKeys:', channelKeys);
      
      channelKeys.forEach(channelKey => {
        if (brandSalesData[channelKey]) {
          const channelItems = brandSalesData[channelKey];
          console.log(`ì±„ë„ [${channelKey}] ë°ì´í„°:`, channelItems);
          Object.entries(channelItems).forEach(([itemKey, value]) => {
            if (value > 0) {
              let itemDisplayName = itemKey;
              if (itemKey === 'Shoes') itemDisplayName = 'ì‹ ë°œ';
              else if (itemKey === 'Bag') itemDisplayName = 'ê°€ë°©';
              else if (itemKey === 'Headwear') itemDisplayName = 'ëª¨ì';
              else if (itemKey === 'Cap') itemDisplayName = 'ëª¨ì';
              else if (itemKey === 'Acc_etc') itemDisplayName = 'ê¸°íƒ€ACC';
              else if (itemKey === 'ë‹¹ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ë‹¹ì‹œì¦Œì˜ë¥˜';
              else if (itemKey === 'ì°¨ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ì°¨ì‹œì¦Œì˜ë¥˜';
              else if (itemKey === 'ê³¼ì‹œì¦Œì˜ë¥˜') itemDisplayName = 'ê³¼ì‹œì¦Œì˜ë¥˜';
              
              if (!itemTotals[itemDisplayName]) itemTotals[itemDisplayName] = 0;
              itemTotals[itemDisplayName] += value;
              if (itemDisplayName === 'ë‹¹ì‹œì¦Œì˜ë¥˜') {
                console.log(`  ë‹¹ì‹œì¦Œì˜ë¥˜ ëˆ„ì : ${itemTotals[itemDisplayName].toLocaleString()}ì› (${(itemTotals[itemDisplayName]/100000000).toFixed(2)}ì–µì›) - ì±„ë„: ${channelKey}, ê°’: ${value.toLocaleString()}ì›`);
              }
            }
          });
        } else {
          console.warn(`ì±„ë„ [${channelKey}] ë°ì´í„° ì—†ìŒ`);
        }
      });
      
      console.log('ìµœì¢… itemTotals:', itemTotals);
      
      const sortedItems = itemList
        .map(item => ({ item, value: itemTotals[item] || 0 }))
        .filter(obj => obj.value > 0)
        .sort((a, b) => b.value - a.value);
      
      const colorPalette = [
        'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)',
        'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)',
        'rgba(168,85,247,0.8)', 'rgba(34,197,94,0.8)'
      ];
      let colorIndex = 0;
      
      const drilldownTotalValue = sortedItems.reduce((sum, obj) => sum + obj.value, 0);
      const customDrilldownText = [];
      const customDataArray = [];
      
      sortedItems.forEach((obj, index) => {
        const percentage = drilldownTotalValue > 0 ? ((obj.value / drilldownTotalValue) * 100).toFixed(1) : 0;
        labels.push(obj.item);
        values.push(obj.value / 100000000);
        parents.push('');
        ids.push(`channel-${selectedChannel}-item-${index}`);
        colors.push(colorPalette[colorIndex % colorPalette.length]);
        colorIndex++;
        
        let discountRate = 0;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const metricsRoot = window.channelItemMetrics?.[brandCode]?.[selectedChannel];
          if (metricsRoot) {
            const reverseMap = {
              'ì‹ ë°œ': ['Shoes'],
              'ê°€ë°©': ['Bag'],
              'ëª¨ì': ['Headwear','Cap'],
              'ê¸°íƒ€ACC': ['Acc_etc'],
              'ë‹¹ì‹œì¦Œì˜ë¥˜': ['ë‹¹ì‹œì¦Œì˜ë¥˜'],
              'ì°¨ì‹œì¦Œì˜ë¥˜': ['ì°¨ì‹œì¦Œì˜ë¥˜'],
              'ê³¼ì‹œì¦Œì˜ë¥˜': ['ê³¼ì‹œì¦Œì˜ë¥˜']
            };
            const candidates = reverseMap[obj.item] || [obj.item];
            let rate = null;
            for (const k of candidates) {
              const m = metricsRoot[k];
              if (m && typeof m.discountRate === 'number') { rate = m.discountRate; break; }
            }
            if (rate !== null) {
              discountRate = rate * 100;
            }
          }
        } catch (e) {}
        // ë¹„ì¤‘ê³¼ í• ì¸ìœ¨ì„ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
        const percentageNum = parseFloat(percentage);
        const discountRateNum = parseFloat(discountRate.toFixed(1));
        customDataArray.push([percentageNum, discountRateNum]);
        // â˜… í•­ìƒ í• ì¸ìœ¨ í‘œì‹œ (0%ì¸ ê²½ìš°ì—ë„ í‘œì‹œ) â˜…
        const discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
        customDrilldownText.push(`<b style="font-size:15px;color:white;">${obj.item}</b><br><span style="font-size:13px;color:white;">${(obj.value / 100000000).toFixed(1)}ì–µì› (${percentage}%)</span>${discountText}`);
      });
      
      if (labels.length === 0) {
        console.warn('ë“œë¦´ë‹¤ìš´ ë°ì´í„° ì—†ìŒ:', {selectedChannel, itemTotals});
        return [];
      }
      
      return [{
        type: 'treemap',
        labels: labels,
        values: values,
        parents: parents,
        ids: ids,
        text: customDrilldownText,
        textinfo: 'text',
        hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}%<extra></extra>',
        customdata: customDataArray,
        textfont: { size: 14 },
        marker: { colors: colors }
      }];
    }
    
    // -------- ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ ë°ì´í„° (ì•„ì´í…œ ì„ íƒ ì‹œ ì±„ë„ë³„ë¡œ ë¶„ë¥˜) --------
    function getItemDrilldownData(selectedItem) {
      // ë¸Œëœë“œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
      const channelItemSalesData = getChannelItemSalesData();
      const brandSalesData = channelItemSalesData[brandCode];
      
      console.log('ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ ë°ì´í„° ìš”ì²­:', {selectedItem, brandCode, currentBrand, hasData: !!brandSalesData});
      
      if (!brandSalesData) {
        console.warn('ë¸Œëœë“œ ë°ì´í„° ì—†ìŒ:', brandCode);
        return [];
      }
      
      // ì„ íƒëœ ì•„ì´í…œì˜ í‘œì‹œëª…ì„ ë°ì´í„° í‚¤ë¡œ ì—­ë§¤í•‘
      const itemKeyMapReverse = {
        'ì‹ ë°œ': ['Shoes'],
        'ê°€ë°©': ['Bag'],
        'ëª¨ì': ['Headwear', 'Cap'], // HeadwearëŠ” ëª¨ìë¡œ ë§¤í•‘
        'ê¸°íƒ€ACC': ['Acc_etc'],
        'ë‹¹ì‹œì¦Œì˜ë¥˜': ['ë‹¹ì‹œì¦Œì˜ë¥˜'],
        'ì°¨ì‹œì¦Œì˜ë¥˜': ['ì°¨ì‹œì¦Œì˜ë¥˜'],
        'ê³¼ì‹œì¦Œì˜ë¥˜': ['ê³¼ì‹œì¦Œì˜ë¥˜']
      };
      
      const labels = [];
      const values = [];
      const parents = [];
      const ids = [];
      const colors = [];
      
      // ì„ íƒëœ ì•„ì´í…œì˜ ì±„ë„ë³„ ë§¤ì¶œ ê³„ì‚°
      let totalChannelValue = 0;
      const channelTotals = {};
      
      // ì•„ì´í…œ í‚¤ ì°¾ê¸°
      const itemKeys = itemKeyMapReverse[selectedItem] || [selectedItem];
      
      console.log('ì•„ì´í…œ í‚¤ ê²€ìƒ‰:', {selectedItem, itemKeys});
      
      // ê° ì±„ë„ì—ì„œ í•´ë‹¹ ì•„ì´í…œì˜ ë§¤ì¶œ í•©ê³„
      Object.keys(brandSalesData).forEach(channelKey => {
        const channelItems = brandSalesData[channelKey];
        let channelItemValue = 0;
        
        itemKeys.forEach(itemKey => {
          if (channelItems[itemKey] && channelItems[itemKey] > 0) {
            channelItemValue += channelItems[itemKey];
          }
        });
        
        if (channelItemValue > 0) {
          // ì±„ë„ëª…ì€ ì´ë¯¸ ìµœì¢…ì±„ë„ëª…ìœ¼ë¡œ ë˜ì–´ ìˆìŒ
          const mappedChannel = channelNameToFinal[channelKey] || channelKey;
          
          if (!channelTotals[mappedChannel]) channelTotals[mappedChannel] = 0;
          channelTotals[mappedChannel] += channelItemValue;
        }
      });
      
      console.log('ì±„ë„ë³„ í•©ê³„:', channelTotals);
      
      // ì „ì²´ ì±„ë„ ëª©ë¡ (MLBì˜ ê²½ìš° RF í¬í•¨)
      let allChannels = [...channelList];
      if (brandCode === 'M' && brandSalesData['RF']) {
        allChannels.push('RF');
      }
      
      // ì±„ë„ì„ ë§¤ì¶œìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      const sortedChannels = allChannels
        .map(channel => ({ channel, value: channelTotals[channel] || 0 }))
        .filter(item => item.value > 0)
        .sort((a, b) => b.value - a.value);
      
      // ì •ë ¬ëœ ì±„ë„ ëª©ë¡ìœ¼ë¡œ ë°ì´í„° ì¶”ê°€ (ìì‹ë§Œ)
      const colorPalette = [
        'rgba(79,70,229,0.8)', 'rgba(124,58,237,0.8)', 'rgba(59,130,246,0.8)',
        'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(239,68,68,0.8)',
        'rgba(168,85,247,0.8)', 'rgba(34,197,94,0.8)', 'rgba(251,146,60,0.8)',
        'rgba(244,63,94,0.8)'
      ];
      let colorIndex = 0;
      
      // ì „ì²´ ì±„ë„ ë§¤ì¶œ í•©ê³„ ê³„ì‚°
      const itemDrilldownTotalValue = sortedChannels.reduce((sum, item) => sum + item.value, 0);
      const customItemDrilldownText = [];
      const discountRates = [];
      
      // YOY ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (itemTreemapDataì—ì„œ)
      let channelYoyData = {};
      try {
        const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
        const itemKeyMapForTreemap = {
          'ì‹ ë°œ': 'Shoes',
          'ê°€ë°©': 'Bag',
          'ëª¨ì': 'Headwear',
          'ê¸°íƒ€ACC': 'Acc_etc',
          'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
          'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜',
          'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜'
        };
        const itemKey = itemKeyMapForTreemap[selectedItem] || selectedItem;
        
        if (window.treemapRawData?.[brandCode]?.item?.items?.[itemKey]?.channels) {
          channelYoyData = window.treemapRawData[brandCode].item.items[itemKey].channels;
        }
      } catch (e) {
        console.warn('YOY ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      
      sortedChannels.forEach((item, index) => {
        const percentage = itemDrilldownTotalValue > 0 ? ((item.value / itemDrilldownTotalValue) * 100).toFixed(1) : 0;
        labels.push(item.channel);
        values.push(item.value / 100000000); // ì› ë‹¨ìœ„ë¥¼ ì–µì›ìœ¼ë¡œ ë³€í™˜
          parents.push('');  // ë¶€ëª¨ë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ (ìµœìƒìœ„ ë ˆë²¨)
          ids.push(`item-${selectedItem}-channel-${index}`);
          colors.push(colorPalette[colorIndex % colorPalette.length]);
          colorIndex++;
        totalChannelValue += item.value;
        // ì•„ì´í…œâ†’ì±„ë„ ë“œë¦´ë‹¤ìš´: ì•„ì´í…œ-ì±„ë„ ê°œë³„ í• ì¸ìœ¨
        let discountRate = 0;
        try {
          const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
          const candidates = itemKeyMapReverse[selectedItem] || [selectedItem];
          const metricsRoot = window.itemChannelMetrics?.[brandCode];
          if (metricsRoot) {
            let rate = null;
            for (const k of candidates) {
              const m = metricsRoot[k]?.[item.channel];
              if (m && typeof m.discountRate === 'number') { rate = m.discountRate; break; }
            }
            if (rate !== null) {
              discountRate = rate * 100;
            }
          }
        } catch (e) {}
        
        // YOY ë° ì „ë…„í• ì¸ìœ¨ ê°€ì ¸ì˜¤ê¸°
        const yoy = channelYoyData[item.channel]?.yoy;
        const prevDiscountRate = channelYoyData[item.channel]?.prevDiscountRate;
        
        // ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOYë¥¼ ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼
        const discountRateNum = parseFloat(discountRate.toFixed(1));
        const prevDiscountRateNum = prevDiscountRate !== null && prevDiscountRate !== undefined ? parseFloat(prevDiscountRate).toFixed(1) : null;
        discountRates.push({discountRate: discountRateNum, prevDiscountRate: prevDiscountRateNum, yoy: yoy});
        
        // í• ì¸ìœ¨ í‘œì‹œ
        let discountText = `<br><span style="font-size:12px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
        
        // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ (ë³„ë„ ì¤„)
        let prevDiscountText = '';
        if (prevDiscountRateNum !== null) {
          prevDiscountText = `<br><span style="font-size:12px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateNum}%</span>`;
        }
        
        // YOY í‘œì‹œ ì¶”ê°€
        let yoyText = '';
        if (yoy !== null && yoy !== undefined) {
          const yoyDisplay = (100 + yoy).toFixed(1);
          yoyText = `<br><span style="font-size:12px;color:#fde68a;">YOY : ${yoyDisplay}%</span>`;
        }
        
        customItemDrilldownText.push(`<b style="font-size:15px;color:white;">${item.channel}</b><br><span style="font-size:13px;color:white;">${(item.value / 100000000).toFixed(1)}ì–µì› (${percentage}%)</span>${discountText}${prevDiscountText}${yoyText}`);
      });
      
      console.log('ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ ë°ì´í„° ìƒì„±:', {labels, values, parents, ids, totalChannelValue, channelCount: labels.length});
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ ë°˜í™˜
      if (labels.length === 0) {
        console.warn('ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ ë°ì´í„° ì—†ìŒ:', {selectedItem, channelTotals});
        return [];
      }
      
      // customdata ë°°ì—´ ìƒì„±: [ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY] í˜•ì‹ (ì†Œìˆ˜ì  í•œ ìë¦¬ë¡œ í†µì¼)
      const customDataArray = sortedChannels.map((item, index) => {
        const share = itemDrilldownTotalValue > 0 ? ((item.value / itemDrilldownTotalValue) * 100) : 0;
        const rateData = discountRates[index] || {discountRate: 0, prevDiscountRate: 0.0, yoy: 0};
        const prevDiscountRateNum = rateData.prevDiscountRate !== null && rateData.prevDiscountRate !== undefined ? parseFloat(rateData.prevDiscountRate) : 0.0;
        const yoyPercentage = rateData.yoy !== null && rateData.yoy !== undefined ? parseFloat((100 + rateData.yoy).toFixed(1)) : 0.0;
        return [parseFloat(share.toFixed(1)), parseFloat(rateData.discountRate.toFixed(1)), prevDiscountRateNum, yoyPercentage];
      });
      
      return [{
        type: 'treemap',
        labels: labels,
        values: values,
        parents: parents,
        ids: ids,
        text: customItemDrilldownText,
        textinfo: 'text',
        hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[0]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[1]:.1f}% (ì „ë…„ : %{customdata[2]:.1f}%)<br>YOY : %{customdata[3]:.1f}%<extra></extra>',
        customdata: customDataArray,
        textfont: { size: 14 },
        marker: {
          colors: colors
        }
      }];
    }
    
    // -------- íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ë°ì´í„° (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€) --------
    function getTreemapDrilldownData(type, path) {
      if (type === 'channel') {
        return getChannelDrilldownData(path);
      } else {
        return getItemDrilldownData(path);
      }
    }

    // -------- ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„°/íˆ´íŒ/í† ê¸€ --------
    function getChannelRadarData(brand){
      // â˜… ì „ì—­ currentBrand ì‚¬ìš© (brand íŒŒë¼ë¯¸í„° ë¬´ì‹œ) â˜…
      const brandToUse = currentBrand || brand || 'MLB';
      const brandCode = brandCodeMap[brandToUse] || brandToUse;
      
      // â˜… window.brandKPI ì‚¬ìš© (ì•ˆì „í•œ ì ‘ê·¼) â˜…
      const brandKPIData = window.brandKPI || {};
      
      // brandKPI ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì •ì  ë°ì´í„° ë°˜í™˜
      if (!brandKPIData[brandCode]?.channelPlan) {
        console.warn('[getChannelRadarData] brandKPI ë°ì´í„° ì—†ìŒ, ì •ì  ë°ì´í„° ì‚¬ìš©:', brandToUse, brandCode);
        return getStaticRadarData();
      }
      
      // ë¸Œëœë“œë³„ ì±„ë„ ëª©ë¡ ì„¤ì • (ëª…ì‹œì ìœ¼ë¡œ ì§€ì •ëœ ì±„ë„ë§Œ ì‚¬ìš©)
      // â˜… brandToUse ì‚¬ìš© (currentBrand ê¸°ë°˜) â˜…
      let allLabels = [];
      if (brandToUse === 'MLB') {
        // MLB: ë°±í™”ì , ë©´ì„¸ì , RF, ì§ì˜ì (ê°€ë‘), ìì‚¬ëª°, ì œíœ´ëª°, ëŒ€ë¦¬ì , ì§ì˜ëª°
        // ì£¼ì˜: 'ì‚¬ì…', 'ê¸°íƒ€' ë“±ì€ ë ˆì´ë” ì°¨íŠ¸ì— í¬í•¨í•˜ì§€ ì•ŠìŒ
        allLabels = ['ë°±í™”ì ', 'ë©´ì„¸ì ', 'RF', 'ì§ì˜ì (ê°€ë‘)', 'ìì‚¬ëª°', 'ì œíœ´ëª°', 'ëŒ€ë¦¬ì ', 'ì§ì˜ëª°'];
      } else {
        // MLB ì™¸: ë°±í™”ì , ë©´ì„¸ì , ì§ì˜ì (ê°€ë‘), ìì‚¬ëª°, ì œíœ´ëª°, ëŒ€ë¦¬ì , ì§ì˜ëª°, ì•„ìš¸ë ›
        // ì£¼ì˜: 'ì‚¬ì…', 'ê¸°íƒ€' ë“±ì€ ë ˆì´ë” ì°¨íŠ¸ì— í¬í•¨í•˜ì§€ ì•ŠìŒ
        allLabels = ['ë°±í™”ì ', 'ë©´ì„¸ì ', 'ì§ì˜ì (ê°€ë‘)', 'ìì‚¬ëª°', 'ì œíœ´ëª°', 'ëŒ€ë¦¬ì ', 'ì§ì˜ëª°', 'ì•„ìš¸ë ›'];
      }
      
      console.log('[getChannelRadarData] ì‹¤ì œ ë°ì´í„° ì‚¬ìš©:', brandToUse, brandCode);
      
      // ë‹¹ë…„ ë°ì´í„°: brandKPIì—ì„œ ì±„ë„ë³„ ë‹¹ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë‹¨ìœ„: ì›, forecast íŒŒì¼ì—ì„œ ì¶”ì¶œ)
      const brandCurrentData = brandKPIData[brandCode]?.channelCurrent || {};
      
      // ì „ë…„ ë°ì´í„°: brandKPIì—ì„œ ì±„ë„ë³„ ì „ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë‹¨ìœ„: ì›)
      const brandYoyData = brandKPIData[brandCode]?.channelYoy || {};
      
      // ê³„íš ë°ì´í„°: brandKPIì—ì„œ ì±„ë„ë³„ ê³„íš ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë‹¨ìœ„: ì›)
      const brandPlanData = brandKPIData[brandCode]?.channelPlan || {};
      
      // ì „ë…„ ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜
      const getYoySales = (name) => {
        if (name === 'ì§ì˜ì (ê°€ë‘)') {
          return ((brandYoyData['ì§ì˜ì (ê°€ë‘)'] || brandYoyData['ì§ì˜ì '] || brandYoyData['ì§ì˜ê°€ë‘'] || 0)) / 100000000;
        } else if (name === 'ì§ì˜ëª°') {
          return (brandYoyData['ì§ì˜ëª°'] || 0) / 100000000;
        } else if (name === 'ì•„ìš¸ë ›') {
          return (brandYoyData['ì•„ìš¸ë ›'] || 0) / 100000000;
        } else if (name === 'RF') {
          return (brandYoyData['RF'] || 0) / 100000000;
        } else if (name === 'ìì‚¬ëª°') {
          return (brandYoyData['ìì‚¬ëª°'] || (brandYoyData['ì˜¨ë¼ì¸'] ? brandYoyData['ì˜¨ë¼ì¸']/2 : 0)) / 100000000;
        } else if (name === 'ì œíœ´ëª°') {
          return (brandYoyData['ì œíœ´ëª°'] || (brandYoyData['ì˜¨ë¼ì¸'] ? brandYoyData['ì˜¨ë¼ì¸']/2 : 0)) / 100000000;
        } else {
          return (brandYoyData[name] || 0) / 100000000;
        }
      };
      
      // ë‹¹ë…„ ë°ì´í„°ì—ì„œ ì±„ë„ë³„ ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
      const getCurrentSales = (name) => {
        if (name === 'ì§ì˜ì (ê°€ë‘)') {
          return (brandCurrentData['ì§ì˜ì (ê°€ë‘)'] || brandCurrentData['ì§ì˜ì '] || brandCurrentData['ì§ì˜ê°€ë‘'] || 0) / 100000000;
        } else if (name === 'ì§ì˜ëª°') {
          return (brandCurrentData['ì§ì˜ëª°'] || 0) / 100000000;
        } else if (name === 'ì•„ìš¸ë ›') {
          return (brandCurrentData['ì•„ìš¸ë ›'] || 0) / 100000000;
        } else if (name === 'RF') {
          return (brandCurrentData['RF'] || 0) / 100000000;
        } else if (name === 'ìì‚¬ëª°' || name === 'ì œíœ´ëª°') {
          return (brandCurrentData[name] || (brandCurrentData['ì˜¨ë¼ì¸'] ? brandCurrentData['ì˜¨ë¼ì¸']/2 : 0)) / 100000000;
        } else {
          return (brandCurrentData[name] || 0) / 100000000;
        }
      };
      
      // ê³„íš ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜
      const getPlanSales = (name) => {
        if (name === 'ì§ì˜ì (ê°€ë‘)') {
          return (brandPlanData['ì§ì˜ì (ê°€ë‘)'] || brandPlanData['ì§ì˜ì '] || brandPlanData['ì§ì˜ê°€ë‘'] || 0) / 100000000;
        } else if (name === 'ì§ì˜ëª°') {
          return (brandPlanData['ì§ì˜ëª°'] || 0) / 100000000;
        } else if (name === 'ì•„ìš¸ë ›') {
          return (brandPlanData['ì•„ìš¸ë ›'] || 0) / 100000000;
        } else if (name === 'RF') {
          return (brandPlanData['RF'] || 0) / 100000000;
        } else if (name === 'ìì‚¬ëª°' || name === 'ì œíœ´ëª°') {
          return (brandPlanData[name] || (brandPlanData['ì˜¨ë¼ì¸'] ? brandPlanData['ì˜¨ë¼ì¸']/2 : 0)) / 100000000;
        } else {
          return (brandPlanData[name] || 0) / 100000000;
        }
      };
      
      // â˜… ì „ë…„/ë‹¹ë…„/ê³„íš ì¤‘ í•˜ë‚˜ë¼ë„ ë§¤ì¶œì´ ìˆëŠ” ì±„ë„ë§Œ í•„í„°ë§ â˜…
      const labels = allLabels.filter(label => {
        const yoySales = getYoySales(label);
        const currentSales = getCurrentSales(label);
        const planSales = getPlanSales(label);
        // ì „ë…„, ë‹¹ë…„, ê³„íš ì¤‘ í•˜ë‚˜ë¼ë„ 0ë³´ë‹¤ í¬ë©´ í¬í•¨
        return yoySales > 0 || currentSales > 0 || planSales > 0;
      });
      
      const prevMap = {};
      labels.forEach(label => {
        prevMap[label] = getYoySales(label);
      });
      
      // ê³„íš ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const planSalesMap = {};
      labels.forEach(n => {
        planSalesMap[n] = getPlanSales(n);
      });
      
      // ë‹¹ë…„ ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const currentSalesMap = {};
      labels.forEach(n => {
        currentSalesMap[n] = getCurrentSales(n);
      });
      
      // ì „ë…„ ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const yoySalesMap = {};
      labels.forEach(n => {
        yoySalesMap[n] = prevMap[n] || 0;
      });
      
      const plan = labels.map(n=>{
        const currentSales = getCurrentSales(n);
        const planSales = planSalesMap[n] || 0;
        return planSales > 0 ? Math.round((currentSales / planSales) * 100) : 0;
      });
      
      const yoy = labels.map(n=>{
        const currentSales = getCurrentSales(n);
        const prev = prevMap[n] || 0;
        return prev > 0 ? Math.round((currentSales / prev) * 100) : 0;
      });
      
      const sales = labels.map(n=>{
        const currentSales = getCurrentSales(n);
        return `${currentSales.toFixed(1)}ì–µ`;
      });
      
      // ë¸Œëœë“œë³„ ì „ì²´ ê³„íš ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚°
      const brandTotalPlan = (() => {
        // weekly_trend.jsonì—ì„œ ë¸Œëœë“œë³„ ì „ì²´ ê³„íš ê°€ì ¸ì˜¤ê¸°
        const weeklyTrend = window.weeklyTrend || {};
        const brandData = weeklyTrend.byBrand?.[brandCode];
        if (brandData && brandData.totalPlan) {
          return brandData.totalPlan / 100000000; // ì–µì› ë‹¨ìœ„
        }
        // radar_chart.jsonì—ì„œ ë¸Œëœë“œë³„ ì „ì²´ ê³„íš ê°€ì ¸ì˜¤ê¸°
        const radarChart = window.radarChartData || {};
        const brandNameMap = {
          'M': 'MLB',
          'I': 'MLB_KIDS',
          'X': 'DISCOVERY',
          'V': 'DUVETICA',
          'ST': 'SERGIO',
          'W': 'SUPRA'
        };
        const brandName = brandNameMap[brandCode] || brandCode;
        if (radarChart.brandTotalPlan && radarChart.brandTotalPlan[brandName]) {
          return radarChart.brandTotalPlan[brandName] / 100000000; // ì–µì› ë‹¨ìœ„
        }
        return 0;
      })();
      
      const brandPlan = labels.map(n=>{
        const currentSales = getCurrentSales(n);
        // ë¸Œëœë“œ ì „ì²´ ê³„íš ëŒ€ë¹„ ê° ì±„ë„ì˜ ë¹„ìœ¨ ê³„ì‚°
        if (brandTotalPlan > 0) {
          // ê° ì±„ë„ì˜ ê³„íš ë§¤ì¶œ
          let channelPlanSales = 0;
          if (n === 'ì§ì˜ì (ê°€ë‘)') {
            channelPlanSales = (brandPlanData['ì§ì˜ì (ê°€ë‘)'] || brandPlanData['ì§ì˜ì '] || brandPlanData['ì§ì˜ê°€ë‘'] || 0) / 100000000;
          } else if (n === 'ì§ì˜ëª°') {
            channelPlanSales = (brandPlanData['ì§ì˜ëª°'] || 0) / 100000000;
          } else if (n === 'ì•„ìš¸ë ›') {
            channelPlanSales = (brandPlanData['ì•„ìš¸ë ›'] || 0) / 100000000;
          } else if (n === 'RF') {
            channelPlanSales = (brandPlanData['RF'] || 0) / 100000000;
          } else if (n === 'ìì‚¬ëª°' || n === 'ì œíœ´ëª°') {
            channelPlanSales = (brandPlanData[n] || (brandPlanData['ì˜¨ë¼ì¸'] ? brandPlanData['ì˜¨ë¼ì¸']/2 : 0)) / 100000000;
          } else {
            channelPlanSales = (brandPlanData[n] || 0) / 100000000;
          }
          
          // ë¸Œëœë“œ ì „ì²´ ê³„íš ëŒ€ë¹„ ê° ì±„ë„ ê³„íšì˜ ë¹„ìœ¨
          const channelPlanRatio = brandTotalPlan > 0 ? (channelPlanSales / brandTotalPlan) * 100 : 0;
          // ë‹¹ë…„ ë§¤ì¶œì´ ë¸Œëœë“œ ì „ì²´ ê³„íš ëŒ€ë¹„ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨
          const currentRatio = brandTotalPlan > 0 ? (currentSales / brandTotalPlan) * 100 : 0;
          // ê³„íš ëŒ€ë¹„ ë‹¬ì„±ë¥ 
          return channelPlanRatio > 0 ? Math.round((currentRatio / channelPlanRatio) * 100) : 0;
        }
        return 0;
      });
      
      // ë””ë²„ê¹…: MLBì¸ ê²½ìš° RF ë°ì´í„° í™•ì¸
      if (brandToUse === 'MLB') {
        console.log('[getChannelRadarData] MLB ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„°:', {
          labels: labels,
          RF_current: getCurrentSales('RF'),
          RF_plan: (brandPlanData['RF'] || 0) / 100000000,
          RF_yoy: (brandYoyData['RF'] || 0) / 100000000,
          brandTotalPlan: brandTotalPlan,
          brandCurrentData: brandCurrentData,
          brandPlanData: brandPlanData,
          brandYoyData: brandYoyData
        });
      }
      
      return { labels, plan, yoy, brandPlan, sales, planSalesMap, currentSalesMap, yoySalesMap };
    }

    // -------- ë ˆì´ë” ì°¨íŠ¸ ì±„ë„/ì•„ì´í…œ ìƒì„¸ ì •ë³´ í† ê¸€ --------
    function showRadarChannelToggle(event, channelName, brand, type, radarData) {
      const toggle = document.getElementById('radarChannelToggle');
      if (!toggle) return;
      
      // ë¸Œëœë“œëª…ì„ ë¸Œëœë“œ ì½”ë“œë¡œ ë³€í™˜
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[brand] || brand;
      
      // radarDataê°€ ì—†ê±°ë‚˜ í•„ìš”í•œ ë§µì´ ì—†ìœ¼ë©´ getChannelRadarData/getItemRadarData í•¨ìˆ˜ í˜¸ì¶œ
      if (!radarData || !radarData.currentSalesMap || !radarData.yoySalesMap || !radarData.planSalesMap) {
        if (type === 'item') {
          radarData = getItemRadarData(brand);
        } else {
          radarData = getChannelRadarData(brand);
        }
      }
      
      // ì±„ë„/ì•„ì´í…œ ì¸ë±ìŠ¤ ì°¾ê¸°
      const dataIndex = radarData.labels.indexOf(channelName);
      if (dataIndex === -1) return;
      
      let currentSales, yoySales, planSales;
      
      // radarDataì—ì„œ ì§ì ‘ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      if (radarData.currentSalesMap && radarData.currentSalesMap[channelName] !== undefined) {
        currentSales = radarData.currentSalesMap[channelName];
      } else if (radarData.sales && radarData.sales[dataIndex]) {
        // sales ë°°ì—´ì—ì„œ ê°€ì ¸ì˜¤ê¸° (ì˜ˆ: "123.4ì–µ" í˜•ì‹)
        const salesStr = radarData.sales[dataIndex];
        currentSales = parseFloat(salesStr.replace('ì–µ', '')) || 0;
      } else {
        currentSales = 0;
      }
      
      // ì „ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      if (radarData.yoySalesMap && radarData.yoySalesMap[channelName] !== undefined) {
        yoySales = radarData.yoySalesMap[channelName];
      } else {
        yoySales = 0;
      }
      
      // ê³„íš ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      if (radarData.planSalesMap && radarData.planSalesMap[channelName] !== undefined) {
        planSales = radarData.planSalesMap[channelName];
      } else {
        planSales = 0;
      }
      
      // ì „ë…„ëŒ€ë¹„ í¼ì„¼íŠ¸ ê³„ì‚°
      const yoyPercent = yoySales > 0 ? Math.round((currentSales / yoySales) * 100) : 0;
      
      // ê³„íšëŒ€ë¹„ í¼ì„¼íŠ¸ ê³„ì‚°
      const planPercent = planSales > 0 ? Math.round((currentSales / planSales) * 100) : 0;
      
      // í† ê¸€ ë‚´ìš© ì—…ë°ì´íŠ¸
      document.getElementById('radarToggleChannelName').textContent = channelName;
      document.getElementById('radarToggleCurrent').textContent = `${currentSales.toFixed(1)}ì–µ`;
      document.getElementById('radarToggleYoy').textContent = `${yoySales.toFixed(1)}ì–µ (${yoyPercent}%)`;
      document.getElementById('radarTogglePlan').textContent = `${planSales.toFixed(1)}ì–µ (${planPercent}%)`;
      
      // í† ê¸€ ìœ„ì¹˜ ì„¤ì • (í´ë¦­í•œ ìœ„ì¹˜ ê¸°ì¤€)
      const chartContainer = document.getElementById('radarChart').closest('.chart-wrapper');
      if (!chartContainer) {
        console.warn('[showRadarChannelToggle] chartContainerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      const rect = chartContainer.getBoundingClientRect();
      // Chart.js v3ì—ì„œëŠ” event.nativeê°€ ì—†ì„ ìˆ˜ ìˆìŒ
      let clickX, clickY;
      if (event && event.native) {
        clickX = event.native.clientX;
        clickY = event.native.clientY;
      } else if (event && event.clientX !== undefined) {
        clickX = event.clientX;
        clickY = event.clientY;
      } else {
        // ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ ì¤‘ì•™ì— í‘œì‹œ
        clickX = rect.left + rect.width / 2;
        clickY = rect.top + rect.height / 2;
      }
      
      const x = clickX - rect.left;
      const y = clickY - rect.top;
      
      // í† ê¸€ì´ ì»¨í…Œì´ë„ˆ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      const toggleWidth = 200;
      const toggleHeight = 120;
      let finalX = x + 20;
      let finalY = y + 20;
      
      if (finalX + toggleWidth > rect.width) {
        finalX = x - toggleWidth - 20;
      }
      if (finalY + toggleHeight > rect.height) {
        finalY = y - toggleHeight - 20;
      }
      
      toggle.style.left = `${Math.max(10, finalX)}px`;
      toggle.style.top = `${Math.max(10, finalY)}px`;
      toggle.style.display = 'block';
      
      // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ í† ê¸€ ìˆ¨ê¸°ê¸°
      setTimeout(() => {
        const hideOnClick = (e) => {
          if (!toggle.contains(e.target) && e.target.id !== 'radarChart' && !e.target.closest('#radarChart')) {
            hideRadarChannelToggle();
            document.removeEventListener('click', hideOnClick);
          }
        };
        document.addEventListener('click', hideOnClick);
      }, 100);
    }
    
    function hideRadarChannelToggle() {
      const toggle = document.getElementById('radarChannelToggle');
      if (toggle) {
        toggle.style.display = 'none';
      }
    }

    // ì „ì²´í˜„í™© ë ˆì´ë” ì°¨íŠ¸ íˆ´íŒ í‘œì‹œ í•¨ìˆ˜
    function showBrandAllRadarToggle(event, brandName, brandKey) {
      const toggle = document.getElementById('brandAllRadarToggle');
      if (!toggle) return;
      
      // ë¸Œëœë“œë³„ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      let currentSales = 0;
      let yoySales = 0;
      let planSales = 0;
      
      // brandDataì—ì„œ forecast ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
      if (brandData && brandData[brandKey] && brandData[brandKey].channels) {
        currentSales = Object.values(brandData[brandKey].channels).reduce((sum, ch) => sum + (ch.forecast || 0), 0);
      } else {
        // brandDataê°€ ì—†ìœ¼ë©´ overviewByBrandì—ì„œ ê°€ì ¸ì˜¤ê¸°
        const overviewBrand = window.by_brand?.find(b => {
          const brandNameMap = { 'MLB': 'MLB', 'MLB_KIDS': 'MLB KIDS', 'DISCOVERY': 'DISCOVERY', 'DUVETICA': 'DUVETICA', 'SERGIO': 'SERGIO' };
          return b.BRAND === brandNameMap[brandKey];
        });
        if (overviewBrand) {
          currentSales = overviewBrand.SALES || 0; // ì´ë¯¸ ì–µì› ë‹¨ìœ„
        }
      }
      
      // brandPLDataì—ì„œ ì „ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      if (brandPLData && brandPLData[brandKey] && brandPLData[brandKey].revenue) {
        yoySales = brandPLData[brandKey].revenue.prev || 0;
      } else {
        // brandPLDataê°€ ì—†ìœ¼ë©´ overviewByBrandì—ì„œ ê³„ì‚°
        const overviewBrand = window.by_brand?.find(b => {
          const brandNameMap = { 'MLB': 'MLB', 'MLB_KIDS': 'MLB KIDS', 'DISCOVERY': 'DISCOVERY', 'DUVETICA': 'DUVETICA', 'SERGIO': 'SERGIO' };
          return b.BRAND === brandNameMap[brandKey];
        });
        if (overviewBrand && overviewBrand.YOY_SALES) {
          // YOY_SALESê°€ 100% ê¸°ì¤€ì´ë¯€ë¡œ, currentSales / (YOY_SALES/100) = prev
          yoySales = currentSales / (overviewBrand.YOY_SALES / 100);
        }
      }
      
      // brandPlanDataì—ì„œ ê³„íš ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandPlanData = window.brandPlanData || {};
      planSales = brandPlanData[brandKey] || 0;
      
      // brandDataì˜ targetë„ ì‹œë„ (í•˜ìœ„ í˜¸í™˜ì„±)
      if (planSales === 0 && brandData && brandData[brandKey] && brandData[brandKey].channels) {
        planSales = Object.values(brandData[brandKey].channels).reduce((sum, ch) => sum + (ch.target || 0), 0);
      }
      
      // ì „ë…„ëŒ€ë¹„ í¼ì„¼íŠ¸ ê³„ì‚°
      const yoyPercentCalc = yoySales > 0 ? Math.round((currentSales / yoySales) * 100) : 0;
      
      // ê³„íšëŒ€ë¹„ í¼ì„¼íŠ¸ ê³„ì‚°
      const planPercentCalc = planSales > 0 ? Math.round((currentSales / planSales) * 100) : 0;
      
      // í† ê¸€ ë‚´ìš© ì—…ë°ì´íŠ¸
      document.getElementById('brandAllRadarToggleBrandName').textContent = brandName;
      document.getElementById('brandAllRadarToggleCurrent').textContent = `${currentSales.toFixed(1)}ì–µ`;
      document.getElementById('brandAllRadarToggleYoy').textContent = `${yoySales.toFixed(1)}ì–µ (${yoyPercentCalc}%)`;
      document.getElementById('brandAllRadarTogglePlan').textContent = `${planSales.toFixed(1)}ì–µ (${planPercentCalc}%)`;
      
      // í† ê¸€ ìœ„ì¹˜ ì„¤ì •
      const chartContainer = document.getElementById('brandAllRadarChart').closest('.chart-wrapper');
      if (!chartContainer) {
        console.warn('[showBrandAllRadarToggle] chartContainerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      const rect = chartContainer.getBoundingClientRect();
      let clickX, clickY;
      if (event && event.clientX !== undefined) {
        clickX = event.clientX;
        clickY = event.clientY;
      } else {
        // ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ ì¤‘ì•™ì— í‘œì‹œ
        clickX = rect.left + rect.width / 2;
        clickY = rect.top + rect.height / 2;
      }
      
      const x = clickX - rect.left;
      const y = clickY - rect.top;
      
      // í† ê¸€ì´ ì»¨í…Œì´ë„ˆ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      const toggleWidth = 200;
      const toggleHeight = 120;
      let finalX = x + 20;
      let finalY = y + 20;
      
      if (finalX + toggleWidth > rect.width) {
        finalX = x - toggleWidth - 20;
      }
      if (finalY + toggleHeight > rect.height) {
        finalY = y - toggleHeight - 20;
      }
      
      toggle.style.left = `${Math.max(10, finalX)}px`;
      toggle.style.top = `${Math.max(10, finalY)}px`;
      toggle.style.display = 'block';
    }

    // ì „ì²´í˜„í™© ë ˆì´ë” ì°¨íŠ¸ íˆ´íŒ ìˆ¨ê¹€ í•¨ìˆ˜
    function hideBrandAllRadarToggle() {
      const toggle = document.getElementById('brandAllRadarToggle');
      if (toggle) {
        toggle.style.display = 'none';
      }
    }

    function getItemRadarData(brand){
      // â˜… ì „ì—­ currentBrand ì‚¬ìš© (brand íŒŒë¼ë¯¸í„° ë¬´ì‹œ) â˜…
      const brandToUse = currentBrand || brand || 'MLB';
      const brandCode = brandCodeMap[brandToUse] || brandToUse;
      
      // â˜… window.brandKPI ì‚¬ìš© (ì•ˆì „í•œ ì ‘ê·¼) â˜…
      const brandKPIData = window.brandKPI || {};
      
      // brandKPI ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì •ì  ë°ì´í„° ë°˜í™˜
      if (!brandKPIData[brandCode]?.itemPlan) {
        console.warn('[getItemRadarData] brandKPI ë°ì´í„° ì—†ìŒ, ì •ì  ë°ì´í„° ì‚¬ìš©:', brandToUse, brandCode);
        return getStaticItemRadarData();
      }
      
      console.log('[getItemRadarData] ì‹¤ì œ ë°ì´í„° ì‚¬ìš©:', brandToUse, brandCode);
      
      // ì•„ì´í…œ ëª©ë¡ ì •ì˜ (í‘œì‹œ ìˆœì„œ)
      const allItems = ['ë‹¹ì‹œì¦Œì˜ë¥˜', 'ê³¼ì‹œì¦Œì˜ë¥˜', 'ì°¨ì‹œì¦Œì˜ë¥˜', 'ëª¨ì', 'ê°€ë°©', 'ì‹ ë°œ', 'ê¸°íƒ€'];
      
      // ë‹¹ë…„ ë°ì´í„°: brandKPIì—ì„œ ì•„ì´í…œë³„ ë‹¹ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandItemCurrent = brandKPIData[brandCode]?.itemCurrent || {};
      
      // ì „ë…„ ë°ì´í„°: brandKPIì—ì„œ ì•„ì´í…œë³„ ì „ë…„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandItemYoy = brandKPIData[brandCode]?.itemYoy || {};
      
      // ê³„íš ë°ì´í„°: brandKPIì—ì„œ ì•„ì´í…œë³„ ê³„íš ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const brandItemPlan = brandKPIData[brandCode]?.itemPlan || {};
      
      // ë‹¹ë…„ ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
      const getCurrentSales = (name) => {
        return (brandItemCurrent[name] || 0) / 100000000;
      };
      
      // ì „ë…„ ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
      const getYoySales = (name) => {
        return (brandItemYoy[name] || 0) / 100000000;
      };
      
      // ê³„íš ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
      const getPlanSales = (name) => {
        return (brandItemPlan[name] || 0) / 100000000;
      };
      
      // â˜… ì „ë…„/ë‹¹ë…„/ê³„íš ì¤‘ í•˜ë‚˜ë¼ë„ ë§¤ì¶œì´ ìˆëŠ” ì•„ì´í…œë§Œ í•„í„°ë§ â˜…
      const labels = allItems.filter(item => {
        const yoySales = getYoySales(item);
        const currentSales = getCurrentSales(item);
        const planSales = getPlanSales(item);
        // ì „ë…„, ë‹¹ë…„, ê³„íš ì¤‘ í•˜ë‚˜ë¼ë„ 0ë³´ë‹¤ í¬ë©´ í¬í•¨
        return yoySales > 0 || currentSales > 0 || planSales > 0;
      });
      
      // ê³„íš ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const planSalesMap = {};
      labels.forEach(n => {
        planSalesMap[n] = getPlanSales(n);
      });
      
      // ë‹¹ë…„ ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const currentSalesMap = {};
      labels.forEach(n => {
        currentSalesMap[n] = getCurrentSales(n);
      });
      
      // ì „ë…„ ë§¤ì¶œ ê°’ ì €ì¥ (í† ê¸€ì—ì„œ ì‚¬ìš©)
      const yoySalesMap = {};
      labels.forEach(n => {
        yoySalesMap[n] = getYoySales(n);
      });
      
      // ê³„íš ë‹¬ì„±ë¥  ê³„ì‚°
      const plan = labels.map(n => {
        const planSales = planSalesMap[n];
        const currentSales = getCurrentSales(n);
        return planSales > 0 ? Math.round((currentSales / planSales) * 100) : 0;
      });
      
      // ì „ë…„ ëŒ€ë¹„ ê³„ì‚°
      const yoy = labels.map(n => {
        const currentSales = getCurrentSales(n);
        const prevSales = getYoySales(n);
        return prevSales > 0 ? Math.round((currentSales / prevSales) * 100) : 0;
      });
      
      // ë§¤ì¶œ í‘œì‹œìš© (ì–µì› ë‹¨ìœ„)
      const sales = labels.map(n => {
        const currentSales = getCurrentSales(n);
        return `${currentSales.toFixed(1)}ì–µ`;
      });
      
      // ë¸Œëœë“œë³„ ì „ì²´ ì•„ì´í…œ ê³„íš ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚°
      const brandTotalItemPlan = (() => {
        // radar_chart.jsonì—ì„œ ë¸Œëœë“œë³„ ì „ì²´ ì•„ì´í…œ ê³„íš ê°€ì ¸ì˜¤ê¸°
        const radarChart = window.radarChartData || {};
        const brandNameMap = {
          'M': 'MLB',
          'I': 'MLB_KIDS',
          'X': 'DISCOVERY',
          'V': 'DUVETICA',
          'ST': 'SERGIO',
          'W': 'SUPRA'
        };
        const brandName = brandNameMap[brandCode] || brandCode;
        if (radarChart.brandTotalItemPlan && radarChart.brandTotalItemPlan[brandName]) {
          return radarChart.brandTotalItemPlan[brandName] / 100000000; // ì–µì› ë‹¨ìœ„
        }
        return 0;
      })();
      
      const brandPlan = labels.map(n => {
        const currentSales = getCurrentSales(n);
        // ë¸Œëœë“œ ì „ì²´ ì•„ì´í…œ ê³„íš ëŒ€ë¹„ ê° ì•„ì´í…œì˜ ë¹„ìœ¨ ê³„ì‚°
        if (brandTotalItemPlan > 0) {
          // ê° ì•„ì´í…œì˜ ê³„íš ë§¤ì¶œ
          const itemPlanSales = getPlanSales(n);
          // ë¸Œëœë“œ ì „ì²´ ì•„ì´í…œ ê³„íš ëŒ€ë¹„ ê° ì•„ì´í…œ ê³„íšì˜ ë¹„ìœ¨
          const itemPlanRatio = brandTotalItemPlan > 0 ? (itemPlanSales / brandTotalItemPlan) * 100 : 0;
          // ë‹¹ë…„ ë§¤ì¶œì´ ë¸Œëœë“œ ì „ì²´ ì•„ì´í…œ ê³„íš ëŒ€ë¹„ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨
          const currentRatio = brandTotalItemPlan > 0 ? (currentSales / brandTotalItemPlan) * 100 : 0;
          // ê³„íš ëŒ€ë¹„ ë‹¬ì„±ë¥ 
          return itemPlanRatio > 0 ? Math.round((currentRatio / itemPlanRatio) * 100) : 0;
        }
        return 0;
      });
      
      return { labels, plan, yoy, brandPlan, sales, planSalesMap, currentSalesMap, yoySalesMap };
    }

    function customRadarTooltip(context){
      const label = context[0]?.label;
      const brand = currentBrand;
      const type = window.radarChartType || 'channel';
      const data = (type==='channel') ? getChannelRadarData(brand) : getItemRadarData(brand);
      const idx = data.labels.indexOf(label);
      const plan = data.plan[idx];
      const yoy = data.yoy[idx];
      const brandPlan = data.brandPlan ? data.brandPlan[idx] : null;
      const sales = data.sales[idx];
      let tooltip = `${label} (${sales})\nê³„íš ${plan}% | ì „ë…„ ${yoy}%`;
      if (brandPlan !== null && brandPlan !== undefined) {
        tooltip += ` | ë¸Œëœë“œê³„íš ${brandPlan}%`;
      }
      return tooltip;
    }

    function initRadarToggle(){
      window.radarChartType = window.radarChartType || 'channel';
      const btnCh = document.getElementById('radarBtnChannel');
      const btnIt = document.getElementById('radarBtnItem');
      if(!btnCh || !btnIt) return;
      const applyActive = ()=>{
        if(window.radarChartType==='channel'){
          btnCh.style.background = '#2563eb'; btnCh.style.color = '#fff';
          btnIt.style.background = '#e5e7eb'; btnIt.style.color = '#374151';
        }else{
          btnIt.style.background = '#2563eb'; btnIt.style.color = '#fff';
          btnCh.style.background = '#e5e7eb'; btnCh.style.color = '#374151';
        }
      };
      btnCh.onclick = ()=>{ window.radarChartType='channel'; applyActive(); updateRadarStaticOrDynamic(); };
      btnIt.onclick = ()=>{ window.radarChartType='item'; applyActive(); updateRadarStaticOrDynamic(); };
      applyActive();
    }

    function updateRadarStaticOrDynamic(){
      if(!charts.radar) {
        console.warn('[updateRadarStaticOrDynamic] ë ˆì´ë” ì°¨íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      const type = window.radarChartType || 'channel';
      console.log('[updateRadarStaticOrDynamic] íƒ€ì…:', type, 'currentBrand:', currentBrand);
      
      let data;
      if (window.uiStaticMode) {
        data = (type==='channel') ? getStaticRadarData() : getStaticItemRadarData();
      } else {
        data = (type==='channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand);
      }
      
      if (!data || !data.labels || !data.plan || !data.yoy) {
        console.error('[updateRadarStaticOrDynamic] ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', data);
        return;
      }
      
      charts.radar.data.labels = data.labels;
      charts.radar.data.datasets[0].data = data.plan;
      charts.radar.data.datasets[1].data = data.yoy;
      // ë¸Œëœë“œë³„ ê³„íš ë°ì´í„°ì…‹ ì¶”ê°€/ì—…ë°ì´íŠ¸
      if (data.brandPlan) {
        if (charts.radar.data.datasets.length < 3) {
          charts.radar.data.datasets.push({
            label: 'ë¸Œëœë“œê³„íš',
            data: data.brandPlan,
            borderColor: '#F59E0B',
            backgroundColor: 'rgba(245,158,11,0.2)',
            borderWidth: 2,
            pointRadius: 2,
            borderDash: [5, 5]
          });
        } else {
          charts.radar.data.datasets[2].data = data.brandPlan;
        }
      } else if (charts.radar.data.datasets.length > 2) {
        // ë¸Œëœë“œë³„ ê³„íš ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì œê±°
        charts.radar.data.datasets.pop();
      }
      
      // onClick/onHover ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸ (í˜„ì¬ typeì— ë§ê²Œ)
      charts.radar.options.onClick = function(event, elements) {
        try {
          if (elements && elements.length > 0) {
            const element = elements[0];
            const index = element.index;
            const currentType = window.radarChartType || 'channel';
            const currentData = window.uiStaticMode 
              ? ((currentType==='channel') ? getStaticRadarData() : getStaticItemRadarData())
              : ((currentType==='channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand));
            if (index !== undefined && currentData.labels && currentData.labels[index]) {
              const label = currentData.labels[index];
              showRadarChannelToggle(event, label, currentBrand, currentType, currentData);
            }
          } else {
            hideRadarChannelToggle();
          }
        } catch (e) {
          console.warn('[ë ˆì´ë” ì°¨íŠ¸ onClick ì—ëŸ¬]', e);
        }
      };
      
      charts.radar.options.onHover = function(event, elements) {
        try {
          if (elements && elements.length > 0) {
            const element = elements[0];
            const index = element.index;
            const currentType = window.radarChartType || 'channel';
            const currentData = window.uiStaticMode 
              ? ((currentType==='channel') ? getStaticRadarData() : getStaticItemRadarData())
              : ((currentType==='channel') ? getChannelRadarData(currentBrand) : getItemRadarData(currentBrand));
            if (index !== undefined && currentData.labels && currentData.labels[index]) {
              const label = currentData.labels[index];
              if (event && event.native && event.native.target) {
                event.native.target.style.cursor = 'pointer';
              }
              showRadarChannelToggle(event, label, currentBrand, currentType, currentData);
            }
          } else {
            if (event && event.native && event.native.target) {
              event.native.target.style.cursor = 'default';
            }
            hideRadarChannelToggle();
          }
        } catch (e) {
          console.warn('[ë ˆì´ë” ì°¨íŠ¸ onHover ì—ëŸ¬]', e);
        }
      };
      
      charts.radar.update();
    }

    // ì „ì²´ ë¸Œëœë“œ ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™”
    function initAllBrandsRadarChart(){
      const brandAllRadarCtx = document.getElementById('brandAllRadarChart');
      if (!brandAllRadarCtx) return;
      
      if(charts.brandAllRadar){ charts.brandAllRadar.destroy(); delete charts.brandAllRadar; }
      
      // ì „ì²´ ë¸Œëœë“œ ë°ì´í„° ìˆ˜ì§‘ (SUPRA ì œì™¸)
      const brandLabels = ['MLB','MLB KIDS','DISCOVERY','DUVETICA','SERGIO'];
      const brandKeys = ['MLB','MLB_KIDS','DISCOVERY','DUVETICA','SERGIO'];
      
      // ê° ë¸Œëœë“œì˜ ë‹¬ì„±ë¥ (ê³„íš)ê³¼ ì „ë…„ë¹„ë¥¼ ê³„ì‚°
      // ë¸Œëœë“œë³„ ê³„íš ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (brand_plan.jsonì—ì„œ, ì–µì› ë‹¨ìœ„)
      const brandPlanData = window.brandPlanData || {};
      
      console.log('[ë ˆì´ë”ì°¨íŠ¸] brandPlanData:', brandPlanData);
      console.log('[ë ˆì´ë”ì°¨íŠ¸] brandData keys:', brandData ? Object.keys(brandData) : 'ì—†ìŒ');
      console.log('[ë ˆì´ë”ì°¨íŠ¸] window.by_brand:', window.by_brand ? window.by_brand.length + 'ê°œ ë¸Œëœë“œ' : 'ì—†ìŒ');
      
      const plan = brandKeys.map(key => {
        // brand_plan.jsonì—ì„œ ë¸Œëœë“œë³„ ê³„íš ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸° (ì–µì› ë‹¨ìœ„)
        const brandPlan = brandPlanData[key] || 0;
        
        console.log(`[ë ˆì´ë”ì°¨íŠ¸] ${key}: brandPlanData[${key}] = ${brandPlan}ì–µì›`);
        
        // brandDataì—ì„œ forecast ê°€ì ¸ì˜¤ê¸°
        let totalForecast = 0;
        if (brandData && brandData[key] && brandData[key].channels) {
          totalForecast = Object.values(brandData[key].channels).reduce((sum, ch) => sum + (ch.forecast || 0), 0);
        } else {
          // brandDataê°€ ì—†ìœ¼ë©´ overviewByBrandì—ì„œ ê°€ì ¸ì˜¤ê¸°
          const overviewBrand = window.by_brand?.find(b => {
            const brandNameMap = { 'MLB': 'MLB', 'MLB_KIDS': 'MLB KIDS', 'DISCOVERY': 'DISCOVERY', 'DUVETICA': 'DUVETICA', 'SERGIO': 'SERGIO' };
            return b.BRAND === brandNameMap[key];
          });
          if (overviewBrand) {
            totalForecast = overviewBrand.SALES || 0; // ì´ë¯¸ ì–µì› ë‹¨ìœ„
          }
        }
        
        // brandDataì˜ targetë„ ì‹œë„ (í•˜ìœ„ í˜¸í™˜ì„±)
        let totalTarget = 0;
        if (brandData && brandData[key] && brandData[key].channels) {
          totalTarget = Object.values(brandData[key].channels).reduce((sum, ch) => sum + (ch.target || 0), 0);
        }
        
        // ìš°ì„ ìˆœìœ„: brand_plan.json > brandData.channels.target
        const planValue = brandPlan > 0 ? brandPlan : totalTarget; // ë‘˜ ë‹¤ ì–µì› ë‹¨ìœ„
        
        console.log(`[ë ˆì´ë”ì°¨íŠ¸] ${key}: planValue=${planValue}ì–µì›, totalForecast=${totalForecast}ì–µì›, ë‹¬ì„±ë¥ =${planValue > 0 ? Math.round((totalForecast / planValue) * 100) : 0}%`);
        
        return planValue > 0 ? Math.round((totalForecast / planValue) * 100) : 0;
      });
      
      const yoy = brandKeys.map(key => {
        // brandPLDataì—ì„œ ê°€ì ¸ì˜¤ê¸°
        let prev = 0;
        let forecast = 0;
        
        if (brandPLData && brandPLData[key] && brandPLData[key].revenue) {
          prev = brandPLData[key].revenue.prev || 0;
          forecast = brandPLData[key].revenue.forecast || 0;
        } else {
          // brandPLDataê°€ ì—†ìœ¼ë©´ overviewByBrandì—ì„œ ê°€ì ¸ì˜¤ê¸°
          const overviewBrand = window.by_brand?.find(b => {
            const brandNameMap = { 'MLB': 'MLB', 'MLB_KIDS': 'MLB KIDS', 'DISCOVERY': 'DISCOVERY', 'DUVETICA': 'DUVETICA', 'SERGIO': 'SERGIO' };
            return b.BRAND === brandNameMap[key];
          });
          if (overviewBrand) {
            // ì „ë…„ëŒ€ë¹„ ê³„ì‚°: forecast / prev * 100
            // overviewByBrandì—ëŠ” YOY_SALESê°€ ìˆìŒ (ì´ë¯¸ % ë‹¨ìœ„)
            return overviewBrand.YOY_SALES || 100;
          }
        }
        
        return prev > 0 ? Math.round((forecast / prev) * 100) : 100;
      });
      
      const sales = brandKeys.map(key => {
        let totalForecast = 0;
        if (brandData && brandData[key] && brandData[key].channels) {
          totalForecast = Object.values(brandData[key].channels).reduce((sum, ch) => sum + (ch.forecast || 0), 0);
        } else {
          // brandDataê°€ ì—†ìœ¼ë©´ overviewByBrandì—ì„œ ê°€ì ¸ì˜¤ê¸°
          const overviewBrand = window.by_brand?.find(b => {
            const brandNameMap = { 'MLB': 'MLB', 'MLB_KIDS': 'MLB KIDS', 'DISCOVERY': 'DISCOVERY', 'DUVETICA': 'DUVETICA', 'SERGIO': 'SERGIO' };
            return b.BRAND === brandNameMap[key];
          });
          if (overviewBrand) {
            totalForecast = overviewBrand.SALES || 0; // ì´ë¯¸ ì–µì› ë‹¨ìœ„
          }
        }
        return `${totalForecast.toFixed(1)}ì–µ`;
      });
      
      charts.brandAllRadar = new Chart(brandAllRadarCtx.getContext('2d'), {
        type: 'radar',
        data: {
          labels: brandLabels,
          datasets: [
            { label: 'ê³„íš', data: plan, borderColor: '#3B82F6', backgroundColor: 'rgba(59,130,246,0.2)', borderWidth: 2, pointRadius: 2 },
            { label: 'ì „ë…„', data: yoy, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.2)', borderWidth: 2, pointRadius: 2 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { display: false }, 
            tooltip: { 
              enabled: false  // Chart.js ê¸°ë³¸ tooltip ë¹„í™œì„±í™” (ì»¤ìŠ¤í…€ íˆ´íŒ ì‚¬ìš©)
            },
            afterDraw: function(chart) {
              // 100% êµ¬ë¶„ì„  ê·¸ë¦¬ê¸°
              const ctx = chart.ctx;
              const meta = chart.getDatasetMeta(0);
              if (!meta || !meta.data || meta.data.length === 0) return;
              
              const centerX = meta.data[0].x;
              const centerY = meta.data[0].y;
              const maxRadius = Math.sqrt(
                Math.pow(meta.data[0].x - centerX, 2) + 
                Math.pow(meta.data[0].y - centerY, 2)
              );
              
              // 100% ìœ„ì¹˜ ê³„ì‚° (120ì´ ìµœëŒ€ê°’ì´ë¯€ë¡œ 100/120 ë¹„ìœ¨)
              const radius100 = (maxRadius * 100) / 120;
              
              ctx.save();
              ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
              ctx.lineWidth = 2;
              ctx.beginPath();
              
              // ê° ì¶•ì— ëŒ€í•´ 100% ìœ„ì¹˜ì— ì ì„ ì°ê³  ì—°ê²°
              meta.data.forEach((point, index) => {
                const angle = Math.atan2(point.y - centerY, point.x - centerX);
                const x = centerX + Math.cos(angle) * radius100;
                const y = centerY + Math.sin(angle) * radius100;
                
                if (index === 0) {
                  ctx.moveTo(x, y);
                } else {
                  ctx.lineTo(x, y);
                }
              });
              
              ctx.closePath();
              ctx.stroke();
              ctx.restore();
            }
          },
          scales: { 
            r: { 
              suggestedMin: 0, 
              suggestedMax: 120, 
              ticks: { 
                stepSize: 30, 
                backdropColor: 'transparent', 
                font: { size: 9 },
                callback: function(value) {
                  // 100% êµ¬ë¶„ì„  ê°•ì¡°
                  if (value === 100) {
                    return '100%';
                  }
                  return value;
                }
              }
            } 
          }
        }
      });
      
      // ì „ì²´í˜„í™© ë ˆì´ë” ì°¨íŠ¸ hover ì´ë²¤íŠ¸ ì¶”ê°€
      const existingHoverHandler = brandAllRadarCtx._brandAllRadarHoverHandler;
      if (existingHoverHandler) {
        brandAllRadarCtx.removeEventListener('mousemove', existingHoverHandler);
        brandAllRadarCtx.removeEventListener('mouseleave', existingHoverHandler);
      }
      
      // hover í•¸ë“¤ëŸ¬ ìƒì„±
      const hoverHandler = function(e) {
        if (!charts.brandAllRadar) return;
        
        const canvasPosition = Chart.helpers.getRelativePosition(e, charts.brandAllRadar);
        const labels = charts.brandAllRadar.data.labels;
        let closestIndex = -1;
        let minDistance = Infinity;
        
        // ê° ë°ì´í„° í¬ì¸íŠ¸ì™€ì˜ ê±°ë¦¬ ê³„ì‚°
        labels.forEach((label, index) => {
          const meta = charts.brandAllRadar.getDatasetMeta(0);
          if (meta && meta.data && meta.data[index]) {
            const point = meta.data[index];
            const distance = Math.sqrt(
              Math.pow(canvasPosition.x - point.x, 2) + 
              Math.pow(canvasPosition.y - point.y, 2)
            );
            if (distance < minDistance && distance < 50) { // 50px ì´ë‚´
              minDistance = distance;
              closestIndex = index;
            }
          }
        });
        
        if (closestIndex !== -1) {
          const brandLabel = labels[closestIndex];
          const brandKey = brandKeys[closestIndex];
          showBrandAllRadarToggle(e, brandLabel, brandKey);
          e.target.style.cursor = 'pointer';
        } else {
          hideBrandAllRadarToggle();
          e.target.style.cursor = 'default';
        }
      };
      
      const leaveHandler = function(e) {
        hideBrandAllRadarToggle();
        if (e.target) {
          e.target.style.cursor = 'default';
        }
      };
      
      // í•¸ë“¤ëŸ¬ë¥¼ canvasì— ì €ì¥ (ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´)
      brandAllRadarCtx._brandAllRadarHoverHandler = hoverHandler;
      brandAllRadarCtx._brandAllRadarLeaveHandler = leaveHandler;
      brandAllRadarCtx.addEventListener('mousemove', hoverHandler);
      brandAllRadarCtx.addEventListener('mouseleave', leaveHandler);
    }

    // ì „ì²´ í˜„í™© ë²„ë¸” ì°¨íŠ¸ ì´ˆê¸°í™”
    let overviewBubbleView = '4quadrant';
    let overviewBubbleBrand = 'all';
    
    async function initOverviewBubbleChart(){
      const bubbleCtx = document.getElementById('overviewBubbleChart');
      if (!bubbleCtx) return;
      
      if(charts.overviewBubble){ charts.overviewBubble.destroy(); delete charts.overviewBubble; }
      
      // â˜… API ë°ì´í„° ë¡œë“œë¥¼ ë¨¼ì € ê¸°ë‹¤ë¦¼ â˜…
      if (!window.overviewStockWeeksData) {
        console.log('[ë²„ë¸”ì°¨íŠ¸] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì¤‘...');
        await loadOverviewStockWeeksData();
        
        if (!window.overviewStockWeeksData) {
          console.error('âŒ [ë²„ë¸”ì°¨íŠ¸] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨!');
        } else {
          console.log('âœ… [ë²„ë¸”ì°¨íŠ¸] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        }
      }
      
      // â˜… API ë°ì´í„° ì‚¬ìš©: window.overviewStockWeeksData í™œìš© â˜…
      const rawData = [];
      
      if (window.overviewStockWeeksData && window.overviewStockWeeksData.data) {
        console.log('[ë²„ë¸”ì°¨íŠ¸] API ë°ì´í„° ì‚¬ìš©');
        console.log('[ë²„ë¸”ì°¨íŠ¸] API ë°ì´í„° êµ¬ì¡°:', {
          success: window.overviewStockWeeksData.success,
          hasCY: !!window.overviewStockWeeksData.data.CY,
          hasPY: !!window.overviewStockWeeksData.data.PY,
          CY_count: window.overviewStockWeeksData.data.CY?.length || 0,
          PY_count: window.overviewStockWeeksData.data.PY?.length || 0
        });
        const cyData = window.overviewStockWeeksData.data.CY || [];
        const pyData = window.overviewStockWeeksData.data.PY || [];
        
        // ITEM_CDë³„ë¡œ ì§‘ê³„ (ë¸Œëœë“œë³„ ITEM_CD ì¡°í•©ìœ¼ë¡œ)
        const itemMap = {};
        
        console.log('[ë²„ë¸”ì°¨íŠ¸] CY ë°ì´í„° ìƒ˜í”Œ 3ê°œ:', cyData.slice(0, 3).map(r => ({
          BRD_CD: r.BRD_CD,
          ITEM: r.ITEM,
          ITEM_CD: r.ITEM_CD,
          ITEM_NM: r.ITEM_NM,
          PRDT_CD: r.PRDT_CD,
          PRDT_NM: r.PRDT_NM,
          SALE_TAG_7D: r.SALE_TAG_7D,
          STOCK_TAG: r.STOCK_TAG,
          STOCK_QTY: r.STOCK_QTY
        })));
        
        cyData.forEach(row => {
          // ë¸Œëœë“œ + ITEM_CD ì¡°í•©ìœ¼ë¡œ í‚¤ ìƒì„±
          const itemCode = row.ITEM_CD || row.ITEM;
          const key = `${row.BRD_CD}_${itemCode}`;
          
          if (!itemMap[key]) {
            itemMap[key] = {
              brand: row.BRD_CD,
              item: itemCode,
              name: row.ITEM_NM,
              category: row.PRDT_KIND_NM,
              cy: {
                salesQty: 0,
                salesAmt: 0,
                sale28d: 0,
                stockQty: 0,
                stockAmt: 0
              },
              py: {
                sale28d: 0,
                stockQty: 0
              }
            };
          }
          
          itemMap[key].cy.salesQty += row.SALE_QTY_7D || 0;
          itemMap[key].cy.salesAmt += row.SALE_TAG_7D || 0;
          itemMap[key].cy.sale28d += row.SALE_QTY_28D || 0;
          itemMap[key].cy.stockQty += row.STOCK_QTY || 0;
          itemMap[key].cy.stockAmt += row.STOCK_TAG_AMT || 0;
        });
        
        pyData.forEach(row => {
          const itemCode = row.ITEM_CD || row.ITEM;
          const key = `${row.BRD_CD}_${itemCode}`;
          
          if (!itemMap[key]) {
            itemMap[key] = {
              brand: row.BRD_CD,
              item: itemCode,
              name: row.ITEM_NM,
              category: row.PRDT_KIND_NM,
              cy: { salesQty: 0, salesAmt: 0, sale28d: 0, stockQty: 0, stockAmt: 0 },
              py: { sale28d: 0, stockQty: 0 }
            };
          }
          
          itemMap[key].py.sale28d += row.SALE_QTY_28D || 0;
          itemMap[key].py.stockQty += row.STOCK_QTY || 0;
        });
        
        console.log('[ë²„ë¸”ì°¨íŠ¸] itemMap í‚¤ ëª©ë¡:', Object.keys(itemMap));
        console.log('[ë²„ë¸”ì°¨íŠ¸] itemMap ê°œìˆ˜:', Object.keys(itemMap).length);
        if (Object.keys(itemMap).length > 0) {
          const firstKey = Object.keys(itemMap)[0];
          console.log('[ë²„ë¸”ì°¨íŠ¸] itemMap ì²«ë²ˆì§¸ í•­ëª©:', {
            key: firstKey,
            data: itemMap[firstKey],
            cy_stockAmt_raw: itemMap[firstKey].cy.stockAmt,
            cy_stockAmt_million: itemMap[firstKey].cy.stockAmt / 1000000
          });
        }
        
        // rawData ìƒì„± (SUPRA(W) ë¸Œëœë“œ ì œì™¸)
        Object.values(itemMap).forEach(item => {
          if (item.brand === 'W') return; // SUPRA ì œì™¸
          
          const avg4w = item.cy.sale28d / 4;
          const stockWeeks = avg4w > 0 ? item.cy.stockQty / avg4w : 0;
          
          // ì „ë…„ ì¬ê³ ì£¼ìˆ˜ ê³„ì‚°
          const pyAvg4w = item.py.sale28d / 4;
          const pyStockWeeks = pyAvg4w > 0 ? item.py.stockQty / pyAvg4w : 0;
          
          // ë§¤ì¶œ YOY ê³„ì‚° (ì „ë…„ ëŒ€ë¹„ ë¹„ìœ¨, ì˜ˆ: 8% ì„±ì¥ ì‹œ 108%)
          const pyWeeklySales = item.py.sale28d > 0 ? item.py.sale28d / 4 : 0;
          const cyWeeklySales = avg4w;
          const saleYoy = pyWeeklySales > 0 ? (cyWeeklySales / pyWeeklySales) * 100 : 0;
          
          // stockWeeksê°€ 0ë³´ë‹¤ í° ê²½ìš°ë§Œ í¬í•¨
          if (stockWeeks > 0) {
            rawData.push({
              brand: item.brand,
              category: item.category,
              item: item.item,
              name: item.name,
              salesQty: item.cy.salesQty,
              salesAmt: item.cy.salesAmt / 1000000, // ë°±ë§Œì› ë‹¨ìœ„
              yoy: saleYoy,
              share: 0, // ë¸Œëœë“œë³„ ì´ ë§¤ì¶œ ëŒ€ë¹„ ë¹„ì¤‘ (ì•„ë˜ì—ì„œ ê³„ì‚°)
              avgSales: avg4w,
              inventory: item.cy.stockQty,
              stockAmt: item.cy.stockAmt / 1000000, // ë°±ë§Œì› ë‹¨ìœ„
              weeks: stockWeeks,
              yoyDiff: stockWeeks - pyStockWeeks
            });
          }
        });
        
        // ë¸Œëœë“œë³„ ì´ ë§¤ì¶œ ê³„ì‚°í•˜ì—¬ ë§¤ì¶œë¹„ì¤‘ ì‚°ì •
        const brandTotalSales = {};
        rawData.forEach(item => {
          if (!brandTotalSales[item.brand]) {
            brandTotalSales[item.brand] = 0;
          }
          brandTotalSales[item.brand] += item.salesAmt;
        });
        
        // ê° ì•„ì´í…œì˜ ë¸Œëœë“œ ë‚´ ë§¤ì¶œë¹„ì¤‘ ê³„ì‚°
        rawData.forEach(item => {
          const brandTotal = brandTotalSales[item.brand] || 1;
          item.share = brandTotal > 0 ? ((item.salesAmt / brandTotal) * 100).toFixed(1) : 0;
        });
        
        console.log('[ë²„ë¸”ì°¨íŠ¸] ë¸Œëœë“œë³„ ì´ ë§¤ì¶œ:', brandTotalSales);
        if (rawData.length > 0) {
          console.log('[ë²„ë¸”ì°¨íŠ¸] rawData ìƒ˜í”Œ:', {
            brand: rawData[0].brand,
            item: rawData[0].item,
            name: rawData[0].name,
            salesAmt: rawData[0].salesAmt,
            stockAmt: rawData[0].stockAmt,
            share: rawData[0].share,
            weeks: rawData[0].weeks
          });
        }
        
        console.log('[ë²„ë¸”ì°¨íŠ¸] API ë°ì´í„° ë³€í™˜ ì™„ë£Œ, rawData ê°œìˆ˜:', rawData.length);
      } else {
        // API ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
        console.log('[ë²„ë¸”ì°¨íŠ¸] ê¸°ì¡´ ë°ì´í„° ì‚¬ìš© (inventoryTableDataByBrand)');
        
        // â˜… ë°ì´í„° ë³€í™˜ í•¨ìˆ˜ í˜¸ì¶œ (ì•„ì§ ë³€í™˜ë˜ì§€ ì•Šì•˜ìœ¼ë©´) â˜…
        if (typeof window.accStockAnalysis !== 'undefined' && typeof convertAccDataToInventoryFormat === 'function') {
          const inventoryData = window.inventoryTableDataByBrand || inventoryTableDataByBrand || {};
          const hasData = Object.keys(inventoryData).length > 0;
          if (!hasData) {
            console.log('[ë²„ë¸”ì°¨íŠ¸] ë°ì´í„° ë³€í™˜ í•¨ìˆ˜ í˜¸ì¶œ');
            convertAccDataToInventoryFormat();
          }
        }
        
        // window.inventoryTableDataByBrand ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ë¡œì»¬ ë³€ìˆ˜ ì‚¬ìš©
        const inventoryDataByBrand = window.inventoryTableDataByBrand || inventoryTableDataByBrand || {};
        
        // ëª¨ë“  ë¸Œëœë“œì˜ ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘ (SUPRA ì œì™¸)
        Object.keys(inventoryDataByBrand).forEach(brandCode => {
          // SUPRA(W) ë¸Œëœë“œëŠ” ì œì™¸
          if (brandCode === 'W') return;
          
          const brandData = inventoryDataByBrand[brandCode];
          if (!Array.isArray(brandData)) return;
          brandData.forEach(item => {
            // stockWeeksê°€ ìˆê³  0ë³´ë‹¤ í° ê²½ìš°ë§Œ í¬í•¨ (yoyëŠ” nullì´ì–´ë„ í¬í•¨)
            if (item.stockWeeks != null && item.stockWeeks > 0) {
              rawData.push({
                brand: brandCode,
                category: item.category,
                item: item.item,
                name: item.name,
                salesQty: item.qty || 0,
                salesAmt: item.sales || 0,
                yoy: item.yoy || 0, // nullì´ë©´ 0ìœ¼ë¡œ ì²˜ë¦¬
                share: item.weight || 0,
                avgSales: item.avg4w || 0,
                inventory: item.stockQty || 0,
                stockAmt: item.stockAmt != null ? item.stockAmt : null, // ì´ë¯¸ ë°±ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜ë¨
                weeks: item.stockWeeks,
                yoyDiff: item.diff || 0
              });
            }
          });
        });
      }
      
      // ê¸°ì¡´ í•˜ë“œì½”ë”© ë°ì´í„°ëŠ” ì œê±°í•˜ê³  ìœ„ ë°ì´í„°ë§Œ ì‚¬ìš©
      /*
      const rawData = [
        {brand: "I", category: "Bag", itë¸Œëœem: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 2279, salesAmt: 194, yoy: 139, share: 35, avgSales: 1473, inventory: 45768, weeks: 31.1, yoyDiff: -49.9},
        {brand: "I", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 1948, salesAmt: 73, yoy: 110, share: 13, avgSales: 2601, inventory: 114785, weeks: 44.1, yoyDiff: 15.6},
        {brand: "I", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 776, salesAmt: 67, yoy: 109, share: 12, avgSales: 891, inventory: 46827, weeks: 52.6, yoyDiff: 10.7},
        {brand: "I", category: "Shoes", item: "WB", name: "ë°©í•œí™”", salesQty: 795, salesAmt: 56, yoy: 107, share: 10, avgSales: 498, inventory: 29908, weeks: 60.1, yoyDiff: -43.1},
        {brand: "I", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 1113, salesAmt: 45, yoy: 80, share: 8, avgSales: 741, inventory: 32135, weeks: 43.4, yoyDiff: 12.5},
        {brand: "I", category: "Shoes", item: "RN", name: "ëŸ°ë‹í™”", salesQty: 468, salesAmt: 45, yoy: 135, share: 8, avgSales: 569, inventory: 30214, weeks: 53.1, yoyDiff: 24.5},
        {brand: "I", category: "Headwear", item: "WM", name: "ë°©í•œëª¨", salesQty: 380, salesAmt: 24, yoy: 92, share: 4, avgSales: 239, inventory: 20646, weeks: 86.4, yoyDiff: 16.2},
        {brand: "I", category: "Shoes", item: "SX", name: "ìŠ¤ë‹ˆì»¤ì¦ˆ", salesQty: 233, salesAmt: 19, yoy: 44, share: 3, avgSales: 264, inventory: 22745, weeks: 86.2, yoyDiff: 34.1},
        {brand: "I", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 183, salesAmt: 17, yoy: 40, share: 3, avgSales: 253, inventory: 47128, weeks: 186.3, yoyDiff: -203.6},
        {brand: "I", category: "Acc_etc", item: "ET", name: "ê¸°íƒ€", salesQty: 43, salesAmt: 3, yoy: 208, share: 1, avgSales: 38, inventory: 9808, weeks: 258.1, yoyDiff: -259.5},
        {brand: "I", category: "Acc_etc", item: "MF", name: "ë¨¸í”ŒëŸ¬(ìŠ¤ì¹´í”„)", salesQty: 44, salesAmt: 3, yoy: 73, share: 0, avgSales: 41, inventory: 2492, weeks: 60.8, yoyDiff: 23.6},
        {brand: "I", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 233, salesAmt: 3, yoy: 56, share: 0, avgSales: 375, inventory: 61438, weeks: 163.8, yoyDiff: 4.7},
        {brand: "I", category: "Headwear", item: "WR", name: "ì™€ì´ì–´ìº¡", salesQty: 51, salesAmt: 2, yoy: 159, share: 0, avgSales: 46, inventory: 1536, weeks: 33.4, yoyDiff: -11.6},
        {brand: "I", category: "Acc_etc", item: "GL", name: "ì¥ê°‘", salesQty: 24, salesAmt: 1, yoy: 44, share: 0, avgSales: 11, inventory: 8831, weeks: 802.8, yoyDiff: 483.1},
        {brand: "I", category: "Headwear", item: "HT", name: "í–‡", salesQty: 24, salesAmt: 1, yoy: 70, share: 0, avgSales: 46, inventory: 15278, weeks: 332.1, yoyDiff: -199.5},
        {brand: "I", category: "Shoes", item: "SD", name: "ìƒŒë“¤", salesQty: 5, salesAmt: 0, yoy: 407, share: 0, avgSales: 3, inventory: 24222, weeks: 8074, yoyDiff: 0},
        {brand: "I", category: "Headwear", item: "SC", name: "ì„ ìº¡", salesQty: 8, salesAmt: 0, yoy: 159, share: 0, avgSales: 4, inventory: 8094, weeks: 2023.5, yoyDiff: 503.2},
        {brand: "I", category: "Bag", item: "UB", name: "ë³´ì¡°ê°€ë°©", salesQty: 3, salesAmt: 0, yoy: 33, share: 0, avgSales: 4, inventory: 4836, weeks: 1209, yoyDiff: -941.7},
        {brand: "I", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 1, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 645, weeks: 0, yoyDiff: 0},
        {brand: "I", category: "Shoes", item: "MU", name: "ë®¬", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: -2, weeks: 0, yoyDiff: 0},
        {brand: "I", category: "Acc_etc", item: "GG", name: "ê³ ê¸€", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 79, weeks: 0, yoyDiff: 0},
        {brand: "I", category: "Acc_etc", item: "ML", name: "í† ì‹œ", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 884, weeks: 897.5, yoyDiff: 0},
        {brand: "I", category: "Bag", item: "BM", name: "ë²„í‚·ë°±", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 1, weeks: 0, yoyDiff: 0},
        {brand: "I", category: "Shoes", item: "CV", name: "ìº”ë²„ìŠ¤í™”", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: -8, weeks: 0, yoyDiff: 0},
        {brand: "I", category: "Bag", item: "HS", name: "í™ìƒ‰", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 1699, weeks: 151.8, yoyDiff: 0},
        {brand: "I", category: "Bag", item: "BG", name: "ê°€ë°©", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 2, inventory: 1770, weeks: 885, yoyDiff: 699.8},
        {brand: "I", category: "Acc_etc", item: "PE", name: "PET", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 18256, weeks: 269.7, yoyDiff: 0},
        {brand: "I", category: "Bag", item: "SG", name: "ìŠ¬ë§ë°±", salesQty: -1, salesAmt: 0, yoy: -4, share: 0, avgSales: 2, inventory: 2474, weeks: 1237, yoyDiff: 1101.4},
        {brand: "M", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 95861, salesAmt: 3505, yoy: 190, share: 52, avgSales: 75915, inventory: 1358737, weeks: 17.9, yoyDiff: 3.3},
        {brand: "M", category: "Shoes", item: "SX", name: "ìŠ¤ë‹ˆì»¤ì¦ˆ", salesQty: 6950, salesAmt: 959, yoy: 126, share: 14, avgSales: 4536, inventory: 253642, weeks: 55.9, yoyDiff: 4.5},
        {brand: "M", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 18548, salesAmt: 785, yoy: 480, share: 12, avgSales: 8339, inventory: 129038, weeks: 15.5, yoyDiff: -11.9},
        {brand: "M", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 5591, salesAmt: 581, yoy: 108, share: 9, avgSales: 4345, inventory: 309281, weeks: 71.2, yoyDiff: 0.2},
        {brand: "M", category: "Bag", item: "OR", name: "ì‡¼í¼ë°±", salesQty: 1954, salesAmt: 334, yoy: 193, share: 5, avgSales: 630, inventory: 16083, weeks: 25.5, yoyDiff: -8.5},
        {brand: "M", category: "Shoes", item: "RN", name: "ëŸ°ë‹í™”", salesQty: 1033, salesAmt: 143, yoy: 131, share: 2, avgSales: 1061, inventory: 106773, weeks: 100.6, yoyDiff: 59.1},
        {brand: "M", category: "Bag", item: "BQ", name: "ìˆ„ë”ë°±", salesQty: 816, salesAmt: 88, yoy: 48, share: 1, avgSales: 1127, inventory: 89903, weeks: 79.8, yoyDiff: 36.3},
        {brand: "M", category: "Headwear", item: "HT", name: "í–‡", salesQty: 1048, salesAmt: 63, yoy: 57, share: 1, avgSales: 862, inventory: 48013, weeks: 55.7, yoyDiff: -4.1},
        {brand: "M", category: "Bag", item: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 451, salesAmt: 52, yoy: 75, share: 1, avgSales: 316, inventory: 40606, weeks: 128.5, yoyDiff: 59.1},
        {brand: "M", category: "Shoes", item: "WB", name: "ë°©í•œí™”", salesQty: 381, salesAmt: 41, yoy: 111, share: 1, avgSales: 168, inventory: 36455, weeks: 217, yoyDiff: 10.1},
        {brand: "M", category: "Bag", item: "BM", name: "ë²„í‚·ë°±", salesQty: 229, salesAmt: 28, yoy: 115, share: 0, avgSales: 264, inventory: 19452, weeks: 73.7, yoyDiff: -0.7},
        {brand: "M", category: "Bag", item: "HS", name: "í™ìƒ‰", salesQty: 431, salesAmt: 25, yoy: 42, share: 0, avgSales: 205, inventory: 15479, weeks: 75.5, yoyDiff: 44.5},
        {brand: "M", category: "Headwear", item: "WM", name: "ë°©í•œëª¨", salesQty: 316, salesAmt: 24, yoy: 245, share: 0, avgSales: 136, inventory: 14129, weeks: 103.9, yoyDiff: -146.6},
        {brand: "M", category: "Bag", item: "BG", name: "ê°€ë°©", salesQty: 109, salesAmt: 15, yoy: 547, share: 0, avgSales: 36, inventory: 13799, weeks: 383.3, yoyDiff: -230.1},
        {brand: "M", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 91, salesAmt: 13, yoy: 158, share: 0, avgSales: 98, inventory: 16367, weeks: 167, yoyDiff: 52.4},
        {brand: "M", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 721, salesAmt: 11, yoy: 91, share: 0, avgSales: 829, inventory: 70586, weeks: 85.1, yoyDiff: 22.8},
        {brand: "M", category: "Acc_etc", item: "MF", name: "ë¨¸í”ŒëŸ¬(ìŠ¤ì¹´í”„)", salesQty: 100, salesAmt: 8, yoy: 40, share: 0, avgSales: 28, inventory: 8318, weeks: 297.1, yoyDiff: 219.9},
        {brand: "M", category: "Acc_etc", item: "PO", name: "íŒŒìš°ì¹˜", salesQty: 182, salesAmt: 5, yoy: 117, share: 0, avgSales: 110, inventory: 3341, weeks: 30.4, yoyDiff: 6.5},
        {brand: "M", category: "Shoes", item: "MU", name: "ë®¬", salesQty: 66, salesAmt: 3, yoy: 26, share: 0, avgSales: 147, inventory: 48901, weeks: 332.7, yoyDiff: 107.8},
        {brand: "M", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 39, salesAmt: 2, yoy: 76, share: 0, avgSales: 71, inventory: 50157, weeks: 706.4, yoyDiff: 43},
        {brand: "M", category: "Headwear", item: "MC", name: "ë©”ì‹œìº¡", salesQty: 38, salesAmt: 2, yoy: -3399, share: 0, avgSales: 51, inventory: 6356, weeks: 124.6, yoyDiff: 0},
        {brand: "M", category: "Acc_etc", item: "ET", name: "ê¸°íƒ€", salesQty: 56, salesAmt: 1, yoy: 75, share: 0, avgSales: 52, inventory: 3387, weeks: 65.1, yoyDiff: -258.7},
        {brand: "M", category: "Acc_etc", item: "HH", name: "ìºë¦¬ì–´(í•˜ë“œì¼€ì´ìŠ¤)", salesQty: 3, salesAmt: 1, yoy: 74, share: 0, avgSales: 3, inventory: 879, weeks: 293, yoyDiff: 255.4},
        {brand: "M", category: "Acc_etc", item: "GL", name: "ì¥ê°‘", salesQty: 9, salesAmt: 0, yoy: 0, share: 0, avgSales: 3, inventory: 1975, weeks: 658.3, yoyDiff: 0},
        {brand: "M", category: "Shoes", item: "SD", name: "ìƒŒë“¤", salesQty: 7, salesAmt: 0, yoy: 6, share: 0, avgSales: 20, inventory: 56345, weeks: 2817.3, yoyDiff: 2184.4},
        {brand: "M", category: "Bag", item: "BW", name: "ë³´ìŠ¤í†¤ë°±", salesQty: 3, salesAmt: 0, yoy: 79, share: 0, avgSales: 2, inventory: 2870, weeks: 1435, yoyDiff: 644.9},
        {brand: "M", category: "Shoes", item: "SQ", name: "ì•„ì¿ ì•„ ìŠˆì¦ˆ", salesQty: 2, salesAmt: 0, yoy: 33, share: 0, avgSales: 10, inventory: 9235, weeks: 923.5, yoyDiff: -1017.5},
        {brand: "M", category: "Headwear", item: "SC", name: "ì„ ìº¡", salesQty: 2, salesAmt: 0, yoy: 0, share: 0, avgSales: 7, inventory: 2317, weeks: 331, yoyDiff: -5151},
        {brand: "M", category: "Acc_etc", item: "MK", name: "ë§ˆìŠ¤í¬(íŒ¨ì…˜ìš©)", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 8, weeks: 0, yoyDiff: 0},
        {brand: "M", category: "Acc_etc", item: "ML", name: "í† ì‹œ", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 897, weeks: 0, yoyDiff: 0},
        {brand: "M", category: "Shoes", item: "CV", name: "ìº”ë²„ìŠ¤í™”", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 12, weeks: 0, yoyDiff: 0},
        {brand: "M", category: "Acc_etc", item: "TW", name: "íƒ€ì˜¬", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 1, weeks: 0, yoyDiff: 0},
        {brand: "M", category: "Headwear", item: "CB", name: "ì—¬ì„± ë² ë ˆëª¨", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 138, weeks: 24.8, yoyDiff: 0},
        {brand: "ST", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 133, salesAmt: 9, yoy: 180, share: 34, avgSales: 266, inventory: 10592, weeks: 39.8, yoyDiff: -281.6},
        {brand: "ST", category: "Bag", item: "BW", name: "ë³´ìŠ¤í†¤ë°±", salesQty: 33, salesAmt: 5, yoy: 268, share: 21, avgSales: 26, inventory: 667, weeks: 25.7, yoyDiff: -48.3},
        {brand: "ST", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 76, salesAmt: 4, yoy: 209, share: 15, avgSales: 92, inventory: 3993, weeks: 43.4, yoyDiff: 10},
        {brand: "ST", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 158, salesAmt: 3, yoy: 82, share: 12, avgSales: 152, inventory: 11135, weeks: 73.3, yoyDiff: 39.6},
        {brand: "ST", category: "Headwear", item: "SC", name: "ì„ ìº¡", salesQty: 27, salesAmt: 2, yoy: 150, share: 6, avgSales: 39, inventory: 2967, weeks: 76.1, yoyDiff: 13.6},
        {brand: "ST", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 7, salesAmt: 1, yoy: 83, share: 5, avgSales: 33, inventory: 1597, weeks: 48.4, yoyDiff: -51.8},
        {brand: "ST", category: "Bag", item: "TG", name: "í† ë“œë°±", salesQty: 9, salesAmt: 1, yoy: 133, share: 3, avgSales: 13, inventory: 1641, weeks: 126.2, yoyDiff: -59.1},
        {brand: "ST", category: "Acc_etc", item: "PR", name: "ë³´í˜¸ëŒ€", salesQty: 19, salesAmt: 0, yoy: 66, share: 2, avgSales: 14, inventory: 2189, weeks: 156.4, yoyDiff: 39.4},
        {brand: "ST", category: "Bag", item: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 2, salesAmt: 0, yoy: 74, share: 1, avgSales: 5, inventory: 705, weeks: 141, yoyDiff: 13.7},
        {brand: "ST", category: "Bag", item: "SG", name: "ìŠ¬ë§ë°±", salesQty: 3, salesAmt: 0, yoy: 0, share: 1, avgSales: 1, inventory: 131, weeks: 131, yoyDiff: 10},
        {brand: "ST", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 2, salesAmt: 0, yoy: 54, share: 0, avgSales: 1, inventory: 691, weeks: 691, yoyDiff: 403},
        {brand: "ST", category: "Acc_etc", item: "HB", name: "í—¤ë“œë°´ë“œ", salesQty: 5, salesAmt: 0, yoy: 44, share: 0, avgSales: 14, inventory: 874, weeks: 62.4, yoyDiff: -24.1},
        {brand: "ST", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 1, salesAmt: 0, yoy: 0, share: 0, avgSales: 2, inventory: 597, weeks: 298.5, yoyDiff: 0},
        {brand: "ST", category: "Acc_etc", item: "AM", name: "ë¨¸í”ŒëŸ¬", salesQty: 1, salesAmt: 0, yoy: 0, share: 0, avgSales: 1, inventory: 415, weeks: 415, yoyDiff: 0},
        {brand: "ST", category: "Headwear", item: "HT", name: "í–‡", salesQty: 3, salesAmt: 0, yoy: 19, share: 0, avgSales: 7, inventory: 855, weeks: 122.1, yoyDiff: -714.2},
        {brand: "ST", category: "Bag", item: "RB", name: "ë¼ì¼“ë°±", salesQty: 1, salesAmt: 0, yoy: 11, share: 0, avgSales: 9, inventory: 993, weeks: 110.3, yoyDiff: -1.8},
        {brand: "ST", category: "Acc_etc", item: "RK", name: "ë¼ì¼“", salesQty: 1, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 513, weeks: 27.5, yoyDiff: 0},
        {brand: "ST", category: "Acc_etc", item: "AC", name: "ê¸°íƒ€ì†Œí’ˆë¥˜", salesQty: 1, salesAmt: 0, yoy: 160, share: 0, avgSales: 1, inventory: 1312, weeks: 1312, yoyDiff: 1054.3},
        {brand: "ST", category: "Acc_etc", item: "TW", name: "íƒ€ì˜¬", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 8, weeks: 0, yoyDiff: 0},
        {brand: "ST", category: "Acc_etc", item: "LL", name: "ë³¼", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 34, weeks: 41, yoyDiff: 0},
        {brand: "V", category: "Shoes", item: "WB", name: "ë°©í•œí™”", salesQty: 57, salesAmt: 12, yoy: 181, share: 26, avgSales: 33, inventory: 5713, weeks: 173.1, yoyDiff: 53.6},
        {brand: "V", category: "Bag", item: "TG", name: "í† ë“œë°±", salesQty: 27, salesAmt: 8, yoy: 319, share: 19, avgSales: 27, inventory: 2114, weeks: 78.3, yoyDiff: -1.9},
        {brand: "V", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 14, salesAmt: 5, yoy: 179, share: 11, avgSales: 12, inventory: 538, weeks: 44.8, yoyDiff: -21.7},
        {brand: "V", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 33, salesAmt: 5, yoy: 133, share: 11, avgSales: 28, inventory: 1165, weeks: 41.6, yoyDiff: -237.5},
        {brand: "V", category: "Headwear", item: "HT", name: "í–‡", salesQty: 29, salesAmt: 4, yoy: 226, share: 9, avgSales: 32, inventory: 1630, weeks: 50.9, yoyDiff: -117.6},
        {brand: "V", category: "Bag", item: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 14, salesAmt: 2, yoy: 183, share: 5, avgSales: 13, inventory: 1271, weeks: 97.8, yoyDiff: -118.2},
        {brand: "V", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 20, salesAmt: 2, yoy: 686, share: 4, avgSales: 18, inventory: 839, weeks: 46.6, yoyDiff: -120.1},
        {brand: "V", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 19, salesAmt: 2, yoy: 475, share: 4, avgSales: 12, inventory: 1132, weeks: 94.3, yoyDiff: -57.5},
        {brand: "V", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 52, salesAmt: 1, yoy: 435, share: 2, avgSales: 41, inventory: 1380, weeks: 33.7, yoyDiff: -183.6},
        {brand: "V", category: "Acc_etc", item: "ML", name: "í† ì‹œ", salesQty: 5, salesAmt: 1, yoy: 0, share: 1, avgSales: 4, inventory: 301, weeks: 75.3, yoyDiff: 0},
        {brand: "V", category: "Headwear", item: "WM", name: "ë°©í•œëª¨", salesQty: 4, salesAmt: 1, yoy: 0, share: 1, avgSales: 2, inventory: 221, weeks: 110.5, yoyDiff: 0},
        {brand: "V", category: "Bag", item: "HS", name: "í™ìƒ‰", salesQty: 6, salesAmt: 1, yoy: 0, share: 1, avgSales: 4, inventory: 131, weeks: 32.8, yoyDiff: 0},
        {brand: "V", category: "Acc_etc", item: "DC", name: "ë‹¤ìš´ ìŠ¤ì¹´í”„", salesQty: 5, salesAmt: 1, yoy: 135, share: 1, avgSales: 3, inventory: 468, weeks: 156, yoyDiff: -29},
        {brand: "V", category: "Shoes", item: "MU", name: "ë®¬", salesQty: 4, salesAmt: 0, yoy: -274, share: 1, avgSales: 5, inventory: 125, weeks: 25, yoyDiff: -403},
        {brand: "V", category: "Acc_etc", item: "AG", name: "ì¥ê°‘", salesQty: 3, salesAmt: 0, yoy: 127, share: 1, avgSales: 2, inventory: 499, weeks: 249.5, yoyDiff: -110.5},
        {brand: "V", category: "Bag", item: "BG", name: "ê°€ë°©", salesQty: 1, salesAmt: 0, yoy: 0, share: 1, avgSales: 1, inventory: 485, weeks: 485, yoyDiff: 0},
        {brand: "V", category: "Headwear", item: "SC", name: "ì„ ìº¡", salesQty: 4, salesAmt: 0, yoy: 262, share: 1, avgSales: 5, inventory: 218, weeks: 43.6, yoyDiff: -153.1},
        {brand: "V", category: "Acc_etc", item: "MF", name: "ë¨¸í”ŒëŸ¬(ìŠ¤ì¹´í”„)", salesQty: 1, salesAmt: 0, yoy: 0, share: 0, avgSales: 2, inventory: 789, weeks: 394.5, yoyDiff: 0},
        {brand: "V", category: "Bag", item: "TA", name: "ë²¨íŠ¸ë°±", salesQty: 1, salesAmt: 0, yoy: 46, share: 0, avgSales: 2, inventory: 39, weeks: 19.5, yoyDiff: -103.5},
        {brand: "V", category: "Acc_etc", item: "PO", name: "íŒŒìš°ì¹˜", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 10, weeks: 79, yoyDiff: 0},
        {brand: "V", category: "Bag", item: "EB", name: "ê¸°íƒ€ê°€ë°©", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 16, weeks: 54, yoyDiff: 0},
        {brand: "V", category: "Acc_etc", item: "GL", name: "ì¥ê°‘", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 21, weeks: 59, yoyDiff: 0},
        {brand: "V", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 405, weeks: 0, yoyDiff: 0},
        {brand: "W", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 45, salesAmt: 2, yoy: 22, share: 38, avgSales: 53, inventory: 3289, weeks: 62.1, yoyDiff: -74.9},
        {brand: "W", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 110, salesAmt: 2, yoy: 54, share: 27, avgSales: 114, inventory: 4918, weeks: 43.1, yoyDiff: -211.7},
        {brand: "W", category: "Bag", item: "BG", name: "ê°€ë°©", salesQty: 20, salesAmt: 0, yoy: 254, share: 8, avgSales: 40, inventory: 2042, weeks: 51.1, yoyDiff: -790.4},
        {brand: "W", category: "Bag", item: "BW", name: "ë³´ìŠ¤í†¤ë°±", salesQty: 8, salesAmt: 0, yoy: 0, share: 6, avgSales: 7, inventory: 319, weeks: 45.6, yoyDiff: 0},
        {brand: "W", category: "Shoes", item: "WB", name: "ë°©í•œí™”", salesQty: 12, salesAmt: 0, yoy: 0, share: 6, avgSales: 14, inventory: 259, weeks: 18.5, yoyDiff: 0},
        {brand: "W", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 6, salesAmt: 0, yoy: 42, share: 5, avgSales: 6, inventory: 1419, weeks: 236.5, yoyDiff: -108.9},
        {brand: "W", category: "Bag", item: "TG", name: "í† ë“œë°±", salesQty: 4, salesAmt: 0, yoy: 0, share: 2, avgSales: 2, inventory: 155, weeks: 77.5, yoyDiff: 0},
        {brand: "W", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 6, salesAmt: 0, yoy: 21, share: 2, avgSales: 7, inventory: 304, weeks: 43.4, yoyDiff: -10.6},
        {brand: "W", category: "Headwear", item: "HT", name: "í–‡", salesQty: 6, salesAmt: 0, yoy: 157, share: 1, avgSales: 11, inventory: 2185, weeks: 198.6, yoyDiff: -734.7},
        {brand: "W", category: "Headwear", item: "SC", name: "ì„ ìº¡", salesQty: 3, salesAmt: 0, yoy: 0, share: 1, avgSales: 2, inventory: 171, weeks: 85.5, yoyDiff: 0},
        {brand: "W", category: "Bag", item: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 2, salesAmt: 0, yoy: 37, share: 1, avgSales: 3, inventory: 668, weeks: 222.7, yoyDiff: 156},
        {brand: "W", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 4, salesAmt: 0, yoy: 12, share: 1, avgSales: 6, inventory: 101, weeks: 16.8, yoyDiff: -95.7},
        {brand: "W", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 1, salesAmt: 0, yoy: 3, share: 1, avgSales: 3, inventory: 614, weeks: 204.7, yoyDiff: -24.3},
        {brand: "W", category: "Bag", item: "HS", name: "í™ìƒ‰", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 2, inventory: 304, weeks: 152, yoyDiff: 96.4},
        {brand: "W", category: "Headwear", item: "WM", name: "ë°©í•œëª¨", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 83, weeks: 0, yoyDiff: 0},
        {brand: "X", category: "Shoes", item: "SH", name: "ì‹ ë°œ", salesQty: 6296, salesAmt: 609, yoy: 72, share: 61, avgSales: 6773, inventory: 381634, weeks: 56.3, yoyDiff: -5.6},
        {brand: "X", category: "Bag", item: "BK", name: "ë°±íŒ©", salesQty: 914, salesAmt: 120, yoy: 97, share: 12, avgSales: 1095, inventory: 115764, weeks: 105.7, yoyDiff: 29.5},
        {brand: "X", category: "Headwear", item: "CP", name: "ìš´ë™ëª¨", salesQty: 1171, salesAmt: 46, yoy: 108, share: 5, avgSales: 1176, inventory: 87747, weeks: 74.6, yoyDiff: 20.1},
        {brand: "X", category: "Bag", item: "CR", name: "í¬ë¡œìŠ¤ë°±", salesQty: 667, salesAmt: 46, yoy: 101, share: 5, avgSales: 704, inventory: 45916, weeks: 65.2, yoyDiff: 10.5},
        {brand: "X", category: "Bag", item: "SG", name: "ìŠ¬ë§ë°±", salesQty: 474, salesAmt: 37, yoy: 44, share: 4, avgSales: 509, inventory: 23885, weeks: 46.9, yoyDiff: 23.3},
        {brand: "X", category: "Shoes", item: "LP", name: "ìŠ¬ë¦¬í¼", salesQty: 695, salesAmt: 33, yoy: 92, share: 3, avgSales: 920, inventory: 21652, weeks: 23.5, yoyDiff: -9.8},
        {brand: "X", category: "Acc_etc", item: "DC", name: "ë‹¤ìš´ ìŠ¤ì¹´í”„", salesQty: 635, salesAmt: 26, yoy: 52, share: 3, avgSales: 221, inventory: 76709, weeks: 347.1, yoyDiff: 278.4},
        {brand: "X", category: "Headwear", item: "BN", name: "ë¹„ë‹ˆ", salesQty: 394, salesAmt: 13, yoy: 105, share: 1, avgSales: 220, inventory: 33335, weeks: 151.5, yoyDiff: -8.5},
        {brand: "X", category: "Headwear", item: "HT", name: "í–‡", salesQty: 278, salesAmt: 13, yoy: 54, share: 1, avgSales: 318, inventory: 34400, weeks: 108.2, yoyDiff: 21.1},
        {brand: "X", category: "Acc_etc", item: "GL", name: "ì¥ê°‘", salesQty: 895, salesAmt: 12, yoy: 213, share: 1, avgSales: 317, inventory: 19258, weeks: 60.8, yoyDiff: -160.4},
        {brand: "X", category: "Acc_etc", item: "SO", name: "ì–‘ë§", salesQty: 842, salesAmt: 8, yoy: 129, share: 1, avgSales: 915, inventory: 69566, weeks: 76, yoyDiff: -26.8},
        {brand: "X", category: "Headwear", item: "WM", name: "ë°©í•œëª¨", salesQty: 99, salesAmt: 7, yoy: 0, share: 1, avgSales: 35, inventory: 9028, weeks: 257.9, yoyDiff: 0},
        {brand: "X", category: "Bag", item: "TG", name: "í† ë“œë°±", salesQty: 110, salesAmt: 6, yoy: 47, share: 1, avgSales: 86, inventory: 21047, weeks: 244.7, yoyDiff: 123.3},
        {brand: "X", category: "Bag", item: "MR", name: "ë©”ì‹ ì €ë°±", salesQty: 70, salesAmt: 5, yoy: 38, share: 1, avgSales: 86, inventory: 9820, weeks: 114.2, yoyDiff: 29.3},
        {brand: "X", category: "Bag", item: "HS", name: "í™ìƒ‰", salesQty: 76, salesAmt: 4, yoy: 35, share: 0, avgSales: 107, inventory: 8118, weeks: 75.9, yoyDiff: 26.4},
        {brand: "X", category: "Bag", item: "BW", name: "ë³´ìŠ¤í†¤ë°±", salesQty: 65, salesAmt: 4, yoy: 141, share: 0, avgSales: 45, inventory: 3096, weeks: 68.8, yoyDiff: -67.5},
        {brand: "X", category: "Bag", item: "BG", name: "ê°€ë°©", salesQty: 42, salesAmt: 3, yoy: 207, share: 0, avgSales: 42, inventory: 5042, weeks: 120, yoyDiff: -142.9},
        {brand: "X", category: "Acc_etc", item: "AC", name: "ê¸°íƒ€ì†Œí’ˆë¥˜", salesQty: 83, salesAmt: 3, yoy: 37, share: 0, avgSales: 42, inventory: 15526, weeks: 369.7, yoyDiff: 162.2},
        {brand: "X", category: "Bag", item: "BZ", name: "ë°”ë””ë°±", salesQty: 15, salesAmt: 1, yoy: 0, share: 0, avgSales: 19, inventory: 603, weeks: 31.7, yoyDiff: 0},
        {brand: "X", category: "Acc_etc", item: "MK", name: "ë§ˆìŠ¤í¬(íŒ¨ì…˜ìš©)", salesQty: 29, salesAmt: 1, yoy: 995, share: 0, avgSales: 18, inventory: 3575, weeks: 198.6, yoyDiff: 40.9},
        {brand: "X", category: "Acc_etc", item: "MS", name: "ë©€í‹°ìŠ¤ì¹´í”„", salesQty: 29, salesAmt: 1, yoy: 69, share: 0, avgSales: 26, inventory: 6737, weeks: 259.1, yoyDiff: -113.8},
        {brand: "X", category: "Acc_etc", item: "ML", name: "í† ì‹œ", salesQty: 20, salesAmt: 0, yoy: 512, share: 0, avgSales: 21, inventory: 7536, weeks: 358.9, yoyDiff: -764},
        {brand: "X", category: "Acc_etc", item: "PO", name: "íŒŒìš°ì¹˜", salesQty: 0, salesAmt: 0, yoy: 0, share: 0, avgSales: 0, inventory: 23, weeks: 0, yoyDiff: 0}
      ];
      */
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê²½ê³ í•˜ê³  ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
      if (rawData.length === 0) {
        console.error('âŒ [ë²„ë¸”ì°¨íŠ¸] rawDataê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!');
        console.log('[ë²„ë¸”ì°¨íŠ¸] window.overviewStockWeeksData:', window.overviewStockWeeksData);
        console.log('[ë²„ë¸”ì°¨íŠ¸] window.overviewStockWeeksData.data:', window.overviewStockWeeksData?.data);
        console.log('[ë²„ë¸”ì°¨íŠ¸] CY ë°ì´í„° ê°œìˆ˜:', window.overviewStockWeeksData?.data?.CY?.length || 0);
        console.log('[ë²„ë¸”ì°¨íŠ¸] PY ë°ì´í„° ê°œìˆ˜:', window.overviewStockWeeksData?.data?.PY?.length || 0);
        
        if (typeof inventoryDataByBrand !== 'undefined') {
          console.log('[ë²„ë¸”ì°¨íŠ¸] inventoryDataByBrand í‚¤:', Object.keys(inventoryDataByBrand));
        }
        console.log('[ë²„ë¸”ì°¨íŠ¸] window.accStockAnalysis:', typeof window.accStockAnalysis !== 'undefined' ? Object.keys(window.accStockAnalysis || {}) : 'ì—†ìŒ');
        console.log('[ë²„ë¸”ì°¨íŠ¸] window.inventoryTableDataByBrand:', typeof window.inventoryTableDataByBrand !== 'undefined' ? Object.keys(window.inventoryTableDataByBrand || {}) : 'ì—†ìŒ');
        
        // ë¹ˆ ë°ì´í„°ë¡œë¼ë„ overviewBubbleData ì´ˆê¸°í™” (ì—ëŸ¬ ë°©ì§€)
        window.overviewBubbleData = {
          data4: { critical: [], caution: [], growth: [], review: [] },
          data9: { q1: [], q2: [], q3: [], q4: [], q5: [], q6: [], q7: [], q8: [], q9: [] },
          processedData: []
        };
        
        // ë¹ˆ ì°¨íŠ¸ë¼ë„ ìƒì„±í•´ì„œ í‘œì‹œ
        charts.overviewBubble = createOverviewBubbleChart();
        updateOverviewBubbleKPIs();
        return;
      }
      
      // ë¸Œëœë“œ ìƒ‰ìƒ ë° ì´ë¦„ ë§¤í•‘ (SUPRA ì œì™¸, SERGIO í¬í•¨)
      const brandColors = { 'M': '#dc2626', 'I': '#eab308', 'X': '#3b82f6', 'V': '#1f2937', 'ST': '#8b5cf6' };
      // window.brandNamesê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
      const brandNames = window.brandNames || {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'W': 'SUPRA',
        'ST': 'SERGIO'
      };
      
      // ë°ì´í„° ì „ì²˜ë¦¬ (weeks, yoyë¥¼ 80, 250ìœ¼ë¡œ ì œí•œ)
      // KPI ì¹´ë“œ ê³„ì‚°ì„ ìœ„í•´ ëª¨ë“  ë°ì´í„° í¬í•¨ (yoyê°€ 0ì´ì–´ë„ í¬í•¨)
      // ë²„ë¸” ì°¨íŠ¸ í‘œì‹œëŠ” yoy > 0ì¸ í•­ëª©ë§Œ í‘œì‹œ
      const data = rawData.map(d => ({
        ...d,
        weeksOriginal: d.weeks,
        weeks: Math.min(d.weeks, 80),
        yoy: Math.min(Math.max(d.yoy || 0, 0), 250), // nullì´ë©´ 0, ìµœëŒ€ 250
        yoyOriginal: d.yoy || 0
      }));
      
      // 4ë¶„ë©´/9ë¶„ë©´ ë¶„ë¥˜ ê¸°ì¤€ê°’
      const WEEKS_THRESHOLD_4 = 40;
      const YOY_THRESHOLD_4 = 100;
      const WEEKS_THRESHOLD_LOW = 30;
      const WEEKS_THRESHOLD_HIGH = 50;
      const YOY_THRESHOLD_LOW = 80;
      const YOY_THRESHOLD_HIGH = 120;
      
      // 4ë¶„ë©´ ë¶„ë¥˜ (ì°¨íŠ¸ í‘œì‹œìš©ìœ¼ë¡œ ì œí•œëœ weeks ì‚¬ìš©)
      const processedData4 = data.map(d => {
        let quadrant;
        if (d.weeks >= WEEKS_THRESHOLD_4 && d.yoy < YOY_THRESHOLD_4) quadrant = 'critical';
        else if (d.weeks >= WEEKS_THRESHOLD_4 && d.yoy >= YOY_THRESHOLD_4) quadrant = 'caution';
        else if (d.weeks < WEEKS_THRESHOLD_4 && d.yoy >= YOY_THRESHOLD_4) quadrant = 'growth';
        else quadrant = 'review';
        return {...d, quadrant4: quadrant};
      });
      
      // 9ë¶„ë©´ ë¶„ë¥˜ (ì›ë³¸ weeksOriginal ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ë¶„ë¥˜)
      const processedData9 = data.map(d => {
        let quadrant;
        const weeksValue = d.weeksOriginal || d.weeks; // ì›ë³¸ ê°’ ì‚¬ìš©
        const yoyValue = d.yoyOriginal || d.yoy; // ì›ë³¸ ê°’ ì‚¬ìš©
        if (weeksValue < WEEKS_THRESHOLD_LOW) {
          if (yoyValue >= YOY_THRESHOLD_HIGH) quadrant = 'q1';
          else if (yoyValue >= YOY_THRESHOLD_LOW) quadrant = 'q2';
          else quadrant = 'q3';
        } else if (weeksValue >= WEEKS_THRESHOLD_LOW && weeksValue < WEEKS_THRESHOLD_HIGH) {
          if (yoyValue >= YOY_THRESHOLD_HIGH) quadrant = 'q4';
          else if (yoyValue >= YOY_THRESHOLD_LOW) quadrant = 'q5';
          else quadrant = 'q6';
        } else {
          if (yoyValue >= YOY_THRESHOLD_HIGH) quadrant = 'q7';
          else if (yoyValue >= YOY_THRESHOLD_LOW) quadrant = 'q8';
          else quadrant = 'q9';
        }
        return {...d, quadrant9: quadrant};
      });
      
      const processedData = data.map((d, i) => ({
        ...d,
        quadrant4: processedData4[i].quadrant4,
        quadrant9: processedData9[i].quadrant9
      }));
      
      // ë¶„ë©´ë³„ ë°ì´í„° ê·¸ë£¹í™”
      const data4 = {
        critical: processedData.filter(d => d.quadrant4 === 'critical'),
        caution: processedData.filter(d => d.quadrant4 === 'caution'),
        growth: processedData.filter(d => d.quadrant4 === 'growth'),
        review: processedData.filter(d => d.quadrant4 === 'review')
      };
      
      const data9 = {
        q1: processedData.filter(d => d.quadrant9 === 'q1'),
        q2: processedData.filter(d => d.quadrant9 === 'q2'),
        q3: processedData.filter(d => d.quadrant9 === 'q3'),
        q4: processedData.filter(d => d.quadrant9 === 'q4'),
        q5: processedData.filter(d => d.quadrant9 === 'q5'),
        q6: processedData.filter(d => d.quadrant9 === 'q6'),
        q7: processedData.filter(d => d.quadrant9 === 'q7'),
        q8: processedData.filter(d => d.quadrant9 === 'q8'),
        q9: processedData.filter(d => d.quadrant9 === 'q9')
      };
      
      // ì¬ê³ ê¸ˆì•¡ ìµœëŒ€ê°’ ê³„ì‚° (ì •ê·œí™”ìš©)
      const stockAmtValues = processedData
        .map(d => d.stockAmt)
        .filter(val => val != null && val > 0);
      const maxStockAmt = stockAmtValues.length > 0 ? Math.max(...stockAmtValues) : 1000; // ê¸°ë³¸ê°’ 1000ë°±ë§Œì›
      
      // ì°¨íŠ¸ ë°ì´í„°ì…‹ ìƒì„±
      const datasets = Object.keys(brandColors).map(brand => {
        const brandData = processedData.filter(d => d.brand === brand);
        return {
          label: brandNames[brand],
          clip: false,
          data: brandData.map(d => {
            // ì¬ê³ ê¸ˆì•¡ì„ 2/3 ì§€ìˆ˜ ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜í•˜ì—¬ í¬ê¸° ì°¨ì´ë¥¼ ì•½ 3ë°°ë¡œ í‘œì‹œ
            // 3424 vs 500 (7ë°° ì°¨ì´) â†’ 2/3 ì§€ìˆ˜: ì•½ 3ë°° í¬ê¸° ì°¨ì´
            // ê³„ì‚°: 500/3424 = 0.146 â†’ 0.146^(2/3) = 0.28 â†’ 3 + 0.28 * 47 = 16.2
            // 3424/3424 = 1.0 â†’ 1.0^(2/3) = 1.0 â†’ 3 + 1.0 * 47 = 50
            // ì°¨ì´: 50/16.2 â‰ˆ 3.1ë°°
            const normalized = d.stockAmt / maxStockAmt;
            const bubbleSize = (d.stockAmt != null && d.stockAmt > 0 && maxStockAmt > 0) 
              ? Math.max(3, Math.min(50, 3 + Math.pow(normalized, 2/3) * 47))
              : 3;
            return {
              x: d.weeks,
              y: d.yoy,
              r: bubbleSize,
              item: d.name,
              salesAmt: d.salesAmt,
              inventory: d.inventory,
              stockAmt: d.stockAmt || 0,
              weeksOriginal: d.weeksOriginal,
              share: d.share,
              yoyOriginal: d.yoyOriginal,
              brand: brand,
              quadrant4: d.quadrant4,
              quadrant9: d.quadrant9
            };
          }),
          backgroundColor: brandData.map(d => {
            const alpha = 0.8;
            return brandColors[brand] + Math.round(alpha * 255).toString(16).padStart(2, '0');
          }),
          borderWidth: 0
        };
      });
      
      // 4ë¶„ë©´ ë°°ê²½ í”ŒëŸ¬ê·¸ì¸
      const backgroundPlugin4 = {
        id: 'backgroundQuadrants4',
        beforeDraw: (chart) => {
          const {ctx, chartArea: {left, top, right, bottom}, scales: {x, y}} = chart;
          const xMid = x.getPixelForValue(WEEKS_THRESHOLD_4);
          const yMid = y.getPixelForValue(YOY_THRESHOLD_4);
          
          ctx.fillStyle = 'rgba(219, 234, 254, 0.35)';
          ctx.fillRect(left, top, xMid - left, yMid - top);
          ctx.fillStyle = 'rgba(254, 243, 199, 0.35)';
          ctx.fillRect(xMid, top, right - xMid, yMid - top);
          ctx.fillStyle = 'rgba(243, 244, 246, 0.35)';
          ctx.fillRect(left, yMid, xMid - left, bottom - yMid);
          ctx.fillStyle = 'rgba(254, 226, 226, 0.45)';
          ctx.fillRect(xMid, yMid, right - xMid, bottom - yMid);
          
          ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
          ctx.lineWidth = 2;
          ctx.setLineDash([6, 3]);
          ctx.beginPath();
          ctx.moveTo(xMid, top);
          ctx.lineTo(xMid, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yMid);
          ctx.lineTo(right, yMid);
          ctx.stroke();
          ctx.setLineDash([]);
          
          ctx.font = 'bold 12px "Segoe UI"';
          ctx.textAlign = 'center';
          
          ctx.fillStyle = '#1e40af';
          ctx.fillText('ğŸ”¥ ê³ ì„±ì¥+ì €ì¬ê³ ', left + (xMid - left) / 2, top + 20);
          
          ctx.fillStyle = '#b45309';
          ctx.fillText('âš ï¸ ê³ ì„±ì¥+ê³ ì¬ê³ ', xMid + (right - xMid) / 2, top + 20);
          
          ctx.fillStyle = '#6b7280';
          ctx.fillText('ğŸ“‹ ì €ì„±ì¥+ì €ì¬ê³ ', left + (xMid - left) / 2, bottom - 10);
          
          ctx.fillStyle = '#991b1b';
          ctx.fillText('ğŸš¨ ì €ì„±ì¥+ê³ ì¬ê³ ', xMid + (right - xMid) / 2, bottom - 10);
        }
      };
      
      // 9ë¶„ë©´ ë°°ê²½ í”ŒëŸ¬ê·¸ì¸
      const backgroundPlugin9 = {
        id: 'backgroundQuadrants9',
        beforeDraw: (chart) => {
          const {ctx, chartArea: {left, top, right, bottom}, scales: {x, y}} = chart;
          const xLow = x.getPixelForValue(WEEKS_THRESHOLD_LOW);
          const xHigh = x.getPixelForValue(WEEKS_THRESHOLD_HIGH);
          const yLow = y.getPixelForValue(YOY_THRESHOLD_LOW);
          const yHigh = y.getPixelForValue(YOY_THRESHOLD_HIGH);
          
          const colors = [
            'rgba(219, 234, 254, 0.4)','rgba(209, 250, 229, 0.4)','rgba(243, 244, 246, 0.4)',
            'rgba(209, 250, 229, 0.35)','rgba(224, 231, 255, 0.4)','rgba(254, 243, 199, 0.4)',
            'rgba(255, 247, 237, 0.45)','rgba(254, 215, 170, 0.45)','rgba(254, 226, 226, 0.5)'
          ];
          const rects = [
            [left, top, xLow - left, yHigh - top],
            [left, yHigh, xLow - left, yLow - yHigh],
            [left, yLow, xLow - left, bottom - yLow],
            [xLow, top, xHigh - xLow, yHigh - top],
            [xLow, yHigh, xHigh - xLow, yLow - yHigh],
            [xLow, yLow, xHigh - xLow, bottom - yLow],
            [xHigh, top, right - xHigh, yHigh - top],
            [xHigh, yHigh, right - xHigh, yLow - yHigh],
            [xHigh, yLow, right - xHigh, bottom - yLow]
          ];
          
          rects.forEach((rect, idx) => {
            ctx.fillStyle = colors[idx];
            ctx.fillRect(...rect);
          });
          
          ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
          ctx.lineWidth = 2;
          ctx.setLineDash([6, 3]);
          ctx.beginPath();
          ctx.moveTo(xLow, top);
          ctx.lineTo(xLow, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(xHigh, top);
          ctx.lineTo(xHigh, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yHigh);
          ctx.lineTo(right, yHigh);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yLow);
          ctx.lineTo(right, yLow);
          ctx.stroke();
          ctx.setLineDash([]);
          
          ctx.font = 'bold 11px "Segoe UI"';
          ctx.textAlign = 'center';
          
          ctx.fillStyle = '#1e40af';
          ctx.fillText('ğŸ”¥ ì ê·¹ë°œì£¼', left + (xLow - left) / 2, top + 18);
          
          ctx.fillStyle = '#059669';
          ctx.fillText('âœ… ë°œì£¼ìœ ì§€', left + (xLow - left) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#6b7280';
          ctx.fillText('ğŸ“‹ ê²€í† í•„ìš”', left + (xLow - left) / 2, bottom - 10);
          
          ctx.fillStyle = '#047857';
          ctx.fillText('ğŸ’š ì•ˆì •ì„±ì¥', xLow + (xHigh - xLow) / 2, top + 18);
          
          ctx.fillStyle = '#4f46e5';
          ctx.fillText('ğŸ”µ í˜„ìƒìœ ì§€', xLow + (xHigh - xLow) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#d97706';
          ctx.fillText('âš ï¸ ì£¼ì˜ê´€ì°°', xLow + (xHigh - xLow) / 2, bottom - 10);
          
          ctx.fillStyle = '#f97316';
          ctx.fillText('ğŸŸ¡ ë°œì£¼ì¤‘ë‹¨', xHigh + (right - xHigh) / 2, top + 18);
          
          ctx.fillStyle = '#ea580c';
          ctx.fillText('ğŸŸ  ì¬ê³ ê´€ë¦¬', xHigh + (right - xHigh) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#991b1b';
          ctx.fillText('ğŸš¨ ê¸´ê¸‰ì¡°ì¹˜', xHigh + (right - xHigh) / 2, bottom - 10);
        }
      };
      
      // ì°¨íŠ¸ ìƒì„±
      overviewBubbleView = '4quadrant';
      overviewBubbleBrand = 'all';
      window.overviewBubbleData = { data4, data9, processedData };
      
      charts.overviewBubble = createOverviewBubbleChart();
      updateOverviewBubbleKPIs();
    }
    
    function createOverviewBubbleChart(){
      const bubbleCtx = document.getElementById('overviewBubbleChart');
      if (!bubbleCtx) return null;
      
      // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì•ˆì „í•˜ê²Œ ì²´í¬)
      if (!window.overviewBubbleData || !window.overviewBubbleData.processedData) {
        console.warn('overviewBubbleData not initialized yet, ì´ˆê¸°í™” ì‹œë„...');
        // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ì´ˆê¸°í™” ì‹œë„
        if (typeof initOverviewBubbleChart === 'function') {
          initOverviewBubbleChart();
          // ë‹¤ì‹œ í™•ì¸
          if (!window.overviewBubbleData || !window.overviewBubbleData.processedData) {
            console.warn('overviewBubbleData ì´ˆê¸°í™” ì‹¤íŒ¨');
            return null;
          }
        } else {
          return null;
        }
      }
      const { processedData } = window.overviewBubbleData;
      
      console.log('[ë²„ë¸”ì°¨íŠ¸ ë¼ë²¨] processedData ê°œìˆ˜:', processedData.length);
      if (processedData.length > 0) {
        console.log('[ë²„ë¸”ì°¨íŠ¸ ë¼ë²¨] ì²«ë²ˆì§¸ ë°ì´í„° ìƒ˜í”Œ:', {
          brand: processedData[0].brand,
          name: processedData[0].name,
          weeks: processedData[0].weeks,
          weeksOriginal: processedData[0].weeksOriginal,
          yoy: processedData[0].yoy,
          yoyOriginal: processedData[0].yoyOriginal,
          salesAmt: processedData[0].salesAmt,
          stockAmt: processedData[0].stockAmt,
          share: processedData[0].share
        });
      }
      
      const brandColors = { 'M': '#dc2626', 'I': '#eab308', 'X': '#3b82f6', 'V': '#1f2937', 'ST': '#8b5cf6' };
      // window.brandNamesê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
      const brandNames = window.brandNames || {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'W': 'SUPRA',
        'ST': 'SERGIO'
      };
      
      // ì¬ê³ ê¸ˆì•¡ ìµœëŒ€ê°’ ê³„ì‚° (ì •ê·œí™”ìš©)
      const stockAmtValues = processedData
        .map(d => d.stockAmt)
        .filter(val => val != null && val > 0);
      const maxStockAmt = stockAmtValues.length > 0 ? Math.max(...stockAmtValues) : 1000; // ê¸°ë³¸ê°’ 1000ë°±ë§Œì›
      
      // ì°¨íŠ¸ ë°ì´í„°ì…‹ ìƒì„± (yoy > 0ì¸ í•­ëª©ë§Œ í‘œì‹œ, KPI ì¹´ë“œëŠ” ëª¨ë“  ë°ì´í„° í¬í•¨)
      const datasets = Object.keys(brandColors).map(brand => {
        const brandData = processedData.filter(d => d.brand === brand && d.yoyOriginal > 0);
        
        const mappedData = brandData.map(d => {
          // ì¬ê³ ê¸ˆì•¡ì„ 2/3 ì§€ìˆ˜ ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜í•˜ì—¬ í¬ê¸° ì°¨ì´ë¥¼ ì•½ 3ë°°ë¡œ í‘œì‹œ
          // 3424 vs 500 (7ë°° ì°¨ì´) â†’ 2/3 ì§€ìˆ˜: ì•½ 3ë°° í¬ê¸° ì°¨ì´
          // ê³„ì‚°: 500/3424 = 0.146 â†’ 0.146^(2/3) = 0.28 â†’ 3 + 0.28 * 47 = 16.2
          // 3424/3424 = 1.0 â†’ 1.0^(2/3) = 1.0 â†’ 3 + 1.0 * 47 = 50
          // ì°¨ì´: 50/16.2 â‰ˆ 3.1ë°°
          const normalized = d.stockAmt / maxStockAmt;
          const bubbleSize = (d.stockAmt != null && d.stockAmt > 0 && maxStockAmt > 0) 
            ? Math.max(3, Math.min(50, 3 + Math.pow(normalized, 2/3) * 47))
            : 3;
          return {
            x: d.weeks,
            y: d.yoy,
            r: bubbleSize,
            item: d.name,
            salesAmt: d.salesAmt,
            inventory: d.inventory,
            stockAmt: d.stockAmt || 0,
            weeksOriginal: d.weeksOriginal,
            share: d.share,
            yoyOriginal: d.yoyOriginal,
            brand: brand,
            quadrant4: d.quadrant4,
            quadrant9: d.quadrant9
          };
        });
        
        if (brand === 'M' && mappedData.length > 0) {
          console.log(`[ë²„ë¸”ì°¨íŠ¸ ë¼ë²¨] ${brand} ë¸Œëœë“œ ë°ì´í„° ìƒ˜í”Œ:`, {
            count: mappedData.length,
            first: {
              x: mappedData[0].x,
              y: mappedData[0].y,
              r: mappedData[0].r,
              weeksOriginal: mappedData[0].weeksOriginal,
              item: mappedData[0].item
            }
          });
        }
        
        return {
          label: brandNames[brand],
          clip: false,
          data: mappedData,
          backgroundColor: brandData.map(d => {
            const alpha = 0.8;
            return brandColors[brand] + Math.round(alpha * 255).toString(16).padStart(2, '0');
          }),
          borderWidth: 0
        };
      });
      
      // 4ë¶„ë©´ ë°°ê²½ í”ŒëŸ¬ê·¸ì¸
      const WEEKS_THRESHOLD_4 = 40;
      const YOY_THRESHOLD_4 = 100;
      const WEEKS_THRESHOLD_LOW = 30;
      const WEEKS_THRESHOLD_HIGH = 50;
      const YOY_THRESHOLD_LOW = 80;
      const YOY_THRESHOLD_HIGH = 120;
      
      const backgroundPlugin4 = {
        id: 'backgroundQuadrants4',
        beforeDraw: (chart) => {
          const {ctx, chartArea: {left, top, right, bottom}, scales: {x, y}} = chart;
          const xMid = x.getPixelForValue(WEEKS_THRESHOLD_4);
          const yMid = y.getPixelForValue(YOY_THRESHOLD_4);
          
          ctx.fillStyle = 'rgba(219, 234, 254, 0.35)';
          ctx.fillRect(left, top, xMid - left, yMid - top);
          ctx.fillStyle = 'rgba(254, 243, 199, 0.35)';
          ctx.fillRect(xMid, top, right - xMid, yMid - top);
          ctx.fillStyle = 'rgba(243, 244, 246, 0.35)';
          ctx.fillRect(left, yMid, xMid - left, bottom - yMid);
          ctx.fillStyle = 'rgba(254, 226, 226, 0.45)';
          ctx.fillRect(xMid, yMid, right - xMid, bottom - yMid);
          
          ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
          ctx.lineWidth = 2;
          ctx.setLineDash([6, 3]);
          ctx.beginPath();
          ctx.moveTo(xMid, top);
          ctx.lineTo(xMid, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yMid);
          ctx.lineTo(right, yMid);
          ctx.stroke();
          ctx.setLineDash([]);
          
          ctx.font = 'bold 12px "Segoe UI"';
          ctx.textAlign = 'center';
          
          ctx.fillStyle = '#1e40af';
          ctx.fillText('ğŸ”¥ ê³ ì„±ì¥+ì €ì¬ê³ ', left + (xMid - left) / 2, top + 20);
          
          ctx.fillStyle = '#b45309';
          ctx.fillText('âš ï¸ ê³ ì„±ì¥+ê³ ì¬ê³ ', xMid + (right - xMid) / 2, top + 20);
          
          ctx.fillStyle = '#6b7280';
          ctx.fillText('ğŸ“‹ ì €ì„±ì¥+ì €ì¬ê³ ', left + (xMid - left) / 2, bottom - 10);
          
          ctx.fillStyle = '#991b1b';
          ctx.fillText('ğŸš¨ ì €ì„±ì¥+ê³ ì¬ê³ ', xMid + (right - xMid) / 2, bottom - 10);
        }
      };
      
      const backgroundPlugin9 = {
        id: 'backgroundQuadrants9',
        beforeDraw: (chart) => {
          const {ctx, chartArea: {left, top, right, bottom}, scales: {x, y}} = chart;
          const xLow = x.getPixelForValue(WEEKS_THRESHOLD_LOW);
          const xHigh = x.getPixelForValue(WEEKS_THRESHOLD_HIGH);
          const yLow = y.getPixelForValue(YOY_THRESHOLD_LOW);
          const yHigh = y.getPixelForValue(YOY_THRESHOLD_HIGH);
          
          const colors = [
            'rgba(219, 234, 254, 0.4)','rgba(209, 250, 229, 0.4)','rgba(243, 244, 246, 0.4)',
            'rgba(209, 250, 229, 0.35)','rgba(224, 231, 255, 0.4)','rgba(254, 243, 199, 0.4)',
            'rgba(255, 247, 237, 0.45)','rgba(254, 215, 170, 0.45)','rgba(254, 226, 226, 0.5)'
          ];
          const rects = [
            [left, top, xLow - left, yHigh - top],
            [left, yHigh, xLow - left, yLow - yHigh],
            [left, yLow, xLow - left, bottom - yLow],
            [xLow, top, xHigh - xLow, yHigh - top],
            [xLow, yHigh, xHigh - xLow, yLow - yHigh],
            [xLow, yLow, xHigh - xLow, bottom - yLow],
            [xHigh, top, right - xHigh, yHigh - top],
            [xHigh, yHigh, right - xHigh, yLow - yHigh],
            [xHigh, yLow, right - xHigh, bottom - yLow]
          ];
          
          rects.forEach((rect, idx) => {
            ctx.fillStyle = colors[idx];
            ctx.fillRect(...rect);
          });
          
          ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
          ctx.lineWidth = 2;
          ctx.setLineDash([6, 3]);
          ctx.beginPath();
          ctx.moveTo(xLow, top);
          ctx.lineTo(xLow, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(xHigh, top);
          ctx.lineTo(xHigh, bottom);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yHigh);
          ctx.lineTo(right, yHigh);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(left, yLow);
          ctx.lineTo(right, yLow);
          ctx.stroke();
          ctx.setLineDash([]);
          
          ctx.font = 'bold 11px "Segoe UI"';
          ctx.textAlign = 'center';
          
          ctx.fillStyle = '#1e40af';
          ctx.fillText('ğŸ”¥ ì ê·¹ë°œì£¼', left + (xLow - left) / 2, top + 18);
          
          ctx.fillStyle = '#059669';
          ctx.fillText('âœ… ë°œì£¼ìœ ì§€', left + (xLow - left) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#6b7280';
          ctx.fillText('ğŸ“‹ ê²€í† í•„ìš”', left + (xLow - left) / 2, bottom - 10);
          
          ctx.fillStyle = '#047857';
          ctx.fillText('ğŸ’š ì•ˆì •ì„±ì¥', xLow + (xHigh - xLow) / 2, top + 18);
          
          ctx.fillStyle = '#4f46e5';
          ctx.fillText('ğŸ”µ í˜„ìƒìœ ì§€', xLow + (xHigh - xLow) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#d97706';
          ctx.fillText('âš ï¸ ì£¼ì˜ê´€ì°°', xLow + (xHigh - xLow) / 2, bottom - 10);
          
          ctx.fillStyle = '#f97316';
          ctx.fillText('ğŸŸ¡ ë°œì£¼ì¤‘ë‹¨', xHigh + (right - xHigh) / 2, top + 18);
          
          ctx.fillStyle = '#ea580c';
          ctx.fillText('ğŸŸ  ì¬ê³ ê´€ë¦¬', xHigh + (right - xHigh) / 2, yHigh + (yLow - yHigh) / 2);
          
          ctx.fillStyle = '#991b1b';
          ctx.fillText('ğŸš¨ ê¸´ê¸‰ì¡°ì¹˜', xHigh + (right - xHigh) / 2, bottom - 10);
        }
      };
      
      const currentPlugin = overviewBubbleView === '4quadrant' ? backgroundPlugin4 : backgroundPlugin9;
      
      // ë²„ë¸” ì°¨íŠ¸ ë¼ë²¨ í”ŒëŸ¬ê·¸ì¸ (ì¬ê³ ì£¼ìˆ˜ í‘œì‹œ)
      const bubbleLabelPlugin = {
        id: 'bubbleLabels',
        afterDatasetsDraw: (chart) => {
          const ctx = chart.ctx;
          
          chart.data.datasets.forEach((dataset, datasetIndex) => {
            const meta = chart.getDatasetMeta(datasetIndex);
            
            if (!meta.hidden && dataset.data && dataset.data.length > 0) {
              meta.data.forEach((element, index) => {
                if (!element || index >= dataset.data.length) return;
                
                const data = dataset.data[index];
                if (!data) return;
                
                const x = element.x;
                const y = element.y;
                
                // ì¬ê³ ì£¼ìˆ˜ ê°’ (ì›ë³¸ ê°’ ìš°ì„ , ì—†ìœ¼ë©´ x ì¢Œí‘œê°’ ì‚¬ìš©)
                const weeksValue = data.weeksOriginal !== undefined ? data.weeksOriginal : 
                                   (data.x !== undefined ? data.x : 0);
                
                if (weeksValue <= 0) return; // 0 ì´í•˜ë©´ í‘œì‹œ ì•ˆí•¨
                
                const weeksText = weeksValue.toFixed(0); // ì •ìˆ˜ë¡œ í‘œì‹œ
                
                // ë²„ë¸” í¬ê¸°ì— ë”°ë¼ í°íŠ¸ í¬ê¸° ì¡°ì •
                const radius = element.options.radius || 5;
                const fontSize = Math.max(9, Math.min(12, radius / 3));
                
                // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼
                ctx.save();
                ctx.fillStyle = '#1f2937';
                ctx.font = `bold ${fontSize}px "Segoe UI"`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // í…ìŠ¤íŠ¸ ë°°ê²½ (ê°€ë…ì„± í–¥ìƒ)
                ctx.shadowColor = 'rgba(255, 255, 255, 0.9)';
                ctx.shadowBlur = 4;
                
                // ì¬ê³ ì£¼ìˆ˜ í‘œì‹œ
                ctx.fillText(weeksText, x, y);
                
                ctx.restore();
              });
            }
          });
        }
      };
      
      return new Chart(bubbleCtx.getContext('2d'), {
        type: 'bubble',
        data: { datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: { padding: { top: 20, right: 20, bottom: 20, left: 20 } },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.95)',
              padding: 14,
              titleFont: { size: 14, weight: 'bold' },
              bodyFont: { size: 12 },
              bodySpacing: 5,
              callbacks: {
                title: function(context) {
                  const d = context[0].raw;
                  const quadrant = overviewBubbleView === '4quadrant' ? d.quadrant4 : d.quadrant9;
                  const quadrantNames4 = {
                    'critical': 'ğŸš¨ ì €ì„±ì¥+ê³ ì¬ê³ ',
                    'caution': 'âš ï¸ ê³ ì„±ì¥+ê³ ì¬ê³ ',
                    'growth': 'ğŸ”¥ ê³ ì„±ì¥+ì €ì¬ê³ ',
                    'review': 'ğŸ“‹ ì €ì„±ì¥+ì €ì¬ê³ '
                  };
                  const quadrantNames9 = {
                    'q1': 'ğŸ”¥ ì ê·¹ë°œì£¼', 'q2': 'âœ… ë°œì£¼ìœ ì§€', 'q3': 'ğŸ“‹ ê²€í† í•„ìš”',
                    'q4': 'ğŸ’š ì•ˆì •ì„±ì¥', 'q5': 'ğŸ”µ í˜„ìƒìœ ì§€', 'q6': 'âš ï¸ ì£¼ì˜ê´€ì°°',
                    'q7': 'ğŸŸ¡ ë°œì£¼ì¤‘ë‹¨', 'q8': 'ğŸŸ  ì¬ê³ ê´€ë¦¬', 'q9': 'ğŸš¨ ê¸´ê¸‰ì¡°ì¹˜'
                  };
                  const quadrantName = overviewBubbleView === '4quadrant' 
                    ? quadrantNames4[quadrant] : quadrantNames9[quadrant];
                  return `${brandNames[d.brand]} ${d.item} (${quadrantName})`;
                },
                label: function(context) {
                  const d = context.raw;
                  const weeksDisplay = d.weeksOriginal > 80 ? `${d.weeksOriginal.toFixed(1)}ì£¼ (80ì£¼+)` : `${d.weeksOriginal.toFixed(1)}ì£¼`;
                  const yoyDisplay = d.yoyOriginal > 250 ? `${Math.round(d.yoyOriginal)}% (250%+)` : `${Math.round(d.yoyOriginal)}%`;
                  
                  // ë§¤ì¶œì•¡ê³¼ ì¬ê³ ê¸ˆì•¡ í¬ë§·íŒ… (ì†Œìˆ˜ì  ì œê±°, ì²œ ë‹¨ìœ„ êµ¬ë¶„)
                  const salesAmtText = d.salesAmt ? Math.round(d.salesAmt).toLocaleString('ko-KR') : '0';
                  const stockAmtText = d.stockAmt && d.stockAmt > 0 ? Math.round(d.stockAmt).toLocaleString('ko-KR') : '0';
                  
                  return [
                    `ë§¤ì¶œì•¡: ${salesAmtText} ë°±ë§Œì›`,
                    `ì¬ê³ ì£¼ìˆ˜: ${weeksDisplay}`,
                    `ë§¤ì¶œ YOY: ${yoyDisplay}`,
                    `ë§¤ì¶œë¹„ì¤‘: ${d.share}%`,
                    `ì¬ê³ : ${(d.inventory/1000).toFixed(1)}Kê°œ`,
                    `ì¬ê³ ê¸ˆì•¡: ${stockAmtText} ë°±ë§Œì›`
                  ];
                }
              }
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'ì¬ê³ ì£¼ìˆ˜ (ì£¼) â†’',
                font: { size: 13, weight: 'bold' },
                color: '#1f2937'
              },
              min: 0,
              max: 80,
              grid: { color: 'rgba(0, 0, 0, 0.06)' },
              ticks: {
                font: { size: 11 },
                stepSize: 10,
                callback: function(value) {
                  if (value === 80) return '80+';
                  return value;
                }
              }
            },
            y: {
              title: {
                display: true,
                text: 'â†‘ ë§¤ì¶œ YOY (%)',
                font: { size: 13, weight: 'bold' },
                color: '#1f2937'
              },
              max: 250,
              grid: { color: 'rgba(0, 0, 0, 0.06)' },
              ticks: {
                font: { size: 11 },
                stepSize: 50,
                callback: function(value) {
                  if (value === 250) return '250%+';
                  return value + '%';
                }
              }
            }
          }
        },
        plugins: [currentPlugin, bubbleLabelPlugin]
      });
    }
    
    // ë²„ë¸” ì°¨íŠ¸ KPI ì—…ë°ì´íŠ¸
    function updateOverviewBubbleKPIs(){
      if (!window.overviewBubbleData) return;
      const { data4, data9 } = window.overviewBubbleData;
      
      let filteredData4, filteredData9;
      if (overviewBubbleBrand === 'all') {
        filteredData4 = data4;
        filteredData9 = data9;
      } else {
        filteredData4 = {
          critical: data4.critical.filter(d => d.brand === overviewBubbleBrand),
          caution: data4.caution.filter(d => d.brand === overviewBubbleBrand),
          growth: data4.growth.filter(d => d.brand === overviewBubbleBrand),
          review: data4.review.filter(d => d.brand === overviewBubbleBrand)
        };
        filteredData9 = {
          q1: data9.q1.filter(d => d.brand === overviewBubbleBrand),
          q2: data9.q2.filter(d => d.brand === overviewBubbleBrand),
          q3: data9.q3.filter(d => d.brand === overviewBubbleBrand),
          q4: data9.q4.filter(d => d.brand === overviewBubbleBrand),
          q5: data9.q5.filter(d => d.brand === overviewBubbleBrand),
          q6: data9.q6.filter(d => d.brand === overviewBubbleBrand),
          q7: data9.q7.filter(d => d.brand === overviewBubbleBrand),
          q8: data9.q8.filter(d => d.brand === overviewBubbleBrand),
          q9: data9.q9.filter(d => d.brand === overviewBubbleBrand)
        };
      }
      
      window.overviewBubbleQuadrantData = { ...filteredData4, ...filteredData9 };
      
      if (overviewBubbleView === '4quadrant') {
        document.getElementById('overviewCriticalCount').textContent = filteredData4.critical.length;
        document.getElementById('overviewCautionCount').textContent = filteredData4.caution.length;
        document.getElementById('overviewGrowthCount').textContent = filteredData4.growth.length;
        document.getElementById('overviewReviewCount').textContent = filteredData4.review.length;
      } else {
        document.getElementById('overviewQ1Count').textContent = filteredData9.q1.length;
        document.getElementById('overviewQ2Count').textContent = filteredData9.q2.length;
        document.getElementById('overviewQ3Count').textContent = filteredData9.q3.length;
        document.getElementById('overviewQ4Count').textContent = filteredData9.q4.length;
        document.getElementById('overviewQ5Count').textContent = filteredData9.q5.length;
        document.getElementById('overviewQ6Count').textContent = filteredData9.q6.length;
        document.getElementById('overviewQ7Count').textContent = filteredData9.q7.length;
        document.getElementById('overviewQ8Count').textContent = filteredData9.q8.length;
        document.getElementById('overviewQ9Count').textContent = filteredData9.q9.length;
      }
    }
    
    // ë²„ë¸” ì°¨íŠ¸ ëª¨ë‹¬ ì—´ê¸°
    function openBubbleModal(type){
      if (!window.overviewBubbleQuadrantData) return;
      
      // ëª¨ë‹¬ì´ ì—†ìœ¼ë©´ ìƒì„±
      let modal = document.getElementById('overviewBubbleModal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'overviewBubbleModal';
        modal.style.cssText = 'display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);animation:fadeIn 0.2s;';
        modal.innerHTML = `
          <div style="background-color:white;margin:3% auto;padding:0;border-radius:10px;width:90%;max-width:1200px;max-height:85vh;box-shadow:0 4px 20px rgba(0,0,0,0.3);animation:slideDown 0.3s;overflow:hidden;">
            <div id="overviewBubbleModalHeader" style="padding:18px 25px;color:white;font-weight:700;font-size:16px;display:flex;justify-content:space-between;align-items:center;">
              <span id="overviewBubbleModalTitle"></span>
              <span class="close-btn" onclick="closeBubbleModal()" style="font-size:28px;font-weight:bold;color:white;cursor:pointer;line-height:1;padding:0 10px;">&times;</span>
            </div>
            <div style="padding:20px 25px;overflow-y:auto;max-height:calc(85vh - 80px);">
              <table style="width:100%;border-collapse:collapse;font-size:13px;">
                <thead style="background:#f9fafb;position:sticky;top:0;z-index:10;">
                  <tr>
                    <th style="padding:12px 10px;text-align:left;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ë¸Œëœë“œ</th>
                    <th style="padding:12px 10px;text-align:left;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ì•„ì´í…œëª…</th>
                    <th style="padding:12px 10px;text-align:right;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ë§¤ì¶œ (ë°±ë§Œ)</th>
                    <th style="padding:12px 10px;text-align:right;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ë§¤ì¶œ YOY</th>
                    <th style="padding:12px 10px;text-align:right;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ì¬ê³ ì£¼ìˆ˜</th>
                    <th style="padding:12px 10px;text-align:right;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ì „ë…„ëŒ€ë¹„</th>
                    <th style="padding:12px 10px;text-align:right;font-weight:700;color:#374151;border-bottom:2px solid #e5e7eb;">ë§¤ì¶œë¹„ì¤‘</th>
                  </tr>
                </thead>
                <tbody id="overviewBubbleModalTableBody"></tbody>
              </table>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        modal.addEventListener('click', (e)=> { if(e.target===modal) modal.style.display='none'; });
      }
      
      const items = window.overviewBubbleQuadrantData[type];
      if (!items || items.length === 0) return;
      
      const titles = {
        critical: 'ğŸš¨ ì €ì„±ì¥+ê³ ì¬ê³ ',
        caution: 'âš ï¸ ê³ ì„±ì¥+ê³ ì¬ê³ ',
        growth: 'ğŸ”¥ ê³ ì„±ì¥+ì €ì¬ê³ ',
        review: 'ğŸ“‹ ì €ì„±ì¥+ì €ì¬ê³ ',
        q1: 'ğŸ”¥ ì ê·¹ë°œì£¼: ìµœìš°ì„  ì¬ê³  í™•ë³´ í•„ìš”',
        q2: 'âœ… ë°œì£¼ìœ ì§€: ì•ˆì •ì  ë°œì£¼ ìœ ì§€',
        q3: 'ğŸ“‹ ê²€í† í•„ìš”: ì „ëµ ì¬ê²€í†  í•„ìš”',
        q4: 'ğŸ’š ì•ˆì •ì„±ì¥: ëª¨ë‹ˆí„°ë§ ì§€ì†',
        q5: 'ğŸ”µ í˜„ìƒìœ ì§€: ì ì • ì¬ê³  ìˆ˜ì¤€',
        q6: 'âš ï¸ ì£¼ì˜ê´€ì°°: ë°œì£¼ ì‹ ì¤‘ ê²€í† ',
        q7: 'ğŸŸ¡ ë°œì£¼ì¤‘ë‹¨: ì¬ê³  ì†Œì§„ ìš°ì„ ',
        q8: 'ğŸŸ  ì¬ê³ ê´€ë¦¬: ì†Œì§„ í™œë™ ì§‘ì¤‘',
        q9: 'ğŸš¨ ê¸´ê¸‰ì¡°ì¹˜: í• ì¸/í”„ë¡œëª¨ì…˜ ì¦‰ì‹œ ì‹¤í–‰'
      };
      
      const headerColors = {
        critical: 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)',
        caution: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
        growth: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
        review: 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)',
        q1: 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)',
        q2: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
        q3: 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)',
        q4: 'linear-gradient(135deg, #059669 0%, #047857 100%)',
        q5: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',
        q6: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
        q7: 'linear-gradient(135deg, #fb923c 0%, #f97316 100%)',
        q8: 'linear-gradient(135deg, #ea580c 0%, #c2410c 100%)',
        q9: 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)'
      };
      
      document.getElementById('overviewBubbleModalTitle').textContent = titles[type];
      document.getElementById('overviewBubbleModalHeader').style.background = headerColors[type];
      
      const brandColorMap = { 'M': '#dc2626', 'I': '#eab308', 'X': '#3b82f6', 'V': '#1f2937', 'ST': '#8b5cf6', 'W': '#10b981' };
      // window.brandNamesê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
      const brandNamesMap = window.brandNames || {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'W': 'SUPRA',
        'ST': 'SERGIO'
      };
      
      document.getElementById('overviewBubbleModalTableBody').innerHTML = items.map(item => `
        <tr style="border-bottom:1px solid #f3f4f6;">
          <td style="padding:12px 10px;">
            <span style="display:inline-block;padding:3px 8px;border-radius:4px;font-size:11px;font-weight:600;color:white;background:${brandColorMap[item.brand]}">
              ${brandNamesMap[item.brand]}
            </span>
          </td>
          <td style="padding:12px 10px;"><strong>${item.name}</strong></td>
          <td style="padding:12px 10px;text-align:right;">${item.salesAmt.toLocaleString()}</td>
          <td style="padding:12px 10px;text-align:right;">
            <span style="color:${item.yoyOriginal >= 100 ? '#059669' : '#dc2626'};font-weight:600;">
              ${Math.round(item.yoyOriginal)}%
            </span>
          </td>
          <td style="padding:12px 10px;text-align:right;">${item.weeksOriginal.toFixed(1)}ì£¼</td>
          <td style="padding:12px 10px;text-align:right;">
            <span style="color:${item.yoyDiff > 0 ? '#059669' : item.yoyDiff < 0 ? '#dc2626' : '#6b7280'};font-weight:600;">
              ${item.yoyDiff > 0 ? '+' : ''}${item.yoyDiff.toFixed(1)}ì£¼
            </span>
          </td>
          <td style="padding:12px 10px;text-align:right;">${item.share}%</td>
        </tr>
      `).join('');
      
      modal.style.display = 'block';
    }
    
    // ë²„ë¸” ì°¨íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeBubbleModal(){
      const modal = document.getElementById('overviewBubbleModal');
      if (modal) modal.style.display = 'none';
    }
    
    // íˆíŠ¸ë§µ ì •ë ¬ í•¨ìˆ˜
    async function sortHeatmap(sortBy) {
      console.log('[íˆíŠ¸ë§µ] ì •ë ¬ ê¸°ì¤€ ë³€ê²½:', sortBy);
      
      // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      const btnSaleRate = document.getElementById('sortBySaleRate');
      const btnSale = document.getElementById('sortBySale');
      
      if (sortBy === 'salesRate') {
        btnSaleRate.style.background = '#2563eb';
        btnSaleRate.style.color = '#fff';
        btnSale.style.background = '#e5e7eb';
        btnSale.style.color = '#374151';
      } else if (sortBy === 'sale') {
        btnSale.style.background = '#2563eb';
        btnSale.style.color = '#fff';
        btnSaleRate.style.background = '#e5e7eb';
        btnSaleRate.style.color = '#374151';
      }
      
      // íˆíŠ¸ë§µ ì¬ìƒì„±
      await createOverviewHeatmap(sortBy);
    }
    
    // ë²„ë¸” ì°¨íŠ¸ ë·° ì „í™˜
    function switchBubbleView(view){
      overviewBubbleView = view;
      
      const btn4 = document.getElementById('bubbleViewBtn4');
      const btn9 = document.getElementById('bubbleViewBtn9');
      const kpi4 = document.getElementById('overviewKpi4');
      const kpi9 = document.getElementById('overviewKpi9');
      
      if (view === '4quadrant') {
        btn4.style.background = 'white';
        btn4.style.color = '#1e293b';
        btn4.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
        btn9.style.background = 'transparent';
        btn9.style.color = '#6b7280';
        btn9.style.boxShadow = 'none';
      } else {
        btn9.style.background = 'white';
        btn9.style.color = '#1e293b';
        btn9.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
        btn4.style.background = 'transparent';
        btn4.style.color = '#6b7280';
        btn4.style.boxShadow = 'none';
      }
      
      if(kpi4) kpi4.style.display = view === '4quadrant' ? 'grid' : 'none';
      if(kpi9) kpi9.style.display = view === '9quadrant' ? 'grid' : 'none';
      
      // overviewBubbleDataê°€ ì—†ìœ¼ë©´ ë¨¼ì € ì´ˆê¸°í™”
      if (!window.overviewBubbleData || !window.overviewBubbleData.processedData) {
        console.log('[switchBubbleView] overviewBubbleData ì—†ìŒ, ì´ˆê¸°í™” ì‹œë„');
        if (typeof initOverviewBubbleChart === 'function') {
          initOverviewBubbleChart();
        }
      }
      
      if (charts.overviewBubble) {
        charts.overviewBubble.destroy();
      }
      charts.overviewBubble = createOverviewBubbleChart();
      
      updateOverviewBubbleKPIs();
    }
    
    // ë²„ë¸” ì°¨íŠ¸ ë¸Œëœë“œ í•„í„°
    function filterBubbleBrand(brand){
      overviewBubbleBrand = brand;
      
      document.querySelectorAll('.brand-filter-btn-overview').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      if (!charts.overviewBubble) return;
      
      // window.brandNamesê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
      const brandNames = window.brandNames || {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'W': 'SUPRA',
        'ST': 'SERGIO'
      };
      
      if (brand === 'all') {
        charts.overviewBubble.data.datasets.forEach(dataset => {
          dataset.hidden = false;
        });
      } else {
        charts.overviewBubble.data.datasets.forEach(dataset => {
          dataset.hidden = dataset.label !== brandNames[brand];
        });
      }
      
      charts.overviewBubble.update();
      updateOverviewBubbleKPIs();
    }

    // ê³ ì • í™”ë©´ìš© ë”ë¯¸ ë°ì´í„°
    function getStaticRadarData(){
      return {
        labels: ['ë°±í™”ì ','ë©´ì„¸ì ','RF','ì§ì˜ì (ê°€ë‘)','ìì‚¬ëª°','ì œíœ´ëª°','ëŒ€ë¦¬ì ','ì§ì˜ëª°'],
        plan: [85, 89, 78, 104, 74, 66, 81, 72],
        yoy:  [83, 87, 82, 88, 75, 70, 86, 79],
        sales: ['49.5ì–µ','64.0ì–µ','20.3ì–µ','27.4ì–µ','7.5ì–µ','11.4ì–µ','36.3ì–µ','5.7ì–µ']
      };
    }
    function getStaticItemRadarData(){
      // ì•„ì´í…œ ëª©ë¡: ë‹¹ì‹œì¦Œì˜ë¥˜, ê³¼ì‹œì¦Œì˜ë¥˜, ëª¨ì, ê°€ë°©, ì‹ ë°œ, ê¸°íƒ€ (ì°¨ì‹œì¦Œì˜ë¥˜ëŠ” ë°ì´í„° ì—†ìœ¼ë©´ ì œì™¸)
      return {
        labels: ['ë‹¹ì‹œì¦Œì˜ë¥˜','ê³¼ì‹œì¦Œì˜ë¥˜','ëª¨ì','ê°€ë°©','ì‹ ë°œ','ê¸°íƒ€'],
        plan: [85, 188, 123, 69, 84, 0],
        yoy:  [93, 64, 126, 95, 96, 93],
        sales: ['120.5ì–µ','21.3ì–µ','122.3ì–µ','18.6ì–µ','58.3ì–µ','2.2ì–µ']
      };
    }
    function getSalesForLabel(label, brand){
      // ë™ì‘ ëª¨ë“œì—ì„œ ì‚¬ìš©í•  ë•Œë§Œ ì°¸ì¡°ë¨. ê°„ë‹¨í•œ í•©ë¦¬ì  í´ë°±
      const data = (window.radarChartType==='channel') ? getChannelRadarData(brand) : getItemRadarData(brand);
      const idx = data.labels.indexOf(label);
      return data.sales[idx] || '0ì–µ';
    }
    function getStaticSales(label){
      const m = { 'ë°±í™”ì ':'49.5ì–µ','ë©´ì„¸ì ':'64.0ì–µ','ì§ì˜ê°€ë‘':'27.4ì–µ','ì˜¨ë¼ì¸':'18.9ì–µ','ëŒ€ë¦¬ì ':'36.3ì–µ' };
      return m[label] || '0ì–µ';
    }
    // -------- ë¦¬ì‚¬ì´ì¦ˆ --------
    window.addEventListener('resize',()=>{
      // ë¸Œëœë“œë³„ íŠ¸ë¦¬ë§µ í¬ê¸° ì¬ê³„ì‚° (Plotly ìë™ ë¦¬ì‚¬ì´ì¦ˆ)
      if (document.getElementById('content-brand')?.classList.contains('active')) {
        setTimeout(() => {
          const channelContainer = document.getElementById('treemapWrapperChannel');
          const itemContainer = document.getElementById('treemapWrapperItem');
          if (channelContainer && window.Plotly && window.Plotly.Plots) {
            window.Plotly.Plots.resize(channelContainer);
          }
          if (itemContainer && window.Plotly && window.Plotly.Plots) {
            window.Plotly.Plots.resize(itemContainer);
          }
        }, 100);
      }
      
      
      Object.values(charts).forEach(c=>{
        if (c && typeof c.resize === 'function') {
          try { c.resize(); } catch(e) {}
        }
      });
    });

    // -------- JS íŒŒì¼ ë°ì´í„°ë¥¼ ëŒ€ì‹œë³´ë“œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ --------
    function convertClothingDataToTableFormat() {
      // brand_stock_analysis JS íŒŒì¼ì—ì„œ ë¡œë“œëœ clothingBrandStatus ë°ì´í„°ë¥¼ itemTableDataByBrand í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      if (typeof window.clothingBrandStatus === 'undefined') {
        console.warn('clothingBrandStatus ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // subCategoryë¥¼ ì¹´í…Œê³ ë¦¬ í‚¤ë¡œ ë§¤í•‘
      const getCategoryKey = (subCategory) => {
        if (!subCategory) return 'Wear_etc';
        const sub = subCategory.toLowerCase();
        
        // Outer ì¹´í…Œê³ ë¦¬
        if (sub.includes('outer') || sub.includes('jacket') || sub.includes('jumper') || 
            sub.includes('coat') || sub.includes('ì í¼') || sub.includes('ìì¼“') || sub.includes('ì½”íŠ¸')) {
          return 'Outer';
        }
        // Inner ì¹´í…Œê³ ë¦¬
        if (sub.includes('inner') || sub.includes('top') || sub.includes('shirt') || 
            sub.includes('tee') || sub.includes('ìƒì˜') || sub.includes('í‹°ì…”ì¸ ') || sub.includes('ë‹ˆíŠ¸')) {
          return 'Inner';
        }
        // Bottom ì¹´í…Œê³ ë¦¬
        if (sub.includes('bottom') || sub.includes('pant') || sub.includes('skirt') || 
            sub.includes('í•˜ì˜') || sub.includes('ë°”ì§€') || sub.includes('ìŠ¤ì»¤íŠ¸')) {
          return 'Bottom';
        }
        // ì§ì ‘ ë§¤ì¹­
        if (['Outer', 'outer'].includes(subCategory)) return 'Outer';
        if (['Inner', 'inner'].includes(subCategory)) return 'Inner';
        if (['Bottom', 'bottom'].includes(subCategory)) return 'Bottom';
        
        return 'Wear_etc';
      };
      
      const formatDiffText = (diff) => {
        if (diff === null || diff === undefined || isNaN(diff)) return '+0.0%p';
        const absVal = Math.abs(diff * 100).toFixed(1);
        if (diff < 0) return `â–³${absVal}%p`;
        if (diff > 0) return `+${absVal}%p`;
        return '+0.0%p';
      };
      
      for (const [brandCode, items] of Object.entries(window.clothingBrandStatus)) {
        if (!Array.isArray(items) || items.length === 0) continue;
        
        const brandData = { Outer: [], Inner: [], Bottom: [], Wear_etc: [] };
        
        for (const item of items) {
          const categoryKey = getCategoryKey(item.subCategory);
          const row = {
            category: categoryKey,
            code: item.itemCode || '',
            name: item.itemName || '',
            poNow: item.orderTag ? Math.round(item.orderTag / 1000000) : 0, // ë°±ë§Œì› ë‹¨ìœ„
            poYoy: item.orderYoY ? Math.round(item.orderYoY * 100) : null, // %
            weekly: item.weeklySalesTag ? Math.round(item.weeklySalesTag / 1000000) : 0,
            yoyWeekly: item.weeklyYoY ? Math.round(item.weeklyYoY * 100) : null,
            cum: item.cumSalesTag ? Math.round(item.cumSalesTag / 1000000) : 0,
            yoyCum: item.cumYoY ? Math.round(item.cumYoY * 100) : null,
            rateNow: item.cumSalesRate ? Number((item.cumSalesRate * 100).toFixed(2)) : 0, // % (ìˆ«ì)
            rateLast: item.pyClosingSalesRate ? Number((item.pyClosingSalesRate * 100).toFixed(2)) : null,
            closingRate: item.pyClosingSalesRate ? Number((item.pyClosingSalesRate * 100).toFixed(2)) : null,
            diffText: formatDiffText(item.cumSalesRateDiff)
          };
          
          if (brandData[categoryKey]) {
            brandData[categoryKey].push(row);
          }
        }
        
        // itemTableDataByBrandì— ë°ì´í„° ë®ì–´ì“°ê¸° (ë¡œì»¬ ë³€ìˆ˜ + window ì „ì—­ ë³€ìˆ˜)
        if (typeof itemTableDataByBrand !== 'undefined') {
          itemTableDataByBrand[brandCode] = brandData;
        }
        // window ì „ì—­ ë³€ìˆ˜ì—ë„ í• ë‹¹ (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        if (typeof window !== 'undefined') {
          if (!window.itemTableDataByBrand) window.itemTableDataByBrand = {};
          window.itemTableDataByBrand[brandCode] = brandData;
        }
      }
      
      console.log('âœ… ë‹¹ì‹œì¦Œì˜ë¥˜ ë°ì´í„° ë³€í™˜ ì™„ë£Œ:', Object.keys(window.clothingBrandStatus));
      console.log('âœ… itemTableDataByBrand ë³€í™˜ ê²°ê³¼:', Object.keys(itemTableDataByBrand));
      // ê° ë¸Œëœë“œë³„ ë°ì´í„° ê°œìˆ˜ ì¶œë ¥
      for (const [code, data] of Object.entries(itemTableDataByBrand)) {
        console.log(`   ë¸Œëœë“œ ${code}: Outer ${data.Outer?.length || 0}ê°œ, Inner ${data.Inner?.length || 0}ê°œ, Bottom ${data.Bottom?.length || 0}ê°œ, Wear_etc ${data.Wear_etc?.length || 0}ê°œ`);
      }
    }
    
    function convertAccDataToInventoryFormat() {
      // brand_stock_analysis JS íŒŒì¼ì—ì„œ ë¡œë“œëœ accStockAnalysis ë°ì´í„°ë¥¼ inventoryTableDataByBrand í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      if (typeof window.accStockAnalysis === 'undefined') {
        console.warn('accStockAnalysis ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const parseYoyRate = (yoyStr) => {
        if (!yoyStr || yoyStr === 'null') return null;
        const match = String(yoyStr).match(/(\d+)/);
        return match ? parseInt(match[1]) : null;
      };
      
      const parseShareRate = (shareStr) => {
        if (!shareStr || shareStr === '0%') return 0;
        const match = String(shareStr).match(/(\d+)/);
        return match ? parseInt(match[1]) : 0;
      };
      
      console.log('[ACC ë³€í™˜] ì‹œì‘ - ë¸Œëœë“œ ìˆ˜:', Object.keys(window.accStockAnalysis).length);
      
      for (const [brandCode, items] of Object.entries(window.accStockAnalysis)) {
        if (!Array.isArray(items) || items.length === 0) {
          console.log(`[ACC ë³€í™˜] ë¸Œëœë“œ ${brandCode}: ë°°ì—´ì´ ì•„ë‹ˆê±°ë‚˜ ë¹„ì–´ìˆìŒ`);
          continue;
        }
        
        // í•´ë‹¹ ë¸Œëœë“œ ì „ì²´ ë§¤ì¶œ ê³„ì‚° (ë¹„ì¤‘ ê³„ì‚°ìš©)
        const totalSales = items.reduce((sum, item) => sum + (item.saleAmt || 0), 0);
        
        const brandData = items.map(item => {
          const stockAmtValue = item.stockAmt != null ? Math.round(item.stockAmt / 1000000) : null;
          // ë””ë²„ê¹…: stockAmt ë³€í™˜ í™•ì¸
          if (item.itemCode === 'WM' && item.itemName === 'ë°©í•œëª¨') {
            console.log(`[ACC ë³€í™˜ ë””ë²„ê¹…] ë°©í•œëª¨ - ì›ë³¸ stockAmt: ${item.stockAmt}, ë³€í™˜ëœ ê°’: ${stockAmtValue}`);
          }
          return {
            category: item.category || 'Acc_etc',
            item: item.itemCode || '',
            name: item.itemName || '',
            sales: item.saleAmt ? Math.round(item.saleAmt / 1000000) : null, // ë°±ë§Œì› ë‹¨ìœ„
            yoy: parseYoyRate(item.yoyRate),
            weight: totalSales > 0 ? Math.round((item.saleAmt || 0) / totalSales * 100) : 0,
            qty: item.saleQty || null,
            avg4w: item.avg4wSaleQty ? Math.round(item.avg4wSaleQty) : null,
            stockQty: item.stockQty || 0,
            stockAmt: stockAmtValue, // ë°±ë§Œì› ë‹¨ìœ„
            stockWeeks: item.stockWeeks || null,
            diff: item.stockWeeksDiff || null
          };
        });
        
        console.log(`[ACC ë³€í™˜] ë¸Œëœë“œ ${brandCode}: ${brandData.length}ê°œ ì•„ì´í…œ, stockWeeks ìˆëŠ” í•­ëª©: ${brandData.filter(d => d.stockWeeks != null && d.stockWeeks > 0).length}ê°œ`);
        // ë””ë²„ê¹…: stockAmtê°€ ìˆëŠ” í•­ëª© í™•ì¸
        const itemsWithStockAmt = brandData.filter(d => d.stockAmt != null && d.stockAmt !== 0);
        console.log(`[ACC ë³€í™˜] ë¸Œëœë“œ ${brandCode}: stockAmt ìˆëŠ” í•­ëª©: ${itemsWithStockAmt.length}ê°œ`, itemsWithStockAmt.slice(0, 3).map(d => `${d.name}: ${d.stockAmt}ë°±ë§Œì›`));
        
        // inventoryTableDataByBrandì— ë°ì´í„° ë®ì–´ì“°ê¸° (ë¡œì»¬ ë³€ìˆ˜ + window ì „ì—­ ë³€ìˆ˜)
        if (typeof inventoryTableDataByBrand !== 'undefined') {
          inventoryTableDataByBrand[brandCode] = brandData;
        }
        // window ì „ì—­ ë³€ìˆ˜ì—ë„ í• ë‹¹ (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        if (typeof window !== 'undefined') {
          if (!window.inventoryTableDataByBrand) window.inventoryTableDataByBrand = {};
          window.inventoryTableDataByBrand[brandCode] = brandData;
        }
      }
      
      console.log('âœ… ACC ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë³€í™˜ ì™„ë£Œ:', Object.keys(window.accStockAnalysis));
      console.log('âœ… window.inventoryTableDataByBrand í‚¤:', Object.keys(window.inventoryTableDataByBrand || {}));
    }
    
    // ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    async function updateAnalysisDateInfo() {
      const cyPeriodEl = document.getElementById('cyAnalysisPeriod');
      const pyPeriodEl = document.getElementById('pyAnalysisPeriod');
      const weekCriteriaEl = document.getElementById('weekCriteria');
      
      if (typeof window.brandStockMetadata !== 'undefined') {
        const meta = window.brandStockMetadata;
        
        // ë‚ ì§œ í¬ë§·íŒ… (YYYY-MM-DD í˜•ì‹ ìœ ì§€)
        const formatDate = (dateStr) => {
          if (!dateStr) return '-';
          return dateStr; // YYYY-MM-DD í˜•ì‹ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        };
        
        // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜ (í•´ë‹¹ ë‚ ì§œê°€ ì†í•œ ì—°ë„ì˜ ì£¼ì°¨)
        const getWeekNumber = (dateStr) => {
          if (!dateStr) return null;
          const date = new Date(dateStr);
          const year = date.getFullYear();
          const startDate = new Date(year, 0, 1);
          const days = Math.floor((date - startDate) / (24 * 60 * 60 * 1000));
          const weekNumber = Math.ceil((days + startDate.getDay() + 1) / 7);
          return weekNumber;
        };
        
        // ë¸Œëœë“œë³„ í˜„í™© ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
        const brandCyPeriodEl = document.getElementById('brandCyPeriod');
        const brandPyPeriodEl = document.getElementById('brandPyPeriod');
        
        // Snowflakeì—ì„œ ì‹¤ì œ ì¡°íšŒí•œ ë§¤ì¶œ ëŒ€ìƒ ê¸°ê°„ ê³„ì‚°
        // ì—…ë°ì´íŠ¸ ì¼ì ê¸°ì¤€ìœ¼ë¡œ ì „ì£¼(ì›”~ì¼) ê³„ì‚°
        let cyWeekStart = meta.cyWeekStart;
        let cyWeekEnd = meta.cyWeekEnd;
        let pyWeekStart = meta.pyWeekStart;
        let pyWeekEnd = meta.pyWeekEnd;
        
        // ë‚ ì§œ ê²€ì¦: cyWeekEndê°€ updateDateë³´ë‹¤ í¬ê±°ë‚˜ ê°™ìœ¼ë©´ ì˜ëª»ëœ ë‚ ì§œ
        if (meta.updateDate && cyWeekEnd) {
          const updateDate = new Date(meta.updateDate);
          const weekEnd = new Date(cyWeekEnd);
          if (weekEnd >= updateDate) {
            // ì˜¬ë°”ë¥¸ ë‚ ì§œ ê³„ì‚°: ì—…ë°ì´íŠ¸ì¼ ì „ë‚ ì´ ì£¼ê°„ ì¢…ë£Œì¼, ê·¸ë¡œë¶€í„° 6ì¼ ì „ì´ ì‹œì‘ì¼
            const correctWeekEnd = new Date(updateDate);
            correctWeekEnd.setDate(correctWeekEnd.getDate() - 1); // ì—…ë°ì´íŠ¸ ì „ë‚ 
            const correctWeekStart = new Date(correctWeekEnd);
            correctWeekStart.setDate(correctWeekStart.getDate() - 6); // ì›”ìš”ì¼
            
            cyWeekEnd = correctWeekEnd.toISOString().split('T')[0];
            cyWeekStart = correctWeekStart.toISOString().split('T')[0];
            
            // ì „ë…„ ë™ì£¼ì°¨ ê³„ì‚° (364ì¼ ì „)
            const pyWeekEndDate = new Date(correctWeekEnd);
            pyWeekEndDate.setDate(pyWeekEndDate.getDate() - 364);
            const pyWeekStartDate = new Date(correctWeekStart);
            pyWeekStartDate.setDate(pyWeekStartDate.getDate() - 364);
            
            pyWeekEnd = pyWeekEndDate.toISOString().split('T')[0];
            pyWeekStart = pyWeekStartDate.toISOString().split('T')[0];
          }
        }
        
        if (brandCyPeriodEl && cyWeekStart && cyWeekEnd) {
          brandCyPeriodEl.textContent = `${formatDate(cyWeekStart)} ~ ${formatDate(cyWeekEnd)}`;
        }
        if (brandPyPeriodEl && pyWeekStart && pyWeekEnd) {
          brandPyPeriodEl.textContent = `${formatDate(pyWeekStart)} ~ ${formatDate(pyWeekEnd)}`;
        }
        
        // ì „ì²´í˜„í™© ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ - /api/sales-rate API ë°ì´í„° ì‚¬ìš©
        const overviewUpdateDateEl = document.getElementById('overviewUpdateDate');
        const overviewCyPeriodEl = document.getElementById('overviewCyPeriod');
        const overviewPyPeriodEl = document.getElementById('overviewPyPeriod');
        
        // ì—…ë°ì´íŠ¸ ì¼ì í‘œì‹œ (ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©)
        if (overviewUpdateDateEl) {
          const today = new Date().toISOString().split('T')[0];
          overviewUpdateDateEl.textContent = today;
        }
        
        // /api/sales-rate API í˜¸ì¶œí•˜ì—¬ ë‹¹ë…„/ì „ë…„ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
        try {
          const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
          const response = await fetch(`/api/sales-rate?date=${apiDate}`);
          
          if (response.ok) {
            const result = await response.json();
            
            if (result.success && result.data) {
              const curSample = result.data.CUR?.[0];
              const pySample = result.data.PY?.[0];
              
              const curDate = curSample?.ASOF_DT || '-';
              const pyDate = pySample?.ASOF_DT || '-';
              
              // APIì—ì„œ ê°€ì ¸ì˜¨ ë‚ ì§œë¡œ í‘œì‹œ
              if (overviewCyPeriodEl) {
                overviewCyPeriodEl.textContent = curDate;
              }
              if (overviewPyPeriodEl) {
                overviewPyPeriodEl.textContent = pyDate;
              }
              
              console.log('âœ… ì „ì²´í˜„í™© ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ (API ì‚¬ìš©):', {
                ì „ì²´í˜„í™©_ì—…ë°ì´íŠ¸ì¼ì: overviewUpdateDateEl?.textContent,
                ì „ì²´í˜„í™©_ë‹¹ë…„ëˆ„ì : curDate,
                ì „ì²´í˜„í™©_ì „ë…„ëˆ„ì : pyDate
              });
            } else {
              // API ì‹¤íŒ¨ ì‹œ í´ë°±: metadata ì‚¬ìš©
              if (overviewCyPeriodEl && cyWeekEnd) {
                overviewCyPeriodEl.textContent = formatDate(cyWeekEnd);
              }
              if (overviewPyPeriodEl && pyWeekEnd) {
                overviewPyPeriodEl.textContent = formatDate(pyWeekEnd);
              }
            }
          }
        } catch (error) {
          console.warn('âš ï¸ /api/sales-rate í˜¸ì¶œ ì‹¤íŒ¨, metadata ì‚¬ìš©:', error);
          // API ì‹¤íŒ¨ ì‹œ í´ë°±: metadata ì‚¬ìš©
          if (overviewCyPeriodEl && cyWeekEnd) {
            overviewCyPeriodEl.textContent = formatDate(cyWeekEnd);
          }
          if (overviewPyPeriodEl && pyWeekEnd) {
            overviewPyPeriodEl.textContent = formatDate(pyWeekEnd);
          }
        }
        
        // ê¸°ì¡´ analysisDateInfoë„ ì—…ë°ì´íŠ¸ (í•˜ìœ„ í˜¸í™˜ì„±)
        if (cyPeriodEl && meta.cyWeekStart && meta.cyWeekEnd) {
          cyPeriodEl.textContent = `${formatDate(meta.cyWeekStart)} ~ ${formatDate(meta.cyWeekEnd)}`;
        }
        if (pyPeriodEl && meta.pyWeekStart && meta.pyWeekEnd) {
          pyPeriodEl.textContent = `${formatDate(meta.pyWeekStart)} ~ ${formatDate(meta.pyWeekEnd)}`;
        }
        
        // ì£¼ì°¨ ê¸°ì¤€ í‘œì‹œ
        if (weekCriteriaEl && meta.cyWeekStart) {
          const weekNum = getWeekNumber(meta.cyWeekStart);
          const year = new Date(meta.cyWeekStart).getFullYear();
          if (weekNum) {
            weekCriteriaEl.textContent = `${year}ë…„ ${weekNum}ì£¼ì°¨ (${formatDate(meta.cyWeekStart)} ê¸°ì¤€)`;
          } else {
            weekCriteriaEl.textContent = `${formatDate(meta.cyWeekStart)} ê¸°ì¤€`;
          }
        }
        
        console.log('âœ… ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
          ë¸Œëœë“œë³„_ë‹¹ë…„: `${meta.cyWeekStart} ~ ${meta.cyWeekEnd}`,
          ë¸Œëœë“œë³„_ì „ë…„: `${meta.pyWeekStart} ~ ${meta.pyWeekEnd}`,
          ì£¼ì°¨ê¸°ì¤€: weekCriteriaEl ? weekCriteriaEl.textContent : '-'
        });
      } else {
        console.warn('âš ï¸ brandStockMetadataê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ë¶„ì„ ê¸°ê°„ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        if (weekCriteriaEl) {
          weekCriteriaEl.textContent = '-';
        }
      }
    }
    
    // -------- ì´ˆê¸°í™” --------
    // ë°ì´í„° ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦° í›„ ì´ˆê¸°í™” ì‹¤í–‰
    const initializeDashboard = () => {
      window.__DASHBOARD_INITIALIZED__ = true;
      console.log('[Dashboard] ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
      
      // JS íŒŒì¼ ë°ì´í„° ë³€í™˜ (í•˜ë“œì½”ë”© ë°ì´í„° ëŒ€ì²´)
      console.log('ğŸ” [ë””ë²„ê·¸] JS íŒŒì¼ ë°ì´í„° ë¡œë“œ ìƒíƒœ:');
      console.log('   - window.clothingBrandStatus:', typeof window.clothingBrandStatus !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
      console.log('   - window.accStockAnalysis:', typeof window.accStockAnalysis !== 'undefined' ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
      
      if (typeof window.clothingBrandStatus !== 'undefined') {
        console.log('   - ì˜ë¥˜ ë¸Œëœë“œ ì½”ë“œ:', Object.keys(window.clothingBrandStatus));
      }
      if (typeof window.accStockAnalysis !== 'undefined') {
        console.log('   - ACC ë¸Œëœë“œ ì½”ë“œ:', Object.keys(window.accStockAnalysis));
      }
      
      convertClothingDataToTableFormat();
      convertAccDataToInventoryFormat();
      
      // ë¶„ì„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
      updateAnalysisDateInfo();
      
      // ë°ì´í„° ë³€í™˜ í›„ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      if (typeof renderItemDiffTable === 'function') {
        renderItemDiffTable();
      }
      
      console.log('[Dashboard] renderInsights í˜¸ì¶œ ì „ ë°ì´í„° í™•ì¸:');
      console.log('  - window.insightsData:', !!window.insightsData);
      console.log('  - window.insightsData.overview:', window.insightsData?.overview);
      console.log('  - window.overviewKPI:', !!window.overviewKPI);
      renderInsights();
      // realDataë¥¼ ë¨¼ì € ì´ˆê¸°í™”í•˜ê¸° ìœ„í•´ initWeeklyTrendChartë¥¼ ë¨¼ì € í˜¸ì¶œ
      initWeeklyTrendChart();
      
      // window.overviewPL ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸ í›„ initOverviewCharts í˜¸ì¶œ
      if (window.overviewPL) {
        console.log('[Dashboard] window.overviewPL ë°ì´í„° í™•ì¸ë¨, initOverviewCharts ì¦‰ì‹œ í˜¸ì¶œ');
        initOverviewCharts();
      } else {
        // ë°ì´í„°ê°€ ì•„ì§ ì—†ìœ¼ë©´ ì§§ì€ ëŒ€ê¸° í›„ ì¬í™•ì¸ (ìµœëŒ€ 1ì´ˆ)
        const waitForOverviewData = (retryCount = 0) => {
          if (window.overviewPL) {
            console.log('[Dashboard] window.overviewPL ë°ì´í„° í™•ì¸ë¨, initOverviewCharts í˜¸ì¶œ');
            initOverviewCharts();
          } else if (retryCount < 10) {
            console.log(`[Dashboard] window.overviewPL ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
            setTimeout(() => waitForOverviewData(retryCount + 1), 100);
          } else {
            console.warn('[Dashboard] window.overviewPL ë°ì´í„° ë¡œë“œ íƒ€ì„ì•„ì›ƒ, ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì´ˆê¸°í™”');
            initOverviewCharts();
          }
        };
        waitForOverviewData();
      }
      
      // ì´ˆê¸° ë¡œë“œ í›„ í¸ì§‘ ë‚´ìš© ì ìš© ë° ì›ë³¸ ë°ì´í„° ì €ì¥
      loadEdits();
      // loadEdits í›„ overview KPI í¬ë§·íŒ… ì¬ì ìš© (ì²œë‹¨ìœ„ ì½¤ë§ˆ)
      // JSON ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ì— ì‹¤í–‰ë˜ë„ë¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      if (window.__DATA_LOADED__) {
        applyOverviewKPIFormatting();
      } else {
        window.addEventListener('jsonDataLoaded', () => {
          applyOverviewKPIFormatting();
        }, { once: true });
      }
      saveOriginalData();
      
      // localStorageì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™” (ìµœì´ˆ 1íšŒë§Œ)
      // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
      const dateStr = window.__DATA_DATE__ || '';
      const storageKey = dateStr ? `dashboard_edits_${dateStr}` : 'dashboard_edits';
      const hasOldFormat = localStorage.getItem(storageKey);
      if (hasOldFormat) {
        try {
          const edits = JSON.parse(hasOldFormat);
          // overview ê´€ë ¨ í‚¤ ì¤‘ ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
          const overviewKeys = Object.keys(edits).filter(key => 
            key.includes('overview-revenue') || 
            key.includes('overview-profit') || 
            key.includes('overview-opprofit')
          );
          const needsCleanup = overviewKeys.some(key => {
            const value = edits[key];
            return value && typeof value === 'string' && 
                   value.includes('ì–µì›') && 
                   !value.includes(',') && 
                   parseFloat(value.replace('ì–µì›', '').trim()) >= 1000;
          });
          
          if (needsCleanup) {
            console.log('âš ï¸ localStorageì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ì—†ëŠ” ê°’ ë°œê²¬, ìë™ ì´ˆê¸°í™” ì¤‘...');
            clearAllLocalStorage();
            return; // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ë˜ë¯€ë¡œ ì—¬ê¸°ì„œ ì¢…ë£Œ
          }
        } catch (e) {
          console.warn('localStorage í™•ì¸ ì¤‘ ì˜¤ë¥˜:', e);
        }
      }
      
      // â˜… ë¸Œëœë“œë³„ í˜„í™© ë°ì´í„°ë„ ì´ˆê¸°í™” â˜…
      // window.brandKPIë¡œ brandData ë¨¼ì € ì—…ë°ì´íŠ¸, ê·¸ ë‹¤ìŒ updateBrandView í˜¸ì¶œ
      const waitForBrandData = (retryCount = 0) => {
        const hasBrandKPI = window.brandKPI && Object.keys(window.brandKPI).length > 0;
        const hasBrandPLData = window.brandPLData && Object.keys(window.brandPLData).length > 0;
        
        if (hasBrandKPI || hasBrandPLData) {
          console.log('[Dashboard] ë¸Œëœë“œ ë°ì´í„° í™•ì¸ë¨');
          console.log('[Dashboard] brandKPI keys:', Object.keys(window.brandKPI || {}));
          console.log('[Dashboard] brandPLData keys:', Object.keys(window.brandPLData || {}));
          
          // â˜…â˜…â˜… í•µì‹¬: brandKPI â†’ brandData ë§¤í•‘ ë¨¼ì € ìˆ˜í–‰ â˜…â˜…â˜…
          if (hasBrandKPI && typeof window.updateBrandDataFromKPI === 'function') {
            console.log('[Dashboard] âœ“ updateBrandDataFromKPI í˜¸ì¶œ');
            window.updateBrandDataFromKPI();
          }
          
          // brandPLData ë¡œì»¬ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
          if (hasBrandPLData) {
            brandPLData = window.brandPLData;
          }
          
          // ê·¸ ë‹¤ìŒ updateBrandView í˜¸ì¶œ
          if (typeof updateBrandView === 'function') {
            console.log('[Dashboard] âœ“ updateBrandView í˜¸ì¶œ');
            updateBrandView();
          }
          if (typeof updateBrandPL === 'function') {
            updateBrandPL();
          }
        } else if (retryCount < 10) {
          console.log(`[Dashboard] ë¸Œëœë“œ ë°ì´í„° ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
          setTimeout(() => waitForBrandData(retryCount + 1), 100);
        } else {
          console.warn('[Dashboard] ë¸Œëœë“œ ë°ì´í„° ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
          if (typeof updateBrandView === 'function') {
            updateBrandView();
          }
        }
      };
      waitForBrandData();
    };
    
    // â˜…â˜…â˜… JSON ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™” â˜…â˜…â˜…
    window.addEventListener('jsonDataLoaded', () => {
      console.log('[Dashboard] â˜… jsonDataLoaded ì´ë²¤íŠ¸ ìˆ˜ì‹  - ì´ˆê¸°í™” ì‹œì‘ â˜…');
      console.log('[Dashboard] overviewPL:', !!window.overviewPL);
      console.log('[Dashboard] by_brand:', !!window.by_brand);
      console.log('[Dashboard] brandPLData:', Object.keys(window.brandPLData || {}));
      console.log('[Dashboard] brandKPI:', Object.keys(window.brandKPI || {}));
      
      // â˜… stock_analysis.json ë°ì´í„° ë³€í™˜ ë° ì°¨íŠ¸ ì´ˆê¸°í™” â˜…
      if (typeof window.clothingBrandStatus !== 'undefined' || typeof window.accStockAnalysis !== 'undefined') {
        console.log('[Dashboard] stock_analysis ë°ì´í„° ë°œê²¬, ë³€í™˜ í•¨ìˆ˜ í˜¸ì¶œ');
        if (typeof convertClothingDataToTableFormat === 'function') {
          convertClothingDataToTableFormat();
        }
        if (typeof convertAccDataToInventoryFormat === 'function') {
          convertAccDataToInventoryFormat();
        }
        
        // íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ë Œë”ë§
        setTimeout(() => {
          if (typeof renderItemDiffTable === 'function') {
            console.log('[Dashboard] íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ë Œë”ë§');
            renderItemDiffTable();
          }
        }, 200);
        
        // ë²„ë¸” ì°¨íŠ¸ ì¬ì´ˆê¸°í™”
        setTimeout(() => {
          if (typeof initOverviewBubbleChart === 'function') {
            console.log('[Dashboard] ë²„ë¸” ì°¨íŠ¸ ì¬ì´ˆê¸°í™”');
            initOverviewBubbleChart();
          }
        }, 100);
        
        // íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ ë·° ì—…ë°ì´íŠ¸ (ë°ì´í„° ë¡œë“œ í›„ ê·¸ë˜í”„ í‘œì‹œ)
        setTimeout(() => {
          if (typeof updateOverviewModeView === 'function') {
            console.log('[Dashboard] íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ ëª¨ë“œ ë·° ì—…ë°ì´íŠ¸');
            updateOverviewModeView();
          }
        }, 300);
      }
      
      // â˜… ë¡œì»¬ brandPLData ë³€ìˆ˜ë¥¼ window.brandPLDataë¡œ ì—…ë°ì´íŠ¸
      if (window.brandPLData && Object.keys(window.brandPLData).length > 0) {
        brandPLData = window.brandPLData;
        console.log('[Dashboard] âœ… brandPLData ì—…ë°ì´íŠ¸ ì™„ë£Œ:', Object.keys(brandPLData));
      }
      
      // â˜…â˜…â˜… brandKPI â†’ brandData ë§¤í•‘ (ì¸ë¼ì¸ ì‹¤í–‰) â˜…â˜…â˜…
      if (window.brandKPI && Object.keys(window.brandKPI).length > 0) {
        console.log('[Dashboard] â˜… brandKPI â†’ brandData ë§¤í•‘ ì‹œì‘');
        if (!window.brandData) window.brandData = {};
        
        const brandNames = ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'];
        const brandCodeMap = { 'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X', 'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W' };
        
        brandNames.forEach(brandName => {
          const kpi = window.brandKPI[brandName] || window.brandKPI[brandCodeMap[brandName]];
          if (kpi) {
            if (!window.brandData[brandName]) {
              window.brandData[brandName] = {
                current: { revenue: {}, profit: {}, margin: {}, progress: {} },
                revenue: {}, profit: {}, opProfit: {}
              };
            }
            // ì‹¤íŒë§¤ì¶œ
            window.brandData[brandName].current.revenue.value = kpi.revenue / 100000000;
            window.brandData[brandName].current.revenue.discountRate = kpi.discountRate || 0;
            window.brandData[brandName].revenue.forecast = kpi.revenueForecast / 100000000;
            window.brandData[brandName].revenue.discountRate = kpi.discountRateForecast || kpi.discountRate || 0;
            window.brandData[brandName].revenue.achievement = kpi.progressRateForecast || kpi.progressRate || 0;
            // ì§ì ‘ì´ìµ
            window.brandData[brandName].current.profit.value = kpi.directProfit / 100000000;
            window.brandData[brandName].current.margin.value = kpi.directProfitRate || 0;
            window.brandData[brandName].profit.forecast = kpi.directProfitForecast / 100000000;
            window.brandData[brandName].profit.marginForecast = kpi.directProfitRateForecast || kpi.directProfitRate || 0;
            window.brandData[brandName].profit.achievement = kpi.progressRateForecast || kpi.progressRate || 0;
            // â˜… ì˜ì—…ì´ìµ (brand_kpi.json ë°ì´í„° ê¸°ë°˜ ê³„ì‚°) â˜…
            const opProfitForecast = (kpi.operatingProfitForecast || 0) / 100000000;
            const opProfitPrevious = (kpi.operatingProfitPrevious || 0) / 100000000;
            window.brandData[brandName].opProfit = {
              current: (kpi.operatingProfit || 0) / 100000000,
              forecast: opProfitForecast,
              rate: kpi.operatingProfitRate || 0,
              rateForecast: kpi.operatingProfitRateForecast || 0,
              previous: opProfitPrevious,
              // â˜… JSON ë°ì´í„° ê¸°ë°˜ ê³„ì‚°: ì˜ì—…ì´ìµ ì „ë…„ëŒ€ë¹„ = (ì›”ë§ì˜ˆìƒ - ì „ë…„) / ì „ë…„ * 100
              vsPrevious: opProfitPrevious !== 0 ? ((opProfitForecast - opProfitPrevious) / Math.abs(opProfitPrevious) * 100) : 0,
              // â˜… JSON ë°ì´í„° ê¸°ë°˜: ì˜ì—…ì´ìµ ëª©í‘œëŒ€ë¹„ëŠ” ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„ ì‚¬ìš© (JSONì— operatingProfitVsPlan ì—†ìŒ)
              vsPlan: kpi.profitVsPlan || 0
            };
            // ì§„ì²™ìœ¨
            window.brandData[brandName].current.progress.value = kpi.progressRate || 0;
            
            // â˜…â˜…â˜… ëª©í‘œëŒ€ë¹„/ì „ë…„ëŒ€ë¹„ (brand_kpi.jsonì—ì„œ ì§ì ‘ ì‚¬ìš©) â˜…â˜…â˜…
            window.brandData[brandName].revenue.vsPlan = kpi.revenueVsPlan || 0;        // ë§¤ì¶œ ëª©í‘œëŒ€ë¹„
            window.brandData[brandName].revenue.vsPrevious = kpi.revenueVsPrevious || 0; // ë§¤ì¶œ ì „ë…„ëŒ€ë¹„
            window.brandData[brandName].profit.vsPlan = kpi.profitVsPlan || 0;          // ì§ì ‘ì´ìµ ëª©í‘œëŒ€ë¹„
            window.brandData[brandName].profit.vsPrevious = kpi.profitVsPrevious || 0;  // ì§ì ‘ì´ìµ ì „ë…„ëŒ€ë¹„
            
            console.log(`[Dashboard] âœ… ${brandName} ë°ì´í„° ë§¤í•‘ ì™„ë£Œ:`, window.brandData[brandName].current.revenue.value, 'ì–µì›');
          }
        });
      }
      
      // â˜…â˜…â˜… ì±„ë„ë³„ ì†ìµ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (channel_profit_loss.json ë°ì´í„° ì‚¬ìš©) â˜…â˜…â˜…
      if (window.channelProfitLossData && typeof updateBrandChannels === 'function') {
        console.log('[Dashboard] âœ“ channelProfitLossData í™•ì¸ë¨, updateBrandChannels í˜¸ì¶œ');
        console.log('[Dashboard] ì±„ë„ ë¸Œëœë“œ:', Object.keys(window.channelProfitLossData.channelRevenueData || {}));
        updateBrandChannels();
      } else {
        console.warn('[Dashboard] channelProfitLossData ì—†ìŒ, ëŒ€ê¸° í›„ ì¬ì‹œë„');
        // ë°ì´í„° ë¡œë“œ ëŒ€ê¸° í›„ ì¬ì‹œë„
        const waitForChannelProfitLoss = (retryCount = 0) => {
          if (window.channelProfitLossData) {
            console.log('[Dashboard] âœ“ channelProfitLossData ë¡œë“œ ì™„ë£Œ, updateBrandChannels í˜¸ì¶œ');
            if (typeof updateBrandChannels === 'function') updateBrandChannels();
          } else if (retryCount < 10) {
            setTimeout(() => waitForChannelProfitLoss(retryCount + 1), 200);
          }
        };
        waitForChannelProfitLoss();
      }
      
      // â˜…â˜…â˜… ì „ì²´ ì†ìµê³„ì‚°ì„œ ì—…ë°ì´íŠ¸ (í•¨ìˆ˜ê°€ ì •ì˜ëœ í›„ í˜¸ì¶œ) â˜…â˜…â˜…
      if (window.overviewPL) {
        console.log('[Dashboard] âœ… overviewPL ë°ì´í„° í™•ì¸, updateOverviewPL í˜¸ì¶œ ì‹œë„');
        const tryUpdateOverviewPL = (retryCount = 0) => {
          if (typeof updateOverviewPL === 'function') {
            console.log('[Dashboard] âœ… updateOverviewPL í•¨ìˆ˜ ë°œê²¬, í˜¸ì¶œ');
            updateOverviewPL();
          } else if (retryCount < 10) {
            console.log(`[Dashboard] updateOverviewPL í•¨ìˆ˜ ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
            setTimeout(() => tryUpdateOverviewPL(retryCount + 1), 100);
          } else {
            console.warn('[Dashboard] âš ï¸ updateOverviewPL í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          }
        };
        tryUpdateOverviewPL();
      } else {
        console.warn('[Dashboard] âš ï¸ window.overviewPL ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
      }
      
      // ë°ì´í„° í™•ì¸ í›„ ì´ˆê¸°í™”
      const hasData = window.overviewPL || window.by_brand || window.brandPLData || window.brandKPI;
      if (hasData) {
        console.log('[Dashboard] âœ… JSON ë°ì´í„° í™•ì¸ë¨, ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”');
        initializeDashboard();
      } else {
        console.warn('[Dashboard] âš ï¸ ë°ì´í„°ê°€ ì—†ìŒ, ê·¸ë˜ë„ ì´ˆê¸°í™” ì‹œë„');
        initializeDashboard();
      }
    }, { once: true });
    
    // â˜…â˜…â˜… ì´ë¯¸ ë°ì´í„°ê°€ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì´ˆê¸°í™” â˜…â˜…â˜…
    setTimeout(() => {
      if (window.__DATA_LOADED__ && !window.__DASHBOARD_INITIALIZED__) {
        console.log('[Dashboard] ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë¨, ì¦‰ì‹œ ì´ˆê¸°í™” ì‹¤í–‰');
        // jsonDataLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì˜ ë¡œì§ì„ ìˆ˜ë™ ì‹¤í–‰
        if (window.overviewPL) {
          const tryUpdateOverviewPL = (retryCount = 0) => {
            if (typeof updateOverviewPL === 'function') {
              console.log('[Dashboard] âœ… updateOverviewPL í•¨ìˆ˜ ë°œê²¬, í˜¸ì¶œ');
              updateOverviewPL();
            } else if (retryCount < 10) {
              console.log(`[Dashboard] updateOverviewPL í•¨ìˆ˜ ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
              setTimeout(() => tryUpdateOverviewPL(retryCount + 1), 100);
            } else {
              console.warn('[Dashboard] âš ï¸ updateOverviewPL í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
          };
          tryUpdateOverviewPL();
        }
        initializeDashboard();
      }
    }, 100);
    
    // í´ë°±: 5ì´ˆ í›„ì—ë„ ì´ë²¤íŠ¸ê°€ ì•ˆ ì˜¤ë©´ ê°•ì œ ì´ˆê¸°í™”
    setTimeout(() => {
      if (!window.__DASHBOARD_INITIALIZED__) {
        console.warn('[Dashboard] íƒ€ì„ì•„ì›ƒ: ê°•ì œ ì´ˆê¸°í™”');
        initializeDashboard();
      }
    }, 5000);

    // -------- ê°œìš” ì„¹ì…˜: ì£¼ì°¨ë³„/ëˆ„ì  í† ê¸€ ë³´ì¥ --------
    function ensureOverviewToggleUI(){
      try{
        const container = document.getElementById('cumulativeTrendChart')?.parentElement;
        if(!container) return;
        let btnWrap = container.previousElementSibling;
        const needBuild = !(btnWrap && btnWrap.querySelector('#overviewModeBtnWeekly'));
        if(needBuild){
          btnWrap = document.createElement('div');
          btnWrap.style.cssText = 'display:flex;justify-content:flex-end;margin:4px 0 8px 0;gap:6px;';
          const btnW = document.createElement('button');
          btnW.id='overviewModeBtnWeekly';
          btnW.textContent='ì£¼ì°¨ë³„';
          btnW.style.cssText='background:#e5e7eb;color:#374151;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;';
          const btnC = document.createElement('button');
          btnC.id='overviewModeBtnCumulative';
          btnC.textContent='ëˆ„ì ';
          btnC.style.cssText='background:#2563eb;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;';
          btnWrap.appendChild(btnW); btnWrap.appendChild(btnC);
          container.parentElement.insertBefore(btnWrap, container);
        }
        if(!window.overviewMode) window.overviewMode='weekly';
        const btnWeekly = document.getElementById('overviewModeBtnWeekly');
        const btnCum = document.getElementById('overviewModeBtnCumulative');
        const applyActive=()=>{
          if(window.overviewMode==='weekly'){
            btnWeekly.style.background='#2563eb'; btnWeekly.style.color='#fff';
            btnCum.style.background='#e5e7eb'; btnCum.style.color='#374151';
          }else{
            btnCum.style.background='#2563eb'; btnCum.style.color='#fff';
            btnWeekly.style.background='#e5e7eb'; btnWeekly.style.color='#374151';
          }
        };
        if(btnWeekly && !btnWeekly.hasAttribute('data-listener')){
          btnWeekly.setAttribute('data-listener','true');
          btnWeekly.addEventListener('click',()=>{ window.overviewMode='weekly'; applyActive(); renderOverviewTrendByMode(); });
        }
        if(btnCum && !btnCum.hasAttribute('data-listener')){
          btnCum.setAttribute('data-listener','true');
          btnCum.addEventListener('click',()=>{ window.overviewMode='cumulative'; applyActive(); renderOverviewTrendByMode(); });
        }
        applyActive();
        // ê¸°ë³¸ ëª¨ë“œ(ì£¼ì°¨ë³„) ë°˜ì˜í•˜ì—¬ ì¦‰ì‹œ ë Œë” ê°±ì‹ 
        renderOverviewTrendByMode();
      }catch(e){ console.warn('ensureOverviewToggleUI failed', e); }
    }

    function renderOverviewTrendByMode(){
      try{
        if(charts.cumulativeTrend){ charts.cumulativeTrend.destroy(); charts.cumulativeTrend=null; }
        const ctx = document.getElementById('cumulativeTrendChart');
        if(!ctx) return;
        
        // window.cumulativeTrendData ì‚¬ìš© - ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ í‘œì‹œí•˜ì§€ ì•ŠìŒ
        if (!window.cumulativeTrendData || !window.cumulativeTrendData.weeks) {
          console.warn('[Dashboard] window.cumulativeTrendData ë°ì´í„°ê°€ ì—†ì–´ ì°¨íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }
        
        const trendData = window.cumulativeTrendData;
        const labels = trendData.weeks;
        const weeklyCurrent = trendData.weekly_current;
        const weeklyPrev = trendData.weekly_prev;
        const cumulativeCurrent = trendData.cumulative_current;
        const cumulativePrev = trendData.cumulative_prev;
        
        if(window.overviewMode==='weekly'){
          // ì£¼ì°¨ë³„ ëª¨ë“œ
          const dataWeekly = { labels, datasets:[
            { label:'ì£¼ì°¨ë³„ ë§¤ì¶œ', data: weeklyCurrent, type:'bar', backgroundColor:'rgba(79,70,229,0.8)', borderColor:'rgba(79,70,229,1)', borderWidth:1 },
            { label:'ì „ë…„ ë§¤ì¶œ', data: weeklyPrev, type:'line', borderColor:'rgba(16,185,129,1)', backgroundColor:'rgba(16,185,129,0.1)', borderWidth:2, tension:0.4, fill:false, pointRadius:3 }
          ]};
          charts.cumulativeTrend = new Chart(ctx.getContext('2d'), { type:'bar', data:dataWeekly, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'top', labels:{ font:{ size:10 } } }, tooltip:{ callbacks:{ label: function(context) { const label = context.dataset.label || ''; const value = context.parsed.y; if (value === null) return ''; return `${label}: ${(value / 100).toFixed(1)}ì–µì›`; } } } }, scales:{ y:{ beginAtZero:true, title:{ display:true, text:'ë§¤ì¶œ (ë°±ë§Œì›)', font:{ size:10 } }, ticks:{ font:{ size:9 } } }, x:{ ticks:{ font:{ size:9 } } } } } });
        }else{
          // ëˆ„ì  ëª¨ë“œ
          charts.cumulativeTrend = new Chart(ctx.getContext('2d'),{
            type:'line',
            data:{ labels, datasets:[
              { label:'ë‹¹ë…„ ëˆ„ì ', data: cumulativeCurrent, borderColor:'rgba(124,58,237,1)', backgroundColor:'rgba(124,58,237,0.1)', borderWidth:3, fill:false, tension:0.3, pointRadius:5, pointHoverRadius:7, spanGaps:false },
              { label:'ì „ë…„ ëˆ„ì ', data: cumulativePrev, borderColor:'rgba(220,38,38,1)', backgroundColor:'rgba(220,38,38,0.1)', borderWidth:2.5, fill:false, tension:0.3, pointRadius:4, pointHoverRadius:6 }
            ] },
            options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'top', labels:{ font:{ size:10 } } }, tooltip:{ callbacks:{ label: function(context) { const label = context.dataset.label || ''; const value = context.parsed.y; if (value === null) return ''; return `${label}: ${(value / 100).toFixed(1)}ì–µì›`; } } } }, scales:{ y:{ type:'linear', display:true, position:'left', title:{ display:true, text:'ëˆ„ì  ë§¤ì¶œ (ë°±ë§Œì›)', font:{ size:11 } }, ticks:{ font:{ size:10 } }, beginAtZero:true }, x:{ ticks:{ font:{ size:10 } } } } }
          });
        }
      }catch(e){ console.error('renderOverviewTrendByMode failed', e); }
    }

    // -------- ì •ì  HTML ë‚´ë³´ë‚´ê¸° (í˜„ì¬ í™”ë©´ ìƒíƒœ ê·¸ëŒ€ë¡œ í•˜ë“œì½”ë”©) --------
    function exportStaticHTML(){
      try{
        // 1. í˜„ì¬ ì°¨íŠ¸ ë°ì´í„° ì¶”ì¶œ (ê¸°ëŠ¥ ìœ ì§€ë¥¼ ìœ„í•´ ë°ì´í„°ë§Œ í•˜ë“œì½”ë”©)
        const exportedChartData = {};
        
        // ë¸Œëœë“œë³„ ë§¤ì¶œ ì°¨íŠ¸ ë°ì´í„° ì¶”ì¶œ
        let hardcodedBrandLabels = ['MLB','MLB KIDS','DISCOVERY','DUVETICA','SERGIO','SUPRA'];
        let hardcodedBrandSales = [236.9,78.9,42.1,28.7,31.2,16.8];
        let hardcodedBrandProfit = [16.6,11.8,4.8,3.9,4.2,1.8];
        
        if (charts.brandRevenue && charts.brandRevenue.data) {
          exportedChartData.brandRevenue = {
            labels: [...(charts.brandRevenue.data.labels || [])],
            datasets: charts.brandRevenue.data.datasets.map(ds => ({
              label: ds.label || '',
              data: [...(ds.data || [])],
              backgroundColor: ds.backgroundColor,
              borderColor: ds.borderColor,
              borderWidth: ds.borderWidth,
              yAxisID: ds.yAxisID
            }))
          };
          // í•˜ë“œì½”ë”© ê°’ ì—…ë°ì´íŠ¸
          if (exportedChartData.brandRevenue.labels.length > 0) {
            hardcodedBrandLabels = [...exportedChartData.brandRevenue.labels];
          }
          exportedChartData.brandRevenue.datasets.forEach((ds, idx) => {
            if (ds.label && ds.label.includes('ë§¤ì¶œ') && ds.data.length > 0) {
              hardcodedBrandSales = [...ds.data];
            }
            if (ds.label && ds.label.includes('ì´ìµ') && ds.data.length > 0) {
              hardcodedBrandProfit = [...ds.data];
            }
          });
        }
        
        // ë¸Œëœë“œë³„ ê¸°ì—¬ë„ ì°¨íŠ¸
        if (charts.brandContribution && charts.brandContribution.data) {
          exportedChartData.brandContribution = {
            labels: [...(charts.brandContribution.data.labels || [])],
            datasets: charts.brandContribution.data.datasets.map(ds => ({
              label: ds.label || '',
              data: [...(ds.data || [])],
              backgroundColor: Array.isArray(ds.backgroundColor) ? [...ds.backgroundColor] : ds.backgroundColor,
              borderColor: Array.isArray(ds.borderColor) ? [...ds.borderColor] : ds.borderColor,
              borderWidth: ds.borderWidth
            }))
          };
        }
        
        // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸
        let hardcodedWeeklyLabels = ['1ì£¼ì°¨','2ì£¼ì°¨','3ì£¼ì°¨','4ì£¼ì°¨','5ì£¼ì°¨'];
        let hardcodedWeeklyData = {};
        
        if (charts.weeklyTrend && charts.weeklyTrend.data) {
          exportedChartData.weeklyTrend = {
            labels: [...(charts.weeklyTrend.data.labels || [])],
            datasets: charts.weeklyTrend.data.datasets.map(ds => ({
              label: ds.label || '',
              data: [...(ds.data || [])],
              type: ds.type,
              backgroundColor: ds.backgroundColor,
              borderColor: ds.borderColor,
              borderWidth: ds.borderWidth,
              tension: ds.tension,
              fill: ds.fill,
              pointRadius: ds.pointRadius,
              borderDash: ds.borderDash
            }))
          };
          if (exportedChartData.weeklyTrend.labels.length > 0) {
            hardcodedWeeklyLabels = [...exportedChartData.weeklyTrend.labels];
          }
          exportedChartData.weeklyTrend.datasets.forEach(ds => {
            hardcodedWeeklyData[ds.label] = [...ds.data];
          });
        }
        
        // ë¼ì´ë‹¤ ì°¨íŠ¸
        let hardcodedRadarData = {};
        if (charts.radar && charts.radar.data) {
          exportedChartData.radar = {
            labels: [...(charts.radar.data.labels || [])],
            datasets: charts.radar.data.datasets.map(ds => ({
              label: ds.label || '',
              data: [...(ds.data || [])],
              borderColor: ds.borderColor,
              backgroundColor: ds.backgroundColor,
              borderWidth: ds.borderWidth,
              pointRadius: ds.pointRadius
            }))
          };
          exportedChartData.radar.datasets.forEach(ds => {
            hardcodedRadarData[ds.label] = {
              labels: [...exportedChartData.radar.labels],
              data: [...ds.data]
            };
          });
        }
        
        // 2. í˜„ì¬ í™”ë©´ì˜ ëª¨ë“  í…ìŠ¤íŠ¸/ìˆ«ì ê°’ ì¶”ì¶œ
        const currentTextValues = {};
        document.querySelectorAll('.editable').forEach((el) => {
          const key = getElementKey(el);
          const isTableCell = el.tagName === 'TD' || el.closest('table');
          const content = isTableCell ? el.textContent.trim() : el.innerHTML.trim();
          currentTextValues[key] = content;
        });
        
        // 3. í˜„ì¬ KPI ê°’ ì¶”ì¶œ
        const currentKPIValues = {};
        ['overview-current-revenue', 'overview-current-profit', 'overview-current-margin'].forEach(id => {
          const el = document.getElementById(id);
          if (el) currentKPIValues[id] = el.textContent.trim();
        });
        
        // 4. í˜„ì¬ ë¸Œëœë“œë³„ KPI ê°’ ì¶”ì¶œ
        const currentBrandKPIValues = {};
        ['brand-current-revenue', 'brand-current-profit', 'brand-current-margin'].forEach(id => {
          const el = document.getElementById(id);
          if (el) currentBrandKPIValues[id] = el.textContent.trim();
        });
        
        // 5. í˜„ì¬ ëª¨ë“œ ìƒíƒœ ì¶”ì¶œ
        const currentModes = {
          overviewMode: window.overviewMode || 'weekly',
          weeklyMode: weeklyMode || 'weekly',
          radarChartType: window.radarChartType || 'channel',
          treemapCurrentType: typeof treemapCurrentType !== 'undefined' ? treemapCurrentType : 'channel'
        };
        
        // 6. ì €ì¥ëœ í¸ì§‘ ë‚´ìš© ìˆ˜ì§‘
        const savedEdits = localStorage.getItem('dashboard_edits');
        // â˜…â˜…â˜… ë‚ ì§œë³„ë¡œ localStorage í‚¤ ë¶„ë¦¬ â˜…â˜…â˜…
        const dateStr = window.__DATA_DATE__ || '';
        const aiSummaryKey = dateStr ? `ai-summary-edits_${dateStr}` : 'ai-summary-edits';
        const savedAISummaryEdits = localStorage.getItem(aiSummaryKey);
        const savedAIPartEdits = {};
        ['MLB', 'MLB_KIDS', 'DISCOVERY', 'DUVETICA', 'SERGIO', 'SUPRA'].forEach(brand => {
          const aiPartKey = dateStr ? `ai-part-edits-${brand}_${dateStr}` : `ai-part-edits-${brand}`;
          const edits = localStorage.getItem(aiPartKey);
          if (edits) savedAIPartEdits[brand] = JSON.parse(edits);
        });
        
        // 7. DOM ë³µì œ
        const clone = document.documentElement.cloneNode(true);
        
        // 7-1. body ìŠ¤íƒ€ì¼ ìˆ˜ì •: ê°€ë¡œ ìŠ¤í¬ë¡¤ ì œê±° (ë ˆì´ì•„ì›ƒ ìœ ì§€)
        const body = clone.querySelector('body');
        if (body) {
          body.style.overflowX = 'hidden';
        }
        
        // 8. í¸ì§‘ëœ ë‚´ìš© ì ìš©
        if (savedEdits) {
          const edits = JSON.parse(savedEdits);
          const editables = clone.querySelectorAll('.editable');
          editables.forEach(el => {
            const key = getElementKey(el);
            if (edits[key] !== undefined) {
              if (el.innerHTML && el.innerHTML.includes('<')) {
                el.innerHTML = edits[key];
              } else {
                el.textContent = edits[key];
              }
            }
          });
        }
        
        // AI í•œì¥ìš”ì•½ í¸ì§‘ ë‚´ìš© ì ìš©
        if (savedAISummaryEdits) {
          const edits = JSON.parse(savedAISummaryEdits);
          const editables = clone.querySelectorAll('.ai-editable');
          editables.forEach((el, index) => {
            const key = `ai-summary-${index}`;
            if (edits[key] !== undefined) {
              el.innerHTML = edits[key];
            }
          });
        }
        
        // AI íŒŒíŠ¸ë³„ ë¶„ì„ í¸ì§‘ ë‚´ìš© ì ìš©
        Object.keys(savedAIPartEdits).forEach(brand => {
          const edits = savedAIPartEdits[brand];
          const editables = clone.querySelectorAll(`.ai-part-editable`);
          editables.forEach(el => {
            const id = el.id || '';
            let key = '';
            if (id.includes('treemap')) key = 'ai-part-treemap';
            else if (id.includes('radar')) key = 'ai-part-radar';
            else if (id.includes('channel-pl')) key = 'ai-part-channel-pl';
            else if (id.includes('weekly')) key = 'ai-part-weekly';
            else if (id.includes('sale-rate')) key = 'ai-part-sale-rate';
            else if (id.includes('inventory')) key = 'ai-part-inventory';
            else if (id.includes('ai-part-note-1')) key = 'ai-part-pl';
            
            if (key && edits[key] !== undefined) {
              el.innerHTML = edits[key];
            }
          });
        });
        
        // 9. í¸ì§‘ëª¨ë“œ ë° ë™ì  ì†ì„± ì œê±°
        clone.querySelectorAll('[contenteditable]').forEach(el => el.removeAttribute('contenteditable'));
        
        // 10. ìŠ¤í¬ë¦½íŠ¸ì— í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì£¼ì…
        const scripts = clone.querySelectorAll('script');
        scripts.forEach(script => {
          if (script.textContent) {
            // window.DASHBOARD_DATAë¥¼ í˜„ì¬ ìƒíƒœë¡œ í•˜ë“œì½”ë”©
            if (script.textContent.includes('const D = window.DASHBOARD_DATA')) {
              // í˜„ì¬ ì¶”ì¶œí•œ ë°ì´í„°ë¡œ D ê°ì²´ ìƒì„±
              // í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì£¼ì…
              const exportedStaticData = {
                chartData: exportedChartData,
                textValues: currentTextValues,
                kpiValues: currentKPIValues,
                brandKPIValues: currentBrandKPIValues,
                modes: currentModes,
                edits: savedEdits ? JSON.parse(savedEdits) : {},
                aiSummaryEdits: savedAISummaryEdits ? JSON.parse(savedAISummaryEdits) : {},
                aiPartEdits: savedAIPartEdits,
                hardcodedBrandData: {
                  labels: hardcodedBrandLabels,
                  sales: hardcodedBrandSales,
                  profit: hardcodedBrandProfit
                },
                hardcodedWeeklyData: {
                  labels: hardcodedWeeklyLabels,
                  datasets: hardcodedWeeklyData
                },
                hardcodedRadarData: hardcodedRadarData
              };
              
              const hardcodedData = `const D = window.DASHBOARD_DATA || {};\n// ë‚´ë³´ë‚¸ ì‹œì ì˜ í•˜ë“œì½”ë”©ëœ ë°ì´í„°\nwindow.EXPORTED_STATIC_DATA = ${JSON.stringify(exportedStaticData, null, 2)};\n// ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ ë¬´íš¨í™”\nwindow.DASHBOARD_DATA = null;\nwindow.USE_EXPORTED_DATA = true;`;
              
              script.textContent = script.textContent.replace(
                /const D = window\.DASHBOARD_DATA \|\| \{\};/,
                hardcodedData
              );
            }
            
            // ì°¨íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤ì´ í•˜ë“œì½”ë”©ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
            if (script.textContent.includes('function initOverviewCharts')) {
              // ì™¸ë¶€ ë°ì´í„° ë¬´íš¨í™”í•˜ê³  í•˜ë“œì½”ë”©ëœ ê°’ ì‚¬ìš©
              script.textContent = script.textContent.replace(
                /const rows = Array\.isArray\(D\.by_brand\) \? D\.by_brand : null;/g,
                `// ë‚´ë³´ë‚¸ íŒŒì¼: í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©\nconst rows = null; // ì™¸ë¶€ ë°ì´í„° ë¬´íš¨í™”`
              );
              
              // í´ë°± ê°’ë“¤ì„ í˜„ì¬ ì¶”ì¶œí•œ ê°’ìœ¼ë¡œ êµì²´
              script.textContent = script.textContent.replace(
                /const labels = rows \? rows\.map\(r=> \(r\.BRAND\|\|r\.brand\|\|r\.name\) \) : \['MLB','MLB KIDS','DISCOVERY','DUVETICA','SERGIO','SUPRA'\];/g,
                `const labels = ${JSON.stringify(hardcodedBrandLabels)}; // ë‚´ë³´ë‚¸ ì‹œì ì˜ í•˜ë“œì½”ë”©ëœ ê°’`
              );
              script.textContent = script.textContent.replace(
                /const sales  = rows \? rows\.map\(r=> Number\(r\.SALES\|\|r\.sales\|\|r\.revenue\|\|0\) \) : \[236\.9,78\.9,42\.1,28\.7,31\.2,16\.8\];/g,
                `const sales = ${JSON.stringify(hardcodedBrandSales)}; // ë‚´ë³´ë‚¸ ì‹œì ì˜ í•˜ë“œì½”ë”©ëœ ê°’`
              );
              script.textContent = script.textContent.replace(
                /const profit = rows \? rows\.map\(r=> Number\(r\.DIRECT_PROFIT\|\|r\.profit\|\|0\) \) : \[16\.6,11\.8,4\.8,3\.9,4\.2,1\.8\];/g,
                `const profit = ${JSON.stringify(hardcodedBrandProfit)}; // ë‚´ë³´ë‚¸ ì‹œì ì˜ í•˜ë“œì½”ë”©ëœ ê°’`
              );
            }
            
            // ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ ì°¨íŠ¸ í•˜ë“œì½”ë”©
            if (script.textContent.includes('updateWeeklyTrendChart')) {
              // ì£¼ì°¨ë³„ ë°ì´í„° í•˜ë“œì½”ë”©
              if (Object.keys(hardcodedWeeklyData).length > 0) {
                script.textContent = script.textContent.replace(
                  /const labels = \['1ì£¼ì°¨','2ì£¼ì°¨','3ì£¼ì°¨','4ì£¼ì°¨','5ì£¼ì°¨'\];/g,
                  `const labels = ${JSON.stringify(hardcodedWeeklyLabels)}; // ë‚´ë³´ë‚¸ ì‹œì ì˜ í•˜ë“œì½”ë”©ëœ ê°’`
                );
                // ê° ë°ì´í„°ì…‹ ê°’ë„ í•˜ë“œì½”ë”© (ì •í™•í•œ íŒ¨í„´ ì°¾ì•„ì„œ êµì²´)
                Object.keys(hardcodedWeeklyData).forEach(label => {
                  const data = hardcodedWeeklyData[label];
                  const regex = new RegExp(`label: '${label.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}',[^}]*data: \\[[^\\]]*\\]`, 'g');
                  script.textContent = script.textContent.replace(regex, (match) => {
                    return match.replace(/data: \[[^\]]*\]/, `data: ${JSON.stringify(data)}`);
                  });
                });
              }
            }
            
            if (script.textContent.includes('function initBrandCharts')) {
              script.textContent = script.textContent.replace(
                /const brandKey = getBrandKey\(currentBrand\);/g,
                `// ë‚´ë³´ë‚¸ íŒŒì¼: í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©\nconst brandKey = getBrandKey(currentBrand);\n// window.DASHBOARD_DATAëŠ” nullë¡œ ì„¤ì •ë˜ì–´ í´ë°± ê°’ë§Œ ì‚¬ìš©`
              );
            }
          }
        });
        
        // 11. ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€: ë‚´ë³´ë‚¸ ë°ì´í„° ì‚¬ìš© ë¡œì§
        const head = clone.querySelector('head');
        if (head) {
          const exportScript = document.createElement('script');
          exportScript.textContent = `
            // ë‚´ë³´ë‚¸ íŒŒì¼ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
            (function() {
              if (window.EXPORTED_STATIC_DATA) {
                // ì°¨íŠ¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œ ì‚¬ìš©
                window.ORIGINAL_CHART_DATA = window.EXPORTED_STATIC_DATA.chartData;
                
                // í¸ì§‘ ë‚´ìš© ë¡œë“œ
                if (window.EXPORTED_STATIC_DATA.edits) {
                  Object.keys(window.EXPORTED_STATIC_DATA.edits).forEach(key => {
                    const el = document.querySelector('[data-key="' + key + '"]');
                    if (el) el.innerHTML = window.EXPORTED_STATIC_DATA.edits[key];
                  });
                }
                
                // AI í¸ì§‘ ë‚´ìš© ë¡œë“œ
                if (window.EXPORTED_STATIC_DATA.aiSummaryEdits) {
                  const edits = window.EXPORTED_STATIC_DATA.aiSummaryEdits;
                  document.querySelectorAll('.ai-editable').forEach((el, index) => {
                    const key = 'ai-summary-' + index;
                    if (edits[key]) el.innerHTML = edits[key];
                  });
                }
                
                // ëª¨ë“œ ìƒíƒœ ë³µì›
                if (window.EXPORTED_STATIC_DATA.modes) {
                  const modes = window.EXPORTED_STATIC_DATA.modes;
                  if (modes.overviewMode) window.overviewMode = modes.overviewMode;
                  if (modes.weeklyMode) window.weeklyMode = modes.weeklyMode;
                  if (modes.radarChartType) window.radarChartType = modes.radarChartType;
                  if (modes.treemapCurrentType !== undefined) window.treemapCurrentType = modes.treemapCurrentType;
                }
                
                // ì£¼ì°¨ë³„/ëˆ„ì  ë²„íŠ¼ ì´ë²¤íŠ¸ ì¬ì—°ê²° (ë¸Œëœë“œë³„ ë¶„ì„ìš©)
                setTimeout(function() {
                  if (typeof initWeeklyTrendChart === 'function') {
                    initWeeklyTrendChart();
                  }
                }, 500);
              }
            })();
          `;
          head.appendChild(exportScript);
        }
        
        // ë¶„ì„ëŒ€ìƒì¼ ì¶”ì¶œ (YYYY-MM-DD í˜•ì‹ ë˜ëŠ” ë‹¤ë¥¸ í˜•ì‹ì—ì„œ YYMMDDë¡œ ë³€í™˜)
        let analysisDate = '250817'; // ê¸°ë³¸ê°’
        
        // window.lastUpdatedì—ì„œ ë‚ ì§œ ì¶”ì¶œ ì‹œë„
        if (window.lastUpdated) {
          const dateStr = window.lastUpdated;
          // "2024-08-17 09:00" í˜•ì‹ ë˜ëŠ” "2024ë…„ 8ì›” 17ì¼" í˜•ì‹ ì²˜ë¦¬
          const yearMatch = dateStr.match(/20(\d{2})/);
          const monthMatch = dateStr.match(/(?:-|ë…„\s*)(\d{1,2})(?:ì›”|[-/])/);
          const dayMatch = dateStr.match(/(?:ì›”\s*|[-/])(\d{1,2})(?:ì¼|\s|$)/);
          
          if (yearMatch && monthMatch && dayMatch) {
            const year = yearMatch[1];
            const month = monthMatch[1].padStart(2, '0');
            const day = dayMatch[1].padStart(2, '0');
            analysisDate = year + month + day;
          }
        } else {
          // last-updated ìš”ì†Œì—ì„œ ì¶”ì¶œ ì‹œë„
          const lastUpdatedEl = document.getElementById('last-updated');
          if (lastUpdatedEl) {
            const text = lastUpdatedEl.textContent;
            const yearMatch = text.match(/20(\d{2})/);
            const monthMatch = text.match(/(?:ë…„\s*)(\d{1,2})(?:ì›”)/);
            const dayMatch = text.match(/(?:ì›”\s*)(\d{1,2})(?:ì¼)/);
            
            if (yearMatch && monthMatch && dayMatch) {
              const year = yearMatch[1];
              const month = monthMatch[1].padStart(2, '0');
              const day = dayMatch[1].padStart(2, '0');
              analysisDate = year + month + day;
            }
          }
        }
        
        const html = '<!DOCTYPE html>\n' + clone.outerHTML;
        const blob = new Blob([html], {type:'text/html;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `ì›”ì¤‘ ì†ìµì˜ˆì¸¡ëŒ€ì‹œë³´ë“œ_${analysisDate}.html`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        
        alert('âœ… ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\ní˜„ì¬ í™”ë©´ ìƒíƒœê°€ í•˜ë“œì½”ë”©ë˜ì–´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\nëª¨ë“  ê¸°ëŠ¥ì€ ìœ ì§€ë˜ë©° ë°ì´í„°ë§Œ ê³ ì •ë©ë‹ˆë‹¤.');
      }catch(err){
        alert('ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        console.error('Export error:', err);
      }
    }
    
    // -------- ì£¼ì°¨ë³„ ë§¤ì¶œ ì¶”ì„¸ (ì£¼ì°¨ë³„/ëˆ„ì ) --------
    let weeklyMode = 'weekly'; // 'weekly' or 'cumulative'
    let weeklyChannelFilter = 'all'; // ì„ íƒëœ ì±„ë„ í•„í„°
    
    function initWeeklyTrendChart(){
      updateWeeklyTrendChart();
      
      // RF ì±„ë„ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ (MLB ë¸Œëœë“œë§Œ í‘œì‹œ)
      const rfBtn = document.getElementById('weeklyChannelFilterRF');
      if (rfBtn) {
        rfBtn.style.display = (currentBrand === 'MLB') ? 'block' : 'none';
      }
      
      // ì£¼ì°¨ë³„/ëˆ„ì  ë²„íŠ¼ ì´ë²¤íŠ¸
      const weeklyBtn = document.getElementById('weeklyModeBtnWeekly');
      const cumBtn = document.getElementById('weeklyModeBtnCumulative');
      if(weeklyBtn && !weeklyBtn.hasAttribute('data-listener')){
        weeklyBtn.setAttribute('data-listener','true');
        weeklyBtn.addEventListener('click',()=>{ weeklyMode='weekly'; updateWeeklyButtons(); updateWeeklyTrendChart(); });
      }
      if(cumBtn && !cumBtn.hasAttribute('data-listener')){
        cumBtn.setAttribute('data-listener','true');
        cumBtn.addEventListener('click',()=>{ weeklyMode='cumulative'; updateWeeklyButtons(); updateWeeklyTrendChart(); });
      }
      
      // ì±„ë„ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
      const filterButtons = document.querySelectorAll('.weekly-channel-filter-btn');
      filterButtons.forEach(btn => {
        if(!btn.hasAttribute('data-listener')){
          btn.setAttribute('data-listener','true');
          btn.addEventListener('click',()=>{
            weeklyChannelFilter = btn.dataset.channel || 'all';
            updateWeeklyChannelFilterButtons();
            updateWeeklyTrendChart();
          });
        }
      });
      
      updateWeeklyButtons();
      updateWeeklyChannelFilterButtons();
    }
    
    function updateWeeklyChannelFilterButtons(){
      const filterButtons = document.querySelectorAll('.weekly-channel-filter-btn');
      filterButtons.forEach(btn => {
        const channel = btn.dataset.channel || 'all';
        if(channel === weeklyChannelFilter){
          btn.style.background = '#2563eb';
          btn.style.color = '#fff';
          btn.classList.add('active');
        } else {
          btn.style.background = '#e5e7eb';
          btn.style.color = '#374151';
          btn.classList.remove('active');
        }
      });
    }
    
    function updateWeeklyButtons(){
      const weeklyBtn = document.getElementById('weeklyModeBtnWeekly');
      const cumBtn = document.getElementById('weeklyModeBtnCumulative');
      if(weeklyBtn && cumBtn){
        if(weeklyMode==='weekly'){ weeklyBtn.style.background='#2563eb'; weeklyBtn.style.color='#fff'; cumBtn.style.background='#e5e7eb'; cumBtn.style.color='#374151'; }
        else { cumBtn.style.background='#2563eb'; cumBtn.style.color='#fff'; weeklyBtn.style.background='#e5e7eb'; weeklyBtn.style.color='#374151'; }
      }
    }
    
    function updateWeeklyTrendChart(){
      console.log('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] updateWeeklyTrendChart í˜¸ì¶œë¨');
      const ctxEl = document.getElementById('weeklyTrendChart');
      if(!ctxEl) {
        console.warn('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] weeklyTrendChart ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      // ë¶€ëª¨ ì—˜ë¦¬ë¨¼íŠ¸ê°€ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ì°¨íŠ¸ ìƒì„± ìŠ¤í‚µ
      const parentSection = ctxEl.closest('#content-brand');
      if (parentSection && parentSection.style.display === 'none') {
        console.log('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] ë¸Œëœë“œ ì„¹ì…˜ì´ ìˆ¨ê²¨ì ¸ ìˆì–´ ì°¨íŠ¸ ìƒì„±ì„ ìŠ¤í‚µí•©ë‹ˆë‹¤');
        return;
      }
      if(charts.weeklyTrend){ charts.weeklyTrend.destroy(); charts.weeklyTrend=null; }
      
      // RF ì±„ë„ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ (MLB ë¸Œëœë“œë§Œ í‘œì‹œ)
      const rfBtn = document.getElementById('weeklyChannelFilterRF');
      if (rfBtn) {
        rfBtn.style.display = (currentBrand === 'MLB') ? 'block' : 'none';
      }
      
      // ìƒˆ ë°ì´í„° íŒŒì¼ì—ì„œ Xì¶• ë ˆì´ë¸” ë° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      let labels, realData;
      
      // â˜… window.weeklySalesTrend ì‚¬ìš© (ì•ˆì „í•œ ì ‘ê·¼) â˜…
      const weeklySalesTrendData = window.weeklySalesTrend;
      console.log('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] weeklySalesTrendData í™•ì¸:', {
        exists: !!weeklySalesTrendData,
        hasRawData: !!weeklySalesTrendData?.rawData,
        rawDataLength: weeklySalesTrendData?.rawData?.length,
        weeks: weeklySalesTrendData?.weeks
      });
      
      if (weeklySalesTrendData?.rawData) {
        // ìƒˆ JS íŒŒì¼ ë°ì´í„° ì‚¬ìš©
        labels = weeklySalesTrendData.weeks;
        
        // ë¸Œëœë“œ ì½”ë“œ â†’ ë¸Œëœë“œëª… ë§¤í•‘
        const brandNameMap = {
          'M': 'MLB',
          'I': 'MLB_KIDS',
          'X': 'DISCOVERY',
          'V': 'DUVETICA',
          'ST': 'SERGIO',
          'W': 'SUPRA'
        };
        
        // ì±„ë„ëª… â†’ ì±„ë„ë²ˆí˜¸ ë§¤í•‘
        const channelNumMap = {
          'ë°±í™”ì ': '1',
          'ë©´ì„¸ì ': '2',
          'ì§ì˜ì (ê°€ë‘)': '3',
          'ìì‚¬ëª°': '4',
          'ì œíœ´ëª°': '5',
          'ëŒ€ë¦¬ì ': '6',
          'ì•„ìš¸ë ›': '7',
          'ì‚¬ì…': '8',
          'ì§ì˜ëª°': '11',
          'RF': 'RF'
        };
        
        // realData êµ¬ì¡°ë¡œ ë³€í™˜
        realData = {};
        const brands = weeklySalesTrendData.brands;
        const weeks = weeklySalesTrendData.weeks;
        
        brands.forEach(brandCode => {
          const brandName = brandNameMap[brandCode] || brandCode;
          realData[brandName] = { ë‹¹ë…„: {}, ì „ë…„: {} };
          
          // ê° ì±„ë„ë³„ë¡œ ì£¼ì°¨ë³„ ë°ì´í„° ë°°ì—´ ìƒì„±
          Object.keys(channelNumMap).forEach(channelName => {
            const channelNum = channelNumMap[channelName];
            realData[brandName].ë‹¹ë…„[channelNum] = [];
            realData[brandName].ì „ë…„[channelNum] = [];
            
            weeks.forEach(week => {
              // weekë¥¼ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì˜ˆ: "9/21" â†’ "09-21", "10/5" â†’ "10-05")
              const [month, day] = week.split('/');
              const monthPadded = month.padStart(2, '0');
              const dayPadded = day.padStart(2, '0');
              const datePattern = `-${monthPadded}-${dayPadded}`;
              
              // í•´ë‹¹ ë¸Œëœë“œ, ì±„ë„, ì£¼ì°¨ì˜ ë°ì´í„° ì°¾ê¸° (ê°™ì€ ì±„ë„ëª…ì´ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ filterë¡œ í•©ì‚°)
              const currDataList = weeklySalesTrendData.rawData.filter(d => 
                d.ë¸Œëœë“œ === brandCode && 
                d.ì±„ë„ëª… === channelName && 
                d.êµ¬ë¶„ === 'ë‹¹ë…„' &&
                d.ì¢…ë£Œì¼.includes(datePattern)
              );
              const prevDataList = weeklySalesTrendData.rawData.filter(d => 
                d.ë¸Œëœë“œ === brandCode && 
                d.ì±„ë„ëª… === channelName && 
                d.êµ¬ë¶„ === 'ì „ë…„' &&
                d.ì¢…ë£Œì¼.includes(datePattern)
              );
              
              // ê°™ì€ ì±„ë„ëª…ì˜ ë§¤ì¶œ í•©ì‚° í›„ ë°±ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜
              const currSum = currDataList.reduce((sum, d) => sum + d.ì‹¤íŒë§¤ì¶œ, 0);
              const prevSum = prevDataList.reduce((sum, d) => sum + d.ì‹¤íŒë§¤ì¶œ, 0);
              
              realData[brandName].ë‹¹ë…„[channelNum].push(Math.round(currSum / 1000000));
              realData[brandName].ì „ë…„[channelNum].push(Math.round(prevSum / 1000000));
            });
          });
        });
        
        console.log('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] ìƒˆ ë°ì´í„° íŒŒì¼ ë¡œë“œ ì™„ë£Œ:', { weeks: labels, brands: Object.keys(realData), realData: realData });
      } else {
        // ë°ì´í„° íŒŒì¼ì´ ì—†ìœ¼ë©´ ì°¨íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
        console.error('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] weekly_sales_trend ë°ì´í„° íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        console.error('[ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸] window.weeklySalesTrend:', window.weeklySalesTrend);
        const ctxWrapper = ctxEl.closest('.chart-wrapper');
        if (ctxWrapper) {
          ctxWrapper.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#ff0000;font-size:14px;flex-direction:column;"><p>ì£¼ì°¨ë³„ ë§¤ì¶œì¶”ì„¸ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p style="font-size:12px;color:#64748b;margin-top:10px;">ì½˜ì†”ì—ì„œ ì—ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p></div>';
        }
        return;
      }
      
      // ì£¼ì°¨ ìˆ˜ (ë™ì )
      const weekCount = labels.length;
      
      // ë¸Œëœë“œë³„, ì±„ë„ë³„ ì£¼ì°¨ë³„ ë§¤ì¶œ ë°ì´í„° êµ¬ì¡°
      const getWeeklyDataByChannel = (brand, channel) => {
        const channelMap = {
          'ë°±í™”ì ': '1',
          'ë©´ì„¸ì ': '2',
          'ì§ì˜ì (ê°€ë‘)': '3',
          'ì§ì˜ì ': '3',
          'ì§ì˜ê°€ë‘': '3',
          'ëŒ€ë¦¬ì ': '6',
          'ì•„ìš¸ë ›': '7',
          'ì§ì˜ëª°': '11',
          'ìì‚¬ëª°': '4',
          'ì˜¨ë¼ì¸ìì‚¬': '4',
          'ì œíœ´ëª°': '5',
          'ì˜¨ë¼ì¸ì œíœ´': '5',
          'ì‚¬ì…': '8',
          'RF': 'RF'
        };
        const channelKey = channelMap[channel] || 'all';
        
        const brandData = realData[brand] || realData.MLB;
        
        if (channelKey === 'all') {
          // ì „ì²´ í•©ê³„ ê³„ì‚°
          const weekly = Array(weekCount).fill(0);
          const prevYear = Array(weekCount).fill(0);
          
          Object.keys(brandData.ë‹¹ë…„).forEach(ch => {
            brandData.ë‹¹ë…„[ch].forEach((v, i) => {
              weekly[i] += v;
            });
          });
          
          Object.keys(brandData.ì „ë…„).forEach(ch => {
            if (brandData.ì „ë…„[ch]) {
              brandData.ì „ë…„[ch].forEach((v, i) => {
                prevYear[i] += v;
              });
            }
          });
          
          // ëª©í‘œëŠ” ë‹¹ë…„ í‰ê· ì˜ 120% ì •ë„ë¡œ ì„¤ì •
          const avgWeekly = weekly.reduce((a,b)=>a+b,0) / 9;
          const target = Array(9).fill(avgWeekly * 1.2);
          
          return { weekly, prevYear, target };
        } else {
          // íŠ¹ì • ì±„ë„ ë°ì´í„°
          const weekly = brandData.ë‹¹ë…„[channelKey] || Array(9).fill(0);
          const prevYear = brandData.ì „ë…„[channelKey] || Array(9).fill(0);
          const avgWeekly = weekly.reduce((a,b)=>a+b,0) / 9;
          const target = Array(9).fill(avgWeekly * 1.2);
          
          return { weekly, prevYear, target };
        }
      };
      
      // ì„ íƒëœ ì±„ë„ì— ë”°ë¥¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      let weeklySales, prevYear, target;
      if(weeklyChannelFilter === 'all'){
        const allData = getWeeklyDataByChannel(currentBrand, 'all');
        weeklySales = allData.weekly;
        prevYear = allData.prevYear;
        target = allData.target || Array(9).fill(50);
      } else {
        const channelData = getWeeklyDataByChannel(currentBrand, weeklyChannelFilter);
        weeklySales = channelData.weekly;
        prevYear = channelData.prevYear;
        target = channelData.target || Array(9).fill(channelData.weekly[0] * 1.3);
      }
      
      const cumulative = weeklySales.reduce((arr,v,i)=>{ arr.push((arr[i-1]||0)+v); return arr; },[]);
      const cumulativePrev = prevYear.reduce((arr,v,i)=>{ arr.push((arr[i-1]||0)+v); return arr; },[]);
      
      const dataWeekly = {
        labels,
        datasets:[
          { label:'ì£¼ì°¨ë³„ ë§¤ì¶œ', data: weeklySales, type:'bar', backgroundColor:'rgba(79,70,229,0.8)', borderColor:'rgba(79,70,229,1)', borderWidth:1 },
          { label:'ì „ë…„ ë§¤ì¶œ', data: prevYear, type:'line', borderColor:'rgba(16,185,129,1)', backgroundColor:'rgba(16,185,129,0.1)', borderWidth:2, tension:0.4, fill:false, pointRadius:3 }
        ]
      };
      const dataCum = {
        labels,
        datasets:[
          { label:'ëˆ„ì  ë§¤ì¶œ', data: cumulative, type:'line', borderColor:'rgba(79,70,229,1)', backgroundColor:'rgba(79,70,229,0.1)', borderWidth:3, tension:0.3, fill:true, pointRadius:3 },
          { label:'ì „ë…„ ëˆ„ì ', data: cumulativePrev, type:'line', borderColor:'rgba(16,185,129,1)', backgroundColor:'rgba(16,185,129,0.1)', borderWidth:2, tension:0.3, fill:false, pointRadius:3 }
        ]
      };
      const chartData = weeklyMode==='weekly' ? dataWeekly : dataCum;
      
      // ì°¨íŠ¸ ì˜µì…˜ (íˆ´íŒì— ë°±ë§Œì› ë‹¨ìœ„ í‘œì‹œ)
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: { font: { size: 10 } }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.dataset.label || '';
                const value = context.parsed.y;
                // ì´ë¯¸ ë°±ë§Œì› ë‹¨ìœ„ë¡œ ì €ì¥ë˜ì–´ ìˆìŒ
                return label + ': ' + value.toLocaleString() + 'ë°±ë§Œ';
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'ë§¤ì¶œ (ë°±ë§Œì›)', font: { size: 10 } },
            ticks: { font: { size: 9 } }
          },
          x: {
            ticks: { font: { size: 12, weight: 'bold' } }
          }
        }
      };
      
      charts.weeklyTrend = new Chart(ctxEl.getContext('2d'), { 
        type: 'bar', 
        data: chartData, 
        options: chartOptions 
      });
      
      // ì£¼ì°¨ë³„ ë§¤ì¶œ ë°ì´í„° í‘œ ì—…ë°ì´íŠ¸ (labels ì „ë‹¬)
      updateWeeklyDataTable(weeklySales, prevYear, labels);
    }
    
    // ì£¼ì°¨ë³„ ë§¤ì¶œ ë°ì´í„° í‘œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateWeeklyDataTable(weeklySales, prevYear, weekLabels) {
      const thead = document.getElementById('weeklyDataTableHead');
      const tbody = document.getElementById('weeklyDataTableBody');
      if (!tbody) return;
      
      // í…Œì´ë¸” í—¤ë” ë™ì  ìƒì„±
      if (thead && weekLabels) {
        let headerHtml = '<tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0;">';
        headerHtml += '<th style="padding:10px;border:1px solid #e2e8f0;font-weight:700;color:#64748b;font-size:14px;">êµ¬ë¶„</th>';
        weekLabels.forEach(label => {
          headerHtml += `<th style="padding:10px;border:1px solid #e2e8f0;font-weight:700;color:#64748b;font-size:14px;">${label}</th>`;
        });
        headerHtml += '</tr>';
        thead.innerHTML = headerHtml;
      }
      
      // YOY ê³„ì‚°
      const yoyData = weeklySales.map((current, idx) => {
        const prev = prevYear[idx];
        if (prev === 0 || prev === null) return 0;
        return Math.round((current / prev) * 100);
      });
      
      // ì´ë¯¸ ë°±ë§Œì› ë‹¨ìœ„ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      const currentMillion = weeklySales.map(v => Math.round(v));
      const prevMillion = prevYear.map(v => Math.round(v));
      
      // í‘œ HTML ìƒì„±
      let html = '';
      
      // ë‹¹ë…„(ë°±ë§Œ) í–‰
      html += '<tr style="background:#fff;">';
      html += '<td style="padding:10px;border:1px solid #e2e8f0;font-weight:700;color:#1e293b;font-size:14px;">ë‹¹ë…„(ë°±ë§Œ)</td>';
      currentMillion.forEach(val => {
        html += `<td style="padding:10px;border:1px solid #e2e8f0;color:#1e293b;font-size:13px;">${val.toLocaleString()}</td>`;
      });
      html += '</tr>';
      
      // ì „ë…„(ë°±ë§Œ) í–‰
      html += '<tr style="background:#fff;">';
      html += '<td style="padding:10px;border:1px solid #e2e8f0;font-weight:700;color:#1e293b;font-size:14px;">ì „ë…„(ë°±ë§Œ)</td>';
      prevMillion.forEach(val => {
        html += `<td style="padding:10px;border:1px solid #e2e8f0;color:#1e293b;font-size:13px;">${val.toLocaleString()}</td>`;
      });
      html += '</tr>';
      
      // YOY í–‰
      html += '<tr style="background:#fff;">';
      html += '<td style="padding:10px;border:1px solid #e2e8f0;font-weight:700;color:#4f46e5;font-size:14px;">YOY</td>';
      yoyData.forEach(val => {
        const color = val >= 100 ? '#059669' : '#dc2626';
        html += `<td style="padding:10px;border:1px solid #e2e8f0;color:${color};font-weight:700;font-size:13px;">${val}%</td>`;
      });
      html += '</tr>';
      
      tbody.innerHTML = html;
    }

    // ===================== íŒë§¤ìœ¨ ë¶„ì„ ê¸°ëŠ¥ =====================
    
    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì €ì¥
    window.salesRateSelectedCategory = 'ì „ì²´';
    
    // íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    async function loadSalesRateData(forceUpdate = false) {
      console.log('[íŒë§¤ìœ¨] ë°ì´í„° ë¡œë“œ ì‹œì‘', { forceUpdate });
      
      // ë¡œë”© í‘œì‹œ
      const loadingDiv = document.getElementById('sales-rate-loading');
      const errorDiv = document.getElementById('sales-rate-error');
      const tableWrapper = document.getElementById('sales-rate-table-wrapper');
      
      if (loadingDiv) loadingDiv.style.display = 'block';
      if (errorDiv) errorDiv.style.display = 'none';
      if (tableWrapper) tableWrapper.style.display = 'none';
      
      try {
        // API í˜¸ì¶œ (ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©)
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        
        // URLì—ì„œ month íŒŒë¼ë¯¸í„° ì½ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const monthParam = urlParams.get('month');
        
        // API URL êµ¬ì„±
        let url = `/api/sales-rate?date=${apiDate}`;
        if (monthParam) {
          url += `&month=${monthParam}`;
        }
        if (forceUpdate) {
          url += '&forceUpdate=true';
        }
        
        const response = await fetch(url);
        
        if (!response.ok) {
          // ì—ëŸ¬ ì‘ë‹µì˜ JSON íŒŒì‹± ì‹œë„
          let errorDetails = '';
          try {
            const errorData = await response.json();
            console.error('[íŒë§¤ìœ¨] API ì—ëŸ¬ ì‘ë‹µ:', errorData);
            errorDetails = errorData.error || errorData.message || '';
            if (errorData.errorCode) errorDetails += ` (ì½”ë“œ: ${errorData.errorCode})`;
            if (errorData.errorDetails) errorDetails += ` - ${errorData.errorDetails}`;
          } catch (e) {
            console.error('[íŒë§¤ìœ¨] ì—ëŸ¬ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:', e);
          }
          throw new Error(`HTTP error! status: ${response.status}${errorDetails ? ' - ' + errorDetails : ''}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          let errorMsg = result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
          if (result.errorCode) errorMsg += ` (ì½”ë“œ: ${result.errorCode})`;
          if (result.errorDetails) errorMsg += ` - ${result.errorDetails}`;
          throw new Error(errorMsg);
        }
        
        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        window.salesRateData = result;
        console.log('[íŒë§¤ìœ¨] ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        updateSalesRateDateInfo(result);
        
        // ì¹´í…Œê³ ë¦¬ í•„í„° ì´ë²¤íŠ¸ ì„¤ì •
        setupCategoryFilters();
        
        // í…Œì´ë¸” ë Œë”ë§
        renderSalesRateTable();
        
        // ë¡œë”© ìˆ¨ê¹€, í…Œì´ë¸” í‘œì‹œ
        if (loadingDiv) loadingDiv.style.display = 'none';
        if (tableWrapper) tableWrapper.style.display = 'block';
        
      } catch (error) {
        console.error('[íŒë§¤ìœ¨] ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
        console.error('[íŒë§¤ìœ¨] ì—ëŸ¬ ìƒì„¸:', error.message, error.stack);
        
        // ì—ëŸ¬ í‘œì‹œ
        if (loadingDiv) loadingDiv.style.display = 'none';
        if (errorDiv) {
          errorDiv.style.display = 'block';
          // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
          const errorMsg = errorDiv.querySelector('p');
          if (errorMsg) {
            let errorText = `âš ï¸ íŒë§¤ìœ¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${error.message})`;
            
            // 500 ì—ëŸ¬ì¸ ê²½ìš° ì„œë²„ ì‘ë‹µ í™•ì¸
            if (error.message.includes('500')) {
              errorText += '\n\nì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Vercel ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
              errorText += '\nê°€ëŠ¥í•œ ì›ì¸: Snowflake ì—°ê²° ì‹¤íŒ¨, í™˜ê²½ë³€ìˆ˜ ëˆ„ë½, ì¿¼ë¦¬ íƒ€ì„ì•„ì›ƒ';
            }
            
            errorMsg.textContent = errorText;
            errorMsg.style.whiteSpace = 'pre-line';
          }
        }
      }
    }
    
    // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateSalesRateDateInfo(result) {
      const updateDateEl = document.getElementById('sales-rate-update-date');
      const periodInfoEl = document.getElementById('sales-rate-period-info');
      const seasonInfoEl = document.getElementById('sales-rate-season-info');
      
      if (updateDateEl && result.date) {
        updateDateEl.textContent = result.date;
      }
      
      if (periodInfoEl && result.data) {
        const curSample = result.data.CUR?.[0];
        const pySample = result.data.PY?.[0];
        const pyEndSample = result.data.PY_END?.[0];
        
        const curDate = curSample?.ASOF_DT || '-';
        const pyDate = pySample?.ASOF_DT || '-';
        const pyEndDate = pyEndSample?.ASOF_DT || '-';
        
        periodInfoEl.textContent = `ë‹¹ë…„: ${curDate} ëˆ„ì  / ì „ë…„: ${pyDate} ëˆ„ì  / ë§ˆê°: ${pyEndDate} ëˆ„ì `;
      }
      
      if (seasonInfoEl && result.data) {
        const curSample = result.data.CUR?.[0];
        const pySample = result.data.PY?.[0];
        
        console.log('[íŒë§¤ìœ¨ ì‹œì¦Œ ì •ë³´ ë””ë²„ê¹…]', {
          curSample: curSample,
          pySample: pySample,
          curSESN: curSample?.SESN,
          pySESN: pySample?.SESN,
          curKeys: curSample ? Object.keys(curSample) : []
        });
        
        // SESN í•„ë“œì—ì„œ ì‹œì¦Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ í•˜ë“œì½”ë”©)
        const curSeason = curSample?.SESN || '25F';
        const pySeason = pySample?.SESN || '24F';
        
        seasonInfoEl.textContent = `ë‹¹ë…„ ${curSeason} ì˜ë¥˜ / ì „ë…„ ${pySeason} ì˜ë¥˜`;
      }
    }
    
    // íƒ­ ì „í™˜ í•¨ìˆ˜ (íŒë§¤ìœ¨ / ì¬ê³ ì£¼ìˆ˜)
    function switchAnalysisTab(tabName) {
      const salesRateTab = document.getElementById('tab-sales-rate');
      const stockWeeksTab = document.getElementById('tab-stock-weeks');
      const salesRateContent = document.getElementById('sales-rate-content');
      const stockWeeksContent = document.getElementById('stock-weeks-content');
      
      if (!salesRateTab || !stockWeeksTab || !salesRateContent || !stockWeeksContent) {
        console.warn('[íƒ­ ì „í™˜] íƒ­ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (tabName === 'sales-rate') {
        // íŒë§¤ìœ¨ íƒ­ í™œì„±í™”
        salesRateTab.style.background = '#4f46e5';
        salesRateTab.style.color = '#fff';
        salesRateTab.classList.add('active');
        stockWeeksTab.style.background = '#f1f5f9';
        stockWeeksTab.style.color = '#64748b';
        stockWeeksTab.classList.remove('active');
        
        salesRateContent.style.display = 'block';
        stockWeeksContent.style.display = 'none';
        
        console.log('[íƒ­ ì „í™˜] íŒë§¤ìœ¨ íƒ­ í™œì„±í™”');
      } else if (tabName === 'stock-weeks') {
        // ì¬ê³ ì£¼ìˆ˜ íƒ­ í™œì„±í™”
        stockWeeksTab.style.background = '#4f46e5';
        stockWeeksTab.style.color = '#fff';
        stockWeeksTab.classList.add('active');
        salesRateTab.style.background = '#f1f5f9';
        salesRateTab.style.color = '#64748b';
        salesRateTab.classList.remove('active');
        
        salesRateContent.style.display = 'none';
        stockWeeksContent.style.display = 'block';
        
        console.log('[íƒ­ ì „í™˜] ì¬ê³ ì£¼ìˆ˜ íƒ­ í™œì„±í™”');
      }
    }
    
    // ì¹´í…Œê³ ë¦¬ í•„í„° ì„¤ì •
    function setupCategoryFilters() {
      const buttons = document.querySelectorAll('.sales-rate-filter-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          window.salesRateSelectedCategory = category;
          
          // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
          buttons.forEach(b => {
            if (b === this) {
              b.style.background = '#4f46e5';
              b.style.color = '#fff';
              b.classList.add('active');
            } else {
              b.style.background = '#e5e7eb';
              b.style.color = '#374151';
              b.classList.remove('active');
            }
          });
          
          // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
          renderSalesRateTable();
        });
      });
    }
    
    // PRDT_KIND_NMì„ ì¹´í…Œê³ ë¦¬ë¡œ ì‚¬ìš©
    function getCategoryFromPrdtKind(row) {
      // PRDT_KIND_NMì´ ë°”ë¡œ ì¹´í…Œê³ ë¦¬ (Outer, Inner, Bottom, Acc_etc ë“±)
      const category = row.PRDT_KIND_NM;
      
      if (!category) return 'ETC';
      
      // ì¹´í…Œê³ ë¦¬ ê°’ì´ ìœ íš¨í•œì§€ í™•ì¸ (ì „ì²´/Outer/Inner/Bottom/Acc_etc)
      const validCategories = ['Outer', 'Inner', 'Bottom', 'Acc_etc'];
      
      if (validCategories.includes(category)) {
        return category;
      }
      
      return 'ETC';
    }
    
    // íŒë§¤ìœ¨ í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜
    function renderSalesRateTable() {
      try {
        console.log('[íŒë§¤ìœ¨] renderSalesRateTable ì‹œì‘');
        console.log('[íŒë§¤ìœ¨] window.salesRateData:', window.salesRateData);
        console.log('[íŒë§¤ìœ¨] currentBrand:', currentBrand);
        
      if (!window.salesRateData || !currentBrand) {
        console.warn('[íŒë§¤ìœ¨] ë°ì´í„° ë˜ëŠ” ë¸Œëœë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      
      const brandCode = brandCodeMap[currentBrand];
      
      // ë°ì´í„°ê°€ ì¤‘ì²© êµ¬ì¡°ì¸ì§€ í™•ì¸
      const dataSource = window.salesRateData.data || window.salesRateData;
      
      // CUR, PY, PY_END ë°ì´í„° ë³‘í•©
      let allData = [];
      if (dataSource.CUR) allData = allData.concat(dataSource.CUR.map(d => ({...d, PERIOD_GB: 'CUR'})));
      if (dataSource.PY) allData = allData.concat(dataSource.PY.map(d => ({...d, PERIOD_GB: 'PY'})));
      if (dataSource.PY_END) allData = allData.concat(dataSource.PY_END.map(d => ({...d, PERIOD_GB: 'PY_END'})));
      
      // í•´ë‹¹ ë¸Œëœë“œ ë°ì´í„° í•„í„°ë§
      const brandData = allData.filter(row => row.BRD_CD === brandCode);
      console.log('[íŒë§¤ìœ¨] ë¸Œëœë“œ:', currentBrand, 'ì½”ë“œ:', brandCode, 'ë°ì´í„°:', brandData.length, 'ê±´');
      
      // ì•„ì´í…œë³„ ì§‘ê³„
      const itemMap = {};
      
      brandData.forEach(row => {
        const itemKey = row.ITEM_CD;
        const itemCategory = getCategoryFromPrdtKind(row);  // row ì „ì²´ë¥¼ ì „ë‹¬
        
        if (!itemMap[itemKey]) {
          itemMap[itemKey] = {
            category: itemCategory,
            prdtKind: row.PRDT_KIND_NM || '-',
            itemCode: row.ITEM_CD,
            itemName: row.ITEM_NM || '-',
            curSale: 0,
            pySale: 0,
            curStor: 0,
            pyStor: 0,
            pyEndStor: 0,
            pyEndSale: 0,
            curOrd: 0,
            pyOrd: 0,
            products: []
          };
        }
        
        // ë°ì´í„° ì§‘ê³„
        if (row.PERIOD_GB === 'CUR') {
          itemMap[itemKey].curSale += row.SALE_TAG || 0;
          itemMap[itemKey].curStor += row.AC_STOR_TAG_AMT_KOR || 0;
          itemMap[itemKey].curOrd += row.AC_ORD_TAG_AMT_KOR || 0;
          
          // ìƒí’ˆë³„ ë°ì´í„° ì¶”ê°€
          itemMap[itemKey].products.push({
            period: 'CUR',
            productCode: row.PRDT_CD,
            productName: row.PRDT_NM || '-',
            category: itemCategory,
            sale: row.SALE_TAG || 0,
            stor: row.AC_STOR_TAG_AMT_KOR || 0,
            ord: row.AC_ORD_TAG_AMT_KOR || 0,
            stock: row.STOCK_TAG_AMT || 0
          });
        } else if (row.PERIOD_GB === 'PY') {
          itemMap[itemKey].pySale += row.SALE_TAG || 0;
          itemMap[itemKey].pyStor += row.AC_STOR_TAG_AMT_KOR || 0;
          itemMap[itemKey].pyOrd += row.AC_ORD_TAG_AMT_KOR || 0;
          
          // ìƒí’ˆë³„ ë°ì´í„° ì¶”ê°€
          itemMap[itemKey].products.push({
            period: 'PY',
            productCode: row.PRDT_CD,
            productName: row.PRDT_NM || '-',
            category: itemCategory,
            sale: row.SALE_TAG || 0,
            stor: row.AC_STOR_TAG_AMT_KOR || 0,
            ord: row.AC_ORD_TAG_AMT_KOR || 0,
            stock: row.STOCK_TAG_AMT || 0
          });
        } else if (row.PERIOD_GB === 'PY_END') {
          itemMap[itemKey].pyEndSale += row.SALE_TAG || 0;
          itemMap[itemKey].pyEndStor += row.AC_STOR_TAG_AMT_KOR || 0;
          
          // ìƒí’ˆë³„ ë°ì´í„° ì¶”ê°€
          itemMap[itemKey].products.push({
            period: 'PY_END',
            productCode: row.PRDT_CD,
            productName: row.PRDT_NM || '-',
            category: itemCategory,
            sale: row.SALE_TAG || 0,
            stor: row.AC_STOR_TAG_AMT_KOR || 0,
            ord: row.AC_ORD_TAG_AMT_KOR || 0,
            stock: row.STOCK_TAG_AMT || 0
          });
        }
      });
      
      // ë°°ì—´ë¡œ ë³€í™˜
      let allItems = Object.values(itemMap);
      
      // ì „ì²´ í•©ê³„ ê³„ì‚° (í•„í„°ë§ ì „)
      const grandTotals = {
        curSale: 0,
        pySale: 0,
        curStor: 0,
        pyStor: 0,
        pyEndStor: 0,
        pyEndSale: 0,
        curOrd: 0,
        pyOrd: 0
      };
      
      allItems.forEach(item => {
        grandTotals.curSale += item.curSale;
        grandTotals.pySale += item.pySale;
        grandTotals.curStor += item.curStor;
        grandTotals.pyStor += item.pyStor;
        grandTotals.pyEndStor += item.pyEndStor;
        grandTotals.pyEndSale += item.pyEndSale;
        grandTotals.curOrd += item.curOrd;
        grandTotals.pyOrd += item.pyOrd;
      });
      
      // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
      const selectedCategory = window.salesRateSelectedCategory || 'ì „ì²´';
      let items = allItems;
      if (selectedCategory !== 'ì „ì²´') {
        items = allItems.filter(item => item.category === selectedCategory);
      }
      
      // ë‹¹ë…„ ëˆ„ì  TAG ë§¤ì¶œ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      items.sort((a, b) => b.curSale - a.curSale);
      
      // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ í•©ê³„ ê³„ì‚°
      const totals = {
        curSale: 0,
        pySale: 0,
        curStor: 0,
        pyStor: 0,
        pyEndStor: 0,
        pyEndSale: 0,
        curOrd: 0,
        pyOrd: 0
      };
      
      items.forEach(item => {
        totals.curSale += item.curSale;
        totals.pySale += item.pySale;
        totals.curStor += item.curStor;
        totals.pyStor += item.pyStor;
        totals.pyEndStor += item.pyEndStor;
        totals.pyEndSale += item.pyEndSale;
        totals.curOrd += item.curOrd;
        totals.pyOrd += item.pyOrd;
      });
      
      // í…Œì´ë¸” ìƒì„±
      const tbody = document.getElementById('sales-rate-tbody');
      if (!tbody) {
        console.error('[íŒë§¤ìœ¨] tbody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      let html = '';
      
      // === 1. ì „ì²´ í•©ê³„ í–‰ (í•­ìƒ í‘œì‹œ) ===
      const grandTotalSaleYOY = grandTotals.pySale > 0 ? Math.round((grandTotals.curSale / grandTotals.pySale) * 100) : 0;
      const grandTotalCurRate = grandTotals.curStor > 0 ? ((grandTotals.curSale / grandTotals.curStor) * 100).toFixed(1) : '0.0';
      const grandTotalPyRate = grandTotals.pyStor > 0 ? ((grandTotals.pySale / grandTotals.pyStor) * 100).toFixed(1) : '0.0';
      const grandTotalDiff = (parseFloat(grandTotalCurRate) - parseFloat(grandTotalPyRate)).toFixed(1);
      const grandTotalPyEndRate = grandTotals.pyEndStor > 0 ? ((grandTotals.pyEndSale / grandTotals.pyEndStor) * 100).toFixed(1) : '0.0';
      const grandTotalOrdYOY = grandTotals.pyOrd > 0 ? Math.round((grandTotals.curOrd / grandTotals.pyOrd) * 100) : 0;
      const grandTotalStorYOY = grandTotals.pyStor > 0 ? Math.round((grandTotals.curStor / grandTotals.pyStor) * 100) : 0;
      
      const grandTotalCurSaleMillion = Math.round(grandTotals.curSale / 1000000);
      const grandTotalCurOrdMillion = Math.round(grandTotals.curOrd / 1000000);
      const grandTotalCurStorMillion = Math.round(grandTotals.curStor / 1000000);
      
      html += `
        <tr style="background:#e0e7ff;font-weight:700;border-bottom:3px solid #818cf8;">
          <td style="position:sticky;left:0;z-index:10;background:#e0e7ff;padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:14px;color:#3730a3;">ì „ì²´í•©ê³„</td>
          <td style="position:sticky;left:80px;z-index:10;background:#e0e7ff;padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;">-</td>
          <td style="position:sticky;left:180px;z-index:10;background:#e0e7ff;padding:12px 8px;text-align:left;border-bottom:3px solid #818cf8;border-right:2px solid #818cf8;font-size:13px;">ì „ì²´</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;border-right:2px solid #818cf8;font-size:13px;">100%</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:3px solid #818cf8;font-size:13px;color:#3730a3;">${grandTotalCurSaleMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;color:${grandTotalSaleYOY >= 100 ? '#059669' : '#dc2626'}">${grandTotalSaleYOY}%</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;color:#3730a3;">${grandTotalCurRate}%</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;">${grandTotalPyRate}%</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;color:${grandTotalDiff >= 0 ? '#059669' : '#dc2626'}">${grandTotalDiff >= 0 ? '+' : ''}${grandTotalDiff}%p</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;border-right:2px solid #818cf8;font-size:13px;">${grandTotalPyEndRate}%</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:3px solid #818cf8;font-size:13px;">${grandTotalCurOrdMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;color:${grandTotalOrdYOY >= 100 ? '#059669' : '#dc2626'}">${grandTotalOrdYOY}%</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:3px solid #818cf8;font-size:13px;">${grandTotalCurStorMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:3px solid #818cf8;font-size:13px;color:${grandTotalStorYOY >= 100 ? '#059669' : '#dc2626'}">${grandTotalStorYOY}%</td>
        </tr>
      `;
      
      // === 2. ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í•©ê³„ í–‰ (í•„í„°ë§ ì‹œë§Œ í‘œì‹œ) ===
      if (selectedCategory !== 'ì „ì²´') {
        const totalSaleYOY = totals.pySale > 0 ? Math.round((totals.curSale / totals.pySale) * 100) : 0;
        const totalCurRate = totals.curStor > 0 ? ((totals.curSale / totals.curStor) * 100).toFixed(1) : '0.0';
        const totalPyRate = totals.pyStor > 0 ? ((totals.pySale / totals.pyStor) * 100).toFixed(1) : '0.0';
        const totalDiff = (parseFloat(totalCurRate) - parseFloat(totalPyRate)).toFixed(1);
        const totalPyEndRate = totals.pyEndStor > 0 ? ((totals.pyEndSale / totals.pyEndStor) * 100).toFixed(1) : '0.0';
        const totalOrdYOY = totals.pyOrd > 0 ? Math.round((totals.curOrd / totals.pyOrd) * 100) : 0;
        const totalStorYOY = totals.pyStor > 0 ? Math.round((totals.curStor / totals.pyStor) * 100) : 0;
        
        const totalCurSaleMillion = Math.round(totals.curSale / 1000000);
        const totalCurOrdMillion = Math.round(totals.curOrd / 1000000);
        const totalCurStorMillion = Math.round(totals.curStor / 1000000);
        
        // ì „ì²´ ëŒ€ë¹„ ë¹„ì¤‘ ê³„ì‚°
        const categoryWeight = grandTotals.curSale > 0 ? ((totals.curSale / grandTotals.curSale) * 100).toFixed(1) : '0.0';
        
        html += `
          <tr style="background:#dbeafe;font-weight:700;">
            <td style="position:sticky;left:0;z-index:10;background:#dbeafe;padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;">${selectedCategory} í•©ê³„</td>
            <td style="position:sticky;left:80px;z-index:10;background:#dbeafe;padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;">-</td>
            <td style="position:sticky;left:180px;z-index:10;background:#dbeafe;padding:12px 8px;text-align:left;border-bottom:2px solid #93c5fd;border-right:2px solid #93c5fd;font-size:13px;">${selectedCategory}</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;border-right:2px solid #93c5fd;font-size:13px;">${categoryWeight}%</td>
            <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalCurSaleMillion.toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:${totalSaleYOY >= 100 ? '#059669' : '#dc2626'}">${totalSaleYOY}%</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalCurRate}%</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;">${totalPyRate}%</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:${totalDiff >= 0 ? '#059669' : '#dc2626'}">${totalDiff >= 0 ? '+' : ''}${totalDiff}%p</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;border-right:2px solid #93c5fd;font-size:13px;">${totalPyEndRate}%</td>
            <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;">${totalCurOrdMillion.toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:${totalOrdYOY >= 100 ? '#059669' : '#dc2626'}">${totalOrdYOY}%</td>
            <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;">${totalCurStorMillion.toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:${totalStorYOY >= 100 ? '#059669' : '#dc2626'}">${totalStorYOY}%</td>
          </tr>
        `;
      }
      
      // ì•„ì´í…œë³„ í–‰ ì¶”ê°€
      items.forEach((item, index) => {
        // ì „ì²´ ëŒ€ë¹„ ë¹„ì¤‘ ê³„ì‚° (grandTotals ì‚¬ìš©)
        const itemWeight = grandTotals.curSale > 0 ? ((item.curSale / grandTotals.curSale) * 100).toFixed(1) : '0.0';
        const saleYOY = item.pySale > 0 ? Math.round((item.curSale / item.pySale) * 100) : 0;
        const curRate = item.curStor > 0 ? ((item.curSale / item.curStor) * 100).toFixed(1) : '0.0';
        const pyRate = item.pyStor > 0 ? ((item.pySale / item.pyStor) * 100).toFixed(1) : '0.0';
        const diff = (parseFloat(curRate) - parseFloat(pyRate)).toFixed(1);
        const pyEndRate = item.pyEndStor > 0 ? ((item.pyEndSale / item.pyEndStor) * 100).toFixed(1) : '0.0';
        const ordYOY = item.pyOrd > 0 ? Math.round((item.curOrd / item.pyOrd) * 100) : 0;
        const storYOY = item.pyStor > 0 ? Math.round((item.curStor / item.pyStor) * 100) : 0;
        
        const curSaleMillion = Math.round(item.curSale / 1000000);
        const curOrdMillion = Math.round(item.curOrd / 1000000);
        const curStorMillion = Math.round(item.curStor / 1000000);
        
        html += `
          <tr style="cursor:pointer;transition:all 0.2s ease;" onclick="openDrilldown('${item.itemCode}')" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='#fff'">
            <td style="position:sticky;left:0;z-index:5;background:inherit;padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;">${item.prdtKind}</td>
            <td style="position:sticky;left:80px;z-index:5;background:inherit;padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;font-weight:600;">${item.itemCode}</td>
            <td style="position:sticky;left:180px;z-index:5;background:inherit;padding:10px 8px;text-align:left;border-bottom:1px solid #e5e7eb;border-right:2px solid #cbd5e1;font-size:12px;">${item.itemName}</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;border-right:2px solid #cbd5e1;font-size:12px;">${itemWeight}%</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;font-weight:600;">${curSaleMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;color:${saleYOY >= 100 ? '#059669' : '#dc2626'}">${saleYOY}%</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;font-weight:600;">${curRate}%</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;">${pyRate}%</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;color:${diff >= 0 ? '#059669' : '#dc2626'}">${diff >= 0 ? '+' : ''}${diff}%p</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;border-right:2px solid #cbd5e1;font-size:12px;">${pyEndRate}%</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${curOrdMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;color:${ordYOY >= 100 ? '#059669' : '#dc2626'}">${ordYOY}%</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${curStorMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;color:${storYOY >= 100 ? '#059669' : '#dc2626'}">${storYOY}%</td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
      
      // ìºì‹œì— ì•„ì´í…œ ë°ì´í„° ì €ì¥ (ë“œë¦´ë‹¤ìš´ìš©)
      if (!window.salesRateCache) {
        window.salesRateCache = {};
      }
      window.salesRateCache[currentBrand] = items;
      
      console.log('[íŒë§¤ìœ¨] í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ, ìºì‹œ ì €ì¥:', items.length, 'ê°œ ì•„ì´í…œ');
      
      } catch (error) {
        console.error('[íŒë§¤ìœ¨] í…Œì´ë¸” ë Œë”ë§ ì—ëŸ¬:', error);
        console.error('[íŒë§¤ìœ¨] ì—ëŸ¬ ìƒì„¸:', error.message, error.stack);
        throw error;  // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ ìƒìœ„ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡
      }
    }
    
    // ë“œë¦´ë‹¤ìš´ íŒ¨ë„ ì—´ê¸°
    function openDrilldown(itemCode) {
      console.log('[ë“œë¦´ë‹¤ìš´] ì•„ì´í…œ ì½”ë“œ:', itemCode);
      
      // ì•„ì´í…œ ë°ì´í„° ì°¾ê¸°
      const items = window.salesRateCache[currentBrand];
      const item = items.find(i => i.itemCode === itemCode);
      
      if (!item) {
        console.error('[ë“œë¦´ë‹¤ìš´] ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', itemCode);
        return;
      }
      
      // íŒ¨ë„ ì œëª© ì—…ë°ì´íŠ¸
      const titleEl = document.getElementById('drilldown-title');
      if (titleEl) {
        titleEl.textContent = `${item.itemName} (${itemCode})`;
      }
      
      // í˜„ì¬ ì„ íƒëœ ê¸°ê°„
      window.currentDrilldownItem = item;
      window.currentDrilldownPeriod = 'CUR';
      
      // ë“œë¦´ë‹¤ìš´ í…Œì´ë¸” ë Œë”ë§
      renderDrilldownTable();
      
      // íŒ¨ë„ ì—´ê¸°
      const panel = document.getElementById('drilldown-panel');
      if (panel) {
        panel.classList.add('open');
      }
    }
    
    // ë“œë¦´ë‹¤ìš´ í…Œì´ë¸” ë Œë”ë§
    function renderDrilldownTable() {
      const item = window.currentDrilldownItem;
      const period = window.currentDrilldownPeriod || 'CUR';
      
      if (!item) return;
      
      // í•´ë‹¹ ê¸°ê°„ì˜ ìƒí’ˆ í•„í„°ë§
      const products = item.products.filter(p => p.period === period);
      
      // ëˆ„ì  íŒë§¤ TAG ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      products.sort((a, b) => b.sale - a.sale);
      
      // í•©ê³„ ê³„ì‚°
      const totals = {
        sale: 0,
        stor: 0,
        ord: 0,
        stock: 0
      };
      
      products.forEach(product => {
        totals.sale += product.sale;
        totals.stor += product.stor;
        totals.ord += product.ord;
        totals.stock += product.stock;
      });
      
      // í…Œì´ë¸” ë Œë”ë§
      const tbody = document.getElementById('drilldown-tbody');
      if (!tbody) return;
      
      let html = '';
      
      // í•©ê³„ í–‰ ì¶”ê°€
      const totalSaleMillion = Math.round(totals.sale / 1000000);
      const totalStorMillion = Math.round(totals.stor / 1000000);
      const totalOrdMillion = Math.round(totals.ord / 1000000);
      const totalStockMillion = Math.round(totals.stock / 1000000);
      const totalRate = totals.stor > 0 ? ((totals.sale / totals.stor) * 100).toFixed(1) : '0.0';
      
      html += `
        <tr style="background:#dbeafe;font-weight:700;border-bottom:2px solid #93c5fd;">
          <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">í•©ê³„</td>
          <td style="padding:12px 8px;text-align:left;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">ì „ì²´ ìƒí’ˆ</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalSaleMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:center;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;font-weight:700;">${totalRate}%</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalOrdMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalStorMillion.toLocaleString()}</td>
          <td style="padding:12px 8px;text-align:right;border-bottom:2px solid #93c5fd;font-size:13px;color:#1e40af;">${totalStockMillion.toLocaleString()}</td>
        </tr>
      `;
      
      // ìƒí’ˆ ë°ì´í„° í–‰
      products.forEach((product, idx) => {
        const saleMillion = Math.round(product.sale / 1000000);
        const storMillion = Math.round(product.stor / 1000000);
        const ordMillion = Math.round(product.ord / 1000000);
        const stockMillion = Math.round(product.stock / 1000000);
        const rate = product.stor > 0 ? ((product.sale / product.stor) * 100).toFixed(1) : '0.0';
        
        const rowBg = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
        
        html += `
          <tr style="background:${rowBg};">
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;">${product.productCode}</td>
            <td style="padding:10px 8px;text-align:left;border-bottom:1px solid #e5e7eb;font-size:12px;">${product.productName}</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${saleMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:center;border-bottom:1px solid #e5e7eb;font-size:12px;font-weight:600;">${rate}%</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${ordMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${storMillion.toLocaleString()}</td>
            <td style="padding:10px 8px;text-align:right;border-bottom:1px solid #e5e7eb;font-size:12px;">${stockMillion.toLocaleString()}</td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }
    
    // ==================== ì¬ê³ ì£¼ìˆ˜ ê´€ë ¨ í•¨ìˆ˜ ====================
    
    // ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ
    async function loadStockWeeksData(forceUpdate = false) {
      console.log('[ì¬ê³ ì£¼ìˆ˜] ë°ì´í„° ë¡œë“œ ì‹œì‘', { forceUpdate });
      
      // ë¡œë”© í‘œì‹œ
      const loadingDiv = document.getElementById('stock-weeks-loading');
      const errorDiv = document.getElementById('stock-weeks-error');
      const tableWrapper = document.getElementById('stock-weeks-table-wrapper');
      
      if (loadingDiv) loadingDiv.style.display = 'block';
      if (errorDiv) errorDiv.style.display = 'none';
      if (tableWrapper) tableWrapper.style.display = 'none';
      
      try {
        // API í˜¸ì¶œ (ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©)
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        const forceParam = forceUpdate ? '&forceUpdate=true' : '';
        const response = await fetch(`/api/stock-weeks?date=${apiDate}${forceParam}`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
        
        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        window.stockWeeksData = result;
        console.log('[ì¬ê³ ì£¼ìˆ˜] ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        updateStockWeeksDateInfo(result);
        
        // ì¹´í…Œê³ ë¦¬ í•„í„° ì„¤ì •
        setupStockWeeksFilters();
        
        // í…Œì´ë¸” ë Œë”ë§
        renderStockWeeksTable();
        
        // ë¡œë”© ìˆ¨ê¹€, í…Œì´ë¸” í‘œì‹œ
        if (loadingDiv) loadingDiv.style.display = 'none';
        if (tableWrapper) tableWrapper.style.display = 'block';
        
      } catch (error) {
        console.error('[ì¬ê³ ì£¼ìˆ˜] ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
        
        // ì—ëŸ¬ í‘œì‹œ
        if (loadingDiv) loadingDiv.style.display = 'none';
        if (errorDiv) {
          errorDiv.style.display = 'block';
          const errorMsg = errorDiv.querySelector('p');
          if (errorMsg) {
            errorMsg.textContent = `âš ï¸ ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${error.message})`;
          }
        }
      }
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateStockWeeksDateInfo(result) {
      const updateDateEl = document.getElementById('stock-weeks-update-date');
      const sevenDStartEl = document.getElementById('stock-weeks-7d-start');
      const sevenDEndEl = document.getElementById('stock-weeks-7d-end');
      const twentyEightDStartEl = document.getElementById('stock-weeks-28d-start');
      const twentyEightDEndEl = document.getElementById('stock-weeks-28d-end');
      
      // ì—…ë°ì´íŠ¸ ì¼ì: ì˜¤ëŠ˜ ë‚ ì§œ (Snowflake ë°ì´í„°ë¥¼ ë•¡ê¸°ëŠ” ë‚ )
      if (updateDateEl) {
        const today = new Date().toISOString().split('T')[0];
        updateDateEl.textContent = today;
      }
      
      // ê¸°ì¤€ì¼ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ê³„ì‚°
      if (result.asof_dt) {
        const asofDate = new Date(result.asof_dt);
        
        // ì£¼ê°„ë§¤ì¶œ: ìµœê·¼ 7ì¼ (asof_dt - 6 ~ asof_dt)
        const sevenDStart = new Date(asofDate);
        sevenDStart.setDate(sevenDStart.getDate() - 6);
        
        // 4ì£¼: ìµœê·¼ 28ì¼ (asof_dt - 27 ~ asof_dt)
        const twentyEightDStart = new Date(asofDate);
        twentyEightDStart.setDate(twentyEightDStart.getDate() - 27);
        
        const formatDate = (date) => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        };
        
        if (sevenDStartEl) sevenDStartEl.textContent = formatDate(sevenDStart);
        if (sevenDEndEl) sevenDEndEl.textContent = result.asof_dt;
        if (twentyEightDStartEl) twentyEightDStartEl.textContent = formatDate(twentyEightDStart);
        if (twentyEightDEndEl) twentyEightDEndEl.textContent = result.asof_dt;
      }
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ì¹´í…Œê³ ë¦¬ í•„í„° ì„¤ì •
    function setupStockWeeksFilters() {
      if (!window.stockWeeksData || !window.stockWeeksData.data || !currentBrand) return;
      
      const brandCodeMap = {
        'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X',
        'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[currentBrand];
      
      // ë‹¹ë…„ ë°ì´í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
      const cyData = window.stockWeeksData.data.CY || [];
      const brandCyData = cyData.filter(row => row.BRD_CD === brandCode);
      
      const categories = new Set();
      brandCyData.forEach(row => {
        if (row.PRDT_KIND_NM) categories.add(row.PRDT_KIND_NM);
      });
      
      // í•„í„° ë²„íŠ¼ ìƒì„±
      const filtersDiv = document.getElementById('stock-weeks-filters');
      if (!filtersDiv) return;
      
      let html = '<button class="stock-weeks-filter-btn active" data-category="ì „ì²´" style="padding:8px 16px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">ì „ì²´</button>';
      
      [...categories].sort().forEach(cat => {
        html += `<button class="stock-weeks-filter-btn" data-category="${cat}" style="padding:8px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">${cat}</button>`;
      });
      
      filtersDiv.innerHTML = html;
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const buttons = filtersDiv.querySelectorAll('.stock-weeks-filter-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          window.stockWeeksSelectedCategory = category;
          
          // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
          buttons.forEach(b => {
            if (b === this) {
              b.style.background = '#4f46e5';
              b.style.color = '#fff';
              b.classList.add('active');
            } else {
              b.style.background = '#e5e7eb';
              b.style.color = '#374151';
              b.classList.remove('active');
            }
          });
          
          // í…Œì´ë¸” ì¬ë Œë”ë§
          renderStockWeeksTable();
        });
      });
    }
    
    // ì¬ê³ ì£¼ìˆ˜ í…Œì´ë¸” ë Œë”ë§
    function renderStockWeeksTable() {
      try {
        console.log('[ì¬ê³ ì£¼ìˆ˜] renderStockWeeksTable ì‹œì‘');
        
        if (!window.stockWeeksData || !currentBrand) {
          console.warn('[ì¬ê³ ì£¼ìˆ˜] ë°ì´í„° ë˜ëŠ” ë¸Œëœë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const brandCodeMap = {
          'MLB': 'M', 'MLB_KIDS': 'I', 'DISCOVERY': 'X',
          'DUVETICA': 'V', 'SERGIO': 'ST', 'SUPRA': 'W'
        };
        const brandCode = brandCodeMap[currentBrand];
        
        const dataSource = window.stockWeeksData.data || window.stockWeeksData;
        const cyData = dataSource.CY || [];
        const pyData = dataSource.PY || [];
        
        // ë¸Œëœë“œ í•„í„°ë§
        const brandCyData = cyData.filter(row => row.BRD_CD === brandCode);
        const brandPyData = pyData.filter(row => row.BRD_CD === brandCode);
        
        console.log('[ì¬ê³ ì£¼ìˆ˜] ë¸Œëœë“œ:', currentBrand, 'ë‹¹ë…„:', brandCyData.length, 'ì „ë…„:', brandPyData.length);
        
        // prdt_cd ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘ (ë‹¹ë…„/ì „ë…„ ë³‘í•©)
        const prdtMap = {};
        
        brandCyData.forEach(row => {
          const key = row.PRDT_CD;
          if (!prdtMap[key]) {
            prdtMap[key] = {
              category: row.PRDT_KIND_NM || '-',
              item: row.ITEM_CD || '-',
              itemName: row.ITEM_NM || '-',
              prdtCode: row.PRDT_CD,
              prdtName: row.PRDT_NM || '-',
              cy: null,
              py: null
            };
          }
          prdtMap[key].cy = row;
        });
        
        brandPyData.forEach(row => {
          const key = row.PRDT_CD;
          if (!prdtMap[key]) {
            prdtMap[key] = {
              category: row.PRDT_KIND_NM || '-',
              item: row.ITEM_CD || '-',
              itemName: row.ITEM_NM || '-',
              prdtCode: row.PRDT_CD,
              prdtName: row.PRDT_NM || '-',
              cy: null,
              py: null
            };
          }
          prdtMap[key].py = row;
        });
        
        // item ë ˆë²¨ë¡œ ì§‘ê³„
        const itemMap = {};
        
        Object.values(prdtMap).forEach(prdt => {
          const itemKey = prdt.item;
          
          if (!itemMap[itemKey]) {
            itemMap[itemKey] = {
              category: prdt.category,
              item: prdt.item,
              itemName: prdt.itemName,
              saleQty7d: 0,
              saleTag7d: 0,
              saleQty28d: 0,
              stockQty: 0,
              stockTag: 0,
              pySaleQty7d: 0,
              pySaleTag7d: 0,
              pySaleQty28d: 0,  // ì¶”ê°€!
              pyStockQty: 0,
              pyStockTag: 0,
              products: []
            };
          }
          
          // ë‹¹ë…„ ë°ì´í„°
          if (prdt.cy) {
            itemMap[itemKey].saleQty7d += prdt.cy.SALE_QTY_7D || 0;
            itemMap[itemKey].saleTag7d += prdt.cy.SALE_TAG_7D || 0;
            itemMap[itemKey].saleQty28d += prdt.cy.SALE_QTY_28D || 0;
            itemMap[itemKey].stockQty += prdt.cy.STOCK_QTY || 0;
            itemMap[itemKey].stockTag += prdt.cy.STOCK_TAG_AMT || 0;
          }
          
          // ì „ë…„ ë°ì´í„°
          if (prdt.py) {
            itemMap[itemKey].pySaleQty7d += prdt.py.SALE_QTY_7D || 0;
            itemMap[itemKey].pySaleTag7d += prdt.py.SALE_TAG_7D || 0;
            itemMap[itemKey].pySaleQty28d += prdt.py.SALE_QTY_28D || 0;  // ì¶”ê°€!
            itemMap[itemKey].pyStockQty += prdt.py.STOCK_QTY || 0;
            itemMap[itemKey].pyStockTag += prdt.py.STOCK_TAG_AMT || 0;
          }
          
          // ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
          itemMap[itemKey].products.push(prdt);
        });
        
        // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        const selectedCategory = window.stockWeeksSelectedCategory || 'ì „ì²´';
        let items = Object.values(itemMap);
        
        if (selectedCategory !== 'ì „ì²´') {
          items = items.filter(item => item.category === selectedCategory);
        }
        
        // ì£¼ê°„TAGë§¤ì¶œ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        items.sort((a, b) => b.saleTag7d - a.saleTag7d);
        
        // ìºì‹œì— ì €ì¥ (ë“œë¦´ë‹¤ìš´ìš©)
        if (!window.stockWeeksCache) window.stockWeeksCache = {};
        window.stockWeeksCache[currentBrand] = itemMap;
        
        // í•©ê³„ ê³„ì‚°
        const grandTotals = {
          saleQty7d: 0,
          saleTag7d: 0,
          saleQty28d: 0,
          stockQty: 0,
          stockTag: 0,
          pySaleTag7d: 0,
          pySaleQty28d: 0,
          pyStockQty: 0,
          pyStockTag: 0
        };
        
        const categoryTotals = {
          saleQty7d: 0,
          saleTag7d: 0,
          saleQty28d: 0,
          stockQty: 0,
          stockTag: 0
        };
        
        items.forEach(item => {
          grandTotals.saleQty7d += item.saleQty7d;
          grandTotals.saleTag7d += item.saleTag7d;
          grandTotals.saleQty28d += item.saleQty28d;
          grandTotals.stockQty += item.stockQty;
          grandTotals.stockTag += item.stockTag;
          grandTotals.pySaleTag7d += item.pySaleTag7d;
          grandTotals.pySaleQty28d += item.pySaleQty28d;
          grandTotals.pyStockQty += item.pyStockQty;
          grandTotals.pyStockTag += item.pyStockTag;
          
          if (selectedCategory !== 'ì „ì²´' && item.category === selectedCategory) {
            categoryTotals.saleQty7d += item.saleQty7d;
            categoryTotals.saleTag7d += item.saleTag7d;
            categoryTotals.saleQty28d += item.saleQty28d;
            categoryTotals.stockQty += item.stockQty;
            categoryTotals.stockTag += item.stockTag;
          }
        });
        
        // 4ì£¼ í‰ê· íŒë§¤ëŸ‰ ê³„ì‚°
        const grand4wAvg = grandTotals.saleQty28d / 4;
        const grandStockWeeks = grand4wAvg > 0 ? grandTotals.stockQty / grand4wAvg : 0;
        
        // ì „ì²´ í•©ê³„ YOY ê³„ì‚°
        const grandSaleYoy = grandTotals.pySaleTag7d > 0 
          ? Math.round((grandTotals.saleTag7d / grandTotals.pySaleTag7d) * 100) + '%'
          : '-';
        const grandSaleYoyColor = grandTotals.pySaleTag7d > 0 && (grandTotals.saleTag7d / grandTotals.pySaleTag7d) >= 1
          ? '#10b981' : '#dc2626';
        
        const grandStockYoy = grandTotals.pyStockTag > 0
          ? Math.round((grandTotals.stockTag / grandTotals.pyStockTag) * 100) + '%'
          : '-';
        const grandStockYoyColor = grandTotals.pyStockTag > 0 && (grandTotals.stockTag / grandTotals.pyStockTag) >= 1
          ? '#10b981' : '#dc2626';
        
        // ì „ì²´ í•©ê³„ ì¬ê³ ì£¼ìˆ˜ ì°¨ì´
        let grandStockWeeksDiff = '-';
        if (grandTotals.pyStockQty > 0 && grandTotals.pySaleQty28d > 0) {
          const pyGrand4wAvg = grandTotals.pySaleQty28d / 4;
          const pyGrandStockWeeks = pyGrand4wAvg > 0 ? grandTotals.pyStockQty / pyGrand4wAvg : 0;
          const diff = grandStockWeeks - pyGrandStockWeeks;
          grandStockWeeksDiff = (diff >= 0 ? '+' : '') + diff.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        const category4wAvg = categoryTotals.saleQty28d / 4;
        const categoryStockWeeks = category4wAvg > 0 ? categoryTotals.stockQty / category4wAvg : 0;
        
        // ë°±ë§Œ ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜ (ì²œë‹¨ìœ„ ì»´ë§ˆë§Œ, 'ë°±' ì œê±°)
        const formatMillion = (value) => {
          return Math.round(value / 1000000).toLocaleString();
        };
        
        // HTML ìƒì„±
        let html = '';
        const tbody = document.getElementById('stock-weeks-tbody');
        
        // ì „ì²´ í•©ê³„ í–‰
        html += `
          <tr style="background:#fef3c7;font-weight:700;border-bottom:2px solid #fbbf24;">
            <td style="position:sticky;left:0;z-index:10;background:#fef3c7;padding:12px 8px;text-align:center;font-size:14px;">ì „ì²´í•©ê³„</td>
            <td style="position:sticky;left:100px;z-index:10;background:#fef3c7;padding:12px 8px;text-align:center;font-size:14px;">-</td>
            <td style="position:sticky;left:180px;z-index:10;background:#fef3c7;padding:12px 8px;text-align:left;font-size:14px;border-right:2px solid #cbd5e1;">-</td>
            <td style="padding:12px 8px;text-align:right;font-size:14px;">${grandTotals.saleQty7d.toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:right;font-size:14px;">${formatMillion(grandTotals.saleTag7d)}</td>
            <td style="padding:12px 8px;text-align:center;font-size:14px;font-weight:600;color:${grandSaleYoyColor};border-right:2px solid #cbd5e1;">${grandSaleYoy}</td>
            <td style="padding:12px 8px;text-align:right;font-size:14px;">${Math.round(grand4wAvg).toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:center;font-size:14px;font-weight:600;color:${grandStockWeeks <= 20 ? '#10b981' : grandStockWeeks <= 50 ? '#f59e0b' : '#dc2626'};">${grandStockWeeks.toFixed(1).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}ì£¼</td>
            <td style="padding:12px 8px;text-align:center;font-size:14px;border-right:2px solid #cbd5e1;">${grandStockWeeksDiff}</td>
            <td style="padding:12px 8px;text-align:right;font-size:14px;">${grandTotals.stockQty.toLocaleString()}</td>
            <td style="padding:12px 8px;text-align:right;font-size:14px;">${formatMillion(grandTotals.stockTag)}</td>
            <td style="padding:12px 8px;text-align:center;font-size:14px;font-weight:600;color:${grandStockYoyColor};">${grandStockYoy}</td>
          </tr>
        `;
        
        // ì¹´í…Œê³ ë¦¬ í•©ê³„ í–‰ (ì „ì²´ê°€ ì•„ë‹ ë•Œ)
        if (selectedCategory !== 'ì „ì²´') {
          html += `
            <tr style="background:#e0f2fe;font-weight:700;border-bottom:2px solid #38bdf8;">
              <td style="position:sticky;left:0;z-index:10;background:#e0f2fe;padding:12px 8px;text-align:center;">${selectedCategory} í•©ê³„</td>
              <td style="position:sticky;left:100px;z-index:10;background:#e0f2fe;padding:12px 8px;text-align:center;">-</td>
              <td style="position:sticky;left:180px;z-index:10;background:#e0f2fe;padding:12px 8px;text-align:left;border-right:2px solid #cbd5e1;">-</td>
              <td style="padding:12px 8px;text-align:right;">${categoryTotals.saleQty7d.toLocaleString()}</td>
              <td style="padding:12px 8px;text-align:right;">${formatMillion(categoryTotals.saleTag7d)}</td>
              <td style="padding:12px 8px;text-align:center;border-right:2px solid #cbd5e1;">-</td>
              <td style="padding:12px 8px;text-align:right;">${Math.round(category4wAvg).toLocaleString()}</td>
              <td style="padding:12px 8px;text-align:center;">${categoryStockWeeks.toFixed(1)}ì£¼</td>
              <td style="padding:12px 8px;text-align:center;border-right:2px solid #cbd5e1;">-</td>
              <td style="padding:12px 8px;text-align:right;">${categoryTotals.stockQty.toLocaleString()}</td>
              <td style="padding:12px 8px;text-align:right;">${formatMillion(categoryTotals.stockTag)}</td>
              <td style="padding:12px 8px;text-align:center;">-</td>
            </tr>
          `;
        }
        
        // ì•„ì´í…œ í–‰
        items.forEach(item => {
          const avg4w = item.saleQty28d / 4;
          const stockWeeks = avg4w > 0 ? item.stockQty / avg4w : 0;
          
          // ë””ë²„ê·¸: CP ì•„ì´í…œ í™•ì¸
          if (item.item === 'CP') {
            console.log('[ì¬ê³ ì£¼ìˆ˜] CP ì•„ì´í…œ ìƒì„¸:', {
              ë‹¹ë…„ì¬ê³ ìˆ˜ëŸ‰: item.stockQty,
              ë‹¹ë…„4ì£¼íŒë§¤ëŸ‰: item.saleQty28d,
              ë‹¹ë…„í‰ê· : avg4w,
              ë‹¹ë…„ì¬ê³ ì£¼ìˆ˜: stockWeeks.toFixed(1),
              ì „ë…„ì¬ê³ ìˆ˜ëŸ‰: item.pyStockQty,
              ì „ë…„4ì£¼íŒë§¤ëŸ‰: item.pySaleQty28d,
              ì „ë…„í‰ê· : item.pySaleQty28d / 4,
              ì „ë…„ì¬ê³ ì£¼ìˆ˜: item.pySaleQty28d > 0 ? (item.pyStockQty / (item.pySaleQty28d / 4)).toFixed(1) : 'N/A'
            });
          }
          
          // ë§¤ì¶œYOY ê³„ì‚° (ë‹¬ì„±ë¥ : ì „ë…„ ëŒ€ë¹„ ë‹¹ë…„ ë¹„ìœ¨, ì •ìˆ˜)
          let saleYoy = '-';
          let saleYoyColor = '#1f2937';
          if (item.pySaleTag7d > 0) {
            const yoyValue = (item.saleTag7d / item.pySaleTag7d) * 100;
            saleYoy = Math.round(yoyValue) + '%';
            // ìƒ‰ìƒ: 100% ì´ìƒ ì´ˆë¡, 100% ë¯¸ë§Œ ë¹¨ê°•
            saleYoyColor = yoyValue >= 100 ? '#10b981' : '#dc2626';
          }
          
          // ì¬ê³ YOY ê³„ì‚° (ë‹¬ì„±ë¥ : ì „ë…„ ëŒ€ë¹„ ë‹¹ë…„ ë¹„ìœ¨, ì •ìˆ˜)
          let stockYoy = '-';
          let stockYoyColor = '#1f2937';
          if (item.pyStockTag > 0) {
            const yoyValue = (item.stockTag / item.pyStockTag) * 100;
            stockYoy = Math.round(yoyValue) + '%';
            // ìƒ‰ìƒ: 100% ì´ìƒ ì´ˆë¡, 100% ë¯¸ë§Œ ë¹¨ê°•
            stockYoyColor = yoyValue >= 100 ? '#10b981' : '#dc2626';
          }
          
          // ì¬ê³ ì£¼ìˆ˜ì°¨ì´ ê³„ì‚° (ì „ë…„ ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ)
          let stockWeeksDiff = '-';
          // ì „ë…„ ì¬ê³ ê°€ ìˆê³ , ì „ë…„ íŒë§¤ëŸ‰ì´ ìˆìœ¼ë©´ ê³„ì‚°
          if (item.pyStockQty > 0 && item.pySaleQty28d > 0) {
            const pyAvg4w = item.pySaleQty28d / 4;
            if (pyAvg4w > 0) {
              const pyStockWeeks = item.pyStockQty / pyAvg4w;
              const diff = stockWeeks - pyStockWeeks;
              stockWeeksDiff = (diff >= 0 ? '+' : '') + diff.toFixed(1);
            }
          }
          
          // ë°±ë§Œ ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜ (ì²œë‹¨ìœ„ ì»´ë§ˆë§Œ, 'ë°±' ì œê±°)
          const formatMillion = (value) => {
            return Math.round(value / 1000000).toLocaleString();
          };
          
          html += `
            <tr style="cursor:pointer;transition:background 0.2s;" 
                onclick="openStockWeeksDrilldown('${item.item}')"
                onmouseover="this.style.background='#f1f5f9'" 
                onmouseout="this.style.background=''">
              <td style="position:sticky;left:0;z-index:10;background:#fff;padding:10px 8px;text-align:center;font-size:13px;color:#1f2937;">${item.category}</td>
              <td style="position:sticky;left:100px;z-index:10;background:#fff;padding:10px 8px;text-align:center;font-size:13px;color:#1f2937;">${item.item}</td>
              <td style="position:sticky;left:180px;z-index:10;background:#fff;padding:10px 8px;text-align:left;font-size:13px;color:#1f2937;border-right:2px solid #cbd5e1;">${item.itemName}</td>
              <td style="padding:10px 8px;text-align:right;font-size:13px;color:#1f2937;">${item.saleQty7d.toLocaleString()}</td>
              <td style="padding:10px 8px;text-align:right;font-size:13px;color:#1f2937;">${formatMillion(item.saleTag7d)}</td>
              <td style="padding:10px 8px;text-align:center;font-size:13px;font-weight:600;color:${saleYoyColor};border-right:2px solid #cbd5e1;">${saleYoy}</td>
              <td style="padding:10px 8px;text-align:right;font-size:13px;color:#1f2937;">${Math.round(avg4w).toLocaleString()}</td>
              <td style="padding:10px 8px;text-align:center;font-size:13px;font-weight:600;color:${stockWeeks <= 20 ? '#10b981' : stockWeeks <= 50 ? '#f59e0b' : '#dc2626'};">${stockWeeks.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}ì£¼</td>
              <td style="padding:10px 8px;text-align:center;font-size:13px;color:#1f2937;border-right:2px solid #cbd5e1;">${stockWeeksDiff}</td>
              <td style="padding:10px 8px;text-align:right;font-size:13px;color:#1f2937;">${item.stockQty.toLocaleString()}</td>
              <td style="padding:10px 8px;text-align:right;font-size:13px;color:#1f2937;">${formatMillion(item.stockTag)}</td>
              <td style="padding:10px 8px;text-align:center;font-size:13px;font-weight:600;color:${stockYoyColor};">${stockYoy}</td>
            </tr>
          `;
        });
        
        tbody.innerHTML = html;
        
      } catch (error) {
        console.error('[ì¬ê³ ì£¼ìˆ˜] ë Œë”ë§ ì—ëŸ¬:', error);
      }
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ë“œë¦´ë‹¤ìš´ ì—´ê¸°
    function openStockWeeksDrilldown(itemCode) {
      console.log('[ì¬ê³ ì£¼ìˆ˜] ë“œë¦´ë‹¤ìš´:', itemCode);
      
      window.currentStockWeeksItem = itemCode;
      window.currentStockWeeksPeriod = 'CY';
      
      const panel = document.getElementById('stock-weeks-drilldown-panel');
      const title = document.getElementById('stock-weeks-drilldown-title');
      
      if (!panel) return;
      
      // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
      const itemData = window.stockWeeksCache?.[currentBrand]?.[itemCode];
      if (title && itemData) {
        title.textContent = `${itemData.itemName} (${itemCode}) ìƒì„¸`;
      }
      
      // íŒ¨ë„ ì—´ê¸°
      panel.classList.add('open');
      
      // í…Œì´ë¸” ë Œë”ë§
      renderStockWeeksDrilldownTable();
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ë“œë¦´ë‹¤ìš´ í…Œì´ë¸” ë Œë”ë§
    function renderStockWeeksDrilldownTable() {
      const itemCode = window.currentStockWeeksItem;
      const period = window.currentStockWeeksPeriod || 'CY';
      
      if (!itemCode || !window.stockWeeksCache || !window.stockWeeksCache[currentBrand]) {
        console.warn('[ì¬ê³ ì£¼ìˆ˜ ë“œë¦´ë‹¤ìš´] ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      const itemData = window.stockWeeksCache[currentBrand][itemCode];
      if (!itemData || !itemData.products) {
        console.warn('[ì¬ê³ ì£¼ìˆ˜ ë“œë¦´ë‹¤ìš´] ì•„ì´í…œ ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      const tbody = document.getElementById('stock-weeks-drilldown-tbody');
      if (!tbody) return;
      
      let html = '';
      let totalSaleQty7d = 0;
      let totalSaleTag7d = 0;
      let totalSaleQty28d = 0;
      let totalStockQty = 0;
      let totalStockTag = 0;
      
      // ë°±ë§Œ ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜
      const formatMillion = (value) => {
        return Math.round(value / 1000000).toLocaleString();
      };
      
      // ìƒí’ˆë³„ ë°ì´í„° í‘œì‹œ
      itemData.products.forEach(prdt => {
        const data = period === 'CY' ? prdt.cy : prdt.py;
        
        if (!data) return;
        
        const saleQty7d = data.SALE_QTY_7D || 0;
        const saleTag7d = data.SALE_TAG_7D || 0;
        const saleQty28d = data.SALE_QTY_28D || 0;
        const stockQty = data.STOCK_QTY || 0;
        const stockTag = data.STOCK_TAG_AMT || 0;
        
        const avg4w = saleQty28d / 4;
        const stockWeeks = avg4w > 0 ? stockQty / avg4w : 0;
        
        totalSaleQty7d += saleQty7d;
        totalSaleTag7d += saleTag7d;
        totalSaleQty28d += saleQty28d;
        totalStockQty += stockQty;
        totalStockTag += stockTag;
        
        html += `
          <tr style="border-bottom:1px solid #e5e7eb;">
            <td style="padding:8px 6px;text-align:center;font-size:11px;color:#1f2937;">${prdt.prdtCode}</td>
            <td style="padding:8px 6px;text-align:left;font-size:11px;color:#1f2937;">${prdt.prdtName}</td>
            <td style="padding:8px 6px;text-align:right;font-size:11px;color:#1f2937;">${saleQty7d.toLocaleString()}</td>
            <td style="padding:8px 6px;text-align:right;font-size:11px;color:#1f2937;">${formatMillion(saleTag7d)}</td>
            <td style="padding:8px 6px;text-align:right;font-size:11px;color:#1f2937;">${Math.round(avg4w).toLocaleString()}</td>
            <td style="padding:8px 6px;text-align:center;font-size:11px;font-weight:600;color:${stockWeeks <= 20 ? '#10b981' : stockWeeks <= 50 ? '#f59e0b' : '#dc2626'};">${stockWeeks > 0 ? stockWeeks.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì£¼' : 'íŒë§¤ì—†ìŒ'}</td>
            <td style="padding:8px 6px;text-align:right;font-size:11px;color:#1f2937;">${stockQty.toLocaleString()}</td>
            <td style="padding:8px 6px;text-align:right;font-size:11px;color:#1f2937;">${formatMillion(stockTag)}</td>
          </tr>
        `;
      });
      
      // í•©ê³„ í–‰
      const totalAvg4w = totalSaleQty28d / 4;
      const totalStockWeeks = totalAvg4w > 0 ? totalStockQty / totalAvg4w : 0;
      
      html = `
        <tr style="background:#f8fafc;font-weight:700;border-bottom:2px solid #cbd5e1;">
          <td style="padding:10px 6px;text-align:center;font-size:11px;color:#1f2937;">í•©ê³„</td>
          <td style="padding:10px 6px;text-align:left;font-size:11px;color:#1f2937;">-</td>
          <td style="padding:10px 6px;text-align:right;font-size:11px;color:#1f2937;">${totalSaleQty7d.toLocaleString()}</td>
          <td style="padding:10px 6px;text-align:right;font-size:11px;color:#1f2937;">${formatMillion(totalSaleTag7d)}</td>
          <td style="padding:10px 6px;text-align:right;font-size:11px;color:#1f2937;">${Math.round(totalAvg4w).toLocaleString()}</td>
          <td style="padding:10px 6px;text-align:center;font-size:11px;font-weight:700;color:${totalStockWeeks <= 20 ? '#10b981' : totalStockWeeks <= 50 ? '#f59e0b' : '#dc2626'};">${totalStockWeeks.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}ì£¼</td>
          <td style="padding:10px 6px;text-align:right;font-size:11px;color:#1f2937;">${totalStockQty.toLocaleString()}</td>
          <td style="padding:10px 6px;text-align:right;font-size:11px;color:#1f2937;">${formatMillion(totalStockTag)}</td>
        </tr>
      ` + html;
      
      tbody.innerHTML = html;
    }
    
    // ==================== ë: ì¬ê³ ì£¼ìˆ˜ ê´€ë ¨ í•¨ìˆ˜ ====================
    
    // ==================== ì „ì²´í˜„í™© íˆíŠ¸ë§µ API ì—°ë™ ====================
    
    // ì „ì²´í˜„í™©ìš© íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ
    async function loadOverviewSalesRateData() {
      if (window.overviewSalesRateData) {
        console.log('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë°ì´í„° ì´ë¯¸ ë¡œë“œë¨');
        return window.overviewSalesRateData;
      }
      
      try {
        console.log('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ ì‹œì‘');
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        
        // URLì—ì„œ month íŒŒë¼ë¯¸í„° ì½ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const monthParam = urlParams.get('month');
        
        // API URL êµ¬ì„±
        let url = `/api/sales-rate?date=${apiDate}`;
        if (monthParam) {
          url += `&month=${monthParam}`;
        }
        
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
        
        window.overviewSalesRateData = result;
        console.log('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        return result;
        
      } catch (error) {
        console.error('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
        return null;
      }
    }
    
    // ì „ì²´í˜„í™©ìš© ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ
    async function loadOverviewStockWeeksData() {
      if (window.overviewStockWeeksData) {
        console.log('[ì „ì²´í˜„í™©] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ì´ë¯¸ ë¡œë“œë¨');
        return window.overviewStockWeeksData;
      }
      
      try {
        console.log('[ì „ì²´í˜„í™©] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì‹œì‘');
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        const response = await fetch(`/api/stock-weeks?date=${apiDate}`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
        
        window.overviewStockWeeksData = result;
        console.log('[ì „ì²´í˜„í™©] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        return result;
        
      } catch (error) {
        console.error('[ì „ì²´í˜„í™©] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
        return null;
      }
    }
    
    // ==================== ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ (íŠ¸ë¦¬ë§µìš©) ====================
    
    // ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    async function loadSalesCompositionData(forceUpdate = false) {
      // ê°•ì œ ì—…ë°ì´íŠ¸ê°€ ì•„ë‹ˆê³  ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ìºì‹œ ë°˜í™˜
      if (!forceUpdate && window.salesCompositionData) {
        console.log('[ë§¤ì¶œêµ¬ì„±] ë°ì´í„° ì´ë¯¸ ë¡œë“œë¨ (ìºì‹œ ì‚¬ìš©)');
        return window.salesCompositionData;
      }
      
      try {
        console.log('[ë§¤ì¶œêµ¬ì„±] ë°ì´í„° ë¡œë“œ ì‹œì‘', { forceUpdate });
        const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        
        // URLì—ì„œ month íŒŒë¼ë¯¸í„° ì½ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const monthParam = urlParams.get('month');
        
        // API URL êµ¬ì„±
        let url = `/api/sales-composition?date=${apiDate}`;
        if (monthParam) {
          url += `&month=${monthParam}`;
        }
        if (forceUpdate) {
          url += '&forceUpdate=true';
        }
        
        console.log('[ë§¤ì¶œêµ¬ì„±] API í˜¸ì¶œ:', { url, monthParam });
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
        
        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        window.salesCompositionData = result;
        console.log('[ë§¤ì¶œêµ¬ì„±] ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
          cached: result.cached,
          cyCount: result.rowCount?.CY || 0,
          pyCount: result.rowCount?.PY || 0,
          asof_dt: result.asof_dt
        });
        
        // ë°ì´í„° êµ¬ì¡° í™•ì¸
        if (result.data && result.data.CY && result.data.CY.length > 0) {
          console.log('[ë§¤ì¶œêµ¬ì„±] CY ì²« ë²ˆì§¸ í–‰ ìƒ˜í”Œ:', result.data.CY[0]);
          console.log('[ë§¤ì¶œêµ¬ì„±] CY ì»¬ëŸ¼ëª…:', Object.keys(result.data.CY[0]));
        }
        
        return result;
        
      } catch (error) {
        console.error('[ë§¤ì¶œêµ¬ì„±] ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
        return null;
      }
    }
    
    // ì „ì²´í˜„í™©ìš© í• ì¸ë‚´ì—­ ë°ì´í„° ë¡œë“œ (ë§¤ì¶œêµ¬ì„±ê³¼ ë™ì¼í•˜ê²Œ ì „ì²´ ë¸Œëœë“œ í•œ ë²ˆì— ë¡œë“œ)
    // í• ì¸ë‚´ì—­ APIëŠ” ë¸Œëœë“œë³„ í˜¸ì¶œì´ë¯€ë¡œ M,I,X,V,ST,W ë³‘ë ¬ í˜¸ì¶œ í›„ ë¸Œëœë“œë³„ë¡œ ì €ì¥
    // í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ì €ì¥ (Promise.allSettled) â†’ í…Œì´ë¸”ì€ í•­ìƒ í‘œì‹œ
    // Failed to fetch ë“± ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ 1íšŒ ì¬ì‹œë„
    async function fetchDiscountWithRetry(url, code, retries = 1) {
      try {
        var res = await fetch(url);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        var json = await res.json();
        if (!json.success) throw new Error(json.error || 'API ì‹¤íŒ¨');
        return { code: code, result: json };
      } catch (e) {
        if (retries > 0 && (e.message === 'Failed to fetch' || e.name === 'TypeError')) {
          await new Promise(function (r) { setTimeout(r, 800); });
          return fetchDiscountWithRetry(url, code, 0);
        }
        throw e;
      }
    }
    async function loadOverviewDiscountData() {
      if (window.overviewDiscountData && typeof window.overviewDiscountData === 'object' && Object.keys(window.overviewDiscountData).length > 0) {
        console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë°ì´í„° ì´ë¯¸ ë¡œë“œë¨ (ì „ì²´ ë¸Œëœë“œ)');
        return window.overviewDiscountData;
      }
      
      console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì‹œì‘ (ì „ì²´ ë¸Œëœë“œ)');
      const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
      const analysisMonth = `${apiDate.slice(0, 4)}-${apiDate.slice(4, 6)}`;
      const brandCodes = ['M', 'I', 'X', 'V', 'ST', 'W'];
      
      const settled = await Promise.allSettled(
        brandCodes.map(function (code) {
          var url = '/api/discount-detail?brand=' + encodeURIComponent(code) + '&month=' + encodeURIComponent(analysisMonth);
          return fetchDiscountWithRetry(url, code);
        })
      );
      
      window.overviewDiscountData = {};
      settled.forEach((outcome, i) => {
        if (outcome.status === 'fulfilled' && outcome.value) {
          var code = outcome.value.code;
          var result = outcome.value.result; // API ì‘ë‹µ ì „ì²´: { success, data: [...], rowCount, ... }
          if (result && typeof result === 'object') {
            // dataê°€ ë°°ì—´ì¸ì§€ í™•ì¸ í›„ ì €ì¥ (APIëŠ” í•­ìƒ data: rows ë°°ì—´ ë°˜í™˜)
            var dataArr = Array.isArray(result.data) ? result.data : [];
            window.overviewDiscountData[code] = {
              success: result.success,
              date: result.date,
              asof_dt: result.asof_dt,
              brandCode: result.brandCode,
              analysisMonth: result.analysisMonth,
              data: dataArr,
              rowCount: dataArr.length,
              cached: result.cached
            };
            console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë¸Œëœë“œ ì €ì¥:', code, 'í–‰ ìˆ˜:', dataArr.length);
          }
        } else if (outcome.status === 'rejected') {
          console.warn('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë¸Œëœë“œ ë¡œë“œ ì‹¤íŒ¨:', brandCodes[i], outcome.reason);
        }
      });
      var keys = Object.keys(window.overviewDiscountData);
      var totalRows = keys.reduce(function (sum, k) { return sum + (window.overviewDiscountData[k].data?.length || 0); }, 0);
      console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì™„ë£Œ (ì „ì²´ ë¸Œëœë“œ):', keys, 'ì´ í–‰:', totalRows);
      return window.overviewDiscountData;
    }
    
    /**
     * í”„ë¡œëª¨ì…˜ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (ì „ì²´ ë¸Œëœë“œ)
     * ëŒ€ì‹œë³´ë“œ ì ‘ì† ì‹œ ëª¨ë“  ë¸Œëœë“œì˜ í”„ë¡œëª¨ì…˜ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œ
     */
    async function loadAllPromotionData() {
      if (window.promotionData && typeof window.promotionData === 'object' && Object.keys(window.promotionData).length > 0) {
        console.log('[í”„ë¡œëª¨ì…˜] ë°ì´í„° ì´ë¯¸ ë¡œë“œë¨ (ì „ì²´ ë¸Œëœë“œ)');
        return window.promotionData;
      }
      
      console.log('[í”„ë¡œëª¨ì…˜] ë°ì´í„° ë¡œë“œ ì‹œì‘ (ì „ì²´ ë¸Œëœë“œ)');
      const brandCodes = ['M', 'I', 'X', 'V', 'ST', 'W'];
      
      const settled = await Promise.allSettled(
        brandCodes.map(async function (code) {
          try {
            const url = '/api/promotion?brand=' + encodeURIComponent(code);
            const response = await fetch(url);
            if (!response.ok) {
              throw new Error('HTTP ' + response.status);
            }
            const result = await response.json();
            return { code: code, result: result };
          } catch (error) {
            console.error('[í”„ë¡œëª¨ì…˜] ë¸Œëœë“œ ë¡œë“œ ì‹¤íŒ¨:', code, error);
            throw error;
          }
        })
      );
      
      window.promotionData = {};
      settled.forEach((outcome, i) => {
        if (outcome.status === 'fulfilled' && outcome.value) {
          const code = outcome.value.code;
          const result = outcome.value.result;
          if (result && result.success) {
            const dataArr = Array.isArray(result.data) ? result.data : [];
            window.promotionData[code] = {
              success: result.success,
              date: result.date,
              brandCode: result.brandCode,
              data: dataArr,
              rowCount: dataArr.length,
              cached: result.cached
            };
            console.log('[í”„ë¡œëª¨ì…˜] ë¸Œëœë“œ ì €ì¥:', code, 'í–‰ ìˆ˜:', dataArr.length);
          }
        } else if (outcome.status === 'rejected') {
          console.warn('[í”„ë¡œëª¨ì…˜] ë¸Œëœë“œ ë¡œë“œ ì‹¤íŒ¨:', brandCodes[i], outcome.reason);
        }
      });
      
      const keys = Object.keys(window.promotionData);
      const totalRows = keys.reduce(function (sum, k) { return sum + (window.promotionData[k].data?.length || 0); }, 0);
      console.log('[í”„ë¡œëª¨ì…˜] ë°ì´í„° ë¡œë“œ ì™„ë£Œ (ì „ì²´ ë¸Œëœë“œ):', keys, 'ì´ í–‰:', totalRows);
      return window.promotionData;
    }
    
    /** ë¸Œëœë“œ ì½”ë“œ â†’ ë¸Œëœë“œëª… (í• ì¸ë‚´ì—­ ìºì‹œ í‚¤ìš©) */
    var discountBrandCodeToName = { 'M': 'MLB', 'I': 'MLB_KIDS', 'X': 'DISCOVERY', 'V': 'DUVETICA', 'ST': 'SERGIO', 'W': 'SUPRA' };
    
    /**
     * overview ë¡œë“œëœ ì›ë³¸ ë°°ì—´ë¡œ í• ì¸ì½”ë“œë³„ byCode êµ¬ì¡° ìƒì„± (ë“œë¦´ë‹¤ìš´ ìºì‹œìš©)
     * @param {Array} rawData - ì›ë³¸ í–‰ ë°°ì—´
     * @returns {Object} { [í• ì¸ìœ í˜•ëª…]: { discountCode, products: [] } }
     */
    function buildDiscountByCode(rawData) {
      var byCode = {};
      if (!Array.isArray(rawData)) return byCode;
      rawData.forEach(function (row) {
        // ì—¬ëŸ¬ ì¼€ì´ìŠ¤ í™•ì¸ (í•œê¸€ ì»¬ëŸ¼ëª…, ì˜ë¬¸ ëŒ€ë¬¸ì, ì˜ë¬¸ ì†Œë¬¸ì)
        var code = row['í• ì¸ìœ í˜•ëª…'] || row['CD_NM'] || row['cd_nm'] || 'ê¸°íƒ€';
        if (!byCode[code]) {
          byCode[code] = { discountCode: code, products: [] };
        }
        byCode[code].products.push(row);
      });
      return byCode;
    }
    
    /**
     * ì „ì²´í˜„í™© í• ì¸ë‚´ì—­ ë¡œë“œ í›„, ë¸Œëœë“œë³„ë¡œ ìºì‹œ(byCode) êµ¬ì¡° ë§Œë“¤ì–´ discountCacheì— ë„£ìŒ.
     * ì´í›„ updateDiscountTable í˜¸ì¶œ ì‹œ í•´ë‹¹ ë¸Œëœë“œ ë°ì´í„°ê°€ ë°”ë¡œ ì‚¬ìš©ë¨.
     */
    function buildDiscountCacheFromOverview() {
      if (!window.overviewDiscountData || typeof window.overviewDiscountData !== 'object') return;
      if (!window.discountCache) window.discountCache = {};
      var codeToName = discountBrandCodeToName;
      Object.keys(window.overviewDiscountData).forEach(function (brandCode) {
        var entry = window.overviewDiscountData[brandCode];
        var rawData = entry && Array.isArray(entry.data) ? entry.data : [];
        if (rawData.length === 0) return;
        var brandName = codeToName[brandCode];
        if (!brandName) return;
        window.discountCache[brandName] = buildDiscountByCode(rawData);
        console.log('[ì „ì²´í˜„í™©] í• ì¸ë‚´ì—­ ë¸Œëœë“œë³„ ìºì‹œ êµ¬ì„±:', brandName, 'í• ì¸ì½”ë“œ ìˆ˜:', Object.keys(window.discountCache[brandName]).length);
      });
    }
    
    // íŒë§¤ìœ¨ ë°ì´í„°ë¥¼ íˆíŠ¸ë§µìš©ìœ¼ë¡œ ì§‘ê³„
    function aggregateSalesRateForHeatmap(salesRateData) {
      if (!window.salesCompositionData || !window.salesCompositionData.data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      const brandCode = brandCodeMap[brand];
      const cyData = window.salesCompositionData.data.CY || [];
      const pyData = window.salesCompositionData.data.PY || [];
      
      // ë¸Œëœë“œ í•„í„°ë§
      const cyFiltered = cyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      const pyFiltered = pyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      
      // ì±„ë„ë³„ ì§‘ê³„
      const channelMap = {};
      
      cyFiltered.forEach(row => {
        const channel = row.ì±„ë„;
        if (!channelMap[channel]) {
          channelMap[channel] = {
            channel,
            tagSales: 0,
            realSales: 0,
            categories: {}
          };
        }
        
        channelMap[channel].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!channelMap[channel].categories[category]) {
          channelMap[channel].categories[category] = {
            category,
            tagSales: 0,
            realSales: 0,
            items: {}
          };
        }
        
        channelMap[channel].categories[category].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].categories[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì•„ì´í…œë³„ ì§‘ê³„
        const item = row.ì•„ì´í…œ;
        if (!channelMap[channel].categories[category].items[item]) {
          channelMap[channel].categories[category].items[item] = {
            item,
            tagSales: 0,
            realSales: 0
          };
        }
        
        channelMap[channel].categories[category].items[item].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].categories[category].items[item].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // ì „ë…„ ë°ì´í„° ì§‘ê³„ (YOY ê³„ì‚°ìš©)
      const pyChannelMap = {};
      pyFiltered.forEach(row => {
        const channel = row.ì±„ë„;
        if (!pyChannelMap[channel]) {
          pyChannelMap[channel] = { realSales: 0 };
        }
        pyChannelMap[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // YOY ê³„ì‚°
      Object.keys(channelMap).forEach(channel => {
        const cyReal = channelMap[channel].realSales;
        const pyReal = pyChannelMap[channel]?.realSales || 0;
        channelMap[channel].yoy = pyReal > 0 ? Math.round((cyReal / pyReal) * 100) : 0;
        channelMap[channel].discount = channelMap[channel].tagSales > 0 
          ? ((1 - cyReal / channelMap[channel].tagSales) * 100).toFixed(1)
          : '0.0';
      });
      
      return channelMap;
    }
    
    /**
     * ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì§‘ê³„
     * ë“œë¦´ë‹¤ìš´: ì±„ë„ â†’ ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ
     */
    function aggregateChannelSalesComposition(brand) {
      if (!window.salesCompositionData || !window.salesCompositionData.data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'MLB KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[brand] || brandCodeMap[brand.replace('_', ' ')] || 'M';
      const cyData = window.salesCompositionData.data.CY || [];
      const pyData = window.salesCompositionData.data.PY || [];
      
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] ë¸Œëœë“œ:', brand, 'â†’ ì½”ë“œ:', brandCode);
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] CY ë°ì´í„° ê°œìˆ˜:', cyData.length);
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] PY ë°ì´í„° ê°œìˆ˜:', pyData.length);
      if (cyData.length > 0) {
        console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] CY ì²« í–‰ ìƒ˜í”Œ:', cyData[0]);
      }
      
      // ë¸Œëœë“œ í•„í„°ë§
      const cyFiltered = cyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      const pyFiltered = pyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] í•„í„°ë§ í›„ CY:', cyFiltered.length, 'í–‰');
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ ì§‘ê³„] í•„í„°ë§ í›„ PY:', pyFiltered.length, 'í–‰');
      
      // ì±„ë„ë³„ ì§‘ê³„
      const channelMap = {};
      
      cyFiltered.forEach(row => {
        const channel = row.ì±„ë„;
        if (!channelMap[channel]) {
          channelMap[channel] = {
            channel,
            tagSales: 0,
            realSales: 0,
            categories: {}
          };
        }
        
        channelMap[channel].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!channelMap[channel].categories[category]) {
          channelMap[channel].categories[category] = {
            category,
            tagSales: 0,
            realSales: 0,
            items: {}
          };
        }
        
        channelMap[channel].categories[category].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].categories[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì•„ì´í…œë³„ ì§‘ê³„
        const item = row.ì•„ì´í…œ;
        if (!channelMap[channel].categories[category].items[item]) {
          channelMap[channel].categories[category].items[item] = {
            item,
            tagSales: 0,
            realSales: 0
          };
        }
        
        channelMap[channel].categories[category].items[item].tagSales += row.TAGë§¤ì¶œ || 0;
        channelMap[channel].categories[category].items[item].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // ì „ë…„ ë°ì´í„° ì§‘ê³„ (í• ì¸ìœ¨, YOY ê³„ì‚°ìš©)
      const pyChannelMap = {};
      pyFiltered.forEach(row => {
        const channel = row.ì±„ë„;
        if (!pyChannelMap[channel]) {
          pyChannelMap[channel] = { 
            tagSales: 0,
            realSales: 0,
            categories: {}
          };
        }
        pyChannelMap[channel].tagSales += row.TAGë§¤ì¶œ || 0;
        pyChannelMap[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì¹´í…Œê³ ë¦¬ë³„ ì „ë…„ ë°ì´í„°
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!pyChannelMap[channel].categories[category]) {
          pyChannelMap[channel].categories[category] = {
            tagSales: 0,
            realSales: 0,
            items: {}
          };
        }
        pyChannelMap[channel].categories[category].tagSales += row.TAGë§¤ì¶œ || 0;
        pyChannelMap[channel].categories[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì•„ì´í…œë³„ ì „ë…„ ë°ì´í„°
        const item = row.ì•„ì´í…œ;
        if (!pyChannelMap[channel].categories[category].items[item]) {
          pyChannelMap[channel].categories[category].items[item] = {
            tagSales: 0,
            realSales: 0
          };
        }
        pyChannelMap[channel].categories[category].items[item].tagSales += row.TAGë§¤ì¶œ || 0;
        pyChannelMap[channel].categories[category].items[item].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY ê³„ì‚°
      Object.keys(channelMap).forEach(channel => {
        const cyData = channelMap[channel];
        const pyData = pyChannelMap[channel] || { tagSales: 0, realSales: 0, categories: {} };
        
        // ì±„ë„ ë ˆë²¨
        cyData.discountRate = cyData.tagSales > 0 
          ? parseFloat(((1 - cyData.realSales / cyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.prevDiscountRate = pyData.tagSales > 0
          ? parseFloat(((1 - pyData.realSales / pyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.yoy = pyData.realSales > 0 ? Math.round((cyData.realSales / pyData.realSales) * 100) : 0;
        
        // ì¹´í…Œê³ ë¦¬ ë ˆë²¨
        Object.keys(cyData.categories).forEach(category => {
          const cyCat = cyData.categories[category];
          const pyCat = pyData.categories[category] || { tagSales: 0, realSales: 0, items: {} };
          
          cyCat.discountRate = cyCat.tagSales > 0
            ? parseFloat(((1 - cyCat.realSales / cyCat.tagSales) * 100).toFixed(1))
            : 0.0;
          cyCat.prevDiscountRate = pyCat.tagSales > 0
            ? parseFloat(((1 - pyCat.realSales / pyCat.tagSales) * 100).toFixed(1))
            : 0.0;
          cyCat.yoy = pyCat.realSales > 0 ? Math.round((cyCat.realSales / pyCat.realSales) * 100) : 0;
          
          // ì•„ì´í…œ ë ˆë²¨
          Object.keys(cyCat.items).forEach(item => {
            const cyItem = cyCat.items[item];
            const pyItem = pyCat.items[item] || { tagSales: 0, realSales: 0 };
            
            cyItem.discountRate = cyItem.tagSales > 0
              ? parseFloat(((1 - cyItem.realSales / cyItem.tagSales) * 100).toFixed(1))
              : 0.0;
            cyItem.prevDiscountRate = pyItem.tagSales > 0
              ? parseFloat(((1 - pyItem.realSales / pyItem.tagSales) * 100).toFixed(1))
              : 0.0;
            cyItem.yoy = pyItem.realSales > 0 ? Math.round((cyItem.realSales / pyItem.realSales) * 100) : 0;
          });
        });
      });
      
      return channelMap;
    }
    
    /**
     * ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì§‘ê³„
     * ë“œë¦´ë‹¤ìš´: ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ
     */
    function aggregateItemSalesComposition(brand) {
      if (!window.salesCompositionData || !window.salesCompositionData.data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'MLB KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[brand] || brandCodeMap[brand.replace('_', ' ')] || 'M';
      const cyData = window.salesCompositionData.data.CY || [];
      const pyData = window.salesCompositionData.data.PY || [];
      
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] ë¸Œëœë“œ:', brand, 'â†’ ì½”ë“œ:', brandCode);
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] CY ë°ì´í„° ê°œìˆ˜:', cyData.length);
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] PY ë°ì´í„° ê°œìˆ˜:', pyData.length);
      
      // ë¸Œëœë“œ í•„í„°ë§
      const cyFiltered = cyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      const pyFiltered = pyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] í•„í„°ë§ í›„ CY:', cyFiltered.length, 'í–‰');
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] í•„í„°ë§ í›„ PY:', pyFiltered.length, 'í–‰');
      if (cyFiltered.length > 0) {
        console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] CY ì²« í–‰ ìƒ˜í”Œ:', cyFiltered[0]);
      }
      
      // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
      const categoryMap = {};
      
      cyFiltered.forEach(row => {
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!categoryMap[category]) {
          categoryMap[category] = {
            category,
            tagSales: 0,
            realSales: 0,
            items: {}
          };
        }
        
        categoryMap[category].tagSales += row.TAGë§¤ì¶œ || 0;
        categoryMap[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì•„ì´í…œë³„ ì§‘ê³„
        const item = row.ì•„ì´í…œ;
        if (!categoryMap[category].items[item]) {
          categoryMap[category].items[item] = {
            item,
            tagSales: 0,
            realSales: 0
          };
        }
        
        categoryMap[category].items[item].tagSales += row.TAGë§¤ì¶œ || 0;
        categoryMap[category].items[item].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // ì „ë…„ ë°ì´í„° ì§‘ê³„ (í• ì¸ìœ¨, YOY ê³„ì‚°ìš©)
      const pyCategoryMap = {};
      pyFiltered.forEach(row => {
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!pyCategoryMap[category]) {
          pyCategoryMap[category] = { 
            tagSales: 0,
            realSales: 0,
            items: {}
          };
        }
        pyCategoryMap[category].tagSales += row.TAGë§¤ì¶œ || 0;
        pyCategoryMap[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì•„ì´í…œë³„ ì „ë…„ ë°ì´í„°
        const item = row.ì•„ì´í…œ;
        if (!pyCategoryMap[category].items[item]) {
          pyCategoryMap[category].items[item] = {
            tagSales: 0,
            realSales: 0
          };
        }
        pyCategoryMap[category].items[item].tagSales += row.TAGë§¤ì¶œ || 0;
        pyCategoryMap[category].items[item].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY ê³„ì‚°
      Object.keys(categoryMap).forEach(category => {
        const cyData = categoryMap[category];
        const pyData = pyCategoryMap[category] || { tagSales: 0, realSales: 0, items: {} };
        
        // ì¹´í…Œê³ ë¦¬ ë ˆë²¨
        cyData.discountRate = cyData.tagSales > 0
          ? parseFloat(((1 - cyData.realSales / cyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.prevDiscountRate = pyData.tagSales > 0
          ? parseFloat(((1 - pyData.realSales / pyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.yoy = pyData.realSales > 0 ? Math.round((cyData.realSales / pyData.realSales) * 100) : 0;
        
        // ì•„ì´í…œ ë ˆë²¨
        Object.keys(cyData.items).forEach(item => {
          const cyItem = cyData.items[item];
          const pyItem = pyData.items[item] || { tagSales: 0, realSales: 0 };
          
          cyItem.discountRate = cyItem.tagSales > 0
            ? parseFloat(((1 - cyItem.realSales / cyItem.tagSales) * 100).toFixed(1))
            : 0.0;
          cyItem.prevDiscountRate = pyItem.tagSales > 0
            ? parseFloat(((1 - pyItem.realSales / pyItem.tagSales) * 100).toFixed(1))
            : 0.0;
          cyItem.yoy = pyItem.realSales > 0 ? Math.round((cyItem.realSales / pyItem.realSales) * 100) : 0;
        });
      });
      
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] ì¹´í…Œê³ ë¦¬ ê°œìˆ˜:', Object.keys(categoryMap).length);
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ ì§‘ê³„] ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ:', 
        Object.entries(categoryMap).map(([cat, data]) => ({
          ì¹´í…Œê³ ë¦¬: cat,
          ì‹¤íŒë§¤ì¶œ: (data.realSales / 100000000).toFixed(1) + 'ì–µì›'
        }))
      );
      
      return categoryMap;
    }
    
    /**
     * ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„ íŠ¸ë¦¬ë§µ ë°ì´í„° (ì‚¬ì´ë“œë°”ìš©)
     */
    function aggregateCategoryChannelComposition(brand) {
      if (!window.salesCompositionData || !window.salesCompositionData.data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'MLB KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[brand] || brandCodeMap[brand.replace('_', ' ')] || 'M';
      const cyData = window.salesCompositionData.data.CY || [];
      const pyData = window.salesCompositionData.data.PY || [];
      
      // ë¸Œëœë“œ í•„í„°ë§
      const cyFiltered = cyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      const pyFiltered = pyData.filter(row => row.ë¸Œëœë“œ === brandCode);
      
      // ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
      const categoryMap = {};
      
      cyFiltered.forEach(row => {
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!categoryMap[category]) {
          categoryMap[category] = {
            category,
            tagSales: 0,
            realSales: 0,
            channels: {}
          };
        }
        
        categoryMap[category].tagSales += row.TAGë§¤ì¶œ || 0;
        categoryMap[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì±„ë„ë³„ ì§‘ê³„
        const channel = row.ì±„ë„;
        if (!categoryMap[category].channels[channel]) {
          categoryMap[category].channels[channel] = {
            channel,
            tagSales: 0,
            realSales: 0
          };
        }
        
        categoryMap[category].channels[channel].tagSales += row.TAGë§¤ì¶œ || 0;
        categoryMap[category].channels[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // ì „ë…„ ë°ì´í„° ì§‘ê³„ (í• ì¸ìœ¨, YOY ê³„ì‚°ìš©)
      const pyCategoryMap = {};
      pyFiltered.forEach(row => {
        const category = row.ì¹´í…Œê³ ë¦¬;
        if (!pyCategoryMap[category]) {
          pyCategoryMap[category] = { 
            tagSales: 0,
            realSales: 0,
            channels: {}
          };
        }
        pyCategoryMap[category].tagSales += row.TAGë§¤ì¶œ || 0;
        pyCategoryMap[category].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
        
        // ì±„ë„ë³„ ì „ë…„ ë°ì´í„°
        const channel = row.ì±„ë„;
        if (!pyCategoryMap[category].channels[channel]) {
          pyCategoryMap[category].channels[channel] = {
            tagSales: 0,
            realSales: 0
          };
        }
        pyCategoryMap[category].channels[channel].tagSales += row.TAGë§¤ì¶œ || 0;
        pyCategoryMap[category].channels[channel].realSales += row.ì‹¤íŒë§¤ì¶œ || 0;
      });
      
      // í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY ê³„ì‚°
      Object.keys(categoryMap).forEach(category => {
        const cyData = categoryMap[category];
        const pyData = pyCategoryMap[category] || { tagSales: 0, realSales: 0, channels: {} };
        
        // ì¹´í…Œê³ ë¦¬ ë ˆë²¨
        cyData.discountRate = cyData.tagSales > 0
          ? parseFloat(((1 - cyData.realSales / cyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.prevDiscountRate = pyData.tagSales > 0
          ? parseFloat(((1 - pyData.realSales / pyData.tagSales) * 100).toFixed(1))
          : 0.0;
        cyData.yoy = pyData.realSales > 0 ? Math.round((cyData.realSales / pyData.realSales) * 100) : 0;
        
        // ì±„ë„ ë ˆë²¨
        Object.keys(cyData.channels).forEach(channel => {
          const cyChannel = cyData.channels[channel];
          const pyChannel = pyData.channels[channel] || { tagSales: 0, realSales: 0 };
          
          cyChannel.discountRate = cyChannel.tagSales > 0
            ? parseFloat(((1 - cyChannel.realSales / cyChannel.tagSales) * 100).toFixed(1))
            : 0.0;
          cyChannel.prevDiscountRate = pyChannel.tagSales > 0
            ? parseFloat(((1 - pyChannel.realSales / pyChannel.tagSales) * 100).toFixed(1))
            : 0.0;
          cyChannel.yoy = pyChannel.realSales > 0 ? Math.round((cyChannel.realSales / pyChannel.realSales) * 100) : 0;
        });
      });
      
      return categoryMap;
    }
    
    // ==================== íŠ¸ë¦¬ë§µ ë Œë”ë§ í•¨ìˆ˜ ====================
    
    // ì±„ë„ë³„ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ (ì „ì—­ ë³€ìˆ˜)
    let channelTreemapDrilldownPath = [];
    
    /**
     * ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ ë Œë”ë§ (í˜„ì‹œì )
     * ë“œë¦´ë‹¤ìš´: ì±„ë„ â†’ ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ
     */
    function renderChannelSalesTreemap(containerId, brand, skipAnimation = false) {
      const data = aggregateChannelSalesComposition(brand);
      if (!data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ì±„ë„ë³„ ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ] ë Œë”ë§ ì‹œì‘:', { brand, path: channelTreemapDrilldownPath });
      
      // Plotly ë°ì´í„° êµ¬ì„±
      const labels = [];
      const parents = [];
      const values = [];
      const customdata = [];
      const ids = [];
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚° (ë¹„ì¤‘ ê³„ì‚°ìš©)
      const totalSales = Object.values(data).reduce((sum, channel) => sum + channel.realSales, 0) / 100000000;
      
      // ë“œë¦´ë‹¤ìš´ ê²½ë¡œì— ë”°ë¼ ë‹¤ë¥¸ ë ˆë²¨ í‘œì‹œ
      if (channelTreemapDrilldownPath.length === 0) {
        // Level 1: ì±„ë„ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const sortedChannels = Object.values(data).sort((a, b) => b.realSales - a.realSales);
        sortedChannels.forEach(channel => {
          const sales = channel.realSales / 100000000; // ì–µì›
          if (sales > 0) {
            const ratio = totalSales > 0 ? (sales / totalSales * 100).toFixed(1) : 0;
            labels.push(channel.channel);
            parents.push('');
            values.push(sales);
            ids.push(`channel-${channel.channel}`);
            customdata.push([
              sales.toFixed(1),
              parseFloat(ratio),
              parseFloat(channel.discountRate || 0),
              parseFloat(channel.prevDiscountRate || 0),
              parseFloat(channel.yoy || 0)
            ]);
          }
        });
      } else if (channelTreemapDrilldownPath.length === 1) {
        // Level 2: ì„ íƒëœ ì±„ë„ì˜ ì¹´í…Œê³ ë¦¬
        const selectedChannel = channelTreemapDrilldownPath[0];
        const channelData = data[selectedChannel];
        
        if (channelData && channelData.categories) {
          const channelTotal = channelData.realSales / 100000000;
          Object.values(channelData.categories).forEach(category => {
            const sales = category.realSales / 100000000; // ì–µì›
            if (sales > 0) {
              const ratio = channelTotal > 0 ? (sales / channelTotal * 100).toFixed(1) : 0;
              labels.push(category.category);
              parents.push('');
              values.push(sales);
              ids.push(`category-${category.category}`);
              customdata.push([
                sales.toFixed(1),
                parseFloat(ratio),
                parseFloat(category.discountRate || 0),
                parseFloat(category.prevDiscountRate || 0),
                parseFloat(category.yoy || 0)
              ]);
            }
          });
        }
      } else if (channelTreemapDrilldownPath.length === 2) {
        // Level 3: ì„ íƒëœ ì±„ë„ > ì¹´í…Œê³ ë¦¬ì˜ ì•„ì´í…œ
        const selectedChannel = channelTreemapDrilldownPath[0];
        const selectedCategory = channelTreemapDrilldownPath[1];
        const categoryData = data[selectedChannel]?.categories[selectedCategory];
        
        if (categoryData && categoryData.items) {
          const categoryTotal = categoryData.realSales / 100000000;
          Object.values(categoryData.items).forEach(item => {
            const sales = item.realSales / 100000000; // ì–µì›
            if (sales > 0) {
              const ratio = categoryTotal > 0 ? (sales / categoryTotal * 100).toFixed(1) : 0;
              labels.push(item.item);
              parents.push('');
              values.push(sales);
              ids.push(`item-${item.item}`);
              customdata.push([
                sales.toFixed(1),
                ratio,
                parseFloat(item.discountRate || 0),
                parseFloat(item.prevDiscountRate || 0),
                parseFloat(item.yoy || 0)
              ]);
            }
          });
        }
      }
      
      if (labels.length === 0) {
        console.warn('[ì±„ë„ íŠ¸ë¦¬ë§µ] í‘œì‹œí•  ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      // í…ìŠ¤íŠ¸ ë°°ì—´ ìƒì„± (ê° ë¸”ë¡ì— í‘œì‹œë  ì •ë³´)
      const text = customdata.map((d, i) => 
        `<b style="font-size:16px;color:white;">${labels[i]}</b><br><span style="font-size:14px;color:white;">${d[0]}ì–µ(${d[1]}%)</span><br><span style="font-size:12px;">í• ì¸ìœ¨: ${d[2]}%<br>ì „ë…„í• ì¸ìœ¨: ${d[3]}%<br>YOY: ${d[4]}%</span>`
      );
      
      // ì±„ë„ë³„ ê³ ì • ìƒ‰ìƒ ë§¤í•‘ (ë§¤ì¶œ ë­í‚¹ ìˆœì„œ)
      const colorPalette = [
        '#6F6FD9',  // 1ìœ„
        '#9B6BF0',  // 2ìœ„
        '#6AA7FF',  // 3ìœ„
        '#3CB371',  // 4ìœ„
        '#F4B24D',  // 5ìœ„
        '#F26C6C',  // 6ìœ„
        '#B57CFF',  // 7ìœ„
        '#6ED39A',  // 8ìœ„
        '#F7A35C'   // 9ìœ„
      ];
      
      // ê° ë ˆì´ë¸”ì— ìˆœì„œëŒ€ë¡œ ìƒ‰ìƒ í• ë‹¹ (ì´ë¯¸ ë§¤ì¶œ í° ìˆœì„œë¡œ ì •ë ¬ë¨)
      const colors = labels.map((label, i) => colorPalette[i % colorPalette.length]);
      
      const plotlyData = [{
        type: 'treemap',
        labels,
        parents,
        values,
        ids,
        text,
        textinfo: 'text',
        textfont: { size: 14, color: 'yellow' },
        hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[1]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[2]:.1f}% (ì „ë…„ : %{customdata[3]:.1f}%)<br>YOY : %{customdata[4]:.1f}%<extra></extra>',
        customdata,
        marker: {
          colors: colors,
          showscale: false,
          line: { color: 'white', width: 2 }
        }
      }];
      
      const layout = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        }
      };
      
      const layoutWithoutTransition = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      };
      
      const config = { 
        responsive: true,
        displayModeBar: false
      };
      
      // skipAnimationì´ë©´ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´, ì•„ë‹ˆë©´ ë¶€ë“œëŸ½ê²Œ ì „í™˜
      let plotPromise;
      if (skipAnimation) {
        plotPromise = Plotly.newPlot(containerId, plotlyData, layoutWithoutTransition, config);
      } else {
        const containerEl = document.getElementById(containerId);
        plotPromise = (containerEl && containerEl.data) 
          ? Plotly.react(containerId, plotlyData, layout, config)
          : Plotly.newPlot(containerId, plotlyData, layout, config);
      }
      
      plotPromise.then(() => {
        // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
        const container = document.getElementById(containerId);
        if (container) {
          container.on('plotly_click', function(eventData) {
            if (eventData.points && eventData.points.length > 0) {
              const clickedLabel = eventData.points[0].label;
              
              // ë“œë¦´ë‹¤ìš´ ì‹¤í–‰
              if (channelTreemapDrilldownPath.length < 2) {
                channelTreemapDrilldownPath.push(clickedLabel);
                console.log('[ì±„ë„ íŠ¸ë¦¬ë§µ] ë“œë¦´ë‹¤ìš´:', channelTreemapDrilldownPath);
                renderChannelSalesTreemap(containerId, brand);
                updateChannelTreemapHeader();
              }
            }
          });
        }
      });
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      updateChannelTreemapHeader();
    }
    
    /**
     * ì±„ë„ íŠ¸ë¦¬ë§µ í—¤ë” ì—…ë°ì´íŠ¸ (ê²½ë¡œ í‘œì‹œ ë° ë’¤ë¡œê°€ê¸° ë²„íŠ¼)
     */
    function updateChannelTreemapHeader() {
      const headerEl = document.querySelector('#treemapWrapperChannel').closest('.chart-container')?.querySelector('.chart-title');
      if (!headerEl) return;
      
      let titleText = 'ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„±';
      if (channelTreemapDrilldownPath.length > 0) {
        titleText += ' > ' + channelTreemapDrilldownPath.join(' > ');
      }
      
      // ë’¤ë¡œê°€ê¸° ë²„íŠ¼
      let backButton = '';
      if (channelTreemapDrilldownPath.length > 0) {
        backButton = '<button onclick="channelTreemapGoBack()" style="margin-left:10px;padding:4px 12px;background:#6366f1;color:white;border:none;border-radius:4px;cursor:pointer;font-size:12px;">â† ë’¤ë¡œ</button>';
      }
      
      headerEl.innerHTML = titleText + backButton;
    }
    
    /**
     * ì±„ë„ íŠ¸ë¦¬ë§µ ë’¤ë¡œê°€ê¸°
     */
    function channelTreemapGoBack() {
      if (channelTreemapDrilldownPath.length > 0) {
        channelTreemapDrilldownPath.pop();
        const container = document.querySelector('#treemapWrapperChannel').closest('.chart-container');
        const brand = currentBrand;
        renderChannelSalesTreemap('treemapWrapperChannel', brand, true); // skipAnimation = true
      }
    }
    
    // ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ (ì „ì—­ ë³€ìˆ˜)
    let itemTreemapDrilldownPath = [];
    
    /**
     * ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ ë Œë”ë§ (í˜„ì‹œì )
     * ë“œë¦´ë‹¤ìš´: ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ
     */
    function renderItemSalesTreemap(containerId, brand, skipAnimation = false) {
      const data = aggregateItemSalesComposition(brand);
      if (!data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ì•„ì´í…œë³„ ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ] ë Œë”ë§ ì‹œì‘:', { brand, path: itemTreemapDrilldownPath });
      
      // Plotly ë°ì´í„° êµ¬ì„±
      const labels = [];
      const parents = [];
      const values = [];
      const customdata = [];
      const ids = [];
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚° (ë¹„ì¤‘ ê³„ì‚°ìš©)
      const totalSales = Object.values(data).reduce((sum, category) => sum + category.realSales, 0) / 100000000;
      
      // ë“œë¦´ë‹¤ìš´ ê²½ë¡œì— ë”°ë¼ ë‹¤ë¥¸ ë ˆë²¨ í‘œì‹œ
      if (itemTreemapDrilldownPath.length === 0) {
        // Level 1: ì¹´í…Œê³ ë¦¬ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const sortedCategories = Object.values(data).sort((a, b) => b.realSales - a.realSales);
        sortedCategories.forEach(category => {
          const sales = category.realSales / 100000000; // ì–µì›
          if (sales > 0) {
            const ratio = totalSales > 0 ? (sales / totalSales * 100).toFixed(1) : 0;
            labels.push(category.category);
            parents.push('');
            values.push(sales);
            ids.push(`category-${category.category}`);
            customdata.push([
              sales.toFixed(1),
              ratio,
                parseFloat(category.discountRate || 0),
                parseFloat(category.prevDiscountRate || 0),
                parseFloat(category.yoy || 0)
            ]);
          }
        });
      } else if (itemTreemapDrilldownPath.length === 1) {
        // Level 2: ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ ì•„ì´í…œ
        const selectedCategory = itemTreemapDrilldownPath[0];
        const categoryData = data[selectedCategory];
        
        if (categoryData && categoryData.items) {
          const categoryTotal = categoryData.realSales / 100000000;
          Object.values(categoryData.items).forEach(item => {
            const sales = item.realSales / 100000000; // ì–µì›
            if (sales > 0) {
              const ratio = categoryTotal > 0 ? (sales / categoryTotal * 100).toFixed(1) : 0;
              labels.push(item.item);
              parents.push('');
              values.push(sales);
              ids.push(`item-${item.item}`);
              customdata.push([
                sales.toFixed(1),
                ratio,
                parseFloat(item.discountRate || 0),
                parseFloat(item.prevDiscountRate || 0),
                parseFloat(item.yoy || 0)
              ]);
            }
          });
        }
      }
      
      if (labels.length === 0) {
        console.warn('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ] í‘œì‹œí•  ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      // í…ìŠ¤íŠ¸ ë°°ì—´ ìƒì„± (ê° ë¸”ë¡ì— í‘œì‹œë  ì •ë³´)
      const text = customdata.map((d, i) => 
        `<b style="font-size:16px;color:white;">${labels[i]}</b><br><span style="font-size:14px;color:white;">${d[0]}ì–µ(${d[1]}%)</span><br><span style="font-size:12px;">í• ì¸ìœ¨: ${d[2]}%<br>ì „ë…„í• ì¸ìœ¨: ${d[3]}%<br>YOY: ${d[4]}%</span>`
      );
      
      // ì¹´í…Œê³ ë¦¬ë³„ ê³ ì • ìƒ‰ìƒ ë§¤í•‘ (ë§¤ì¶œ ë­í‚¹ ìˆœì„œ)
      const colorPalette = [
        '#6F6FD9',  // 1ìœ„
        '#9B6BF0',  // 2ìœ„
        '#6AA7FF',  // 3ìœ„
        '#3CB371',  // 4ìœ„
        '#F4B24D',  // 5ìœ„
        '#F26C6C',  // 6ìœ„
        '#B57CFF',  // 7ìœ„
        '#6ED39A',  // 8ìœ„
        '#F7A35C'   // 9ìœ„
      ];
      
      // ê° ë ˆì´ë¸”ì— ìˆœì„œëŒ€ë¡œ ìƒ‰ìƒ í• ë‹¹ (ì´ë¯¸ ë§¤ì¶œ í° ìˆœì„œë¡œ ì •ë ¬ë¨)
      const colors = labels.map((label, i) => colorPalette[i % colorPalette.length]);
      
      const plotlyData = [{
        type: 'treemap',
        labels,
        parents,
        values,
        ids,
        text,
        textinfo: 'text',
        textfont: { size: 14, color: 'yellow' },
        hovertemplate: '%{label}<br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[1]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[2]:.1f}% (ì „ë…„ : %{customdata[3]:.1f}%)<br>YOY : %{customdata[4]:.1f}%<extra></extra>',
        customdata,
        marker: {
          colors: colors,
          showscale: false,
          line: { color: 'white', width: 2 }
        }
      }];
      
      const layout = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        }
      };
      
      const layoutWithoutTransition = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      };
      
      const config = { 
        responsive: true,
        displayModeBar: false
      };
      
      // skipAnimationì´ë©´ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´, ì•„ë‹ˆë©´ ë¶€ë“œëŸ½ê²Œ ì „í™˜
      let plotPromise;
      if (skipAnimation) {
        plotPromise = Plotly.newPlot(containerId, plotlyData, layoutWithoutTransition, config);
      } else {
        const containerEl = document.getElementById(containerId);
        plotPromise = (containerEl && containerEl.data) 
          ? Plotly.react(containerId, plotlyData, layout, config)
          : Plotly.newPlot(containerId, plotlyData, layout, config);
      }
      
      plotPromise.then(() => {
        // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
        const container = document.getElementById(containerId);
        if (container) {
          container.on('plotly_click', function(eventData) {
            if (eventData.points && eventData.points.length > 0) {
              const clickedLabel = eventData.points[0].label;
              
              // ë“œë¦´ë‹¤ìš´ ì‹¤í–‰ (ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ)
              if (itemTreemapDrilldownPath.length === 0) {
                itemTreemapDrilldownPath.push(clickedLabel);
                console.log('[ì•„ì´í…œ íŠ¸ë¦¬ë§µ] ë“œë¦´ë‹¤ìš´:', itemTreemapDrilldownPath);
                renderItemSalesTreemap(containerId, brand);
                updateItemTreemapHeader();
              }
            }
          });
        }
      });
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      updateItemTreemapHeader();
    }
    
    /**
     * ì•„ì´í…œ íŠ¸ë¦¬ë§µ í—¤ë” ì—…ë°ì´íŠ¸ (ê²½ë¡œ í‘œì‹œ ë° ë’¤ë¡œê°€ê¸° ë²„íŠ¼)
     */
    function updateItemTreemapHeader() {
      const headerEl = document.querySelector('#treemapWrapperItem').closest('.chart-container')?.querySelector('.chart-title');
      if (!headerEl) return;
      
      let titleText = 'ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„±';
      if (itemTreemapDrilldownPath.length > 0) {
        titleText += ' > ' + itemTreemapDrilldownPath.join(' > ');
      }
      
      // ë’¤ë¡œê°€ê¸° ë²„íŠ¼
      let backButton = '';
      if (itemTreemapDrilldownPath.length > 0) {
        backButton = '<button onclick="itemTreemapGoBack()" style="margin-left:10px;padding:4px 12px;background:#10b981;color:white;border:none;border-radius:4px;cursor:pointer;font-size:12px;">â† ë’¤ë¡œ</button>';
      }
      
      headerEl.innerHTML = titleText + backButton;
    }
    
    /**
     * ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë’¤ë¡œê°€ê¸°
     */
    function itemTreemapGoBack() {
      if (itemTreemapDrilldownPath.length > 0) {
        itemTreemapDrilldownPath.pop();
        const brand = currentBrand;
        renderItemSalesTreemap('treemapWrapperItem', brand, true); // skipAnimation = true
      }
    }
    
    // ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ
    let sidebarCategoryChannelPath = [];
    
    /**
     * ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„ íŠ¸ë¦¬ë§µ ë Œë”ë§ (ì‚¬ì´ë“œë°”)
     */
    function renderCategoryChannelTreemap(containerId, brand, skipAnimation = false) {
      const data = aggregateCategoryChannelComposition(brand);
      if (!data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ì¹´í…Œê³ ë¦¬-ì±„ë„ ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      console.log('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„] ë Œë”ë§:', { brand, path: sidebarCategoryChannelPath });
      
      // Plotly ë°ì´í„° êµ¬ì„±
      const labels = [];
      const parents = [];
      const values = [];
      const customdata = [];
      const ids = [];
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚° (ë¹„ì¤‘ ê³„ì‚°ìš©)
      const totalSales = Object.values(data).reduce((sum, category) => sum + category.realSales, 0) / 100000000;
      
      // ë“œë¦´ë‹¤ìš´ ê²½ë¡œì— ë”°ë¼ ë‹¤ë¥¸ ë ˆë²¨ í‘œì‹œ
      if (sidebarCategoryChannelPath.length === 0) {
        // Level 1: ì¹´í…Œê³ ë¦¬ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const sortedCategories = Object.values(data).sort((a, b) => b.realSales - a.realSales);
        sortedCategories.forEach(category => {
          const sales = category.realSales / 100000000; // ì–µì›
          if (sales > 0) {
            const ratio = totalSales > 0 ? (sales / totalSales * 100).toFixed(1) : 0;
            labels.push(category.category);
            parents.push('');
            values.push(sales);
            ids.push(`cat-${category.category}`);
            customdata.push([
              sales.toFixed(1),
              ratio,
                parseFloat(category.discountRate || 0),
                parseFloat(category.prevDiscountRate || 0),
                parseFloat(category.yoy || 0)
            ]);
          }
        });
      } else if (sidebarCategoryChannelPath.length === 1) {
        // Level 2: ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ ì±„ë„ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const selectedCategory = sidebarCategoryChannelPath[0];
        const categoryData = data[selectedCategory];
        
        if (categoryData && categoryData.channels) {
          const channelTotal = categoryData.realSales / 100000000;
          const sortedChannels = Object.values(categoryData.channels).sort((a, b) => b.realSales - a.realSales);
          sortedChannels.forEach(channel => {
            const sales = channel.realSales / 100000000; // ì–µì›
            if (sales > 0) {
              const ratio = channelTotal > 0 ? (sales / channelTotal * 100).toFixed(1) : 0;
              labels.push(channel.channel);
              parents.push('');
              values.push(sales);
              ids.push(`channel-${channel.channel}`);
              customdata.push([
                sales.toFixed(1),
                ratio,
                parseFloat(channel.discountRate || 0),
                parseFloat(channel.prevDiscountRate || 0),
                parseFloat(channel.yoy || 0)
              ]);
            }
          });
        }
      }
      
      if (labels.length === 0) {
        console.warn('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„] í‘œì‹œí•  ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      // í…ìŠ¤íŠ¸ ë°°ì—´ ìƒì„± (ë©”ì¸ íŠ¸ë¦¬ë§µê³¼ ë™ì¼í•œ í˜•ì‹)
      const text = customdata.map((d, i) => 
        `<b style="font-size:16px;color:white;">${labels[i]}</b><br><span style="font-size:14px;color:white;">${d[0]}ì–µ(${d[1]}%)</span><br><span style="font-size:12px;">í• ì¸ìœ¨: ${d[2]}%<br>ì „ë…„í• ì¸ìœ¨: ${d[3]}%<br>YOY: ${d[4]}%</span>`
      );
      
      // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (ë©”ì¸ íŠ¸ë¦¬ë§µê³¼ ë™ì¼)
      const colorPalette = [
        '#6F6FD9',  // 1ìœ„
        '#9B6BF0',  // 2ìœ„
        '#6AA7FF',  // 3ìœ„
        '#3CB371',  // 4ìœ„
        '#F4B24D',  // 5ìœ„
        '#F26C6C',  // 6ìœ„
        '#B57CFF',  // 7ìœ„
        '#6ED39A',  // 8ìœ„
        '#F7A35C'   // 9ìœ„
      ];
      
      const colors = labels.map((label, i) => colorPalette[i % colorPalette.length]);
      
      const plotlyData = [{
        type: 'treemap',
        labels,
        parents,
        values,
        ids,
        text,
        textinfo: 'text',
        textposition: 'top left',
        textfont: { size: 14, color: 'yellow' },
        hovertemplate: '<b>%{label}</b><br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[1]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[2]:.1f}% (ì „ë…„ : %{customdata[3]:.1f}%)<br>YOY : %{customdata[4]:.1f}%<extra></extra>',
        customdata,
        marker: {
          colors: colors,
          showscale: false,
          line: { color: 'white', width: 2 }
        }
      }];
      
      const layout = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        height: 350,
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        }
      };
      
      const layoutWithoutTransition = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        height: 350
      };
      
      const config = { 
        responsive: true,
        displayModeBar: false
      };
      
      // skipAnimationì´ë©´ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´, ì•„ë‹ˆë©´ ë¶€ë“œëŸ½ê²Œ ì „í™˜
      let plotPromise;
      if (skipAnimation) {
        plotPromise = Plotly.newPlot(containerId, plotlyData, layoutWithoutTransition, config);
      } else {
        const containerEl = document.getElementById(containerId);
        plotPromise = (containerEl && containerEl.data) 
          ? Plotly.react(containerId, plotlyData, layout, config)
          : Plotly.newPlot(containerId, plotlyData, layout, config);
      }
      
      plotPromise.then(() => {
        // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
        const container = document.getElementById(containerId);
        if (container) {
          container.on('plotly_click', function(eventData) {
            if (eventData.points && eventData.points.length > 0) {
              const clickedLabel = eventData.points[0].label;
              
              // ë“œë¦´ë‹¤ìš´ ì‹¤í–‰ (ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„)
              if (sidebarCategoryChannelPath.length === 0) {
                sidebarCategoryChannelPath.push(clickedLabel);
                console.log('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„] ë“œë¦´ë‹¤ìš´:', sidebarCategoryChannelPath);
                renderCategoryChannelTreemap(containerId, brand);
                updateSidebarCategoryChannelHeader();
              }
            }
          });
        }
      });
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      updateSidebarCategoryChannelHeader();
    }
    
    /**
     * ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„ íŠ¸ë¦¬ë§µ í—¤ë” ì—…ë°ì´íŠ¸
     */
    function updateSidebarCategoryChannelHeader() {
      const backBtn = document.getElementById('sidebar-category-channel-back-btn');
      if (backBtn) {
        if (sidebarCategoryChannelPath.length > 0) {
          backBtn.style.display = 'block';
        } else {
          backBtn.style.display = 'none';
        }
      }
    }
    
    /**
     * ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì±„ë„ ë’¤ë¡œê°€ê¸°
     */
    function sidebarCategoryChannelGoBack() {
      if (sidebarCategoryChannelPath.length > 0) {
        sidebarCategoryChannelPath.pop();
        const brand = currentBrand;
        renderCategoryChannelTreemap('sidebar-category-channel-treemap', brand, true); // skipAnimation = true
      }
    }
    
    // ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë“œë¦´ë‹¤ìš´ ê²½ë¡œ
    let sidebarCategoryItemPath = [];
    
    /**
     * ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë Œë”ë§ (ì‚¬ì´ë“œë°”)
     */
    function renderCategoryItemTreemap(containerId, brand, skipAnimation = false) {
      const data = aggregateItemSalesComposition(brand);
      if (!data) {
        console.warn('[íŠ¸ë¦¬ë§µ] ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬-ì•„ì´í…œ ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      console.log('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ] ë Œë”ë§:', { brand, path: sidebarCategoryItemPath });
      
      // Plotly ë°ì´í„° êµ¬ì„±
      const labels = [];
      const parents = [];
      const values = [];
      const customdata = [];
      const ids = [];
      
      // ì „ì²´ ë§¤ì¶œ í•©ê³„ ê³„ì‚° (ë¹„ì¤‘ ê³„ì‚°ìš©)
      const totalSales = Object.values(data).reduce((sum, category) => sum + category.realSales, 0) / 100000000;
      
      // ë“œë¦´ë‹¤ìš´ ê²½ë¡œì— ë”°ë¼ ë‹¤ë¥¸ ë ˆë²¨ í‘œì‹œ
      if (sidebarCategoryItemPath.length === 0) {
        // Level 1: ì¹´í…Œê³ ë¦¬ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const sortedCategories = Object.values(data).sort((a, b) => b.realSales - a.realSales);
        sortedCategories.forEach(category => {
          const sales = category.realSales / 100000000; // ì–µì›
          if (sales > 0) {
            const ratio = totalSales > 0 ? (sales / totalSales * 100).toFixed(1) : 0;
            labels.push(category.category);
            parents.push('');
            values.push(sales);
            ids.push(`cat-${category.category}`);
            customdata.push([
              sales.toFixed(1),
              ratio,
                parseFloat(category.discountRate || 0),
                parseFloat(category.prevDiscountRate || 0),
                parseFloat(category.yoy || 0)
            ]);
          }
        });
      } else if (sidebarCategoryItemPath.length === 1) {
        // Level 2: ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ ì•„ì´í…œ (ë§¤ì¶œ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬)
        const selectedCategory = sidebarCategoryItemPath[0];
        const categoryData = data[selectedCategory];
        
        if (categoryData && categoryData.items) {
          const categoryTotal = categoryData.realSales / 100000000;
          const sortedItems = Object.values(categoryData.items).sort((a, b) => b.realSales - a.realSales);
          sortedItems.forEach(item => {
            const sales = item.realSales / 100000000; // ì–µì›
            if (sales > 0) {
              const ratio = categoryTotal > 0 ? (sales / categoryTotal * 100).toFixed(1) : 0;
              labels.push(item.item);
              parents.push('');
              values.push(sales);
              ids.push(`item-${item.item}`);
              customdata.push([
                sales.toFixed(1),
                ratio,
                parseFloat(item.discountRate || 0),
                parseFloat(item.prevDiscountRate || 0),
                parseFloat(item.yoy || 0)
              ]);
            }
          });
        }
      }
      
      if (labels.length === 0) {
        console.warn('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ] í‘œì‹œí•  ë°ì´í„° ì—†ìŒ');
        return;
      }
      
      // í…ìŠ¤íŠ¸ ë°°ì—´ ìƒì„± (ë©”ì¸ íŠ¸ë¦¬ë§µê³¼ ë™ì¼í•œ í˜•ì‹)
      const text = customdata.map((d, i) => 
        `<b style="font-size:16px;color:white;">${labels[i]}</b><br><span style="font-size:14px;color:white;">${d[0]}ì–µ(${d[1]}%)</span><br><span style="font-size:12px;">í• ì¸ìœ¨: ${d[2]}%<br>ì „ë…„í• ì¸ìœ¨: ${d[3]}%<br>YOY: ${d[4]}%</span>`
      );
      
      // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (ë©”ì¸ íŠ¸ë¦¬ë§µê³¼ ë™ì¼)
      const colorPalette = [
        '#6F6FD9',  // 1ìœ„
        '#9B6BF0',  // 2ìœ„
        '#6AA7FF',  // 3ìœ„
        '#3CB371',  // 4ìœ„
        '#F4B24D',  // 5ìœ„
        '#F26C6C',  // 6ìœ„
        '#B57CFF',  // 7ìœ„
        '#6ED39A',  // 8ìœ„
        '#F7A35C'   // 9ìœ„
      ];
      
      const colors = labels.map((label, i) => colorPalette[i % colorPalette.length]);
      
      const plotlyData = [{
        type: 'treemap',
        labels,
        parents,
        values,
        ids,
        text,
        textinfo: 'text',
        textposition: 'top left',
        textfont: { size: 14, color: 'yellow' },
        hovertemplate: '<b>%{label}</b><br>ë§¤ì¶œ : %{value:.1f}ì–µ<br>ë¹„ì¤‘ : %{customdata[1]:.1f}%<br>í• ì¸ìœ¨ : %{customdata[2]:.1f}% (ì „ë…„ : %{customdata[3]:.1f}%)<br>YOY : %{customdata[4]:.1f}%<extra></extra>',
        customdata,
        marker: {
          colors: colors,
          showscale: false,
          line: { color: 'white', width: 2 }
        }
      }];
      
      const layout = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        height: 350,
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        }
      };
      
      const layoutWithoutTransition = {
        margin: { l: 0, r: 0, t: 0, b: 0 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent',
        height: 350
      };
      
      const config = { 
        responsive: true,
        displayModeBar: false
      };
      
      // skipAnimationì´ë©´ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´, ì•„ë‹ˆë©´ ë¶€ë“œëŸ½ê²Œ ì „í™˜
      let plotPromise;
      if (skipAnimation) {
        plotPromise = Plotly.newPlot(containerId, plotlyData, layoutWithoutTransition, config);
      } else {
        const containerEl = document.getElementById(containerId);
        plotPromise = (containerEl && containerEl.data) 
          ? Plotly.react(containerId, plotlyData, layout, config)
          : Plotly.newPlot(containerId, plotlyData, layout, config);
      }
      
      plotPromise.then(() => {
        // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
        const container = document.getElementById(containerId);
        if (container) {
          container.on('plotly_click', function(eventData) {
            if (eventData.points && eventData.points.length > 0) {
              const clickedLabel = eventData.points[0].label;
              
              // ë“œë¦´ë‹¤ìš´ ì‹¤í–‰ (ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ, 2ë‹¨ê³„ê¹Œì§€ í—ˆìš©)
              if (sidebarCategoryItemPath.length < 1) {
                sidebarCategoryItemPath.push(clickedLabel);
                console.log('[ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ] ë“œë¦´ë‹¤ìš´:', sidebarCategoryItemPath);
                renderCategoryItemTreemap(containerId, brand);
                updateSidebarCategoryItemHeader();
              }
            }
          });
        }
      });
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      updateSidebarCategoryItemHeader();
    }
    
    /**
     * ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ íŠ¸ë¦¬ë§µ í—¤ë” ì—…ë°ì´íŠ¸
     */
    function updateSidebarCategoryItemHeader() {
      const backBtn = document.getElementById('sidebar-category-item-back-btn');
      if (backBtn) {
        if (sidebarCategoryItemPath.length > 0) {
          backBtn.style.display = 'block';
        } else {
          backBtn.style.display = 'none';
        }
      }
    }
    
    /**
     * ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ ë’¤ë¡œê°€ê¸°
     */
    function sidebarCategoryItemGoBack() {
      if (sidebarCategoryItemPath.length > 0) {
        sidebarCategoryItemPath.pop();
        const brand = currentBrand;
        renderCategoryItemTreemap('sidebar-category-item-treemap', brand, true); // skipAnimation = true
      }
    }
    
    /**
     * ë¸Œëœë“œë³„ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ (ë¸Œëœë“œ ì „í™˜ ì‹œ í˜¸ì¶œ)
     */
    function updateBrandTreemaps(brand) {
      console.log('[íŠ¸ë¦¬ë§µ] ë¸Œëœë“œ íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸:', brand);
      
      // ë¸Œëœë“œ ì „í™˜ ì‹œ ëª¨ë“  ë“œë¦´ë‹¤ìš´ ê²½ë¡œ ì´ˆê¸°í™”
      channelTreemapDrilldownPath = [];
      itemTreemapDrilldownPath = [];
      sidebarCategoryChannelPath = [];
      sidebarCategoryItemPath = [];
      
      // ë§¤ì¶œêµ¬ì„± ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œë“œ
      if (!window.salesCompositionData) {
        console.log('[íŠ¸ë¦¬ë§µ] ë§¤ì¶œêµ¬ì„± ë°ì´í„° ë¡œë“œ ì¤‘...');
        loadSalesCompositionData().then(() => {
          renderAllTreemaps(brand);
        });
      } else {
        renderAllTreemaps(brand);
      }
    }
    
    /**
     * ëª¨ë“  íŠ¸ë¦¬ë§µ ë Œë”ë§
     */
    function renderAllTreemaps(brand) {
      // ì±„ë„ë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ (ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì‚¬ìš©)
      const channelTreemapContainer = document.getElementById('treemapWrapperChannel');
      if (channelTreemapContainer) {
        renderChannelSalesTreemap('treemapWrapperChannel', brand);
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        const dateInfoEl = document.getElementById('treemapChannelDateInfo');
        if (dateInfoEl && window.salesCompositionData) {
          const asofDate = window.salesCompositionData.asof_dt || '-';
          
          // ì˜¤ëŠ˜ ë‚ ì§œ (ì—…ë°ì´íŠ¸ ì¼ì)
          const today = new Date();
          const updateDate = today.toISOString().split('T')[0];
          
          // ë‹¹ë…„/ì „ë…„ ë¶„ì„ê¸°ê°„ ê³„ì‚°
          let cyPeriod = '-';
          let pyPeriod = '-';
          
          if (asofDate && asofDate !== '-') {
            // ë‹¹ë…„: ë‹¹ì›” 1ì¼ ~ asof_dt
            const asofDateObj = new Date(asofDate);
            const cyYear = asofDateObj.getFullYear();
            const cyMonth = String(asofDateObj.getMonth() + 1).padStart(2, '0');
            cyPeriod = `${cyYear}-${cyMonth}-01 ~ ${asofDate}`;
            
            // ì „ë…„: ì „ë…„ ë™ì›” 1ì¼ ~ ì „ë…„ ë™ì¼ ë‚ ì§œ
            const pyYear = cyYear - 1;
            const pyEndDate = new Date(asofDateObj);
            pyEndDate.setFullYear(pyYear);
            const pyEndDateStr = pyEndDate.toISOString().split('T')[0];
            const pyMonth = String(pyEndDate.getMonth() + 1).padStart(2, '0');
            pyPeriod = `${pyYear}-${pyMonth}-01 ~ ${pyEndDateStr}`;
          }
          
          dateInfoEl.innerHTML = `<div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> ${updateDate}</div><div><strong>ë¶„ì„ê¸°ê°„:</strong> ë‹¹ë…„ ${cyPeriod} / ì „ë…„ ${pyPeriod}</div>`;
        }
      }
      
      // ì•„ì´í…œë³„ ë§¤ì¶œêµ¬ì„± íŠ¸ë¦¬ë§µ (ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì‚¬ìš©)
      const itemTreemapContainer = document.getElementById('treemapWrapperItem');
      if (itemTreemapContainer) {
        renderItemSalesTreemap('treemapWrapperItem', brand);
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        const dateInfoEl = document.getElementById('treemapItemDateInfo');
        if (dateInfoEl && window.salesCompositionData) {
          const asofDate = window.salesCompositionData.asof_dt || '-';
          
          // ì˜¤ëŠ˜ ë‚ ì§œ (ì—…ë°ì´íŠ¸ ì¼ì)
          const today = new Date();
          const updateDate = today.toISOString().split('T')[0];
          
          // ë‹¹ë…„/ì „ë…„ ë¶„ì„ê¸°ê°„ ê³„ì‚°
          let cyPeriod = '-';
          let pyPeriod = '-';
          
          if (asofDate && asofDate !== '-') {
            // ë‹¹ë…„: ë‹¹ì›” 1ì¼ ~ asof_dt
            const asofDateObj = new Date(asofDate);
            const cyYear = asofDateObj.getFullYear();
            const cyMonth = String(asofDateObj.getMonth() + 1).padStart(2, '0');
            cyPeriod = `${cyYear}-${cyMonth}-01 ~ ${asofDate}`;
            
            // ì „ë…„: ì „ë…„ ë™ì›” 1ì¼ ~ ì „ë…„ ë™ì¼ ë‚ ì§œ
            const pyYear = cyYear - 1;
            const pyEndDate = new Date(asofDateObj);
            pyEndDate.setFullYear(pyYear);
            const pyEndDateStr = pyEndDate.toISOString().split('T')[0];
            const pyMonth = String(pyEndDate.getMonth() + 1).padStart(2, '0');
            pyPeriod = `${pyYear}-${pyMonth}-01 ~ ${pyEndDateStr}`;
          }
          
          dateInfoEl.innerHTML = `<div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> ${updateDate}</div><div><strong>ë¶„ì„ê¸°ê°„:</strong> ë‹¹ë…„ ${cyPeriod} / ì „ë…„ ${pyPeriod}</div>`;
        }
      }
      
      // ì‚¬ì´ë“œë°” íŠ¸ë¦¬ë§µ 1: ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„
      const categoryChannelContainer = document.getElementById('sidebar-category-channel-treemap');
      if (categoryChannelContainer) {
        renderCategoryChannelTreemap('sidebar-category-channel-treemap', brand);
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        const dateInfoEl = document.getElementById('sidebarCategoryChannelDateInfo');
        if (dateInfoEl && window.salesCompositionData) {
          const asofDate = window.salesCompositionData.asof_dt || '-';
          
          // ì˜¤ëŠ˜ ë‚ ì§œ (ì—…ë°ì´íŠ¸ ì¼ì)
          const today = new Date();
          const updateDate = today.toISOString().split('T')[0];
          
          // ë‹¹ë…„/ì „ë…„ ë¶„ì„ê¸°ê°„ ê³„ì‚°
          let cyPeriod = '-';
          let pyPeriod = '-';
          
          if (asofDate && asofDate !== '-') {
            // ë‹¹ë…„: ë‹¹ì›” 1ì¼ ~ asof_dt
            const asofDateObj = new Date(asofDate);
            const cyYear = asofDateObj.getFullYear();
            const cyMonth = String(asofDateObj.getMonth() + 1).padStart(2, '0');
            cyPeriod = `${cyYear}-${cyMonth}-01 ~ ${asofDate}`;
            
            // ì „ë…„: ì „ë…„ ë™ì›” 1ì¼ ~ ì „ë…„ ë™ì¼ ë‚ ì§œ
            const pyYear = cyYear - 1;
            const pyEndDate = new Date(asofDateObj);
            pyEndDate.setFullYear(pyYear);
            const pyEndDateStr = pyEndDate.toISOString().split('T')[0];
            const pyMonth = String(pyEndDate.getMonth() + 1).padStart(2, '0');
            pyPeriod = `${pyYear}-${pyMonth}-01 ~ ${pyEndDateStr}`;
          }
          
          dateInfoEl.innerHTML = `<div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> ${updateDate}</div><div><strong>ë¶„ì„ê¸°ê°„:</strong> ë‹¹ë…„ ${cyPeriod} / ì „ë…„ ${pyPeriod}</div>`;
        }
      }
      
      // ì‚¬ì´ë“œë°” íŠ¸ë¦¬ë§µ 2: ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ
      const categoryItemContainer = document.getElementById('sidebar-category-item-treemap');
      if (categoryItemContainer) {
        renderCategoryItemTreemap('sidebar-category-item-treemap', brand);
        
        // ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
        const dateInfoEl = document.getElementById('sidebarCategoryItemDateInfo');
        if (dateInfoEl && window.salesCompositionData) {
          const asofDate = window.salesCompositionData.asof_dt || '-';
          
          // ì˜¤ëŠ˜ ë‚ ì§œ (ì—…ë°ì´íŠ¸ ì¼ì)
          const today = new Date();
          const updateDate = today.toISOString().split('T')[0];
          
          // ë‹¹ë…„/ì „ë…„ ë¶„ì„ê¸°ê°„ ê³„ì‚°
          let cyPeriod = '-';
          let pyPeriod = '-';
          
          if (asofDate && asofDate !== '-') {
            // ë‹¹ë…„: ë‹¹ì›” 1ì¼ ~ asof_dt
            const asofDateObj = new Date(asofDate);
            const cyYear = asofDateObj.getFullYear();
            const cyMonth = String(asofDateObj.getMonth() + 1).padStart(2, '0');
            cyPeriod = `${cyYear}-${cyMonth}-01 ~ ${asofDate}`;
            
            // ì „ë…„: ì „ë…„ ë™ì›” 1ì¼ ~ ì „ë…„ ë™ì¼ ë‚ ì§œ
            const pyYear = cyYear - 1;
            const pyEndDate = new Date(asofDateObj);
            pyEndDate.setFullYear(pyYear);
            const pyEndDateStr = pyEndDate.toISOString().split('T')[0];
            const pyMonth = String(pyEndDate.getMonth() + 1).padStart(2, '0');
            pyPeriod = `${pyYear}-${pyMonth}-01 ~ ${pyEndDateStr}`;
          }
          
          dateInfoEl.innerHTML = `<div><strong>ì—…ë°ì´íŠ¸ ì¼ì:</strong> ${updateDate}</div><div><strong>ë¶„ì„ê¸°ê°„:</strong> ë‹¹ë…„ ${cyPeriod} / ì „ë…„ ${pyPeriod}</div>`;
        }
      }
      
      // â˜… íŠ¸ë¦¬ë§µ ë Œë”ë§ ì™„ë£Œ - ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€ â˜…
      setTimeout(() => {
        const treemapChannelLoading = document.getElementById('treemapChannelLoading');
        const treemapItemLoading = document.getElementById('treemapItemLoading');
        if (treemapChannelLoading) {
          treemapChannelLoading.style.display = 'none';
          console.log('[íŠ¸ë¦¬ë§µ] ì±„ë„ íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€');
        }
        if (treemapItemLoading) {
          treemapItemLoading.style.display = 'none';
          console.log('[íŠ¸ë¦¬ë§µ] ì•„ì´í…œ íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€');
        }
      }, 300);
    }
    
    
    // íŒë§¤ìœ¨ ë°ì´í„°ë¥¼ íˆíŠ¸ë§µìš©ìœ¼ë¡œ ì§‘ê³„
    function aggregateSalesRateForHeatmap(salesRateData) {
      if (!salesRateData || !salesRateData.data) {
        console.warn('[ì „ì²´í˜„í™©] íŒë§¤ìœ¨ ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      const brandCodeMap = {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'ST': 'SERGIO',
        'W': 'SUPRA'
      };
      
      // CUR ë°ì´í„°ë§Œ ì‚¬ìš©
      const curData = salesRateData.data.CUR || [];
      
      // ë¸Œëœë“œë³„, ITEM_CDë³„ ì§‘ê³„
      const aggregated = {};
      const itemInfo = {}; // ITEM_CD -> ITEM_NM ë§¤í•‘
      
      curData.forEach(row => {
        const brand = brandCodeMap[row.BRD_CD] || row.BRD_CD;
        const itemCd = row.ITEM_CD;
        const itemNm = row.ITEM_NM || itemCd;
        
        // ITEM_CD ì •ë³´ ì €ì¥
        if (!itemInfo[itemCd]) {
          itemInfo[itemCd] = itemNm;
        }
        
        const key = `${brand}_${itemCd}`;
        
        if (!aggregated[key]) {
          aggregated[key] = {
            brand,
            itemCd,
            itemNm,
            sale: 0,
            stor: 0
          };
        }
        
        aggregated[key].sale += row.SALE_TAG || 0;
        aggregated[key].stor += row.AC_STOR_TAG_AMT_KOR || 0;
      });
      
      // íŒë§¤ìœ¨ ê³„ì‚°
      const result = {
        byBrand: {},
        byItem: {},
        itemInfo: itemInfo
      };
      
      Object.values(aggregated).forEach(item => {
        const salesRate = item.stor > 0 ? (item.sale / item.stor) * 100 : 0;
        
        // ë¸Œëœë“œë³„
        if (!result.byBrand[item.brand]) {
          result.byBrand[item.brand] = { sale: 0, stor: 0, items: {} };
        }
        result.byBrand[item.brand].sale += item.sale;
        result.byBrand[item.brand].stor += item.stor;
        result.byBrand[item.brand].items[item.itemCd] = salesRate;
        
        // ITEM_CDë³„
        if (!result.byItem[item.itemCd]) {
          result.byItem[item.itemCd] = { sale: 0, stor: 0, brands: {}, itemNm: item.itemNm };
        }
        result.byItem[item.itemCd].sale += item.sale;
        result.byItem[item.itemCd].stor += item.stor;
        result.byItem[item.itemCd].brands[item.brand] = salesRate;
      });
      
      // ë¸Œëœë“œë³„ í‰ê·  íŒë§¤ìœ¨ ê³„ì‚°
      Object.keys(result.byBrand).forEach(brand => {
        const data = result.byBrand[brand];
        data.avgSalesRate = data.stor > 0 ? (data.sale / data.stor) * 100 : 0;
      });
      
      // ITEM_CDë³„ í‰ê·  íŒë§¤ìœ¨ ê³„ì‚°
      Object.keys(result.byItem).forEach(itemCd => {
        const data = result.byItem[itemCd];
        data.avgSalesRate = data.stor > 0 ? (data.sale / data.stor) * 100 : 0;
      });
      
      return result;
    }
    
    // ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°ë¥¼ íˆíŠ¸ë§µìš©ìœ¼ë¡œ ì§‘ê³„
    function aggregateStockWeeksForHeatmap(stockWeeksData) {
      if (!stockWeeksData || !stockWeeksData.data) {
        console.warn('[ì „ì²´í˜„í™©] ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ì—†ìŒ');
        return null;
      }
      
      const brandCodeMap = {
        'M': 'MLB',
        'I': 'MLB KIDS',
        'X': 'DISCOVERY',
        'V': 'DUVETICA',
        'ST': 'SERGIO',
        'W': 'SUPRA'
      };
      
      // CY ë°ì´í„°ë§Œ ì‚¬ìš©
      const cyData = stockWeeksData.data.CY || [];
      
      // ë¸Œëœë“œë³„, ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
      const aggregated = {};
      
      cyData.forEach(row => {
        const brand = brandCodeMap[row.BRD_CD] || row.BRD_CD;
        const category = row.PRDT_KIND_NM || 'ETC';
        
        const key = `${brand}_${category}`;
        
        if (!aggregated[key]) {
          aggregated[key] = {
            brand,
            category,
            stockQty: 0,
            sale28d: 0
          };
        }
        
        aggregated[key].stockQty += row.STOCK_QTY || 0;
        aggregated[key].sale28d += row.SALE_QTY_28D || 0;
      });
      
      // ì¬ê³ ì£¼ìˆ˜ ê³„ì‚°
      const result = {
        byBrand: {},
        byCategory: {}
      };
      
      Object.values(aggregated).forEach(item => {
        const avg4w = item.sale28d / 4;
        const stockWeeks = avg4w > 0 ? item.stockQty / avg4w : 0;
        
        // ë¸Œëœë“œë³„
        if (!result.byBrand[item.brand]) {
          result.byBrand[item.brand] = { stockQty: 0, sale28d: 0, categories: {} };
        }
        result.byBrand[item.brand].stockQty += item.stockQty;
        result.byBrand[item.brand].sale28d += item.sale28d;
        result.byBrand[item.brand].categories[item.category] = stockWeeks;
        
        // ì¹´í…Œê³ ë¦¬ë³„
        if (!result.byCategory[item.category]) {
          result.byCategory[item.category] = { stockQty: 0, sale28d: 0, brands: {} };
        }
        result.byCategory[item.category].stockQty += item.stockQty;
        result.byCategory[item.category].sale28d += item.sale28d;
        result.byCategory[item.category].brands[item.brand] = stockWeeks;
      });
      
      // ë¸Œëœë“œë³„ í‰ê·  ì¬ê³ ì£¼ìˆ˜ ê³„ì‚°
      Object.keys(result.byBrand).forEach(brand => {
        const data = result.byBrand[brand];
        const avg4w = data.sale28d / 4;
        data.avgStockWeeks = avg4w > 0 ? data.stockQty / avg4w : 0;
      });
      
      // ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  ì¬ê³ ì£¼ìˆ˜ ê³„ì‚°
      Object.keys(result.byCategory).forEach(category => {
        const data = result.byCategory[category];
        const avg4w = data.sale28d / 4;
        data.avgStockWeeks = avg4w > 0 ? data.stockQty / avg4w : 0;
      });
      
      return result;
    }
    
    // ==================== ë: ì „ì²´í˜„í™© íˆíŠ¸ë§µ API ì—°ë™ ====================
    
    // ë“œë¦´ë‹¤ìš´ íŒ¨ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (DOM ì´ë¯¸ ë¡œë“œëœ ê²½ìš°ì—ë„ ì‹¤í–‰)
    function initDashboardDOM() {
      // íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (íŒë§¤ìœ¨ / ì¬ê³ ì£¼ìˆ˜)
      const salesRateTabBtn = document.getElementById('tab-sales-rate');
      const stockWeeksTabBtn = document.getElementById('tab-stock-weeks');
      
      if (salesRateTabBtn) {
        salesRateTabBtn.addEventListener('click', () => switchAnalysisTab('sales-rate'));
      }
      
      if (stockWeeksTabBtn) {
        stockWeeksTabBtn.addEventListener('click', () => {
          switchAnalysisTab('stock-weeks');
          // ì¬ê³ ì£¼ìˆ˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¡œë“œ
          if (!window.stockWeeksData) {
            loadStockWeeksData();
          }
        });
      }
      
      // ì „ì²´ ë°ì´í„° ì—…ë°ì´íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ìƒë‹¨ í—¤ë”)
      const updateAllBtn = document.getElementById('btn-update-all-data');
      if (updateAllBtn) {
        updateAllBtn.addEventListener('click', async function() {
          console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] í´ë¦­ - ëª¨ë“  API ê°•ì œ ì—…ë°ì´íŠ¸ ì‹œì‘');
          
          // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ìƒíƒœ
          this.disabled = true;
          this.style.opacity = '0.6';
          this.style.cursor = 'not-allowed';
          const originalHTML = this.innerHTML;
          this.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg> ì—…ë°ì´íŠ¸ ì¤‘...';
          
          try {
            // ëª¨ë“  API ë³‘ë ¬ ì—…ë°ì´íŠ¸ (íŒë§¤ìœ¨, ì¬ê³ ì£¼ìˆ˜, íŠ¸ë¦¬ë§µ, í• ì¸ë‚´ì—­)
            console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] ëª¨ë“  API ë³‘ë ¬ í˜¸ì¶œ ì‹œì‘...');
            
            // íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
            const treemapChannelLoading = document.getElementById('treemapChannelLoading');
            const treemapItemLoading = document.getElementById('treemapItemLoading');
            if (treemapChannelLoading) treemapChannelLoading.style.display = 'flex';
            if (treemapItemLoading) treemapItemLoading.style.display = 'flex';
            
            await Promise.all([
              // 1. íŒë§¤ìœ¨
              loadSalesRateData(true).then(() => {
                console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ“ íŒë§¤ìœ¨ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
              }).catch(err => {
                console.error('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ— íŒë§¤ìœ¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err);
              }),
              
              // 2. ì¬ê³ ì£¼ìˆ˜
              loadStockWeeksData(true).then(() => {
                console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ“ ì¬ê³ ì£¼ìˆ˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
              }).catch(err => {
                console.error('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ— ì¬ê³ ì£¼ìˆ˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err);
              }),
              
              // 3. íŠ¸ë¦¬ë§µ (ë§¤ì¶œêµ¬ì„±)
              loadSalesCompositionData(true).then(() => {
                console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ“ íŠ¸ë¦¬ë§µ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                // íŠ¸ë¦¬ë§µ ë‹¤ì‹œ ë Œë”ë§
                if (window.salesCompositionData && typeof updateBrandTreemaps === 'function') {
                  const currentBrand = document.querySelector('.brand-btn.active')?.dataset.brand;
                  if (currentBrand) {
                    updateBrandTreemaps(currentBrand);
                  }
                }
                // íŠ¸ë¦¬ë§µ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                if (treemapItemLoading) treemapItemLoading.style.display = 'none';
              }).catch(err => {
                console.error('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ— íŠ¸ë¦¬ë§µ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err);
                // ì‹¤íŒ¨ ì‹œì—ë„ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                if (treemapChannelLoading) treemapChannelLoading.style.display = 'none';
                if (treemapItemLoading) treemapItemLoading.style.display = 'none';
              }),
              
              // 4. í• ì¸ë‚´ì—­ (í˜„ì¬ ë¸Œëœë“œë§Œ)
              (async () => {
                const currentBrand = document.querySelector('.brand-btn.active')?.dataset.brand;
                if (currentBrand && typeof loadDiscountData === 'function') {
                  // ë¸Œëœë“œ ì½”ë“œ ë§¤í•‘
                  const brandCodeMap = {
                    'MLB': 'M',
                    'MLB_KIDS': 'I',
                    'DISCOVERY': 'X',
                    'DUVETICA': 'V',
                    'SERGIO': 'ST',
                    'SUPRA': 'W'
                  };
                  const brandCode = brandCodeMap[currentBrand] || 'M';
                  
                  // forceUpdateë¥¼ ìœ„í•´ API ì§ì ‘ í˜¸ì¶œ
                  const apiDate = window.__API_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
                  const urlParams = new URLSearchParams(window.location.search);
                  const monthParam = urlParams.get('month');
                  let url = `/api/discount-detail?brand=${brandCode}&date=${apiDate}&forceUpdate=true`;
                  if (monthParam) {
                    url += `&month=${monthParam}`;
                  }
                  return fetch(url).then(r => r.json()).then(() => {
                    console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ“ í• ì¸ë‚´ì—­ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    // í• ì¸ë‚´ì—­ ë‹¤ì‹œ ë¡œë“œ
                    return loadDiscountData(brandCode);
                  }).catch(err => {
                    console.error('[ì „ì²´ ì—…ë°ì´íŠ¸] âœ— í• ì¸ë‚´ì—­ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err);
                  });
                }
              })()
            ]);
            
            console.log('[ì „ì²´ ì—…ë°ì´íŠ¸] ëª¨ë“  API ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            
            // ì„±ê³µ ë©”ì‹œì§€
            this.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> ì—…ë°ì´íŠ¸ ì™„ë£Œ';
            this.style.background = '#10b981';
            
            setTimeout(() => {
              this.innerHTML = originalHTML;
              this.style.background = '#4f46e5';
              this.disabled = false;
              this.style.opacity = '1';
              this.style.cursor = 'pointer';
            }, 2000);
            
          } catch (error) {
            console.error('[ì „ì²´ ì—…ë°ì´íŠ¸] ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            
            // ì—ëŸ¬ ë©”ì‹œì§€
            this.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 18L18 6M6 6l12 12"/></svg> ì—…ë°ì´íŠ¸ ì‹¤íŒ¨';
            this.style.background = '#ef4444';
            
            setTimeout(() => {
              this.innerHTML = originalHTML;
              this.style.background = '#4f46e5';
              this.disabled = false;
              this.style.opacity = '1';
              this.style.cursor = 'pointer';
            }, 2000);
          }
        });
      }
      
      // íŒë§¤ìœ¨ íŒ¨ë„ ë‹«ê¸° ë²„íŠ¼
      const closeBtn = document.getElementById('close-drilldown');
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          const panel = document.getElementById('drilldown-panel');
          if (panel) {
            panel.classList.remove('open');
          }
        });
      }
      
      // ì¬ê³ ì£¼ìˆ˜ íŒ¨ë„ ë‹«ê¸° ë²„íŠ¼
      const closeStockWeeksBtn = document.getElementById('close-stock-weeks-drilldown');
      if (closeStockWeeksBtn) {
        closeStockWeeksBtn.addEventListener('click', function() {
          const panel = document.getElementById('stock-weeks-drilldown-panel');
          if (panel) {
            panel.classList.remove('open');
          }
        });
      }
      
      // ========== ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ==========
      const openItemTreemapSidebarBtn = document.getElementById('openItemTreemapSidebar');
      if (openItemTreemapSidebarBtn) {
        openItemTreemapSidebarBtn.addEventListener('click', function() {
          const sidebar = document.getElementById('item-treemap-sidebar');
          if (sidebar) {
            sidebar.classList.add('open');
            // ì‚¬ì´ë“œë°”ê°€ ì—´ë¦´ ë•Œ ë°ì´í„° ë¡œë“œ
            loadItemTreemapSidebarData();
          }
        });
      }
      
      const closeItemTreemapSidebarBtn = document.getElementById('close-item-treemap-sidebar');
      if (closeItemTreemapSidebarBtn) {
        closeItemTreemapSidebarBtn.addEventListener('click', function() {
          const sidebar = document.getElementById('item-treemap-sidebar');
          if (sidebar) {
            sidebar.classList.remove('open');
          }
        });
      }
      // ========== ë: ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ==========
      
      // ========== ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (Snowflake API) ==========
      function loadItemTreemapSidebarData() {
        console.log('[ì‚¬ì´ë“œë°”] ë°ì´í„° ë¡œë“œ ì‹œì‘ (Snowflake API)');
        
        // Snowflake ë°ì´í„° í™•ì¸
        if (!window.salesCompositionData || !window.salesCompositionData.data) {
          console.warn('[ì‚¬ì´ë“œë°”] Snowflake ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° ë¡œë“œ ì‹œë„...');
          loadSalesCompositionData().then(() => {
            loadItemTreemapSidebarData(); // ì¬ì‹œë„
          });
          return;
        }
        
        // í˜„ì¬ ë¸Œëœë“œ ì •ë³´ í‘œì‹œ
        const brandNameEl = document.getElementById('sidebar-brand-name');
        if (brandNameEl) {
          brandNameEl.textContent = currentBrand || '-';
        }
        
        // ë¸Œëœë“œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
        
        // Snowflake ë°ì´í„°ì—ì„œ í˜„ì¬ ë¸Œëœë“œ ë°ì´í„° í•„í„°ë§
        const cyData = window.salesCompositionData.data.CY || [];
        const brandData = cyData.filter(row => row.ë¸Œëœë“œ === brandCode);
        
        if (brandData.length === 0) {
          console.warn('[ì‚¬ì´ë“œë°”] ë¸Œëœë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', {brandCode, currentBrand});
          return;
        }
        
        // Snowflake ë°ì´í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ í•©ê³„ ë° ê³ ìœ  ì•„ì´í…œ ìˆ˜ ê³„ì‚°
        const categoryTotals = {}; // ì¹´í…Œê³ ë¦¬ë³„ í•©ê³„
        const uniqueItems = new Set(); // ê³ ìœ  ì•„ì´í…œ(ITEM_CD) ìˆ˜ ê³„ì‚°
        
        brandData.forEach(row => {
          const category = row.ì¹´í…Œê³ ë¦¬;
          const realSales = row.ì‹¤íŒë§¤ì¶œ || 0;
          const item = row.ì•„ì´í…œ;
          
          if (!categoryTotals[category]) {
            categoryTotals[category] = 0;
          }
          categoryTotals[category] += realSales;
          
          // ê³ ìœ  ì•„ì´í…œ ì¶”ê°€
          if (item) {
            uniqueItems.add(item);
          }
        });
        
        // ì´ ë§¤ì¶œ ê³„ì‚°
        const totalRevenue = Object.values(categoryTotals).reduce((sum, val) => sum + val, 0);
        
        // ì´ ë§¤ì¶œ í‘œì‹œ (ì´ë¯¸ ì› ë‹¨ìœ„ì´ë¯€ë¡œ ì–µ ë‹¨ìœ„ë¡œ ë³€í™˜)
        const totalRevenueEl = document.getElementById('sidebar-total-revenue');
        if (totalRevenueEl) {
          totalRevenueEl.textContent = `${(totalRevenue / 100000000).toFixed(1)}ì–µì›`;
        }
        
        // ë§¤ì¶œê¸°ê°„ í‘œì‹œ (salesCompositionDataì˜ asof_dt ê¸°ë°˜)
        const salesPeriodEl = document.getElementById('sidebar-sales-period');
        if (salesPeriodEl && window.salesCompositionData) {
          const asofDate = window.salesCompositionData.asof_dt || '-';
          
          if (asofDate && asofDate !== '-') {
            // ë‹¹ë…„: ë‹¹ì›” 1ì¼ ~ asof_dt
            const asofDateObj = new Date(asofDate);
            const cyYear = asofDateObj.getFullYear();
            const cyMonth = String(asofDateObj.getMonth() + 1).padStart(2, '0');
            const cyPeriod = `${cyYear}-${cyMonth}-01 ~ ${asofDate}`;
            
            salesPeriodEl.textContent = cyPeriod;
          } else {
            salesPeriodEl.textContent = '-';
          }
        }
        
        // ì‚¬ì´ë“œë°” íŠ¸ë¦¬ë§µì€ ì´ë¯¸ renderAllTreemaps()ì—ì„œ ë Œë”ë§ë¨
        // ì—¬ê¸°ì„œëŠ” ì¶”ê°€ ì •ë³´ë§Œ ì—…ë°ì´íŠ¸
        console.log('[ì‚¬ì´ë“œë°”] ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
          totalRevenue: (totalRevenue / 100000000).toFixed(1) + 'ì–µì›',
          categoryCount: Object.keys(categoryTotals).length
        });
        
        // í”„ë¡œëª¨ì…˜ ë‚´ìš© ì—…ë°ì´íŠ¸
        console.log('[ì‚¬ì´ë“œë°”] í”„ë¡œëª¨ì…˜ ì—…ë°ì´íŠ¸ í˜¸ì¶œ ì‹œë„');
        if (typeof window.updatePromotionContent === 'function') {
          window.updatePromotionContent();
        } else {
          console.error('[ì‚¬ì´ë“œë°”] updatePromotionContent í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ!');
        }
      }
      
      // 1-1. ì¹´í…Œê³ ë¦¬ â†’ ì±„ë„ ë“œë¦´ë‹¤ìš´ íŠ¸ë¦¬ë§µ ë Œë”ë§ (Snowflake API)
      function updateCategoryChannelTable(categoryTotals, totalRevenue, brandSalesData) {
        // â˜… ìƒˆë¡œìš´ Snowflake ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì‚¬ìš© â˜…
        // renderCategoryChannelTreemap()ì´ ì´ë¯¸ renderAllTreemaps()ì—ì„œ í˜¸ì¶œë¨
        console.log('[ì‚¬ì´ë“œë°”] ì¹´í…Œê³ ë¦¬â†’ì±„ë„ íŠ¸ë¦¬ë§µì€ renderCategoryChannelTreemap()ì—ì„œ ë Œë”ë§ë¨');
        return;
        
        /* ì˜›ë‚  JSON ê¸°ë°˜ ì½”ë“œ (ì‚¬ìš© ì•ˆí•¨)
        const container = document.getElementById('sidebar-category-channel-treemap');
        if (!container) return;
        
        const sortedCategories = Object.entries(categoryTotals)
          .sort((a, b) => b[1] - a[1]);
        
        if (sortedCategories.length === 0) {
          container.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#94a3b8;font-size:13px;">
              ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          `;
          return;
        }
        
        // í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY ë°ì´í„° ì¤€ë¹„
        const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
        
        // íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„±
        const labels = [];
        const values = [];
        const parents = [];
        const ids = [];
        const customText = [];
        const customDataArray = [];
        
        sortedCategories.forEach(([name, value], index) => {
          const percentage = ((value / totalRevenue) * 100).toFixed(1);
          const revenueInBillions = (value / 100000000).toFixed(1);
          
          // í• ì¸ìœ¨ ê³„ì‚° (ìƒ˜í”Œ ë°ì´í„°, ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´ í•„ìš”)
          let discountRate = 25.0; // ê¸°ë³¸ê°’
          let prevDiscountRate = 23.5; // ê¸°ë³¸ê°’
          let yoy = null; // ê¸°ë³¸ê°’
          
          // treemapRawDataì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
          try {
            const itemKeyMap = {
              'ì‹ ë°œ': 'Shoes',
              'ê°€ë°©': 'Bag',
              'ëª¨ì': 'Headwear',
              'ê¸°íƒ€ACC': 'Acc_etc',
              'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
              'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜',
              'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜'
            };
            const itemKey = itemKeyMap[name] || name;
            const treemapRaw = window.treemapRawData?.[brandCode]?.item?.items?.[itemKey];
            
            if (treemapRaw) {
              if (typeof treemapRaw.discountRate === 'number') {
                discountRate = treemapRaw.discountRate;
              }
              if (typeof treemapRaw.prevDiscountRate === 'number') {
                prevDiscountRate = treemapRaw.prevDiscountRate;
              }
              if (typeof treemapRaw.yoy === 'number') {
                yoy = treemapRaw.yoy;
              }
            }
          } catch (e) {
            console.warn('í• ì¸ìœ¨ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
          }
          
          labels.push(name);
          values.push(value / 100000000); // ì–µ ë‹¨ìœ„
          parents.push('');
          ids.push(`cat-channel-${index}`);
          
          // customData ë°°ì—´ ìƒì„± (ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY)
          const percentageNum = parseFloat(percentage);
          const discountRateNum = parseFloat(discountRate.toFixed(1));
          const prevDiscountRateNum = prevDiscountRate !== null ? parseFloat(prevDiscountRate.toFixed(1)) : 0.0;
          const yoyPercentage = yoy !== null ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
          customDataArray.push([percentageNum, discountRateNum, prevDiscountRateNum, yoyPercentage]);
          
          // í…ìŠ¤íŠ¸ ìƒì„±
          let textHtml = `<b style="font-size:14px;">${name}</b><br><span style="font-size:12px;">${revenueInBillions}ì–µì› (${percentage}%)</span>`;
          
          // í• ì¸ìœ¨ í‘œì‹œ
          textHtml += `<br><span style="font-size:11px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
          
          // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ
          if (prevDiscountRateNum !== null) {
            textHtml += `<br><span style="font-size:11px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateNum.toFixed(1)}%</span>`;
          }
          
          // YOY í‘œì‹œ
          if (yoyPercentage !== null) {
            textHtml += `<br><span style="font-size:11px;color:#fde68a;">YOY : ${yoyPercentage.toFixed(1)}%</span>`;
          }
          
          customText.push(textHtml);
        });
        
        const data = [{
          type: 'treemap',
          labels: labels,
          values: values,
          parents: parents,
          ids: ids,
          text: customText,
          textinfo: 'text',
          hovertemplate: '<b>%{label}</b><br>ë§¤ì¶œ: %{value:.1f}ì–µ<br>ë¹„ì¤‘: %{customdata[0]:.1f}%<br>í• ì¸ìœ¨: %{customdata[1]:.1f}%<br>ì „ë…„í• ì¸ìœ¨: %{customdata[2]:.1f}%<br>YOY: %{customdata[3]:.1f}%<extra></extra>',
          customdata: customDataArray,
          textfont: { size: 12, color: 'white' },
          marker: {
            colors: [
              'rgba(79,70,229,0.85)', 'rgba(124,58,237,0.85)', 'rgba(59,130,246,0.85)', 
              'rgba(16,185,129,0.85)', 'rgba(245,158,11,0.85)', 'rgba(239,68,68,0.85)',
              'rgba(168,85,247,0.85)', 'rgba(34,197,94,0.85)', 'rgba(251,146,60,0.85)'
            ],
            line: { color: 'white', width: 2 }
          }
        }];
        
        const layout = {
          margin: { l: 0, r: 0, t: 0, b: 0 },
          paper_bgcolor: 'rgba(0,0,0,0)',
          plot_bgcolor: 'rgba(0,0,0,0)',
          height: 350
        };
        
        const config = { 
          responsive: true, 
          displayModeBar: false 
        };
        
        // íŠ¸ë¦¬ë§µ ë Œë”ë§
        if (window.Plotly && typeof window.Plotly.newPlot === 'function') {
          window.Plotly.newPlot(container, data, layout, config).then(() => {
            // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ (ë“œë¦´ë‹¤ìš´)
            container.on('plotly_click', function(eventData) {
              if (eventData.points && eventData.points.length > 0) {
                const category = eventData.points[0].label;
                alert(`${category}ì˜ ì±„ë„ë³„ ìƒì„¸ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.\n(ì¶”í›„ êµ¬í˜„ ì˜ˆì •)`);
              }
            });
          }).catch(err => {
            console.error('Treemap render failed:', err);
            container.innerHTML = `
              <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#ef4444;font-size:13px;">
                íŠ¸ë¦¬ë§µì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
              </div>
            `;
          });
        } else {
          container.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#f59e0b;font-size:13px;">
              Plotly ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>
          `;
        }
        */ // ì˜›ë‚  ì½”ë“œ ë
      }
      
      // 1-2. ì¹´í…Œê³ ë¦¬ â†’ ì•„ì´í…œ ë“œë¦´ë‹¤ìš´ íŠ¸ë¦¬ë§µ ë Œë”ë§ (Snowflake API)
      function updateCategoryItemTable(categoryTotals, totalRevenue) {
        // â˜… ìƒˆë¡œìš´ Snowflake ê¸°ë°˜ íŠ¸ë¦¬ë§µ ì‚¬ìš© â˜…
        // renderCategoryItemTreemap()ì´ ì´ë¯¸ renderAllTreemaps()ì—ì„œ í˜¸ì¶œë¨
        console.log('[ì‚¬ì´ë“œë°”] ì¹´í…Œê³ ë¦¬â†’ì•„ì´í…œ íŠ¸ë¦¬ë§µì€ renderCategoryItemTreemap()ì—ì„œ ë Œë”ë§ë¨');
        return;
        
        /* ì˜›ë‚  JSON ê¸°ë°˜ ì½”ë“œ (ì‚¬ìš© ì•ˆí•¨)
        const container = document.getElementById('sidebar-category-item-treemap');
        if (!container) return;
        
        const sortedCategories = Object.entries(categoryTotals)
          .sort((a, b) => b[1] - a[1]);
        
        if (sortedCategories.length === 0) {
          container.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#94a3b8;font-size:13px;">
              ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          `;
          return;
        }
        
        // í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY ë°ì´í„° ì¤€ë¹„
        const brandCode = brandCodeMap[currentBrand] || brandCodeMap[currentBrand.replace('_', ' ')] || 'M';
        
        // íŠ¸ë¦¬ë§µ ë°ì´í„° ìƒì„±
        const labels = [];
        const values = [];
        const parents = [];
        const ids = [];
        const customText = [];
        const customDataArray = [];
        
        sortedCategories.forEach(([name, value], index) => {
          const percentage = ((value / totalRevenue) * 100).toFixed(1);
          const revenueInBillions = (value / 100000000).toFixed(1);
          
          // í• ì¸ìœ¨ ê³„ì‚° (ìƒ˜í”Œ ë°ì´í„°, ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´ í•„ìš”)
          let discountRate = 24.5; // ê¸°ë³¸ê°’
          let prevDiscountRate = 22.8; // ê¸°ë³¸ê°’
          let yoy = null; // ê¸°ë³¸ê°’
          
          // treemapRawDataì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
          try {
            const itemKeyMap = {
              'ì‹ ë°œ': 'Shoes',
              'ê°€ë°©': 'Bag',
              'ëª¨ì': 'Headwear',
              'ê¸°íƒ€ACC': 'Acc_etc',
              'ë‹¹ì‹œì¦Œì˜ë¥˜': 'ë‹¹ì‹œì¦Œì˜ë¥˜',
              'ì°¨ì‹œì¦Œì˜ë¥˜': 'ì°¨ì‹œì¦Œì˜ë¥˜',
              'ê³¼ì‹œì¦Œì˜ë¥˜': 'ê³¼ì‹œì¦Œì˜ë¥˜'
            };
            const itemKey = itemKeyMap[name] || name;
            const treemapRaw = window.treemapRawData?.[brandCode]?.item?.items?.[itemKey];
            
            if (treemapRaw) {
              if (typeof treemapRaw.discountRate === 'number') {
                discountRate = treemapRaw.discountRate;
              }
              if (typeof treemapRaw.prevDiscountRate === 'number') {
                prevDiscountRate = treemapRaw.prevDiscountRate;
              }
              if (typeof treemapRaw.yoy === 'number') {
                yoy = treemapRaw.yoy;
              }
            }
          } catch (e) {
            console.warn('í• ì¸ìœ¨ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
          }
          
          labels.push(name);
          values.push(value / 100000000); // ì–µ ë‹¨ìœ„
          parents.push('');
          ids.push(`cat-item-${index}`);
          
          // customData ë°°ì—´ ìƒì„± (ë¹„ì¤‘, í• ì¸ìœ¨, ì „ë…„í• ì¸ìœ¨, YOY)
          const percentageNum = parseFloat(percentage);
          const discountRateNum = parseFloat(discountRate.toFixed(1));
          const prevDiscountRateNum = prevDiscountRate !== null ? parseFloat(prevDiscountRate.toFixed(1)) : 0.0;
          const yoyPercentage = yoy !== null ? parseFloat((100 + yoy).toFixed(1)) : 0.0;
          customDataArray.push([percentageNum, discountRateNum, prevDiscountRateNum, yoyPercentage]);
          
          // í…ìŠ¤íŠ¸ ìƒì„±
          let textHtml = `<b style="font-size:14px;">${name}</b><br><span style="font-size:12px;">${revenueInBillions}ì–µì› (${percentage}%)</span>`;
          
          // í• ì¸ìœ¨ í‘œì‹œ
          textHtml += `<br><span style="font-size:11px;color:#fde68a;">í• ì¸ìœ¨ : ${discountRateNum.toFixed(1)}%</span>`;
          
          // ì „ë…„í• ì¸ìœ¨ í‘œì‹œ
          if (prevDiscountRateNum !== null) {
            textHtml += `<br><span style="font-size:11px;color:#fde68a;">ì „ë…„í• ì¸ìœ¨ : ${prevDiscountRateNum.toFixed(1)}%</span>`;
          }
          
          // YOY í‘œì‹œ
          if (yoyPercentage !== null) {
            textHtml += `<br><span style="font-size:11px;color:#fde68a;">YOY : ${yoyPercentage.toFixed(1)}%</span>`;
          }
          
          customText.push(textHtml);
        });
        
        const data = [{
          type: 'treemap',
          labels: labels,
          values: values,
          parents: parents,
          ids: ids,
          text: customText,
          textinfo: 'text',
          hovertemplate: '<b>%{label}</b><br>ë§¤ì¶œ: %{value:.1f}ì–µ<br>ë¹„ì¤‘: %{customdata[0]:.1f}%<br>í• ì¸ìœ¨: %{customdata[1]:.1f}%<br>ì „ë…„í• ì¸ìœ¨: %{customdata[2]:.1f}%<br>YOY: %{customdata[3]:.1f}%<extra></extra>',
          customdata: customDataArray,
          textfont: { size: 12, color: 'white' },
          marker: {
            colors: [
              'rgba(16,185,129,0.85)', 'rgba(34,197,94,0.85)', 'rgba(5,150,105,0.85)', 
              'rgba(6,182,212,0.85)', 'rgba(14,165,233,0.85)', 'rgba(99,102,241,0.85)',
              'rgba(139,92,246,0.85)', 'rgba(168,85,247,0.85)', 'rgba(217,70,239,0.85)'
            ],
            line: { color: 'white', width: 2 }
          }
        }];
        
        const layout = {
          margin: { l: 0, r: 0, t: 0, b: 0 },
          paper_bgcolor: 'rgba(0,0,0,0)',
          plot_bgcolor: 'rgba(0,0,0,0)',
          height: 350
        };
        
        const config = { 
          responsive: true, 
          displayModeBar: false 
        };
        
        // íŠ¸ë¦¬ë§µ ë Œë”ë§
        if (window.Plotly && typeof window.Plotly.newPlot === 'function') {
          window.Plotly.newPlot(container, data, layout, config).then(() => {
            // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ (ë“œë¦´ë‹¤ìš´)
            container.on('plotly_click', function(eventData) {
              if (eventData.points && eventData.points.length > 0) {
                const category = eventData.points[0].label;
                alert(`${category}ì˜ ì•„ì´í…œë³„ ìƒì„¸ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.\n(ì¶”í›„ êµ¬í˜„ ì˜ˆì •)`);
              }
            });
          }).catch(err => {
            console.error('Treemap render failed:', err);
            container.innerHTML = `
              <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#ef4444;font-size:13px;">
                íŠ¸ë¦¬ë§µì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
              </div>
            `;
          });
        } else {
          container.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:center;height:300px;color:#f59e0b;font-size:13px;">
              Plotly ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>
          `;
        }
        */ // ì˜›ë‚  ì½”ë“œ ë
      }
      
      // ====== í• ì¸ë‚´ì—­ API ì—°ê²° í•¨ìˆ˜ ======
      
      /**
       * í• ì¸ë‚´ì—­ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
       */
      function updateDiscountChart(discountData) {
        const canvas = document.getElementById('sidebar-discount-chart');
        if (!canvas) {
          console.log('[í• ì¸ë‚´ì—­] ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const ctx = canvas.getContext('2d');
        
        // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
        if (window.sidebarDiscountChart) {
          window.sidebarDiscountChart.destroy();
        }
        
        // ì°¨íŠ¸ì— í‘œì‹œí•  í• ì¸ì½”ë“œ ì„ íƒ (ìƒìœ„ 5ê°œ ë˜ëŠ” ì „ì²´)
        const codes = Object.keys(discountData)
          .filter(code => code !== 'í•©ê³„' && code !== 'ì •ìƒ')
          .sort((a, b) => {
            const aTotal = (discountData[a].cy.salesInBillion || 0) + (discountData[a].py.salesInBillion || 0);
            const bTotal = (discountData[b].cy.salesInBillion || 0) + (discountData[b].py.salesInBillion || 0);
            return bTotal - aTotal;
          })
          .slice(0, 5);
        
        const cyData = codes.map(code => discountData[code].cy.salesInBillion || 0);
        const pyData = codes.map(code => discountData[code].py.salesInBillion || 0);
        
        window.sidebarDiscountChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: codes,
            datasets: [
              {
                label: 'ë‹¹ë…„',
                data: cyData,
                backgroundColor: 'rgba(79,70,229,0.8)',
                borderColor: 'rgba(79,70,229,1)',
                borderWidth: 2
              },
              {
                label: 'ì „ë…„',
                data: pyData,
                backgroundColor: 'rgba(16,185,129,0.8)',
                borderColor: 'rgba(16,185,129,1)',
                borderWidth: 2
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'top'
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}ì–µì›`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: '#e5e7eb'
                },
                ticks: {
                  callback: function(value) {
                    return value + 'ì–µ';
                  }
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      /**
       * í• ì¸ë‚´ì—­ ë°ì´í„° ë¡œë“œ (Snowflake API + Redis ìºì‹œ)
       * @param {string} brandCode - ë¸Œëœë“œ ì½”ë“œ (M, I, X, V, ST, W)
       * @returns {Promise<Array>} í• ì¸ë‚´ì—­ ë°ì´í„° ë°°ì—´
       */
      async function loadDiscountData(brandCode) {
        try {
          // overview ë¡œë“œì™€ ë™ì¼í•œ ë¶„ì„ì›” ì‚¬ìš© (__API_DATE__ ìš°ì„ , ì—†ìœ¼ë©´ __DATA_DATE__)
          const dateStr = window.__API_DATE__ || window.__DATA_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '') || '20260119';
          const analysisMonth = `${dateStr.slice(0, 4)}-${dateStr.slice(4, 6)}`;
          
          console.log('[í• ì¸ë‚´ì—­] ë°ì´í„° ë¡œë“œ ì‹œì‘:', { brandCode, analysisMonth });
          
          // API í˜¸ì¶œ (Redis ìºì‹œ ì‚¬ìš©, 60ì´ˆ íƒ€ì„ì•„ì›ƒ)
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 60000);
          const response = await fetch(
            `/api/discount-detail?brand=${brandCode}&month=${analysisMonth}`,
            { signal: controller.signal }
          );
          clearTimeout(timeoutId);
          
          if (!response.ok) {
            throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
          }
          
          const result = await response.json();
          
          if (!result.success) {
            throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
          }
          
          // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ë“œë¦´ë‹¤ìš´ì—ì„œ ì¬ì‚¬ìš©)
          window.discountDetailData = result.data;
          
          console.log('[í• ì¸ë‚´ì—­] ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
            rowCount: result.data.length,
            cached: result.cached
          });
          
          // API ì‘ë‹µ ë°ì´í„° êµ¬ì¡° í™•ì¸
          if (result.data && result.data.length > 0) {
            console.log('[í• ì¸ë‚´ì—­] API ì‘ë‹µ ì²« ë²ˆì§¸ í–‰:', result.data[0]);
            console.log('[í• ì¸ë‚´ì—­] API ì‘ë‹µ í‚¤ ëª©ë¡:', Object.keys(result.data[0]));
          }
          
          return result.data;
          
        } catch (error) {
          const msg = error && error.name === 'AbortError' ? 'í• ì¸ë‚´ì—­ API íƒ€ì„ì•„ì›ƒ(60ì´ˆ ì´ˆê³¼)' : (error && error.message) || error;
          console.error('[í• ì¸ë‚´ì—­] ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', msg);
          throw error;
        }
      }
      
      // ====== í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´ ê´€ë ¨ í•¨ìˆ˜ë“¤ (ë¨¼ì € ì •ì˜) ======
      
      /**
       * ë“œë¦´ë‹¤ìš´ ìƒì„¸ í…Œì´ë¸” ë Œë”ë§
       */
      window.renderDiscountDetailTable = function renderDiscountDetailTable(discountCode, period, selectedChannels, searchText) {
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] renderDiscountDetailTable í˜¸ì¶œ:', { discountCode, period, selectedChannels, searchText });
        
        const container = document.getElementById('discount-detail-table-container');
        if (!container) {
          console.error('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] containerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        
        var src = window.__drilldownData || window.discountDetailData || [];
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ì‚¬ìš© ë°ì´í„° ê°œìˆ˜:', src.length);
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ë°ì´í„° ì†ŒìŠ¤:', window.__drilldownData ? 'drilldownData' : 'discountDetailData');
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] í•„í„° ì¡°ê±´:', { discountCode, period, selectedChannels, searchText });
        
        if (src.length > 0) {
          console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ì²« ë²ˆì§¸ ë°ì´í„° ìƒ˜í”Œ:', src[0]);
        }
        
        // ë°ì´í„° í•„í„°ë§
        let filteredData = src.filter(row => {
          // í• ì¸ì½”ë“œ í•„í„°
          const rowDiscountCode = row['í• ì¸ìœ í˜•ëª…'] || row['CD_NM'] || row['cd_nm'];
          const discountMatch = rowDiscountCode === discountCode;
          
          if (!discountMatch) {
            if (src.indexOf(row) < 3) {
              console.log(`[í• ì¸ë‚´ì—­ í•„í„°] Row ${src.indexOf(row)} í• ì¸ì½”ë“œ ë¶ˆì¼ì¹˜:`, { 
                ì°¾ëŠ”ê°’: discountCode, 
                ì‹¤ì œê°’: rowDiscountCode,
                ì›ë³¸: { í• ì¸ìœ í˜•ëª…: row['í• ì¸ìœ í˜•ëª…'], CD_NM: row['CD_NM'] }
              });
            }
            return false;
          }
          
          // ê¸°ê°„ í•„í„°
          const rowPeriod = row['êµ¬ë¶„'] || row['GUBUN'] || row['gubun'];
          const periodMatch = rowPeriod === period;
          
          if (!periodMatch) {
            if (src.indexOf(row) < 3) {
              console.log(`[í• ì¸ë‚´ì—­ í•„í„°] Row ${src.indexOf(row)} ê¸°ê°„ ë¶ˆì¼ì¹˜:`, { 
                ì°¾ëŠ”ê°’: period, 
                ì‹¤ì œê°’: rowPeriod,
                ì›ë³¸: { êµ¬ë¶„: row['êµ¬ë¶„'], GUBUN: row['GUBUN'] }
              });
            }
            return false;
          }
          
          // ì±„ë„ í•„í„° (ì„ íƒëœ ì±„ë„ì´ ìˆì„ ê²½ìš°ë§Œ)
          if (selectedChannels.length > 0) {
            const rowChannel = row['ì±„ë„ëª…'];
            if (!selectedChannels.includes(rowChannel)) return false;
          }
          
          // ê²€ìƒ‰ í•„í„°
          if (searchText) {
            const searchLower = searchText.toLowerCase();
            const itemName = (row['ì•„ì´í…œëª…'] || '').toLowerCase();
            const productCode = (row['í’ˆë²ˆ'] || '').toLowerCase();
            const productName = (row['í’ˆëª…'] || '').toLowerCase();
            
            if (!itemName.includes(searchLower) && 
                !productCode.includes(searchLower) && 
                !productName.includes(searchLower)) {
              return false;
            }
          }
          
          return true;
        });
        
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] í•„í„°ë§ëœ ë°ì´í„°:', filteredData.length, 'í–‰');
        
        // ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ
        const resultCount = document.createElement('div');
        resultCount.style.cssText = 'padding:12px 16px;background:#f8fafc;border-radius:8px 8px 0 0;border-bottom:2px solid #4f46e5;display:flex;justify-content:space-between;align-items:center;';
        resultCount.innerHTML = `
          <span style="font-size:13px;color:#475569;font-weight:600;">
            <span style="color:#4f46e5;font-weight:700;font-size:16px;">${filteredData.length}</span>ê±´ì˜ ë°ì´í„°
          </span>
          <span style="font-size:11px;color:#64748b;">
            ${window.discountFilterState?.period === 'CY' ? 'ë‹¹ë…„' : 'ì „ë…„'} ë°ì´í„°
            ${window.discountFilterState?.channels?.length > 0 ? ` | ì±„ë„: ${window.discountFilterState.channels.join(', ')}` : ''}
            ${window.discountFilterState?.searchText ? ` | ê²€ìƒ‰: "${window.discountFilterState.searchText}"` : ''}
          </span>
        `;
        
        // í…Œì´ë¸” ìƒì„±
        if (filteredData.length === 0) {
          container.innerHTML = `
            <div style="padding:60px 40px;text-align:center;background:#f8fafc;border-radius:8px;">
              <div style="font-size:48px;margin-bottom:16px;">ğŸ“­</div>
              <div style="color:#64748b;font-size:16px;font-weight:600;margin-bottom:8px;">ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
              <div style="color:#94a3b8;font-size:13px;">ë‹¤ë¥¸ í•„í„° ì¡°ê±´ì„ ì„ íƒí•´ë³´ì„¸ìš”</div>
            </div>
          `;
          return;
        }
        
        const tableWrapper = document.createElement('div');
        tableWrapper.appendChild(resultCount);
        
        const table = document.createElement('table');
        table.style.cssText = 'width:100%;border-collapse:collapse;font-size:12px;';
        
        // í…Œì´ë¸” í—¤ë”
        table.innerHTML = `
          <thead>
            <tr style="background:#4f46e5;border-bottom:2px solid #4338ca;position:sticky;top:0;">
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ë¸Œëœë“œ</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">í• ì¸ìœ í˜•ëª…</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ì±„ë„ì½”ë“œ</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ì±„ë„ëª…</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ì¹´í…Œê³ ë¦¬</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ì•„ì´í…œì½”ë“œ</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">ì•„ì´í…œëª…</th>
              <th style="padding:12px 10px;text-align:center;font-weight:700;color:#fff;font-size:12px;">í’ˆë²ˆ</th>
              <th style="padding:12px 10px;text-align:left;font-weight:700;color:#fff;font-size:12px;">í’ˆëª…</th>
              <th style="padding:12px 10px;text-align:right;font-weight:700;color:#fff;font-size:12px;">TAGë§¤ì¶œ</th>
              <th style="padding:12px 10px;text-align:right;font-weight:700;color:#fff;font-size:12px;">ì‹¤íŒë§¤ì¶œ</th>
              <th style="padding:12px 10px;text-align:right;font-weight:700;color:#fff;font-size:12px;">í• ì¸ìœ¨</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;
        
        const tbody = table.querySelector('tbody');
        
        // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ (ë¡œì»¬)
        const formatNum = (num) => {
          if (!num && num !== 0) return '-';
          return Math.round(num).toLocaleString('ko-KR');
        };
        
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] í…Œì´ë¸” í–‰ ì¶”ê°€ ì‹œì‘:', filteredData.length, 'í–‰');
        
        // í•©ê³„ ê³„ì‚°
        let totalTag = 0;
        let totalSales = 0;
        filteredData.forEach(row => {
          totalTag += parseFloat(row['TAGë§¤ì¶œ']) || 0;
          totalSales += parseFloat(row['ì‹¤íŒë§¤ì¶œ']) || 0;
        });
        const totalDiscountRate = totalTag > 0 ? ((1 - totalSales / totalTag) * 100) : 0;
        
        // í•©ê³„ í–‰ ì¶”ê°€ (ë§¨ ì²« ì¤„)
        const totalRow = document.createElement('tr');
        totalRow.style.cssText = 'background:#f8fafc;font-weight:700;border-bottom:3px solid #4f46e5;position:sticky;top:0;z-index:1;';
        totalRow.innerHTML = `
          <td style="padding:12px 8px;text-align:center;font-weight:700;color:#1f2937;font-size:13px;" colspan="9">í•©ê³„</td>
          <td style="padding:12px 8px;text-align:right;font-weight:700;color:#1f2937;font-size:13px;">${formatNum(totalTag)}</td>
          <td style="padding:12px 8px;text-align:right;font-weight:700;color:#059669;font-size:13px;">${formatNum(totalSales)}</td>
          <td style="padding:12px 8px;text-align:right;font-weight:700;color:#dc2626;font-size:13px;">${totalDiscountRate.toFixed(1)}%</td>
        `;
        tbody.appendChild(totalRow);
        
        // ë°ì´í„° í–‰ ì¶”ê°€
        filteredData.forEach((row, index) => {
          const tag = parseFloat(row['TAGë§¤ì¶œ']) || 0;
          const sales = parseFloat(row['ì‹¤íŒë§¤ì¶œ']) || 0;
          const discountRate = tag > 0 ? ((1 - sales / tag) * 100) : 0;
          
          const tr = document.createElement('tr');
          tr.style.background = index % 2 === 0 ? '#fff' : '#f9fafb';
          tr.style.borderBottom = '1px solid #e5e7eb';
          tr.style.transition = 'background 0.2s';
          tr.onmouseenter = () => { tr.style.background = '#e0e7ff'; };
          tr.onmouseleave = () => { tr.style.background = index % 2 === 0 ? '#fff' : '#f9fafb'; };
          
          tr.innerHTML = `
            <td style="padding:10px 8px;text-align:center;font-weight:600;color:#4f46e5;">${row['ë¸Œëœë“œ'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;font-weight:600;color:#059669;">${row['í• ì¸ìœ í˜•ëª…'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;">${row['ì±„ë„ì½”ë“œ'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;">${row['ì±„ë„ëª…'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;">${row['ì¹´í…Œê³ ë¦¬'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;">${row['ì•„ì´í…œì½”ë“œ'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;">${row['ì•„ì´í…œëª…'] || '-'}</td>
            <td style="padding:10px 8px;text-align:center;font-size:11px;">${row['í’ˆë²ˆ'] || '-'}</td>
            <td style="padding:10px 8px;max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${row['í’ˆëª…']}">${row['í’ˆëª…'] || '-'}</td>
            <td style="padding:10px 8px;text-align:right;font-weight:600;">${formatNum(tag)}</td>
            <td style="padding:10px 8px;text-align:right;font-weight:600;color:#059669;">${formatNum(sales)}</td>
            <td style="padding:10px 8px;text-align:right;font-weight:700;color:#dc2626;font-size:13px;">${discountRate.toFixed(1)}%</td>
          `;
          
          tbody.appendChild(tr);
          
          // ë””ë²„ê¹…: ì²« 3ê°œ í–‰ë§Œ ë¡œê·¸
          if (index < 3) {
            console.log(`[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] Row ${index} ì¶”ê°€:`, { í’ˆëª…: row['í’ˆëª…'], TAGë§¤ì¶œ: tag, ì‹¤íŒë§¤ì¶œ: sales });
          }
        });
        
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] tbody.children.length:', tbody.children.length);
        
        tableWrapper.appendChild(table);
        
        container.innerHTML = '';
        container.appendChild(tableWrapper);
        
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ:', filteredData.length, 'í–‰, container:', container);
      };
      
      /**
       * ë“œë¦´ë‹¤ìš´ í…Œì´ë¸” ì¬ë Œë”ë§
       */
      window.refreshDiscountDetailTable = function refreshDiscountDetailTable() {
        const panel = document.getElementById('discount-drilldown-panel');
        if (!panel) return;
        
        // í˜„ì¬ ë“œë¦´ë‹¤ìš´ì—ì„œ ì—´ë¦° í• ì¸ì½”ë“œ ê°€ì ¸ì˜¤ê¸° (ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
        const discountCode = window.currentDiscountCode;
        
        if (!discountCode) {
          console.warn('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] currentDiscountCodeê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
          return;
        }
        
        const { period, channels, searchText } = window.discountFilterState;
        
        if (typeof window.renderDiscountDetailTable === 'function') {
          window.renderDiscountDetailTable(discountCode, period, channels, searchText);
        }
      };
      
      /**
       * í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
       */
      window.attachDiscountFilterEvents = function attachDiscountFilterEvents() {
        window.discountFilterState = {
          period: 'CY',
          channels: [],
          searchText: ''
        };
        
        // ë‹¹ë…„/ì „ë…„ í† ê¸€
        document.querySelectorAll('.period-toggle-btn').forEach(btn => {
          btn.onclick = () => {
            const period = btn.dataset.period;
            window.discountFilterState.period = period;
            
            document.querySelectorAll('.period-toggle-btn').forEach(b => {
              if (b.dataset.period === period) {
                b.style.background = '#4f46e5';
                b.style.color = '#fff';
                b.style.border = 'none';
                b.style.boxShadow = '0 2px 4px rgba(79, 70, 229, 0.3)';
              } else {
                b.style.background = '#fff';
                b.style.color = '#64748b';
                b.style.border = '1px solid #cbd5e1';
                b.style.boxShadow = 'none';
              }
            });
            
            if (typeof window.refreshDiscountDetailTable === 'function') {
              window.refreshDiscountDetailTable();
            }
          };
        });
        
        // ì±„ë„ í•„í„°
        document.querySelectorAll('.channel-filter-btn').forEach(btn => {
          btn.onclick = () => {
            const channel = btn.dataset.channel;
            const channels = window.discountFilterState.channels;
            
            if (channels.includes(channel)) {
              window.discountFilterState.channels = channels.filter(ch => ch !== channel);
              btn.style.background = '#fff';
              btn.style.color = '#64748b';
              btn.style.borderColor = '#cbd5e1';
              btn.style.boxShadow = 'none';
            } else {
              window.discountFilterState.channels.push(channel);
              btn.style.background = '#4f46e5';
              btn.style.color = '#fff';
              btn.style.borderColor = '#4f46e5';
              btn.style.boxShadow = '0 2px 4px rgba(79, 70, 229, 0.2)';
            }
            
            if (typeof window.refreshDiscountDetailTable === 'function') {
              window.refreshDiscountDetailTable();
            }
          };
        });
        
        // ê²€ìƒ‰
        const searchInput = document.getElementById('discount-detail-search');
        if (searchInput) {
          searchInput.oninput = (e) => {
            window.discountFilterState.searchText = e.target.value.trim();
            clearTimeout(window.discountSearchTimeout);
            window.discountSearchTimeout = setTimeout(() => {
              if (typeof window.refreshDiscountDetailTable === 'function') {
                window.refreshDiscountDetailTable();
              }
            }, 300);
          };
        }
      };
      
      /**
       * ë“œë¦´ë‹¤ìš´ í•„í„° UI ìƒì„±
       */
      window.createDiscountFilterUI = function createDiscountFilterUI() {
        const container = document.createElement('div');
        container.style.cssText = 'display:flex;flex-direction:column;gap:12px;background:#f8fafc;padding:16px;border-radius:8px;border:1px solid #e5e7eb;';
        
        // 1. ë‹¹ë…„/ì „ë…„ í† ê¸€
        const periodToggle = document.createElement('div');
        periodToggle.innerHTML = `
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;min-width:60px;">ğŸ“… ê¸°ê°„:</span>
            <button class="period-toggle-btn" data-period="CY" style="padding:8px 20px;background:#4f46e5;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:13px;font-weight:700;transition:all 0.2s;box-shadow:0 2px 4px rgba(79,70,229,0.3);">ë‹¹ë…„</button>
            <button class="period-toggle-btn" data-period="PY" style="padding:8px 20px;background:#fff;color:#64748b;border:1px solid #cbd5e1;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;">ì „ë…„</button>
          </div>
        `;
        
        // 2. ì±„ë„ í•„í„°
        const channelFilter = document.createElement('div');
        const channels = ['ë°±í™”ì ', 'ë©´ì„¸ì ', 'ì§ì˜ì (ê°€ë‘)', 'ìì‚¬ëª°', 'ì œíœ´ëª°', 'ëŒ€ë¦¬ì ', 'ì•„ìš¸ë ›', 'ì§ì˜ëª°', 'ì§ì˜ì (ê°€ë‘2)'];
        const channelButtons = channels.map(ch => 
          `<button class="channel-filter-btn" data-channel="${ch}" style="padding:7px 14px;background:#fff;color:#64748b;border:1px solid #cbd5e1;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s;">${ch}</button>`
        ).join('');
        
        channelFilter.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:8px;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;">ğŸª ì±„ë„ í•„í„°:</span>
            <div style="display:flex;flex-wrap:wrap;gap:6px;">${channelButtons}</div>
          </div>
        `;
        
        // 3. ê²€ìƒ‰ì°½
        const searchBox = document.createElement('div');
        searchBox.innerHTML = `
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;min-width:60px;">ğŸ” ê²€ìƒ‰:</span>
            <input type="text" id="discount-detail-search" placeholder="ì•„ì´í…œëª…, í’ˆë²ˆ, í’ˆëª… ê²€ìƒ‰..." style="flex:1;padding:10px 14px;border:1px solid #cbd5e1;border-radius:8px;font-size:13px;background:#fff;transition:all 0.2s;" onfocus="this.style.borderColor='#4f46e5';this.style.boxShadow='0 0 0 3px rgba(79,70,229,0.1)';" onblur="this.style.borderColor='#cbd5e1';this.style.boxShadow='none';" />
          </div>
        `;
        
        container.appendChild(periodToggle);
        container.appendChild(channelFilter);
        container.appendChild(searchBox);
        
        setTimeout(() => {
          if (typeof window.attachDiscountFilterEvents === 'function') {
            window.attachDiscountFilterEvents();
          }
        }, 100);
        
        return container;
      };
      
      console.log('[í• ì¸ë‚´ì—­] ë“œë¦´ë‹¤ìš´ í•¨ìˆ˜ë“¤ ì •ì˜ ì™„ë£Œ');
      
      // 2. í• ì¸ë‚´ì—­ ì—…ë°ì´íŠ¸
      async function updateDiscountTable() {
        try {
          // currentBrand í™•ì¸
          if (!currentBrand || typeof currentBrand === 'undefined') {
            console.warn('[í• ì¸ë‚´ì—­] currentBrandê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’ MLB ì‚¬ìš©');
            currentBrand = 'MLB';
          }
          
          const brandCodeMap = {
            'MLB': 'M',
            'MLB_KIDS': 'I',
            'DISCOVERY': 'X',
            'DUVETICA': 'V',
            'SERGIO': 'ST',
            'SUPRA': 'W'
          };
          
          const brandCode = brandCodeMap[currentBrand] || 'M';
          
          console.log('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘:', { currentBrand, brandCode });
          
          // ë§¤ì¶œêµ¬ì„±ê³¼ ë™ì¼í•˜ê²Œ: ì „ì²´ ë¸Œëœë“œê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë¸Œëœë“œ ë°ì´í„° ì‚¬ìš© (ë°°ì—´ì´ê³  ê¸¸ì´ > 0ì¼ ë•Œë§Œ)
          let rawData = null;
          var overview = window.overviewDiscountData && window.overviewDiscountData[brandCode];
          if (overview && Array.isArray(overview.data) && overview.data.length > 0) {
            console.log('[í• ì¸ë‚´ì—­] ì´ë¯¸ ë¡œë“œëœ ë°ì´í„° ì‚¬ìš© (overviewDiscountData)', { brandCode, currentBrand, rows: overview.data.length });
            rawData = overview.data;
          } else {
            console.log('[í• ì¸ë‚´ì—­] APIì—ì„œ ë°ì´í„° ë¡œë“œ:', { brandCode, currentBrand });
            rawData = await loadDiscountData(brandCode);
          }
          
          console.log('[í• ì¸ë‚´ì—­] rawData ë¡œë“œ ì™„ë£Œ:', rawData ? rawData.length : 0, 'í–‰');
          
          if (!rawData || rawData.length === 0) {
            console.warn('[í• ì¸ë‚´ì—­] ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¸Œëœë“œ:', currentBrand, 'ë¸Œëœë“œì½”ë“œ:', brandCode);
            // ë¹ˆ í…Œì´ë¸”ì´ë¼ë„ í‘œì‹œ
            const tbody = document.getElementById('sidebar-discount-tbody');
            if (tbody) {
              tbody.innerHTML = '<tr><td colspan="7" style="padding:20px;text-align:center;color:#64748b;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
            console.log('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ (ë°ì´í„° ì—†ìŒ)');
            return;
          }
          
          // Aì•ˆ: ìºì‹œ êµ¬ì„± (í• ì¸ì½”ë“œë³„ ìƒì„¸ í–‰ â€“ íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼ íŒ¨í„´)
          const byCode = {};
          rawData.forEach(row => {
            // ì—¬ëŸ¬ ì¼€ì´ìŠ¤ í™•ì¸ (í•œê¸€ ì»¬ëŸ¼ëª…, ì˜ë¬¸ ëŒ€ë¬¸ì, ì˜ë¬¸ ì†Œë¬¸ì)
            const code = row['í• ì¸ìœ í˜•ëª…'] || row['CD_NM'] || row['cd_nm'] || 'ê¸°íƒ€';
            if (!byCode[code]) {
              byCode[code] = {
                discountCode: code,
                products: []  // íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼í•˜ê²Œ products ë°°ì—´ ì‚¬ìš©
              };
            }
            byCode[code].products.push(row);
          });
          if (!window.discountCache) window.discountCache = {};
          window.discountCache[currentBrand] = byCode;  // ì¬ê³ ì£¼ìˆ˜ì²˜ëŸ¼ ë‹¨ìˆœ ë§µ êµ¬ì¡°
          
          // ë°ì´í„° ì§‘ê³„ (í• ì¸ì½”ë“œë³„)
          console.log('[í• ì¸ë‚´ì—­] aggregateDiscountData í˜¸ì¶œ ì „');
          const discountData = aggregateDiscountData(rawData);
          console.log('[í• ì¸ë‚´ì—­] aggregateDiscountData í˜¸ì¶œ í›„, ê²°ê³¼:', discountData);
          console.log('[í• ì¸ë‚´ì—­] discountData í‚¤ ê°œìˆ˜:', Object.keys(discountData).length);
          
          // í…Œì´ë¸” ë Œë”ë§ (ë“œë¦´ë‹¤ìš´ì€ ìºì‹œì—ì„œ ì¡°íšŒ)
          console.log('[í• ì¸ë‚´ì—­] renderDiscountTable í˜¸ì¶œ ì‹œì‘');
          renderDiscountTable(discountData, rawData);
          console.log('[í• ì¸ë‚´ì—­] renderDiscountTable í˜¸ì¶œ ì™„ë£Œ');
          
          // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
          try {
            updateDiscountChart(discountData);
          } catch (chartError) {
            console.warn('[í• ì¸ë‚´ì—­] ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (ë¬´ì‹œ):', chartError);
          }
          
          console.log('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ');
          
        } catch (error) {
          console.error('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
        }
      }
      
      // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
      window.updateDiscountTable = updateDiscountTable;
      
      /**
       * í• ì¸ë‚´ì—­ ë°ì´í„° ì§‘ê³„
       * @param {Array} rawData - ì›ë³¸ ë°ì´í„°
       * @returns {Object} ì§‘ê³„ëœ í• ì¸ì½”ë“œë³„ ë°ì´í„°
       */
      function aggregateDiscountData(rawData) {
        const result = {};
        
        console.log('[í• ì¸ë‚´ì—­] ì§‘ê³„ ì‹œì‘ - ì›ë³¸ ë°ì´í„° ê°œìˆ˜:', rawData.length);
        console.log('[í• ì¸ë‚´ì—­] ì²«ë²ˆì§¸ í–‰ ìƒ˜í”Œ:', rawData[0]);
        console.log('[í• ì¸ë‚´ì—­] ì²« 5ê°œ í–‰ì˜ ëª¨ë“  í‚¤:', rawData.slice(0, 5).map(r => Object.keys(r)));
        
        rawData.forEach((row, idx) => {
          // ë””ë²„ê¹…: ì²« 3ê°œ í–‰ì˜ ìƒì„¸ ì •ë³´ ì¶œë ¥
          if (idx < 3) {
            console.log(`[í• ì¸ë‚´ì—­] Row ${idx}:`, row);
          }
          
          // SnowflakeëŠ” í°ë”°ì˜´í‘œ ì—†ìœ¼ë©´ ëŒ€ë¬¸ìë¡œ ë°˜í™˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—¬ëŸ¬ ì¼€ì´ìŠ¤ í™•ì¸
          const discountCode = row['í• ì¸ìœ í˜•ëª…'] || row['CD_NM'] || row['cd_nm'] || 'ê¸°íƒ€';
          const gubun = row['êµ¬ë¶„'] || row['GUBUN'] || row['gubun']; // 'CY' or 'PY'
          const tagSales = parseFloat(row['TAGë§¤ì¶œ'] || row['TAG_SALES'] || row['TAGë§¤ì¶œ_ì›'] || 0) || 0;
          const actualSales = parseFloat(row['ì‹¤íŒë§¤ì¶œ'] || row['ACTUAL_SALES'] || row['ì‹¤íŒë§¤ì¶œ_ì›'] || 0) || 0;
          
          if (!result[discountCode]) {
            result[discountCode] = {
              cy: { tag: 0, sales: 0 },
              py: { tag: 0, sales: 0 }
            };
          }
          
          if (gubun === 'CY') {
            result[discountCode].cy.tag += tagSales;
            result[discountCode].cy.sales += actualSales;
            if (idx < 3) {
              console.log(`[í• ì¸ë‚´ì—­ ì§‘ê³„] Row ${idx}: CY - ${discountCode} ì¶”ê°€, tagSales=${tagSales}, actualSales=${actualSales}`);
            }
          } else if (gubun === 'PY') {
            result[discountCode].py.tag += tagSales;
            result[discountCode].py.sales += actualSales;
            if (idx < 3) {
              console.log(`[í• ì¸ë‚´ì—­ ì§‘ê³„] Row ${idx}: PY - ${discountCode} ì¶”ê°€, tagSales=${tagSales}, actualSales=${actualSales}`);
            }
          } else {
            if (idx < 3) {
              console.warn(`[í• ì¸ë‚´ì—­ ì§‘ê³„] Row ${idx}: gubunì´ 'CY'ë„ 'PY'ë„ ì•„ë‹˜:`, gubun);
            }
          }
        });
        
        console.log('[í• ì¸ë‚´ì—­ ì§‘ê³„] ì§‘ê³„ ì™„ë£Œ ì „ result:', result);
        
        // í• ì¸ìœ¨ ê³„ì‚° ë° ì–µì› ë‹¨ìœ„ ë³€í™˜
        Object.keys(result).forEach(code => {
          const cy = result[code].cy;
          const py = result[code].py;
          
          cy.discountRate = cy.tag > 0 ? ((1 - cy.sales / cy.tag) * 100) : 0;
          py.discountRate = py.tag > 0 ? ((1 - py.sales / py.tag) * 100) : 0;
          
          // ì°¨íŠ¸ìš© ì–µì› ë‹¨ìœ„ ë°ì´í„° ì¶”ê°€
          cy.salesInBillion = cy.sales / 100000000;
          py.salesInBillion = py.sales / 100000000;
        });
        
        console.log('[í• ì¸ë‚´ì—­] ì§‘ê³„ ì™„ë£Œ - í• ì¸ì½”ë“œ ê°œìˆ˜:', Object.keys(result).length);
        console.log('[í• ì¸ë‚´ì—­] ì§‘ê³„ ê²°ê³¼:', result);
        
        return result;
      }
      
      /**
       * í• ì¸ì½”ë“œ ì •ë ¬ í•¨ìˆ˜
       * - 'ì •ìƒ'ì´ ë§¨ ìœ„
       * - ê·¸ ë‹¤ìŒ ìˆ«ì% (10%, 20%, 30%...)
       * - ë‚˜ë¨¸ì§€ëŠ” ê°€ë‚˜ë‹¤ìˆœ
       */
      function sortDiscountCodes(codes) {
        return codes.sort((a, b) => {
          if (a === 'ì •ìƒ') return -1;
          if (b === 'ì •ìƒ') return 1;
          
          const aIsPercent = /^\d+%$/.test(a);
          const bIsPercent = /^\d+%$/.test(b);
          
          if (aIsPercent && bIsPercent) {
            return parseInt(a) - parseInt(b);
          }
          if (aIsPercent) return -1;
          if (bIsPercent) return 1;
          
          return a.localeCompare(b, 'ko');
        });
      }
      
      /**
       * í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´ ì—´ê¸° (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼í•˜ê²Œ ë‹¨ì¼ í•¨ìˆ˜ë¡œ ì§ì ‘ ì²˜ë¦¬)
       */
      function openDiscountDrilldown(code) {
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ì‹œì‘:', { code, currentBrand });
        
        // í˜„ì¬ í• ì¸ì½”ë“œë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (í•„í„° ê°±ì‹  ì‹œ ì‚¬ìš©)
        window.currentDiscountCode = code;
        
        // ìºì‹œì—ì„œ ë°ì´í„° ì¡°íšŒ (íŒë§¤ìœ¨/ì¬ê³ ì£¼ìˆ˜ì™€ ë™ì¼í•œ êµ¬ì¡°)
        var cache = window.discountCache && window.discountCache[currentBrand];
        var discountData = cache && cache[code];
        var data = (discountData && discountData.products) || [];
        if (!data.length) {
          alert('í•´ë‹¹ í• ì¸ë‚´ì—­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ì‚¬ìš© ë°ì´í„° ê°œìˆ˜:', data.length);
        window.__drilldownData = data;  // renderDiscountDetailTableì—ì„œ ì‚¬ìš©
        
        // ê¸°ì¡´ ë“œë¦´ë‹¤ìš´ íŒ¨ë„ì´ ìˆìœ¼ë©´ ì œê±°
        const existingPanel = document.getElementById('discount-drilldown-panel');
        if (existingPanel) {
          existingPanel.remove();
        }
        
        // ì˜¤ë²„ë ˆì´ ìƒì„±
        const overlay = document.createElement('div');
        overlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.6);
          z-index: 10000;
          display: flex;
          align-items: center;
          justify-content: center;
          animation: fadeIn 0.3s ease-out;
        `;
        
        // ë“œë¦´ë‹¤ìš´ íŒ¨ë„ ìƒì„±
        const panel = document.createElement('div');
        panel.id = 'discount-drilldown-panel';
        panel.style.cssText = `
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 16px;
          padding: 24px;
          margin: 20px;
          box-shadow: 0 8px 24px rgba(79, 70, 229, 0.25);
          border: 3px solid #4f46e5;
          animation: slideDown 0.3s ease-out;
          width: 90%;
          max-width: 1200px;
          max-height: 90vh;
          display: flex;
          flex-direction: column;
        `;
        
        // ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ (ì—†ìœ¼ë©´)
        if (!document.getElementById('drilldown-animation-style')) {
          const style = document.createElement('style');
          style.id = 'drilldown-animation-style';
          style.textContent = `
            @keyframes slideDown {
              from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
              }
              to {
                opacity: 1;
                transform: translateY(0) scale(1);
              }
            }
            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            @keyframes fadeOut {
              from { opacity: 1; }
              to { opacity: 0; }
            }
          `;
          document.head.appendChild(style);
        }
        
        // íŒ¨ë„ í—¤ë”
        const header = document.createElement('div');
        header.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding: 16px;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        `;
        header.innerHTML = `
          <h5 style="color:#4f46e5;font-size:18px;font-weight:800;margin:0;display:flex;align-items:center;gap:8px;">
            <span style="font-size:24px;">ğŸ“‹</span>
            <span>${code} ìƒì„¸ë‚´ì—­</span>
          </h5>
          <button id="close-drilldown-btn" style="
            padding: 8px 16px;
            background: #ef4444;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
          " onmouseover="this.style.background='#dc2626';this.style.transform='scale(1.05)';" onmouseout="this.style.background='#ef4444';this.style.transform='scale(1)';">âœ• ë‹«ê¸°</button>
        `;
        panel.appendChild(header);
        
        // ë‹«ê¸° í•¨ìˆ˜
        const closeModal = () => {
          panel.style.animation = 'fadeOut 0.3s ease-out';
          overlay.style.animation = 'fadeOut 0.3s ease-out';
          setTimeout(() => {
            overlay.remove();
          }, 300);
        };
        
        // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        setTimeout(() => {
          const closeBtn = document.getElementById('close-drilldown-btn');
          if (closeBtn) {
            closeBtn.onclick = closeModal;
          }
        }, 100);
        
        // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
        overlay.onclick = (e) => {
          if (e.target === overlay) {
            closeModal();
          }
        };
        
        // ESC í‚¤ë¡œ ë‹«ê¸°
        const handleEscape = (e) => {
          if (e.key === 'Escape') {
            closeModal();
            document.removeEventListener('keydown', handleEscape);
          }
        };
        document.addEventListener('keydown', handleEscape);
        
        // í•„í„° UI ìƒì„±
        const filterWrapper = document.createElement('div');
        filterWrapper.style.cssText = 'background:#fff;border-radius:12px;padding:4px;margin-bottom:16px;';
        
        // createDiscountFilterUIê°€ ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©, ì•„ë‹ˆë©´ ë‚˜ì¤‘ì— ì¶”ê°€
        if (typeof createDiscountFilterUI === 'function') {
          const filterUI = createDiscountFilterUI();
          filterWrapper.appendChild(filterUI);
        } else {
          // ì„ì‹œ ë©”ì‹œì§€
          filterWrapper.innerHTML = '<div style="padding:16px;text-align:center;color:#64748b;">í•„í„° ë¡œë”© ì¤‘...</div>';
          // ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„
          setTimeout(() => {
            if (typeof createDiscountFilterUI === 'function') {
              filterWrapper.innerHTML = '';
              const filterUI = createDiscountFilterUI();
              filterWrapper.appendChild(filterUI);
            }
          }, 100);
        }
        
        panel.appendChild(filterWrapper);
        
        // í…Œì´ë¸” ì»¨í…Œì´ë„ˆ
        const tableContainer = document.createElement('div');
        tableContainer.id = 'discount-detail-table-container';
        tableContainer.style.cssText = `
          flex: 1;
          overflow-y: auto;
          border: 2px solid #4f46e5;
          border-radius: 12px;
          background: #fff;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          min-height: 0;
          max-height: calc(90vh - 250px);
        `;
        panel.appendChild(tableContainer);
        
        // ì˜¤ë²„ë ˆì´ì— íŒ¨ë„ ì¶”ê°€
        overlay.appendChild(panel);
        
        // bodyì— ì˜¤ë²„ë ˆì´ ì¶”ê°€
        document.body.appendChild(overlay);
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ëª¨ë‹¬ ì¶”ê°€ ì™„ë£Œ');
        
        // ì´ˆê¸° ë°ì´í„° ë Œë”ë§
        console.log('[í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´] ì´ˆê¸° ë Œë”ë§ ì‹œì‘:', code);
        window.renderDiscountDetailTable(code, 'CY', [], '');
      }
      window.openDiscountDrilldown = openDiscountDrilldown;
      
      /**
       * í• ì¸ë‚´ì—­ API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
       */
      async function testDiscountAPI() {
        console.log('========== í• ì¸ë‚´ì—­ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ==========');
        const brandCodeMap = {
          'MLB': 'M',
          'MLB_KIDS': 'I',
          'DISCOVERY': 'X',
          'DUVETICA': 'V',
          'SERGIO': 'ST',
          'SUPRA': 'W'
        };
        const brandCode = brandCodeMap[currentBrand] || 'M';
        const dateStr = window.__API_DATE__ || window.__DATA_DATE__ || new Date().toISOString().slice(0, 10).replace(/-/g, '');
        const analysisMonth = `${dateStr.slice(0, 4)}-${dateStr.slice(4, 6)}`;
        const url = `/api/discount-detail?brand=${brandCode}&month=${analysisMonth}`;
        
        console.log('í…ŒìŠ¤íŠ¸ íŒŒë¼ë¯¸í„°:', { currentBrand, brandCode, analysisMonth, url });
        
        try {
          const response = await fetch(url);
          const result = await response.json();
          
          console.log('API ì‘ë‹µ ì „ì²´:', result);
          console.log('API ì„±ê³µ ì—¬ë¶€:', result.success);
          console.log('ë°ì´í„° ê°œìˆ˜:', result.data?.length);
          
          if (result.data && result.data.length > 0) {
            console.log('ì²« ë²ˆì§¸ í–‰:', result.data[0]);
            console.log('ì»¬ëŸ¼ëª… ëª©ë¡:', Object.keys(result.data[0]));
            console.log('ì²« 5ê°œ í–‰:', result.data.slice(0, 5));
          } else {
            console.warn('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
          }
          
          alert(`API í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\në°ì´í„° ê°œìˆ˜: ${result.data?.length || 0}í–‰\nì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.`);
        } catch (error) {
          console.error('API í˜¸ì¶œ ì—ëŸ¬:', error);
          alert('API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message);
        }
        
        console.log('========== í• ì¸ë‚´ì—­ API í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ==========');
      }
      window.testDiscountAPI = testDiscountAPI;
      
      /**
       * í• ì¸ë‚´ì—­ í…Œì´ë¸” ë Œë”ë§
       * @param {Object} discountData - ì§‘ê³„ëœ í• ì¸ì½”ë“œë³„ ë°ì´í„°
       * @param {Array} [rawData] - ì›ë³¸ ë°ì´í„° (ìºì‹œì— ì´ë¯¸ ë„£ì—ˆìœ¼ë©´ ë“œë¦´ë‹¤ìš´ì€ openDiscountDrilldownì—ì„œ ìºì‹œ ì‚¬ìš©)
       */
      function renderDiscountTable(discountData, rawData) {
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] í•¨ìˆ˜ ì§„ì… - discountData:', discountData);
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] discountData íƒ€ì…:', typeof discountData);
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] discountData í‚¤:', Object.keys(discountData));
        
        const tbody = document.getElementById('sidebar-discount-tbody');
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] tbody ìš”ì†Œ:', tbody);
        
        if (!tbody) {
          console.error('[í• ì¸ë‚´ì—­] tbody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        
        console.log('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ë Œë”ë§ ì‹œì‘ - ë°ì´í„°:', discountData);
        
        // ê¸°ì¡´ ë‚´ìš© ì œê±°
        tbody.innerHTML = '';
        
        // í•©ê³„ ê³„ì‚°
        let totalCySales = 0;
        let totalPySales = 0;
        let totalCyTag = 0;
        let totalPyTag = 0;
        
        Object.keys(discountData).forEach(code => {
          totalCySales += discountData[code].cy.sales;
          totalPySales += discountData[code].py.sales;
          totalCyTag += discountData[code].cy.tag;
          totalPyTag += discountData[code].py.tag;
        });
        
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] í•©ê³„ ê³„ì‚°:', { totalCySales, totalPySales, totalCyTag, totalPyTag });
        
        const totalCyDiscountRate = totalCyTag > 0 ? ((1 - totalCySales / totalCyTag) * 100) : 0;
        const totalPyDiscountRate = totalPyTag > 0 ? ((1 - totalPySales / totalPyTag) * 100) : 0;
        const totalYoy = totalPySales > 0 ? ((totalCySales / totalPySales) * 100) : 0;
        const totalDiscountDiff = totalCyDiscountRate - totalPyDiscountRate;
        
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] í•©ê³„ í–‰ ìƒì„±:', { totalCyDiscountRate, totalPyDiscountRate, totalYoy, totalDiscountDiff });
        
        // í•©ê³„ í–‰ ì¶”ê°€
        const totalRow = document.createElement('tr');
        totalRow.style.background = '#f8fafc';
        totalRow.style.fontWeight = '700';
        totalRow.style.borderTop = '2px solid #4f46e5';
        totalRow.style.borderBottom = '2px solid #cbd5e1';
        
        totalRow.innerHTML = `
          <td style="padding:10px 6px;text-align:left;font-size:12px;color:#1f2937;border-right:1px solid #e5e7eb;">í•©ê³„</td>
          <td style="padding:10px 6px;text-align:right;font-size:12px;color:#1f2937;">${(totalCySales / 1000000).toLocaleString('ko-KR', {maximumFractionDigits: 0})}</td>
          <td style="padding:10px 6px;text-align:center;font-size:12px;color:#1f2937;border-right:1px solid #e5e7eb;">${totalCyDiscountRate.toFixed(1)}%</td>
          <td style="padding:10px 6px;text-align:right;font-size:12px;color:#1f2937;">${(totalPySales / 1000000).toLocaleString('ko-KR', {maximumFractionDigits: 0})}</td>
          <td style="padding:10px 6px;text-align:center;font-size:12px;color:#1f2937;border-right:1px solid #e5e7eb;">${totalPyDiscountRate.toFixed(1)}%</td>
          <td style="padding:10px 6px;text-align:center;font-size:12px;color:#1f2937;border-right:1px solid #e5e7eb;">${totalYoy.toFixed(0)}%</td>
          <td style="padding:10px 6px;text-align:center;font-size:12px;color:${totalDiscountDiff >= 0 ? '#dc2626' : '#059669'};font-weight:600;">${totalDiscountDiff >= 0 ? '+' : ''}${totalDiscountDiff.toFixed(1)}%p</td>
        `;
        
        tbody.appendChild(totalRow);
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] í•©ê³„ í–‰ ì¶”ê°€ ì™„ë£Œ');
        
        // í• ì¸ì½”ë“œ ì •ë ¬
        const sortedCodes = sortDiscountCodes(Object.keys(discountData));
        console.log('[í• ì¸ë‚´ì—­ ë Œë”ë§] ì •ë ¬ëœ í• ì¸ì½”ë“œ:', sortedCodes);
        
        // ê° í• ì¸ì½”ë“œë³„ í–‰ ì¶”ê°€ (í• ì¸ì½”ë“œ, ë‹¹ë…„ ì‹¤íŒë§¤ì¶œ/í• ì¸ìœ¨, ì „ë…„ ì‹¤íŒë§¤ì¶œ/í• ì¸ìœ¨, YOY, í• ì¸ìœ¨ì°¨ì´)
        sortedCodes.forEach((code, index) => {
          const data = discountData[code];
          
          if (index < 3) {
            console.log(`[í• ì¸ë‚´ì—­ ë Œë”ë§] í–‰ ${index} - ì½”ë“œ: ${code}, ë°ì´í„°:`, data);
          }
          
          const cySales = data.cy.sales;
          const pySales = data.py.sales;
          const cyDiscountRate = data.cy.discountRate;
          const pyDiscountRate = data.py.discountRate;
          const yoy = pySales > 0 ? ((cySales / pySales) * 100) : 0;
          const discountDiff = cyDiscountRate - pyDiscountRate;
          
          const cySalesText = cySales > 0 ? (cySales / 1000000).toLocaleString('ko-KR', { maximumFractionDigits: 0 }) : '';
          const pySalesText = pySales > 0 ? (pySales / 1000000).toLocaleString('ko-KR', { maximumFractionDigits: 0 }) : '';
          const cyRateText = cySales > 0 ? cyDiscountRate.toFixed(1) + '%' : '';
          const pyRateText = pySales > 0 ? pyDiscountRate.toFixed(1) + '%' : '';
          const yoyText = pySales > 0 && cySales > 0 ? yoy.toFixed(0) + '%' : '';
          const diffText = (cySales > 0 || pySales > 0) ? (discountDiff >= 0 ? '+' : '') + discountDiff.toFixed(1) + '%p' : '';
          const diffColor = discountDiff >= 0 ? '#dc2626' : '#059669';
          
          const row = document.createElement('tr');
          row.style.background = index % 2 === 0 ? '#fff' : '#f9fafb';
          row.style.cursor = 'pointer';
          row.style.transition = 'all 0.2s';
          
          row.innerHTML = `
            <td style="padding:9px 6px;text-align:left;font-size:12px;color:#475569;border-right:1px solid #e5e7eb;">
              <span style="font-weight:600;">${code}</span>
            </td>
            <td style="padding:9px 6px;text-align:right;font-size:12px;color:#475569;">${cySalesText}</td>
            <td style="padding:9px 6px;text-align:center;font-size:12px;color:#475569;border-right:1px solid #e5e7eb;">${cyRateText}</td>
            <td style="padding:9px 6px;text-align:right;font-size:12px;color:#475569;">${pySalesText}</td>
            <td style="padding:9px 6px;text-align:center;font-size:12px;color:#475569;border-right:1px solid #e5e7eb;">${pyRateText}</td>
            <td style="padding:9px 6px;text-align:center;font-size:12px;color:#475569;border-right:1px solid #e5e7eb;">${yoyText}</td>
            <td style="padding:9px 6px;text-align:center;font-size:12px;color:${diffColor};font-weight:600;">${diffText}</td>
          `;
          
          // innerHTML ì„¤ì • í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          row.onmouseenter = () => { 
            row.style.background = '#e0e7ff'; 
            row.style.transform = 'scale(1.01)';
            row.style.boxShadow = '0 2px 8px rgba(79, 70, 229, 0.15)';
          };
          row.onmouseleave = () => { 
            row.style.background = index % 2 === 0 ? '#fff' : '#f9fafb'; 
            row.style.transform = 'scale(1)';
            row.style.boxShadow = 'none';
          };
          row.onclick = () => {
            console.log('[í• ì¸ë‚´ì—­] í–‰ í´ë¦­:', code, currentBrand);
            row.style.background = '#c7d2fe';
            var c = code;
            setTimeout(function () {
              var fn = window.openDiscountDrilldown || openDiscountDrilldown;
              if (fn) fn(c); else alert('í• ì¸ë‚´ì—­ ìƒì„¸ ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
            }, 150);
          };
          
          tbody.appendChild(row);
          
          if (index < 3) {
            console.log(`[í• ì¸ë‚´ì—­ ë Œë”ë§] í–‰ ${index} - tbodyì— ì¶”ê°€ ì™„ë£Œ`);
          }
        });
        
        console.log('[í• ì¸ë‚´ì—­] í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ:', sortedCodes.length, 'ê°œ ì½”ë“œ');
        console.log('[í• ì¸ë‚´ì—­] tbody.children.length:', tbody.children.length);
      }
      
      // ====== í• ì¸ë‚´ì—­ ì˜›ë‚  ì½”ë“œ (ì‚¬ìš© ì•ˆí•¨) ======
      function updateDiscountTable_OLD() {
        console.log('[ì‚¬ì´ë“œë°”] í• ì¸ë‚´ì—­ ì—…ë°ì´íŠ¸ (êµ¬ë²„ì „ - ì‚¬ìš©ì•ˆí•¨)');
        return;
        
        /* ì˜›ë‚  ì½”ë“œ (ì‚¬ìš© ì•ˆí•¨)
        // ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´ í•„ìš”)
        const discountData = {
          total: { cy: 45.3, py: 38.7, yoy: 17.1 },
          '10%': { cy: 12.5, py: 10.3, yoy: 21.4 },
          '20%': { cy: 18.8, py: 16.2, yoy: 16.0 },
          '30%': { cy: 14.0, py: 12.2, yoy: 14.8 }
        };
        
        // í•©ê³„
        document.getElementById('discount-total-cy').textContent = `${discountData.total.cy.toFixed(1)}ì–µ`;
        document.getElementById('discount-total-py').textContent = `${discountData.total.py.toFixed(1)}ì–µ`;
        document.getElementById('discount-total-yoy').innerHTML = `
          <span style="color:${discountData.total.yoy >= 0 ? '#059669' : '#dc2626'};font-weight:600;">
            ${discountData.total.yoy >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(discountData.total.yoy).toFixed(1)}%
          </span>
        `;
        
        // 10%
        document.getElementById('discount-10-cy').textContent = `${discountData['10%'].cy.toFixed(1)}ì–µ`;
        document.getElementById('discount-10-py').textContent = `${discountData['10%'].py.toFixed(1)}ì–µ`;
        document.getElementById('discount-10-yoy').innerHTML = `
          <span style="color:${discountData['10%'].yoy >= 0 ? '#059669' : '#dc2626'};font-weight:600;">
            ${discountData['10%'].yoy >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(discountData['10%'].yoy).toFixed(1)}%
          </span>
        `;
        
        // 20%
        document.getElementById('discount-20-cy').textContent = `${discountData['20%'].cy.toFixed(1)}ì–µ`;
        document.getElementById('discount-20-py').textContent = `${discountData['20%'].py.toFixed(1)}ì–µ`;
        document.getElementById('discount-20-yoy').innerHTML = `
          <span style="color:${discountData['20%'].yoy >= 0 ? '#059669' : '#dc2626'};font-weight:600;">
            ${discountData['20%'].yoy >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(discountData['20%'].yoy).toFixed(1)}%
          </span>
        `;
        
        // 30%
        document.getElementById('discount-30-cy').textContent = `${discountData['30%'].cy.toFixed(1)}ì–µ`;
        document.getElementById('discount-30-py').textContent = `${discountData['30%'].py.toFixed(1)}ì–µ`;
        document.getElementById('discount-30-yoy').innerHTML = `
          <span style="color:${discountData['30%'].yoy >= 0 ? '#059669' : '#dc2626'};font-weight:600;">
            ${discountData['30%'].yoy >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(discountData['30%'].yoy).toFixed(1)}%
          </span>
        `;
        
        // í• ì¸ìœ¨ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        updateDiscountChart(discountData);
      }
      
      // ====== í• ì¸ë‚´ì—­ ë“œë¦´ë‹¤ìš´ ê¸°ëŠ¥ ======
      // (openDiscountDrilldownì—ì„œ ì§ì ‘ ì²˜ë¦¬í•˜ë¯€ë¡œ ë³„ë„ applyDiscountDrilldown í•¨ìˆ˜ ì—†ìŒ)
      
      // í• ì¸ë‚´ì—­ í…Œì´ë¸”ì€ Promise.all(ì „ì²´í˜„í™© API ë¡œë“œ) ì™„ë£Œ í›„ í•œ ë²ˆë§Œ ê°±ì‹ í•¨ (ì¤‘ë³µ í˜¸ì¶œ ì œê±°)
      // â†’ updateDiscountTableì€ 2779 ê·¼ì²˜ Promise.all().then() / .catch() ì—ì„œë§Œ í˜¸ì¶œ
      
      /**
       * ë“œë¦´ë‹¤ìš´ í•„í„° UI ìƒì„±
       */
      window.createDiscountFilterUI = function createDiscountFilterUI() {
        const container = document.createElement('div');
        container.style.cssText = 'display:flex;flex-direction:column;gap:12px;background:#f8fafc;padding:16px;border-radius:8px;border:1px solid #e5e7eb;';
        
        // 1. ë‹¹ë…„/ì „ë…„ í† ê¸€
        const periodToggle = document.createElement('div');
        periodToggle.innerHTML = `
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;min-width:60px;">ğŸ“… ê¸°ê°„:</span>
            <button class="period-toggle-btn" data-period="CY" style="
              padding: 8px 20px;
              background: #4f46e5;
              color: #fff;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 13px;
              font-weight: 700;
              transition: all 0.2s;
              box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
            ">ë‹¹ë…„</button>
            <button class="period-toggle-btn" data-period="PY" style="
              padding: 8px 20px;
              background: #fff;
              color: #64748b;
              border: 1px solid #cbd5e1;
              border-radius: 8px;
              cursor: pointer;
              font-size: 13px;
              font-weight: 600;
              transition: all 0.2s;
            ">ì „ë…„</button>
          </div>
        `;
        
        // 2. ì±„ë„ í•„í„°
        const channelFilter = document.createElement('div');
        const channels = ['ë°±í™”ì ', 'ë©´ì„¸ì ', 'ì§ì˜ì (ê°€ë‘)', 'ìì‚¬ëª°', 'ì œíœ´ëª°', 'ëŒ€ë¦¬ì ', 'ì•„ìš¸ë ›', 'ì§ì˜ëª°', 'ì§ì˜ì (ê°€ë‘2)'];
        const channelButtons = channels.map(ch => 
          `<button class="channel-filter-btn" data-channel="${ch}" style="
            padding: 7px 14px;
            background: #fff;
            color: #64748b;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
          ">${ch}</button>`
        ).join('');
        
        channelFilter.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:8px;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;">ğŸª ì±„ë„ í•„í„°:</span>
            <div style="display:flex;flex-wrap:wrap;gap:6px;">
              ${channelButtons}
            </div>
          </div>
        `;
        
        // 3. ê²€ìƒ‰ì°½
        const searchBox = document.createElement('div');
        searchBox.innerHTML = `
          <div style="display:flex;gap:8px;align-items:center;">
            <span style="font-size:13px;color:#1f2937;font-weight:700;min-width:60px;">ğŸ” ê²€ìƒ‰:</span>
            <input 
              type="text" 
              id="discount-detail-search" 
              placeholder="ì•„ì´í…œëª…, í’ˆë²ˆ, í’ˆëª… ê²€ìƒ‰..."
              style="
                flex: 1;
                padding: 10px 14px;
                border: 1px solid #cbd5e1;
                border-radius: 8px;
                font-size: 13px;
                background: #fff;
                transition: all 0.2s;
              "
              onfocus="this.style.borderColor='#4f46e5';this.style.boxShadow='0 0 0 3px rgba(79,70,229,0.1)';"
              onblur="this.style.borderColor='#cbd5e1';this.style.boxShadow='none';"
            />
          </div>
        `;
        
        container.appendChild(periodToggle);
        container.appendChild(channelFilter);
        container.appendChild(searchBox);
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ë”œë ˆì´ í›„)
        setTimeout(() => {
          if (typeof window.attachDiscountFilterEvents === 'function') {
            window.attachDiscountFilterEvents();
          }
        }, 100);
        
        return container;
      }
      
      /**
       * í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
       */
      window.attachDiscountFilterEvents = function attachDiscountFilterEvents() {
        // í˜„ì¬ ì„ íƒëœ í•„í„° ìƒíƒœ
        window.discountFilterState = {
          period: 'CY',
          channels: [],
          searchText: ''
        };
        
        // ë‹¹ë…„/ì „ë…„ í† ê¸€
        document.querySelectorAll('.period-toggle-btn').forEach(btn => {
          btn.onclick = () => {
            const period = btn.dataset.period;
            window.discountFilterState.period = period;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.period-toggle-btn').forEach(b => {
              if (b.dataset.period === period) {
                b.style.background = '#4f46e5';
                b.style.color = '#fff';
                b.style.border = 'none';
                b.style.boxShadow = '0 2px 4px rgba(79, 70, 229, 0.3)';
              } else {
                b.style.background = '#fff';
                b.style.color = '#64748b';
                b.style.border = '1px solid #cbd5e1';
                b.style.boxShadow = 'none';
              }
            });
            
            // í…Œì´ë¸” ì¬ë Œë”ë§
            if (typeof window.refreshDiscountDetailTable === 'function') {
              window.refreshDiscountDetailTable();
            }
          };
        });
        
        // ì±„ë„ í•„í„°
        document.querySelectorAll('.channel-filter-btn').forEach(btn => {
          btn.onclick = () => {
            const channel = btn.dataset.channel;
            const channels = window.discountFilterState.channels;
            
            if (channels.includes(channel)) {
              // ì„ íƒ í•´ì œ
              window.discountFilterState.channels = channels.filter(ch => ch !== channel);
              btn.style.background = '#fff';
              btn.style.color = '#64748b';
              btn.style.borderColor = '#cbd5e1';
              btn.style.boxShadow = 'none';
            } else {
              // ì„ íƒ
              window.discountFilterState.channels.push(channel);
              btn.style.background = '#4f46e5';
              btn.style.color = '#fff';
              btn.style.borderColor = '#4f46e5';
              btn.style.boxShadow = '0 2px 4px rgba(79, 70, 229, 0.2)';
            }
            
            // í…Œì´ë¸” ì¬ë Œë”ë§
            if (typeof window.refreshDiscountDetailTable === 'function') {
              window.refreshDiscountDetailTable();
            }
          };
        });
        
        // ê²€ìƒ‰
        const searchInput = document.getElementById('discount-detail-search');
        if (searchInput) {
          searchInput.oninput = (e) => {
            window.discountFilterState.searchText = e.target.value.trim();
            // ë””ë°”ìš´ìŠ¤ (300ms)
            clearTimeout(window.discountSearchTimeout);
            window.discountSearchTimeout = setTimeout(() => {
              refreshDiscountDetailTable();
            }, 300);
          };
        }
      }
      
      /**
       * ë“œë¦´ë‹¤ìš´ í…Œì´ë¸” ì¬ë Œë”ë§
       */
      
      // 3. í”„ë¡œëª¨ì…˜ ë‚´ìš© ì—…ë°ì´íŠ¸ (ì „ì—­ìœ¼ë¡œ ì´ë™ë¨)
      // window.updatePromotionContentëŠ” DOMContentLoaded ë¸”ë¡ ë°–ì— ì •ì˜ë˜ì–´ ìˆìŒ
      
      // ========== ë: ì•„ì´í…œë³„ íŠ¸ë¦¬ë§µ ì‚¬ì´ë“œë°” ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (Snowflake APIë¡œ ëŒ€ì²´) ==========
    }
    
    // ========== í”„ë¡œëª¨ì…˜ ê´€ë ¨ í•¨ìˆ˜ (ì „ì—­) ==========
    // â€» DOMContentLoaded ì™¸ë¶€ì—ì„œ ì •ì˜í•˜ì—¬ ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•¨
    
    // ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (YYYY-MM-DD â†’ YYYY.MM.DD)
    function formatPromotionDate(dateStr) {
      if (!dateStr || dateStr === 'unknown') return '-';
      try {
        // Date ê°ì²´ì¸ ê²½ìš°
        if (dateStr instanceof Date) {
          const year = dateStr.getFullYear();
          const month = String(dateStr.getMonth() + 1).padStart(2, '0');
          const day = String(dateStr.getDate()).padStart(2, '0');
          return `${year}.${month}.${day}`;
        }
        // ë¬¸ìì—´ì¸ ê²½ìš°
        const str = String(dateStr);
        if (str.includes('-')) {
          return str.replace(/-/g, '.');
        }
        return str;
      } catch (e) {
        return dateStr;
      }
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      if (!text) return '';
      return String(text)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
    
    // ìˆ«ì í¬ë§· í•¨ìˆ˜ (ì²œë‹¨ìœ„ ì½¤ë§ˆ)
    function formatNumber(num) {
      if (!num && num !== 0) return '-';
      return Number(num).toLocaleString('ko-KR');
    }
    
    /**
     * í”„ë¡œëª¨ì…˜ ë‚´ìš© ì—…ë°ì´íŠ¸ (ë¹„ë™ê¸°)
     */
    async function updatePromotionContent() {
      console.log('[í”„ë¡œëª¨ì…˜] ========== updatePromotionContent í˜¸ì¶œë¨ ==========');
      console.log('[í”„ë¡œëª¨ì…˜] window.promotionData:', window.promotionData);
      console.log('[í”„ë¡œëª¨ì…˜] currentBrand (í´ë¡œì €):', currentBrand);
      
      const promotionContent = document.getElementById('sidebar-promotion-content');
      if (!promotionContent) {
        console.error('[í”„ë¡œëª¨ì…˜] sidebar-promotion-content ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // í˜„ì¬ ì„ íƒëœ ë¸Œëœë“œ í™•ì¸ (í´ë¡œì €ë¥¼ í†µí•´ currentBrand ì ‘ê·¼)
      const selectedBrand = currentBrand || 'MLB';
      const brandCodeMap = {
        'MLB': 'M',
        'MLB_KIDS': 'I',
        'DISCOVERY': 'X',
        'DUVETICA': 'V',
        'SERGIO': 'ST',
        'SUPRA': 'W'
      };
      const brandCode = brandCodeMap[selectedBrand];
      
      if (!brandCode) {
        console.warn('[í”„ë¡œëª¨ì…˜] ë¸Œëœë“œ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', selectedBrand);
        promotionContent.innerHTML = `
          <div style="color:#64748b;font-size:13px;line-height:1.7;">
            <p style="margin-bottom:10px;">ğŸ“Œ ë¸Œëœë“œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
        return;
      }
      
      console.log('[í”„ë¡œëª¨ì…˜] ì»¨í…ì¸  ì—…ë°ì´íŠ¸:', selectedBrand, brandCode);
      
      // window.promotionDataì—ì„œ í•´ë‹¹ ë¸Œëœë“œ ë°ì´í„° ì¡°íšŒ
      let brandData = window.promotionData && window.promotionData[brandCode];
      
      console.log('[í”„ë¡œëª¨ì…˜] brandData (ìºì‹œ):', brandData);
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ APIì—ì„œ ë¡œë“œ
      if (!brandData || !brandData.data) {
        console.log('[í”„ë¡œëª¨ì…˜] ìºì‹œì— ë°ì´í„° ì—†ìŒ, APIì—ì„œ ë¡œë“œ:', brandCode);
        promotionContent.innerHTML = `
          <div style="color:#64748b;font-size:13px;line-height:1.7;">
            <p style="margin-bottom:10px;">â³ í”„ë¡œëª¨ì…˜ ë°ì´í„° ë¡œë”© ì¤‘...</p>
          </div>
        `;
        
        try {
          const response = await fetch(`/api/promotion?brand=${brandCode}`);
          const result = await response.json();
          
          if (result.success && result.data) {
            console.log('[í”„ë¡œëª¨ì…˜] API ë¡œë“œ ì„±ê³µ:', brandCode, result.data.length, 'ê°œ');
            // ìºì‹œì— ì €ì¥
            if (!window.promotionData) window.promotionData = {};
            window.promotionData[brandCode] = result;
            brandData = result;
          } else {
            console.warn('[í”„ë¡œëª¨ì…˜] API ì‘ë‹µ ì‹¤íŒ¨:', result);
            promotionContent.innerHTML = `
              <div style="color:#64748b;font-size:13px;line-height:1.7;">
                <p style="margin-bottom:10px;">âŒ í”„ë¡œëª¨ì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</p>
              </div>
            `;
            return;
          }
        } catch (error) {
          console.error('[í”„ë¡œëª¨ì…˜] API í˜¸ì¶œ ì—ëŸ¬:', error);
          promotionContent.innerHTML = `
            <div style="color:#64748b;font-size:13px;line-height:1.7;">
              <p style="margin-bottom:10px;">âŒ í”„ë¡œëª¨ì…˜ ë°ì´í„° ë¡œë“œ ì—ëŸ¬</p>
            </div>
          `;
          return;
        }
      }
      
      // ë°ì´í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´
      if (!brandData.data || brandData.data.length === 0) {
        promotionContent.innerHTML = `
          <div style="color:#64748b;font-size:13px;line-height:1.7;">
            <p style="margin-bottom:10px;">ğŸ“Œ ì§„í–‰ ì¤‘ì¸ í”„ë¡œëª¨ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
        console.log('[í”„ë¡œëª¨ì…˜] ë°ì´í„° ì—†ìŒ:', brandCode, brandData);
        return;
      }
      
      // ì‹œì‘ì¼ìë³„ë¡œ ê·¸ë£¹í™” (ê°™ì€ ë‚ ì§œì˜ í”„ë¡œëª¨ì…˜ì„ í•˜ë‚˜ë¡œ ë¬¶ìŒ)
      const groupedByDate = {};
      brandData.data.forEach(row => {
        const dateKey = row['ì‹œì‘ì¼ì'] || 'unknown';
        if (!groupedByDate[dateKey]) {
          groupedByDate[dateKey] = {
            startDate: dateKey,
            reason: row['ì‚¬ìœ '] || '-',
            discountRate: row['í• ì¸ìœ¨'] || '-',
            items: []
          };
        }
        groupedByDate[dateKey].items.push(row);
      });
      
      // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
      const sortedPromotions = Object.values(groupedByDate).sort((a, b) => {
        return new Date(b.startDate) - new Date(a.startDate);
      });
      
      console.log('[í”„ë¡œëª¨ì…˜] ê·¸ë£¹í™”ëœ í”„ë¡œëª¨ì…˜ ê°œìˆ˜:', sortedPromotions.length);
      
      // ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë Œë”ë§
      let html = '<div style="display:flex;flex-direction:column;gap:10px;">';
      sortedPromotions.forEach((promo, index) => {
        const formattedDate = formatPromotionDate(promo.startDate);
        const itemCount = promo.items.length;
        
        html += `
          <div class="promotion-item" 
               style="background:#fff;border:1px solid #e5e7eb;border-radius:6px;padding:12px;cursor:pointer;transition:all 0.2s ease;"
               onmouseover="this.style.borderColor='#4f46e5';this.style.boxShadow='0 2px 8px rgba(79,70,229,0.15)';"
               onmouseout="this.style.borderColor='#e5e7eb';this.style.boxShadow='none';"
               onclick="showPromotionDetail('${brandCode}', '${promo.startDate}', '${escapeHtml(promo.reason)}', '${escapeHtml(promo.discountRate)}')">
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
              <div style="font-weight:700;color:#1f2937;font-size:15px;">
                ğŸ“ ${escapeHtml(promo.reason)}
              </div>
              <div style="background:#f3f4f6;padding:2px 8px;border-radius:4px;font-size:11px;color:#6b7280;">
                ${itemCount}ê°œ ìƒí’ˆ
              </div>
            </div>
            <div style="color:#64748b;font-size:12px;margin-bottom:4px;">
              ğŸ“… ì‹œì‘ì¼ì: ${formattedDate}
            </div>
            <div style="color:#059669;font-size:12px;font-weight:600;">
              ğŸ’° í• ì¸ìœ¨: ${escapeHtml(promo.discountRate)}
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      promotionContent.innerHTML = html;
      console.log('[í”„ë¡œëª¨ì…˜] ë Œë”ë§ ì™„ë£Œ:', sortedPromotions.length, 'ê°œ í”„ë¡œëª¨ì…˜');
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ (ë‹¤ë¥¸ ìŠ¤ì½”í”„ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
    window.updatePromotionContent = updatePromotionContent;
    
    /**
     * í”„ë¡œëª¨ì…˜ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
     */
    window.showPromotionDetail = function(brandCode, startDate, reason, discountRate) {
      console.log('[í”„ë¡œëª¨ì…˜ ëª¨ë‹¬] ì—´ê¸°:', { brandCode, startDate, reason, discountRate });
      
      const modal = document.getElementById('promotion-detail-modal');
      const modalTitle = document.getElementById('promotion-modal-title');
      const modalBody = document.getElementById('promotion-modal-body');
      
      if (!modal || !modalTitle || !modalBody) {
        console.error('[í”„ë¡œëª¨ì…˜ ëª¨ë‹¬] ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ëª¨ë‹¬ íƒ€ì´í‹€ ì„¤ì •
      const formattedDate = formatPromotionDate(startDate);
      modalTitle.textContent = `í”„ë¡œëª¨ì…˜ ìƒì„¸ ì •ë³´ - ${formattedDate}`;
      
      // í•´ë‹¹ ë¸Œëœë“œì˜ í”„ë¡œëª¨ì…˜ ë°ì´í„° í•„í„°ë§
      const brandData = window.promotionData && window.promotionData[brandCode];
      if (!brandData || !brandData.data) {
        modalBody.innerHTML = '<p style="color:#64748b;text-align:center;padding:40px;">ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        modal.style.display = 'flex';
        return;
      }
      
      // í•´ë‹¹ ë‚ ì§œì˜ í”„ë¡œëª¨ì…˜ í•­ëª© í•„í„°ë§
      const filteredData = brandData.data.filter(row => {
        return String(row['ì‹œì‘ì¼ì']) === String(startDate);
      });
      
      if (filteredData.length === 0) {
        modalBody.innerHTML = '<p style="color:#64748b;text-align:center;padding:40px;">í”„ë¡œëª¨ì…˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        modal.style.display = 'flex';
        return;
      }
      
      console.log('[í”„ë¡œëª¨ì…˜ ëª¨ë‹¬] í•„í„°ë§ëœ ë°ì´í„°:', filteredData.length, 'ê°œ');
      
      // ê³ ìœ  ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
      const categories = [...new Set(filteredData.map(row => row['ì¹´í…Œê³ ë¦¬'] || '-'))].sort();
      
      // ìš”ì•½ ì •ë³´
      let html = `
        <div style="background:#f8fafc;border-radius:8px;padding:16px;margin-bottom:20px;border:1px solid #e5e7eb;">
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
            <div>
              <div style="color:#64748b;font-size:12px;margin-bottom:4px;">ì‹œì‘ì¼ì</div>
              <div style="color:#1f2937;font-size:14px;font-weight:600;">${formattedDate}</div>
            </div>
            <div>
              <div style="color:#64748b;font-size:12px;margin-bottom:4px;">ì‚¬ìœ </div>
              <div style="color:#1f2937;font-size:14px;font-weight:600;">${escapeHtml(reason)}</div>
            </div>
            <div>
              <div style="color:#64748b;font-size:12px;margin-bottom:4px;">í• ì¸ìœ¨</div>
              <div style="color:#059669;font-size:14px;font-weight:600;">${escapeHtml(discountRate)}</div>
            </div>
          </div>
        </div>
        
        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <div style="background:#f8fafc;border-radius:8px;padding:16px;margin-bottom:20px;border:1px solid #e5e7eb;">
          <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
          <div style="margin-bottom:12px;">
            <div style="color:#1f2937;font-size:13px;font-weight:700;margin-bottom:8px;">ğŸ“‚ ì¹´í…Œê³ ë¦¬ í•„í„°</div>
            <div style="display:flex;flex-wrap:wrap;gap:6px;">
              <button class="promotion-category-filter-btn" data-category="all" 
                style="padding:6px 12px;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s;">
                ì „ì²´
              </button>
              ${categories.map(cat => `
                <button class="promotion-category-filter-btn" data-category="${escapeHtml(cat)}" 
                  style="padding:6px 12px;background:#fff;color:#64748b;border:1px solid #cbd5e1;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s;">
                  ${escapeHtml(cat)}
                </button>
              `).join('')}
            </div>
          </div>
          
          <!-- ê²€ìƒ‰ -->
          <div>
            <div style="color:#1f2937;font-size:13px;font-weight:700;margin-bottom:8px;">ğŸ” ê²€ìƒ‰</div>
            <input 
              type="text" 
              id="promotion-detail-search" 
              placeholder="ì•„ì´í…œëª…, í’ˆë²ˆ, í’ˆëª… ê²€ìƒ‰..."
              style="width:100%;padding:10px 14px;border:1px solid #cbd5e1;border-radius:8px;font-size:13px;background:#fff;transition:all 0.2s;"
              onfocus="this.style.borderColor='#4f46e5';this.style.boxShadow='0 0 0 3px rgba(79,70,229,0.1)';"
              onblur="this.style.borderColor='#cbd5e1';this.style.boxShadow='none';"
            />
          </div>
        </div>
      `;
      
      // ìƒì„¸ í…Œì´ë¸”
      html += `
        <div style="overflow-x:auto;">
          <table id="promotion-detail-table" style="width:100%;border-collapse:collapse;font-size:13px;">
            <thead>
              <tr style="background:#f8fafc;border-bottom:2px solid #e5e7eb;">
                <th style="padding:12px 8px;text-align:left;font-weight:600;color:#1f2937;">ì¹´í…Œê³ ë¦¬</th>
                <th style="padding:12px 8px;text-align:left;font-weight:600;color:#1f2937;">ì•„ì´í…œì½”ë“œ</th>
                <th style="padding:12px 8px;text-align:left;font-weight:600;color:#1f2937;">ì•„ì´í…œëª…</th>
                <th style="padding:12px 8px;text-align:left;font-weight:600;color:#1f2937;">í’ˆë²ˆ</th>
                <th style="padding:12px 8px;text-align:left;font-weight:600;color:#1f2937;">í’ˆëª…</th>
                <th style="padding:12px 8px;text-align:right;font-weight:600;color:#1f2937;">TAGê°€</th>
                <th style="padding:12px 8px;text-align:right;font-weight:600;color:#1f2937;">í• ì¸ê°€</th>
              </tr>
            </thead>
            <tbody id="promotion-detail-tbody">
      `;
      
      filteredData.forEach((row, index) => {
        const bgColor = index % 2 === 0 ? '#fff' : '#f9fafb';
        const category = escapeHtml(row['ì¹´í…Œê³ ë¦¬'] || '-');
        const itemCode = escapeHtml(row['ì•„ì´í…œì½”ë“œ'] || '-');
        const itemName = escapeHtml(row['ì•„ì´í…œëª…'] || '-');
        const productCode = escapeHtml(row['í’ˆë²ˆ'] || '-');
        const productName = escapeHtml(row['í’ˆëª…'] || '-');
        const tagPrice = formatNumber(row['TAGê°€'] || 0);
        const salePrice = formatNumber(row['í• ì¸ê°€'] || 0);
        
        html += `
          <tr data-category="${category}" data-item-name="${itemName.toLowerCase()}" data-product-code="${productCode.toLowerCase()}" data-product-name="${productName.toLowerCase()}" style="background:${bgColor};border-bottom:1px solid #e5e7eb;">
            <td style="padding:10px 8px;color:#1f2937;">${category}</td>
            <td style="padding:10px 8px;color:#64748b;">${itemCode}</td>
            <td style="padding:10px 8px;color:#1f2937;">${itemName}</td>
            <td style="padding:10px 8px;color:#64748b;font-family:monospace;">${productCode}</td>
            <td style="padding:10px 8px;color:#1f2937;">${productName}</td>
            <td style="padding:10px 8px;text-align:right;color:#64748b;">${tagPrice}</td>
            <td style="padding:10px 8px;text-align:right;color:#059669;font-weight:600;">${salePrice}</td>
          </tr>
        `;
      });
      
      html += `
            </tbody>
          </table>
        </div>
        <div id="promotion-result-count" style="margin-top:16px;padding:12px;background:#f8fafc;border-radius:6px;text-align:center;color:#64748b;font-size:12px;">
          ì´ ${filteredData.length}ê°œ ìƒí’ˆ
        </div>
      `;
      
      modalBody.innerHTML = html;
      modal.style.display = 'flex';
      
      // í•„í„° ë° ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      setTimeout(() => {
        // ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼
        const categoryBtns = document.querySelectorAll('.promotion-category-filter-btn');
        let selectedCategory = 'all';
        
        categoryBtns.forEach(btn => {
          btn.addEventListener('click', function() {
            selectedCategory = this.dataset.category;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            categoryBtns.forEach(b => {
              if (b.dataset.category === selectedCategory) {
                b.style.background = '#4f46e5';
                b.style.color = '#fff';
                b.style.border = 'none';
              } else {
                b.style.background = '#fff';
                b.style.color = '#64748b';
                b.style.border = '1px solid #cbd5e1';
              }
            });
            
            // í•„í„° ì ìš©
            applyPromotionFilters();
          });
        });
        
        // ê²€ìƒ‰ ì…ë ¥
        const searchInput = document.getElementById('promotion-detail-search');
        if (searchInput) {
          searchInput.addEventListener('input', function() {
            applyPromotionFilters();
          });
        }
        
        // í•„í„° ì ìš© í•¨ìˆ˜
        function applyPromotionFilters() {
          const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
          const tbody = document.getElementById('promotion-detail-tbody');
          if (!tbody) return;
          
          const rows = tbody.querySelectorAll('tr');
          let visibleCount = 0;
          
          rows.forEach(row => {
            const category = row.dataset.category;
            const itemName = row.dataset.itemName || '';
            const productCode = row.dataset.productCode || '';
            const productName = row.dataset.productName || '';
            
            // ì¹´í…Œê³ ë¦¬ í•„í„° ì²´í¬
            const categoryMatch = selectedCategory === 'all' || category === selectedCategory;
            
            // ê²€ìƒ‰ì–´ ì²´í¬ (ì•„ì´í…œëª…, í’ˆë²ˆ, í’ˆëª…)
            const searchMatch = !searchTerm || 
              itemName.includes(searchTerm) || 
              productCode.includes(searchTerm) || 
              productName.includes(searchTerm);
            
            // ë‘˜ ë‹¤ ë§Œì¡±í•˜ë©´ í‘œì‹œ
            if (categoryMatch && searchMatch) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });
          
          // ê²°ê³¼ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
          const resultCount = document.getElementById('promotion-result-count');
          if (resultCount) {
            resultCount.textContent = `ì´ ${visibleCount}ê°œ ìƒí’ˆ`;
          }
        }
      }, 100);
      
      console.log('[í”„ë¡œëª¨ì…˜ ëª¨ë‹¬] ë Œë”ë§ ì™„ë£Œ');
    };
    
    /**
     * í”„ë¡œëª¨ì…˜ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
     */
    window.closePromotionDetailModal = function() {
      const modal = document.getElementById('promotion-detail-modal');
      if (modal) {
        modal.style.display = 'none';
      }
    };
    
    // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('promotion-detail-modal');
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            window.closePromotionDetailModal();
          }
        });
      }
    });
    
    // ========== ë: í”„ë¡œëª¨ì…˜ ìƒì„¸ ëª¨ë‹¬ í•¨ìˆ˜ ==========
    
    // ê¸°ê°„ ì„ íƒ ë²„íŠ¼
      const periodBtns = document.querySelectorAll('.period-btn');
      periodBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
          periodBtns.forEach(b => {
            b.classList.remove('active');
            b.style.borderColor = '#cbd5e1';
            b.style.background = '#fff';
            b.style.color = '#475569';
          });
          
          this.classList.add('active');
          this.style.borderColor = '#4f46e5';
          this.style.background = '#4f46e5';
          this.style.color = '#fff';
          
          // ê¸°ê°„ ë³€ê²½
          window.currentDrilldownPeriod = this.getAttribute('data-period');
          
          // í…Œì´ë¸” ì¬ë Œë”ë§
          renderDrilldownTable();
        });
      });
      
      // ìƒí’ˆëª… ê²€ìƒ‰
      const searchInput = document.getElementById('product-search');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const tbody = document.getElementById('drilldown-tbody');
          if (!tbody) return;
          
          const rows = tbody.querySelectorAll('tr');
          rows.forEach(row => {
            const productName = row.querySelector('td:nth-child(2)');
            if (productName) {
              const text = productName.textContent.toLowerCase();
              row.style.display = text.includes(searchTerm) ? '' : 'none';
            }
          });
        });
      }
      
      // ì¬ê³ ì£¼ìˆ˜ ê¸°ê°„ ì„ íƒ ë²„íŠ¼
      const stockWeeksPeriodBtns = document.querySelectorAll('.stock-weeks-period-btn');
      stockWeeksPeriodBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
          stockWeeksPeriodBtns.forEach(b => {
            b.classList.remove('active');
            b.style.borderColor = '#cbd5e1';
            b.style.background = '#fff';
            b.style.color = '#475569';
          });
          
          this.classList.add('active');
          this.style.borderColor = '#4f46e5';
          this.style.background = '#4f46e5';
          this.style.color = '#fff';
          
          // ê¸°ê°„ ë³€ê²½
          window.currentStockWeeksPeriod = this.getAttribute('data-period');
          
          // í…Œì´ë¸” ì¬ë Œë”ë§
          renderStockWeeksDrilldownTable();
        });
      });
      
      // ì¬ê³ ì£¼ìˆ˜ ìƒí’ˆëª… ê²€ìƒ‰
      const stockWeeksSearchInput = document.getElementById('stock-weeks-product-search');
      if (stockWeeksSearchInput) {
        stockWeeksSearchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const tbody = document.getElementById('stock-weeks-drilldown-tbody');
          if (!tbody) return;
          
          const rows = tbody.querySelectorAll('tr');
          rows.forEach(row => {
            // ì²« ë²ˆì§¸ í–‰(í•©ê³„)ì€ í•­ìƒ í‘œì‹œ
            if (row.style.fontWeight === '700') {
              row.style.display = '';
              return;
            }
            
            const productCode = row.querySelector('td:nth-child(1)');
            const productName = row.querySelector('td:nth-child(2)');
            if (productCode && productName) {
              const codeText = productCode.textContent.toLowerCase();
              const nameText = productName.textContent.toLowerCase();
              row.style.display = (codeText.includes(searchTerm) || nameText.includes(searchTerm)) ? '' : 'none';
            }
          });
        });
      }
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDashboardDOM);
    } else {
      initDashboardDOM();
    }

    // ============================================================
    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤: Ctrl+Shift+Rë¡œ Snowflake ë°ì´í„° ê°•ì œ ìƒˆë¡œê³ ì¹¨
    // ============================================================
    document.addEventListener('keydown', function(event) {
      // Ctrl+Shift+R ë˜ëŠ” Cmd+Shift+R (Mac)
      if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === 'R') {
        event.preventDefault(); // ë¸Œë¼ìš°ì € ê¸°ë³¸ ìƒˆë¡œê³ ì¹¨ ë°©ì§€
        
        console.log('[í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤] Ctrl+Shift+R ê°ì§€ - Snowflake ë°ì´í„° ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
        
        // ì•Œë¦¼ í‘œì‹œ
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #4CAF50;
          color: white;
          padding: 15px 25px;
          border-radius: 8px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          z-index: 10000;
          font-size: 14px;
          font-weight: 500;
        `;
        notification.textContent = 'ğŸ”„ Snowflake ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...';
        document.body.appendChild(notification);
        
        // Snowflake API ê°•ì œ ìƒˆë¡œê³ ì¹¨
        Promise.all([
          // íŠ¸ë¦¬ë§µ (ë§¤ì¶œêµ¬ì„±)
          loadSalesCompositionData(true),
          // íŒë§¤ìœ¨
          window.loadSalesRateData ? window.loadSalesRateData(true) : Promise.resolve(),
          // ì¬ê³ ì£¼ìˆ˜
          window.loadStockWeeksData ? window.loadStockWeeksData(true) : Promise.resolve(),
          // í• ì¸ë‚´ì—­ (í˜„ì¬ ë¸Œëœë“œ)
          window.currentBrand ? loadDiscountDetailData(window.currentBrand, true) : Promise.resolve()
        ]).then(() => {
          console.log('[í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤] ëª¨ë“  ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
          notification.style.background = '#4CAF50';
          notification.textContent = 'âœ… ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!';
          
          // íŠ¸ë¦¬ë§µ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
          if (window.salesCompositionData) {
            const currentView = document.querySelector('.treemap-view-btn.active')?.dataset.view || 'channel';
            const currentPeriod = document.querySelector('.treemap-period-btn.active')?.dataset.period || 'CY';
            drawTreemap(currentView, currentPeriod);
          }
          
          setTimeout(() => {
            notification.remove();
          }, 3000);
        }).catch(error => {
          console.error('[í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
          notification.style.background = '#f44336';
          notification.textContent = 'âŒ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨';
          setTimeout(() => {
            notification.remove();
          }, 3000);
        });
      }
    });
  
  </script>
</body>
</html>



